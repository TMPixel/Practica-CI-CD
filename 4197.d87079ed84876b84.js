"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4197],{4197:(B,_,a)=>{a.r(_),a.d(_,{HomePageModule:()=>V});var m=a(177),d=a(4341),s=a(1075),p=a(4964),u=a(467),e=a(4438),k=a(2784),h=a(5297),v=a(5265),P=a(9381),b=a(3683);function F(o,r){if(1&o&&(e.j41(0,"ion-avatar"),e.nrm(1,"img",13),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("src",i.form.value.image,e.B4B)}}function U(o,r){1&o&&e.nrm(0,"ion-icon",14)}function y(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"El nombre es requerido"),e.k0s())}function E(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"Ingrese al menos 4 caracteres"),e.k0s())}function $(o,r){if(1&o&&(e.j41(0,"div",15),e.DNE(1,y,2,0,"div",4)(2,E,2,0,"div",4),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.minlength)}}function R(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"El precio es requerido"),e.k0s())}function G(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"El precio m\xednimo debe ser cero"),e.k0s())}function I(o,r){if(1&o&&(e.j41(0,"div",15),e.DNE(1,R,2,0,"div",4)(2,G,2,0,"div",4),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.price.errors?null:i.form.controls.price.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.price.errors?null:i.form.controls.price.errors.min)}}function j(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"Las unidades vendidas es requerido"),e.k0s())}function T(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"El valor m\xednimo debe ser cero"),e.k0s())}function C(o,r){if(1&o&&(e.j41(0,"div",15),e.DNE(1,j,2,0,"div",4)(2,T,2,0,"div",4),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.soldUnits.errors?null:i.form.controls.soldUnits.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.soldUnits.errors?null:i.form.controls.soldUnits.errors.min)}}let A=(()=>{var o;class r{constructor(){this.utils=(0,e.WQX)(v.T),this.user={},this.firebase=(0,e.WQX)(h.f),this.form=new d.gE({id:new d.MJ(""),image:new d.MJ("",[d.k0.required]),name:new d.MJ("",[d.k0.required,d.k0.minLength(3)]),price:new d.MJ(null,[d.k0.required,d.k0.min(0)]),soldUnits:new d.MJ(null,[d.k0.required,d.k0.min(0)])})}ngOnInit(){this.user=this.utils.getFromLocalStorage("user"),this.product&&this.form.setValue(this.product)}takePic(){var t=this;return(0,u.A)(function*(){const n=(yield t.utils.takePic("Imagen del producto")).dataUrl;t.form.controls.image.setValue(n)})()}submit(){this.form.valid&&(this.product?this.updateProduct():this.createProduct())}createProduct(){var t=this;return(0,u.A)(function*(){let n=`users/${t.user.uid}/products`;const c=yield t.utils.loading();yield c.present();let l=t.form.value.image,f=`${t.user.uid}/${Date.now()}`,J=yield t.firebase.uploadImage(f,l);t.form.controls.image.setValue(J),delete t.form.value.id,t.firebase.addDocument(n,t.form.value).then(function(){var g=(0,u.A)(function*(w){t.utils.dismissModal({success:!0}),t.utils.showToast({message:"Producto creado correctamente",duration:2e3,position:"middle",color:"success",icon:"checkmarck-circle-outline"})});return function(w){return g.apply(this,arguments)}}()).catch(g=>{console.log(g),t.utils.showToast({message:"Error al crear el producto",duration:2e3,position:"middle",color:"danger",icon:"close-circle-outline"})}).finally(()=>{c.dismiss()})})()}updateProduct(){var t=this;return(0,u.A)(function*(){let n=`users/${t.user.uid}/products/${t.product.id}`;const c=yield t.utils.loading();yield c.present(),t.firebase.updateDocument(n,t.form.value).then(function(){var l=(0,u.A)(function*(f){t.utils.dismissModal({success:!0}),t.utils.showToast({message:"Producto actualizado correctamente",duration:2e3,position:"middle",color:"success",icon:"checkmarck-circle-outline"})});return function(f){return l.apply(this,arguments)}}()).catch(l=>{console.log(l),t.utils.showToast({message:"Error al actualizar el producto",duration:2e3,position:"middle",color:"danger",icon:"close-circle-outline"})}).finally(()=>{c.dismiss()})})()}}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.VBU({type:o,selectors:[["app-add-update-product"]],inputs:{product:"product"},decls:18,vars:14,consts:[[3,"isModal","title"],[3,"fullscreen"],[1,"d-flex-center"],[1,"auth-form",3,"ngSubmit","keypres.enter","formGroup"],[4,"ngIf"],["class","image-icon","name","image-outline",4,"ngIf"],["mode","ios","size","small","shape","round",3,"click"],["autocomplete","name","type","text","label","Nombre",3,"control"],["class","validators",4,"ngIf"],["type","number","label","Precio",3,"control"],["type","number","label","Unidades Vendidas",3,"control"],["type","submit","mode","ios",1,"ion-margin",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[3,"src"],["name","image-outline",1,"image-icon"],[1,"validators"]],template:function(t,n){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"div",2)(3,"form",3),e.bIt("ngSubmit",function(){return n.submit()})("keypres.enter",function(){return n.submit()}),e.DNE(4,F,2,1,"ion-avatar",4)(5,U,1,0,"ion-icon",5),e.nrm(6,"br"),e.j41(7,"ion-button",6),e.bIt("click",function(){return n.takePic()}),e.EFF(8," Tomar/Seleccionar "),e.k0s(),e.nrm(9,"app-custom-input",7),e.DNE(10,$,3,2,"div",8),e.nrm(11,"app-custom-input",9),e.DNE(12,I,3,2,"div",8),e.nrm(13,"app-custom-input",10),e.DNE(14,C,3,2,"div",8),e.j41(15,"ion-button",11),e.EFF(16),e.nrm(17,"ion-icon",12),e.k0s()()()()),2&t&&(e.Y8G("isModal",!0)("title",n.product?"Actualizar Producto":"Agregar Producto"),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.form.value.image),e.R7$(),e.Y8G("ngIf",!n.form.value.image),e.R7$(4),e.Y8G("control",n.form.controls.name),e.R7$(),e.Y8G("ngIf",n.form.controls.name.errors&&n.form.controls.name.touched),e.R7$(),e.Y8G("control",n.form.controls.price),e.R7$(),e.Y8G("ngIf",n.form.controls.price.errors&&n.form.controls.price.touched),e.R7$(),e.Y8G("control",n.form.controls.soldUnits),e.R7$(),e.Y8G("ngIf",n.form.controls.soldUnits.errors&&n.form.controls.soldUnits.touched),e.R7$(),e.Y8G("disabled",n.form.invalid),e.R7$(),e.SpI(" ",n.product?"Actualizar Producto":"Agregar Producto"," "))},dependencies:[m.bT,s.mC,s.Jm,s.W9,s.iq,d.qT,d.cb,d.j4,P.l,b.H],styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),r})();const Y=()=>["/main/profile"];function M(o,r){if(1&o&&(e.j41(0,"ion-card",9)(1,"div")(2,"h5"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5,"Productos"),e.k0s()(),e.j41(6,"div")(7,"h5"),e.EFF(8),e.nI1(9,"currency"),e.k0s(),e.j41(10,"p"),e.EFF(11,"Ganancias"),e.k0s()()()),2&o){const i=e.XpG();e.R7$(3),e.JRh(i.products.length),e.R7$(5),e.JRh(e.i5U(9,2,i.getProfits(),"USD"))}}function H(o,r){if(1&o){const i=e.RV6();e.j41(0,"ion-item-sliding",11)(1,"ion-item")(2,"ion-avatar",12),e.nrm(3,"img",13),e.k0s(),e.j41(4,"ion-label")(5,"div",14),e.EFF(6),e.k0s(),e.j41(7,"div",15)(8,"strong"),e.EFF(9,"Precio:"),e.k0s(),e.EFF(10),e.nI1(11,"currency"),e.nrm(12,"br"),e.j41(13,"strong"),e.EFF(14,"Unidades Vendidas:"),e.k0s(),e.EFF(15),e.k0s(),e.j41(16,"ion-chip",16)(17,"ion-label"),e.EFF(18),e.nI1(19,"currency"),e.k0s()()()(),e.j41(20,"ion-item-options")(21,"ion-item-option",6),e.bIt("click",function(){const n=e.eBV(i).$implicit,c=e.XpG(2);return e.Njj(c.addUpdateProduct(n))}),e.nrm(22,"ion-icon",17),e.k0s(),e.j41(23,"ion-item-option",18),e.bIt("click",function(){const n=e.eBV(i).$implicit,c=e.XpG(2);return e.Njj(c.confirmDeleteProduct(n))}),e.nrm(24,"ion-icon",19),e.k0s()()()}if(2&o){const i=r.$implicit;e.R7$(3),e.Y8G("src",i.image,e.B4B),e.R7$(3),e.SpI("",i.name," "),e.R7$(4),e.SpI(" ",e.i5U(11,5,i.price,"USD")," "),e.R7$(5),e.SpI(" ",i.soldUnits," "),e.R7$(3),e.SpI("Ganancia: ",e.i5U(19,8,i.price*i.soldUnits,"USD"),"")}}function D(o,r){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,H,25,11,"ion-item-sliding",10),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",i.products)}}function x(o,r){1&o&&(e.j41(0,"div",20),e.nrm(1,"ion-icon",21),e.j41(2,"h3"),e.EFF(3,"No hay productos disponibles"),e.k0s()())}const N=[{path:"",component:(()=>{var o;class r{constructor(){this.loading=!1,this.products=[],this.utils=(0,e.WQX)(v.T),this.firebase=(0,e.WQX)(h.f)}ngOnInit(){}doRefresh(t){setTimeout(()=>{this.getProducts(),t.target.complete()},1e3)}addUpdateProduct(t){var n=this;return(0,u.A)(function*(){(yield n.utils.presentModal({component:A,cssClass:"add-update-modal",componentProps:{product:t}}))&&n.getProducts()})()}user(){return this.utils.getFromLocalStorage("user")}ionViewWillEnter(){this.getProducts()}getProfits(){return this.products.reduce((t,n)=>t+n.price*n.soldUnits,0)}getProducts(){let t=`users/${this.user().uid}/products`;console.log(t),this.loading=!0;let n=[(0,k.My)("soldUnits","desc")],c=this.firebase.getCollectionData(t,n).subscribe({next:l=>{console.log(l),this.products=l,this.loading=!1,c.unsubscribe()}})}confirmDeleteProduct(t){this.utils.presentAlert("Eliminar producto","\xbfEst\xe1s seguro de que quieres eliminar este producto?",[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",handler:()=>{this.deleteProduct(t)}}])}deleteProduct(t){var n=this;return(0,u.A)(function*(){let c=`users/${n.user().uid}/products/${t.id}`;yield n.firebase.deleteDocument(c),yield n.firebase.deleteFile(t.image),n.getProducts()})()}}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.VBU({type:o,selectors:[["app-home"]],decls:12,vars:6,consts:[["title","Inicio",3,"showMenu"],["slot","fixed",3,"ionRefresh"],["mode","ios","color","secondary","class","d-flex-center ion-text-center",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],["type","submit","mode","ios","expand","block","shape","round","routerLinkActive","router-link-active","routerLinkActive","router-link-active",1,"submit",3,"routerLink"],["mode","ios","color","secondary",1,"d-flex-center","ion-text-center"],["class","product-item",4,"ngFor","ngForOf"],[1,"product-item"],["slot","start"],[3,"src"],[1,"name"],[1,"data"],["color","primary","mode","ios","outline","true"],["name","create-outline",1,"option-btn"],["color","danger",3,"click"],["name","trash-outline",1,"option-btn"],[1,"empty"],["name","shield-outline"]],template:function(t,n){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(l){return n.doRefresh(l)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.DNE(4,M,12,5,"ion-card",2)(5,D,2,1,"ion-list",3)(6,x,4,0,"div",4),e.j41(7,"ion-fab",5)(8,"ion-fab-button",6),e.bIt("click",function(){return n.addUpdateProduct()}),e.nrm(9,"ion-icon",7),e.k0s()()(),e.j41(10,"ion-button",8),e.EFF(11," Editar Perfil\n"),e.k0s()),2&t&&(e.Y8G("showMenu",!0),e.R7$(4),e.Y8G("ngIf",!n.loading&&n.products.length),e.R7$(),e.Y8G("ngIf",!n.loading),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.products.length),e.R7$(4),e.Y8G("routerLink",e.lJ4(5,Y)))},dependencies:[m.Sq,m.bT,s.mC,s.Jm,s.b_,s.ZB,s.W9,s.Q8,s.YW,s.iq,s.uz,s.LU,s.CE,s.A7,s.he,s.nf,s.To,s.Ki,s.N7,p.Wk,p.wQ,P.l,m.oe],styles:["ion-card[_ngcontent-%COMP%]{gap:100px;padding:20px 0;border-radius:15px}ion-content[_ngcontent-%COMP%]{--padding-bottom: 70px}"]}),r})()}];let S=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[p.iI.forChild(N),p.iI]}),r})();var X=a(3887);let V=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[m.MD,d.YN,s.bv,S,X.G]}),r})()}}]);