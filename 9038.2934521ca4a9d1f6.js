"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9038],{8407:(Si,Wt,j)=>{j.d(Wt,{$:()=>gr,A:()=>Pe,G:()=>oi,K:()=>Gs,L:()=>as,N:()=>nr,P:()=>pa,R:()=>tu,U:()=>Ke,V:()=>wt,W:()=>qi,X:()=>on,Y:()=>Yu,Z:()=>$e,_:()=>di,a:()=>$t,a0:()=>Go,a1:()=>fs,a2:()=>$o,a3:()=>jr,a4:()=>Ho,a5:()=>Qo,a6:()=>Xu,a7:()=>yr,a8:()=>ys,a9:()=>Jo,aA:()=>Wu,aB:()=>ot,aC:()=>X,aD:()=>Ea,aE:()=>_e,aF:()=>vt,aG:()=>ya,aH:()=>yn,aI:()=>lr,aJ:()=>ft,aN:()=>jt,aQ:()=>On,aa:()=>Ir,ab:()=>zt,ac:()=>ro,ad:()=>Ki,ae:()=>Is,af:()=>Zu,ag:()=>el,ah:()=>Ha,ak:()=>Zo,al:()=>Tr,am:()=>Vt,ap:()=>hs,aq:()=>de,as:()=>Qa,at:()=>ol,au:()=>kt,av:()=>Ls,aw:()=>Fa,ax:()=>Le,ay:()=>hu,az:()=>g,b:()=>Yr,c:()=>gl,d:()=>it,e:()=>au,f:()=>Qi,g:()=>_a,h:()=>Ei,i:()=>aa,j:()=>Ss,k:()=>In,l:()=>fa,m:()=>du,o:()=>ri,p:()=>z,r:()=>ru,s:()=>nu,u:()=>iu});var I=j(467),B=j(7852),w=j(1076),Ie=j(8041),Re=j(1635),ge=j(1362);const z={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Pe={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const oi=function Qt(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},$n=function zn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},jn=new w.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),qe=new Ie.Vy("@firebase/auth");function Ne(c,...o){qe.logLevel<=Ie.$b.ERROR&&qe.error(`Auth (${B.SDK_VERSION}): ${c}`,...o)}function Le(c,...o){throw lt(c,...o)}function ot(c,...o){return lt(c,...o)}function hn(c,o,u){const h=Object.assign(Object.assign({},$n()),{[o]:u});return new w.FA("auth","Firebase",h).create(o,{appName:c.name})}function mt(c){return hn(c,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dn(c,o,u){if(!(o instanceof u))throw u.name!==o.constructor.name&&Le(c,"argument-error"),hn(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lt(c,...o){if("string"!=typeof c){const u=o[0],h=[...o.slice(1)];return h[0]&&(h[0].appName=c.name),c._errorFactory.create(u,...h)}return jn.create(c,...o)}function X(c,o,...u){if(!c)throw lt(o,...u)}function Lt(c){const o="INTERNAL ASSERTION FAILED: "+c;throw Ne(o),new Error(o)}function kt(c,o){c||Lt(o)}function At(){var c;return typeof self<"u"&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function Jt(){return"http:"===Mr()||"https:"===Mr()}function Mr(){var c;return typeof self<"u"&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class hr{constructor(o,u){this.shortDelay=o,this.longDelay=u,kt(u>o,"Short delay should be less than long delay!"),this.isMobile=(0,w.jZ)()||(0,w.lV)()}get(){return function br(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Jt()||(0,w.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function dr(c,o){kt(c.emulator,"Emulator should always be set here");const{url:u}=c.emulator;return o?`${u}${o.startsWith("/")?o.slice(1):o}`:u}class Hn{static initialize(o,u,h){this.fetchImpl=o,u&&(this.headersImpl=u),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void Lt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void Lt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void Lt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const bi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Z=new hr(3e4,6e4);function x(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function F(c,o,u,h){return $.apply(this,arguments)}function $(){return($=(0,I.A)(function*(c,o,u,h,y={}){return H(c,y,(0,I.A)(function*(){let E={},C={};h&&("GET"===o?C=h:E={body:JSON.stringify(h)});const N=(0,w.Am)(Object.assign({key:c.config.apiKey},C)).slice(1),G=yield c._getAdditionalHeaders();return G["Content-Type"]="application/json",c.languageCode&&(G["X-Firebase-Locale"]=c.languageCode),Hn.fetch()(Te(c,c.config.apiHost,u,N),Object.assign({method:o,headers:G,referrerPolicy:"no-referrer"},E))}))})).apply(this,arguments)}function H(c,o,u){return J.apply(this,arguments)}function J(){return(J=(0,I.A)(function*(c,o,u){c._canInitEmulator=!1;const h=Object.assign(Object.assign({},bi),o);try{const y=new Yt(c),E=yield Promise.race([u(),y.promise]);y.clearNetworkTimeout();const C=yield E.json();if("needConfirmation"in C)throw Mt(c,"account-exists-with-different-credential",C);if(E.ok&&!("errorMessage"in C))return C;{const N=E.ok?C.errorMessage:C.error.message,[G,le]=N.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===G)throw Mt(c,"credential-already-in-use",C);if("EMAIL_EXISTS"===G)throw Mt(c,"email-already-in-use",C);if("USER_DISABLED"===G)throw Mt(c,"user-disabled",C);const pe=h[G]||G.toLowerCase().replace(/[_\s]+/g,"-");if(le)throw hn(c,pe,le);Le(c,pe)}}catch(y){if(y instanceof w.g)throw y;Le(c,"network-request-failed",{message:String(y)})}})).apply(this,arguments)}function he(c,o,u,h){return ie.apply(this,arguments)}function ie(){return(ie=(0,I.A)(function*(c,o,u,h,y={}){const E=yield F(c,o,u,h,y);return"mfaPendingCredential"in E&&Le(c,"multi-factor-auth-required",{_serverResponse:E}),E})).apply(this,arguments)}function Te(c,o,u,h){const y=`${o}${u}?${h}`;return c.config.emulator?dr(c.config,y):`${c.config.apiScheme}://${y}`}function Ce(c){switch(c){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Yt{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((u,h)=>{this.timer=setTimeout(()=>h(ot(this.auth,"network-request-failed")),Z.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Mt(c,o,u){const h={appName:c.name};u.email&&(h.email=u.email),u.phoneNumber&&(h.phoneNumber=u.phoneNumber);const y=ot(c,o,h);return y.customData._tokenResponse=u,y}function fr(c){return void 0!==c&&void 0!==c.getResponse}function Cr(c){return void 0!==c&&void 0!==c.enterprise}class xr{constructor(o){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=o.recaptchaEnforcementState}getProviderEnforcementState(o){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const u of this.recaptchaEnforcementState)if(u.provider&&u.provider===o)return Ce(u.enforcementState);return null}isProviderEnabled(o){return"ENFORCE"===this.getProviderEnforcementState(o)||"AUDIT"===this.getProviderEnforcementState(o)}}function Ur(){return(Ur=(0,I.A)(function*(c){return(yield F(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function It(c,o){return Cn.apply(this,arguments)}function Cn(){return(Cn=(0,I.A)(function*(c,o){return F(c,"GET","/v2/recaptchaConfig",x(c,o))})).apply(this,arguments)}function xn(){return(xn=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function Jn(){return(Jn=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function et(c,o){return nt.apply(this,arguments)}function nt(){return(nt=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function fn(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function Zt(){return(Zt=(0,I.A)(function*(c,o=!1){const u=(0,w.Ku)(c),h=yield u.getIdToken(o),y=Yn(h);X(y&&y.exp&&y.auth_time&&y.iat,u.auth,"internal-error");const E="object"==typeof y.firebase?y.firebase:void 0,C=null==E?void 0:E.sign_in_provider;return{claims:y,token:h,authTime:fn(Br(y.auth_time)),issuedAtTime:fn(Br(y.iat)),expirationTime:fn(Br(y.exp)),signInProvider:C||null,signInSecondFactor:(null==E?void 0:E.sign_in_second_factor)||null}})).apply(this,arguments)}function Br(c){return 1e3*Number(c)}function Yn(c){const[o,u,h]=c.split(".");if(void 0===o||void 0===u||void 0===h)return Ne("JWT malformed, contained fewer than 3 sections"),null;try{const y=(0,w.u)(u);return y?JSON.parse(y):(Ne("Failed to decode base64 JWT payload"),null)}catch(y){return Ne("Caught error parsing JWT payload as JSON",null==y?void 0:y.toString()),null}}function pr(c){const o=Yn(c);return X(o,"internal-error"),X(typeof o.exp<"u","internal-error"),X(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}function Qe(c,o){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,I.A)(function*(c,o,u=!1){if(u)return o;try{return yield o}catch(h){throw h instanceof w.g&&function Zn({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}(h)&&c.auth.currentUser===c&&(yield c.auth.signOut()),h}})).apply(this,arguments)}class dt{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var u;if(o){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const y=(null!==(u=this.user.stsTokenManager.expirationTime)&&void 0!==u?u:0)-Date.now()-3e5;return Math.max(0,y)}}schedule(o=!1){var u=this;if(!this.isRunning)return;const h=this.getInterval(o);this.timerId=setTimeout((0,I.A)(function*(){yield u.iteration()}),h)}iteration(){var o=this;return(0,I.A)(function*(){try{yield o.user.getIdToken(!0)}catch(u){return void("auth/network-request-failed"===(null==u?void 0:u.code)&&o.schedule(!0))}o.schedule()})()}}class ve{constructor(o,u){this.createdAt=o,this.lastLoginAt=u,this._initializeTime()}_initializeTime(){this.lastSignInTime=fn(this.lastLoginAt),this.creationTime=fn(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Je(c){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,I.A)(function*(c){var o;const u=c.auth,h=yield c.getIdToken(),y=yield Qe(c,et(u,{idToken:h}));X(null==y?void 0:y.users.length,u,"internal-error");const E=y.users[0];c._notifyReloadListener(E);const C=null!==(o=E.providerUserInfo)&&void 0!==o&&o.length?kn(E.providerUserInfo):[],N=function en(c,o){return[...c.filter(h=>!o.some(y=>y.providerId===h.providerId)),...o]}(c.providerData,C),pe=!!c.isAnonymous&&!(c.email&&E.passwordHash||null!=N&&N.length),Oe={uid:E.localId,displayName:E.displayName||null,photoURL:E.photoUrl||null,email:E.email||null,emailVerified:E.emailVerified||!1,phoneNumber:E.phoneNumber||null,tenantId:E.tenantId||null,providerData:N,metadata:new ve(E.createdAt,E.lastLoginAt),isAnonymous:pe};Object.assign(c,Oe)})).apply(this,arguments)}function Tn(){return(Tn=(0,I.A)(function*(c){const o=(0,w.Ku)(c);yield Je(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function kn(c){return c.map(o=>{var{providerId:u}=o,h=(0,Re.Tt)(o,["providerId"]);return{providerId:u,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function Os(){return(Os=(0,I.A)(function*(c,o){const u=yield H(c,{},(0,I.A)(function*(){const h=(0,w.Am)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:y,apiKey:E}=c.config,C=Te(c,y,"/v1/token",`key=${E}`),N=yield c._getAdditionalHeaders();return N["Content-Type"]="application/x-www-form-urlencoded",Hn.fetch()(C,{method:"POST",headers:N,body:h})}));return{accessToken:u.access_token,expiresIn:u.expires_in,refreshToken:u.refresh_token}})).apply(this,arguments)}function V(){return(V=(0,I.A)(function*(c,o){return F(c,"POST","/v2/accounts:revokeToken",x(c,o))})).apply(this,arguments)}class b{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){X(o.idToken,"internal-error"),X(typeof o.idToken<"u","internal-error"),X(typeof o.refreshToken<"u","internal-error");const u="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):pr(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,u)}updateFromIdToken(o){X(0!==o.length,"internal-error");const u=pr(o);this.updateTokensAndExpiration(o,null,u)}getToken(o,u=!1){var h=this;return(0,I.A)(function*(){return u||!h.accessToken||h.isExpired?(X(h.refreshToken,o,"user-token-expired"),h.refreshToken?(yield h.refresh(o,h.refreshToken),h.accessToken):null):h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,u){var h=this;return(0,I.A)(function*(){const{accessToken:y,refreshToken:E,expiresIn:C}=yield function ui(c,o){return Os.apply(this,arguments)}(o,u);h.updateTokensAndExpiration(y,E,Number(C))})()}updateTokensAndExpiration(o,u,h){this.refreshToken=u||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(o,u){const{refreshToken:h,accessToken:y,expirationTime:E}=u,C=new b;return h&&(X("string"==typeof h,"internal-error",{appName:o}),C.refreshToken=h),y&&(X("string"==typeof y,"internal-error",{appName:o}),C.accessToken=y),E&&(X("number"==typeof E,"internal-error",{appName:o}),C.expirationTime=E),C}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new b,this.toJSON())}_performRefresh(){return Lt("not implemented")}}function P(c,o){X("string"==typeof c||typeof c>"u","internal-error",{appName:o})}class q{constructor(o){var{uid:u,auth:h,stsTokenManager:y}=o,E=(0,Re.Tt)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new dt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=u,this.auth=h,this.stsTokenManager=y,this.accessToken=y.accessToken,this.displayName=E.displayName||null,this.email=E.email||null,this.emailVerified=E.emailVerified||!1,this.phoneNumber=E.phoneNumber||null,this.photoURL=E.photoURL||null,this.isAnonymous=E.isAnonymous||!1,this.tenantId=E.tenantId||null,this.providerData=E.providerData?[...E.providerData]:[],this.metadata=new ve(E.createdAt||void 0,E.lastLoginAt||void 0)}getIdToken(o){var u=this;return(0,I.A)(function*(){const h=yield Qe(u,u.stsTokenManager.getToken(u.auth,o));return X(h,u.auth,"internal-error"),u.accessToken!==h&&(u.accessToken=h,yield u.auth._persistUserIfCurrent(u),u.auth._notifyListenersIfCurrent(u)),h})()}getIdTokenResult(o){return function Dn(c){return Zt.apply(this,arguments)}(this,o)}reload(){return function En(c){return Tn.apply(this,arguments)}(this)}_assign(o){this!==o&&(X(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(u=>Object.assign({},u)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const u=new q(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return u.metadata._copy(this.metadata),u}_onReload(o){X(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,u=!1){var h=this;return(0,I.A)(function*(){let y=!1;o.idToken&&o.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(o),y=!0),u&&(yield Je(h)),yield h.auth._persistUserIfCurrent(h),y&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var o=this;return(0,I.A)(function*(){if((0,B._isFirebaseServerApp)(o.auth.app))return Promise.reject(mt(o.auth));const u=yield o.getIdToken();return yield Qe(o,function Dr(c,o){return xn.apply(this,arguments)}(o.auth,{idToken:u})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,u){var h,y,E,C,N,G,le,pe;const Oe=null!==(h=u.displayName)&&void 0!==h?h:void 0,Pn=null!==(y=u.email)&&void 0!==y?y:void 0,cr=null!==(E=u.phoneNumber)&&void 0!==E?E:void 0,ii=null!==(C=u.photoURL)&&void 0!==C?C:void 0,El=null!==(N=u.tenantId)&&void 0!==N?N:void 0,Pi=null!==(G=u._redirectEventId)&&void 0!==G?G:void 0,Tl=null!==(le=u.createdAt)&&void 0!==le?le:void 0,Ds=null!==(pe=u.lastLoginAt)&&void 0!==pe?pe:void 0,{uid:mu,emailVerified:Al,isAnonymous:_o,providerData:wl,stsTokenManager:hc}=u;X(mu&&hc,o,"internal-error");const Et=b.fromJSON(this.name,hc);X("string"==typeof mu,o,"internal-error"),P(Oe,o.name),P(Pn,o.name),X("boolean"==typeof Al,o,"internal-error"),X("boolean"==typeof _o,o,"internal-error"),P(cr,o.name),P(ii,o.name),P(El,o.name),P(Pi,o.name),P(Tl,o.name),P(Ds,o.name);const yo=new q({uid:mu,auth:o,email:Pn,emailVerified:Al,displayName:Oe,isAnonymous:_o,photoURL:ii,phoneNumber:cr,tenantId:El,stsTokenManager:Et,createdAt:Tl,lastLoginAt:Ds});return wl&&Array.isArray(wl)&&(yo.providerData=wl.map(gu=>Object.assign({},gu))),Pi&&(yo._redirectEventId=Pi),yo}static _fromIdTokenResponse(o,u,h=!1){return(0,I.A)(function*(){const y=new b;y.updateFromServerResponse(u);const E=new q({uid:u.localId,auth:o,stsTokenManager:y,isAnonymous:h});return yield Je(E),E})()}static _fromGetAccountInfoResponse(o,u,h){return(0,I.A)(function*(){const y=u.users[0];X(void 0!==y.localId,"internal-error");const E=void 0!==y.providerUserInfo?kn(y.providerUserInfo):[],C=!(y.email&&y.passwordHash||null!=E&&E.length),N=new b;N.updateFromIdToken(h);const G=new q({uid:y.localId,auth:o,stsTokenManager:N,isAnonymous:C}),le={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:E,metadata:new ve(y.createdAt,y.lastLoginAt),isAnonymous:!(y.email&&y.passwordHash||null!=E&&E.length)};return Object.assign(G,le),G})()}}const oe=new Map;function _e(c){kt(c instanceof Function,"Expected a class definition");let o=oe.get(c);return o?(kt(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,oe.set(c,o),o)}const Ke=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.A)(function*(){return!0})()}_set(u,h){var y=this;return(0,I.A)(function*(){y.storage[u]=h})()}_get(u){var h=this;return(0,I.A)(function*(){const y=h.storage[u];return void 0===y?null:y})()}_remove(u){var h=this;return(0,I.A)(function*(){delete h.storage[u]})()}_addListener(u,h){}_removeListener(u,h){}}return c.type="NONE",c})();function vt(c,o,u){return`firebase:${c}:${o}:${u}`}class Gt{constructor(o,u,h){this.persistence=o,this.auth=u,this.userKey=h;const{config:y,name:E}=this.auth;this.fullUserKey=vt(this.userKey,y.apiKey,E),this.fullPersistenceKey=vt("persistence",y.apiKey,E),this.boundEventHandler=u._onStorageEvent.bind(u),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.A)(function*(){const u=yield o.persistence._get(o.fullUserKey);return u?q._fromJSON(o.auth,u):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var u=this;return(0,I.A)(function*(){if(u.persistence===o)return;const h=yield u.getCurrentUser();return yield u.removeCurrentUser(),u.persistence=o,h?u.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,u,h="authUser"){return(0,I.A)(function*(){if(!u.length)return new Gt(_e(Ke),o,h);const y=(yield Promise.all(u.map(function(){var le=(0,I.A)(function*(pe){if(yield pe._isAvailable())return pe});return function(pe){return le.apply(this,arguments)}}()))).filter(le=>le);let E=y[0]||_e(Ke);const C=vt(h,o.config.apiKey,o.name);let N=null;for(const le of u)try{const pe=yield le._get(C);if(pe){const Oe=q._fromJSON(o,pe);le!==E&&(N=Oe),E=le;break}}catch{}const G=y.filter(le=>le._shouldAllowMigration);return E._shouldAllowMigration&&G.length?(E=G[0],N&&(yield E._set(C,N.toJSON())),yield Promise.all(u.map(function(){var le=(0,I.A)(function*(pe){if(pe!==E)try{yield pe._remove(C)}catch{}});return function(pe){return le.apply(this,arguments)}}())),new Gt(E,o,h)):new Gt(E,o,h)})()}}function tn(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Ci(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(Fe(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(qu(o))return"Blackberry";if(xi(o))return"Webos";if(Nn(o))return"Safari";if((o.includes("chrome/")||ns(o))&&!o.includes("edge/"))return"Chrome";if(Fa(o))return"Android";{const h=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==h?void 0:h.length))return h[1]}return"Other"}function Fe(c=(0,w.ZQ)()){return/firefox\//i.test(c)}function Nn(c=(0,w.ZQ)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function ns(c=(0,w.ZQ)()){return/crios\//i.test(c)}function Ci(c=(0,w.ZQ)()){return/iemobile/i.test(c)}function Fa(c=(0,w.ZQ)()){return/android/i.test(c)}function qu(c=(0,w.ZQ)()){return/blackberry/i.test(c)}function xi(c=(0,w.ZQ)()){return/webos/i.test(c)}function Ls(c=(0,w.ZQ)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function Wu(c=(0,w.ZQ)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}function Ms(c=(0,w.ZQ)()){return Ls(c)||Fa(c)||xi(c)||qu(c)||/windows phone/i.test(c)||Ci(c)}function is(c,o=[]){let u;switch(c){case"Browser":u=tn((0,w.ZQ)());break;case"Worker":u=`${tn((0,w.ZQ)())}-${c}`;break;default:u=c}const h=o.length?o.join(","):"FirebaseCore-web";return`${u}/JsCore/${B.SDK_VERSION}/${h}`}class Ku{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,u){const h=E=>new Promise((C,N)=>{try{C(o(E))}catch(G){N(G)}});h.onAbort=u,this.queue.push(h);const y=this.queue.length-1;return()=>{this.queue[y]=()=>Promise.resolve()}}runMiddleware(o){var u=this;return(0,I.A)(function*(){if(u.auth.currentUser===o)return;const h=[];try{for(const y of u.queue)yield y(o),y.onAbort&&h.push(y.onAbort)}catch(y){h.reverse();for(const E of h)try{E()}catch{}throw u.auth._errorFactory.create("login-blocked",{originalMessage:null==y?void 0:y.message})}})()}}function xo(){return(xo=(0,I.A)(function*(c,o={}){return F(c,"GET","/v2/passwordPolicy",x(c,o))})).apply(this,arguments)}class Do{constructor(o){var u,h,y,E;const C=o.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(u=C.minPasswordLength)&&void 0!==u?u:6,C.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=C.maxPasswordLength),void 0!==C.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=C.containsLowercaseCharacter),void 0!==C.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=C.containsUppercaseCharacter),void 0!==C.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=C.containsNumericCharacter),void 0!==C.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=C.containsNonAlphanumericCharacter),this.enforcementState=o.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(y=null===(h=o.allowedNonAlphanumericCharacters)||void 0===h?void 0:h.join(""))&&void 0!==y?y:"",this.forceUpgradeOnSignin=null!==(E=o.forceUpgradeOnSignin)&&void 0!==E&&E,this.schemaVersion=o.schemaVersion}validatePassword(o){var u,h,y,E,C,N;const G={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(o,G),this.validatePasswordCharacterOptions(o,G),G.isValid&&(G.isValid=null===(u=G.meetsMinPasswordLength)||void 0===u||u),G.isValid&&(G.isValid=null===(h=G.meetsMaxPasswordLength)||void 0===h||h),G.isValid&&(G.isValid=null===(y=G.containsLowercaseLetter)||void 0===y||y),G.isValid&&(G.isValid=null===(E=G.containsUppercaseLetter)||void 0===E||E),G.isValid&&(G.isValid=null===(C=G.containsNumericCharacter)||void 0===C||C),G.isValid&&(G.isValid=null===(N=G.containsNonAlphanumericCharacter)||void 0===N||N),G}validatePasswordLengthOptions(o,u){const h=this.customStrengthOptions.minPasswordLength,y=this.customStrengthOptions.maxPasswordLength;h&&(u.meetsMinPasswordLength=o.length>=h),y&&(u.meetsMaxPasswordLength=o.length<=y)}validatePasswordCharacterOptions(o,u){let h;this.updatePasswordCharacterOptionsStatuses(u,!1,!1,!1,!1);for(let y=0;y<o.length;y++)h=o.charAt(y),this.updatePasswordCharacterOptionsStatuses(u,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(o,u,h,y,E){this.customStrengthOptions.containsLowercaseLetter&&(o.containsLowercaseLetter||(o.containsLowercaseLetter=u)),this.customStrengthOptions.containsUppercaseLetter&&(o.containsUppercaseLetter||(o.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(o.containsNumericCharacter||(o.containsNumericCharacter=y)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(o.containsNonAlphanumericCharacter||(o.containsNonAlphanumericCharacter=E))}}class zu{constructor(o,u,h,y){this.app=o,this.heartbeatServiceProvider=u,this.appCheckServiceProvider=h,this.config=y,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ua(this),this.idTokenSubscription=new Ua(this),this.beforeStateQueue=new Ku(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=y.sdkClientVersion}_initializeWithPersistence(o,u){var h=this;return u&&(this._popupRedirectResolver=_e(u)),this._initializationPromise=this.queue((0,I.A)(function*(){var y,E;if(!h._deleted&&(h.persistenceManager=yield Gt.create(h,o),!h._deleted)){if(null!==(y=h._popupRedirectResolver)&&void 0!==y&&y._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch{}yield h.initializeCurrentUser(u),h.lastNotifiedUid=(null===(E=h.currentUser)||void 0===E?void 0:E.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.A)(function*(){if(o._deleted)return;const u=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||u){if(o.currentUser&&u&&o.currentUser.uid===u.uid)return o._currentUser._assign(u),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(u,!0)}})()}initializeCurrentUserFromIdToken(o){var u=this;return(0,I.A)(function*(){try{const h=yield et(u,{idToken:o}),y=yield q._fromGetAccountInfoResponse(u,h,o);yield u.directlySetCurrentUser(y)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),yield u.directlySetCurrentUser(null)}})()}initializeCurrentUser(o){var u=this;return(0,I.A)(function*(){var h;if((0,B._isFirebaseServerApp)(u.app)){const N=u.app.settings.authIdToken;return N?new Promise(G=>{setTimeout(()=>u.initializeCurrentUserFromIdToken(N).then(G,G))}):u.directlySetCurrentUser(null)}const y=yield u.assertedPersistence.getCurrentUser();let E=y,C=!1;if(o&&u.config.authDomain){yield u.getOrInitRedirectPersistenceManager();const N=null===(h=u.redirectUser)||void 0===h?void 0:h._redirectEventId,G=null==E?void 0:E._redirectEventId,le=yield u.tryRedirectSignIn(o);(!N||N===G)&&null!=le&&le.user&&(E=le.user,C=!0)}if(!E)return u.directlySetCurrentUser(null);if(!E._redirectEventId){if(C)try{yield u.beforeStateQueue.runMiddleware(E)}catch(N){E=y,u._popupRedirectResolver._overrideRedirectResult(u,()=>Promise.reject(N))}return E?u.reloadAndSetCurrentUserOrClear(E):u.directlySetCurrentUser(null)}return X(u._popupRedirectResolver,u,"argument-error"),yield u.getOrInitRedirectPersistenceManager(),u.redirectUser&&u.redirectUser._redirectEventId===E._redirectEventId?u.directlySetCurrentUser(E):u.reloadAndSetCurrentUserOrClear(E)})()}tryRedirectSignIn(o){var u=this;return(0,I.A)(function*(){let h=null;try{h=yield u._popupRedirectResolver._completeRedirectFn(u,o,!0)}catch{yield u._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(o){var u=this;return(0,I.A)(function*(){try{yield Je(o)}catch(h){if("auth/network-request-failed"!==(null==h?void 0:h.code))return u.directlySetCurrentUser(null)}return u.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function bn(){if(typeof navigator>"u")return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,I.A)(function*(){o._deleted=!0})()}updateCurrentUser(o){var u=this;return(0,I.A)(function*(){if((0,B._isFirebaseServerApp)(u.app))return Promise.reject(mt(u));const h=o?(0,w.Ku)(o):null;return h&&X(h.auth.config.apiKey===u.config.apiKey,u,"invalid-user-token"),u._updateCurrentUser(h&&h._clone(u))})()}_updateCurrentUser(o,u=!1){var h=this;return(0,I.A)(function*(){if(!h._deleted)return o&&X(h.tenantId===o.tenantId,h,"tenant-id-mismatch"),u||(yield h.beforeStateQueue.runMiddleware(o)),h.queue((0,I.A)(function*(){yield h.directlySetCurrentUser(o),h.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.A)(function*(){return(0,B._isFirebaseServerApp)(o.app)?Promise.reject(mt(o)):(yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0))})()}setPersistence(o){var u=this;return(0,B._isFirebaseServerApp)(this.app)?Promise.reject(mt(this)):this.queue((0,I.A)(function*(){yield u.assertedPersistence.setPersistence(_e(o))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(o){var u=this;return(0,I.A)(function*(){u._getPasswordPolicyInternal()||(yield u._updatePasswordPolicy());const h=u._getPasswordPolicyInternal();return h.schemaVersion!==u.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(u._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(o)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var o=this;return(0,I.A)(function*(){const u=yield function pn(c){return xo.apply(this,arguments)}(o),h=new Do(u);null===o.tenantId?o._projectPasswordPolicy=h:o._tenantPasswordPolicies[o.tenantId]=h})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new w.FA("auth","Firebase",o())}onAuthStateChanged(o,u,h){return this.registerStateListener(this.authStateSubscription,o,u,h)}beforeAuthStateChanged(o,u){return this.beforeStateQueue.pushCallback(o,u)}onIdTokenChanged(o,u,h){return this.registerStateListener(this.idTokenSubscription,o,u,h)}authStateReady(){return new Promise((o,u)=>{if(this.currentUser)o();else{const h=this.onAuthStateChanged(()=>{h(),o()},u)}})}revokeAccessToken(o){var u=this;return(0,I.A)(function*(){if(u.currentUser){const h=yield u.currentUser.getIdToken(),y={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:o,idToken:h};null!=u.tenantId&&(y.tenantId=u.tenantId),yield function Co(c,o){return V.apply(this,arguments)}(u,y)}})()}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,u){var h=this;return(0,I.A)(function*(){const y=yield h.getOrInitRedirectPersistenceManager(u);return null===o?y.removeCurrentUser():y.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var u=this;return(0,I.A)(function*(){if(!u.redirectPersistenceManager){const h=o&&_e(o)||u._popupRedirectResolver;X(h,u,"argument-error"),u.redirectPersistenceManager=yield Gt.create(u,[_e(h._redirectPersistence)],"redirectUser"),u.redirectUser=yield u.redirectPersistenceManager.getCurrentUser()}return u.redirectPersistenceManager})()}_redirectUserForId(o){var u=this;return(0,I.A)(function*(){var h,y;return u._isInitialized&&(yield u.queue((0,I.A)(function*(){}))),(null===(h=u._currentUser)||void 0===h?void 0:h._redirectEventId)===o?u._currentUser:(null===(y=u.redirectUser)||void 0===y?void 0:y._redirectEventId)===o?u.redirectUser:null})()}_persistUserIfCurrent(o){var u=this;return(0,I.A)(function*(){if(o===u.currentUser)return u.queue((0,I.A)(function*(){return u.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,u;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(u=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==u?u:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,u,h,y){if(this._deleted)return()=>{};const E="function"==typeof u?u:u.next.bind(u);let C=!1;const N=this._isInitialized?Promise.resolve():this._initializationPromise;if(X(N,this,"internal-error"),N.then(()=>{C||E(this.currentUser)}),"function"==typeof u){const G=o.addObserver(u,h,y);return()=>{C=!0,G()}}{const G=o.addObserver(u);return()=>{C=!0,G()}}}directlySetCurrentUser(o){var u=this;return(0,I.A)(function*(){u.currentUser&&u.currentUser!==o&&u._currentUser._stopProactiveRefresh(),o&&u.isProactiveRefreshEnabled&&o._startProactiveRefresh(),u.currentUser=o,o?yield u.assertedPersistence.setCurrentUser(o):yield u.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return X(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=is(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.A)(function*(){var u;const h={"X-Client-Version":o.clientVersion};o.app.options.appId&&(h["X-Firebase-gmpid"]=o.app.options.appId);const y=yield null===(u=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getHeartbeatsHeader();y&&(h["X-Firebase-Client"]=y);const E=yield o._getAppCheckToken();return E&&(h["X-Firebase-AppCheck"]=E),h})()}_getAppCheckToken(){var o=this;return(0,I.A)(function*(){var u;const h=yield null===(u=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getToken();return null!=h&&h.error&&function Ze(c,...o){qe.logLevel<=Ie.$b.WARN&&qe.warn(`Auth (${B.SDK_VERSION}): ${c}`,...o)}(`Error while retrieving App Check token: ${h.error}`),null==h?void 0:h.token})()}}function ft(c){return(0,w.Ku)(c)}class Ua{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,w.tD)(u=>this.observer=u)}get next(){return X(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ki={loadJS:()=>(0,I.A)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Bs(c){return ki.loadJS(c)}function er(c){return`__${c}${Math.floor(1e6*Math.random())}`}class Wa{constructor(o){this.type="recaptcha-enterprise",this.auth=ft(o)}verify(o="verify",u=!1){var h=this;return(0,I.A)(function*(){function E(){return E=(0,I.A)(function*(N){if(!u){if(null==N.tenantId&&null!=N._agentRecaptchaConfig)return N._agentRecaptchaConfig.siteKey;if(null!=N.tenantId&&void 0!==N._tenantRecaptchaConfigs[N.tenantId])return N._tenantRecaptchaConfigs[N.tenantId].siteKey}return new Promise(function(){var G=(0,I.A)(function*(le,pe){It(N,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(Oe=>{if(void 0!==Oe.recaptchaKey){const Pn=new xr(Oe);return null==N.tenantId?N._agentRecaptchaConfig=Pn:N._tenantRecaptchaConfigs[N.tenantId]=Pn,le(Pn.siteKey)}pe(new Error("recaptcha Enterprise site key undefined"))}).catch(Oe=>{pe(Oe)})});return function(le,pe){return G.apply(this,arguments)}}())}),E.apply(this,arguments)}function C(N,G,le){const pe=window.grecaptcha;Cr(pe)?pe.enterprise.ready(()=>{pe.enterprise.execute(N,{action:o}).then(Oe=>{G(Oe)}).catch(()=>{G("NO_RECAPTCHA")})}):le(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((N,G)=>{(function y(N){return E.apply(this,arguments)})(h.auth).then(le=>{if(!u&&Cr(window.grecaptcha))C(le,N,G);else{if(typeof window>"u")return void G(new Error("RecaptchaVerifier is only supported in browser"));let pe=function qa(){return ki.recaptchaEnterpriseScript}();0!==pe.length&&(pe+=le),Bs(pe).then(()=>{C(le,N,G)}).catch(Oe=>{G(Oe)})}}).catch(le=>{G(le)})})})()}}function No(c,o,u){return qs.apply(this,arguments)}function qs(){return(qs=(0,I.A)(function*(c,o,u,h=!1){const y=new Wa(c);let E;try{E=yield y.verify(u)}catch{E=yield y.verify(u,!0)}const C=Object.assign({},o);return Object.assign(C,h?{captchaResp:E}:{captchaResponse:E}),Object.assign(C,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(C,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),C})).apply(this,arguments)}function ss(c,o,u,h){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,I.A)(function*(c,o,u,h){var y;if(null!==(y=c._getRecaptchaConfig())&&void 0!==y&&y.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const E=yield No(c,o,u,"getOobCode"===u);return h(c,E)}return h(c,o).catch(function(){var E=(0,I.A)(function*(C){if("auth/missing-recaptcha-token"===C.code){console.log(`${u} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const N=yield No(c,o,u,"getOobCode"===u);return h(c,N)}return Promise.reject(C)});return function(C){return E.apply(this,arguments)}}())}),Vo.apply(this,arguments)}function Gs(c,o,u){const h=ft(c);X(h._canInitEmulator,h,"emulator-config-failed"),X(/^https?:\/\//.test(o),h,"invalid-emulator-scheme");const y=!(null==u||!u.disableWarnings),E=os(o),{host:C,port:N}=function Ni(c){const o=os(c),u=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!u)return{host:"",port:null};const h=u[2].split("@").pop()||"",y=/^(\[[^\]]+\])(:|$)/.exec(h);if(y){const E=y[1];return{host:E,port:Oo(h.substr(E.length+1))}}{const[E,C]=h.split(":");return{host:E,port:Oo(C)}}}(o);h.config.emulator={url:`${E}//${C}${null===N?"":`:${N}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:C,port:N,protocol:E.replace(":",""),options:Object.freeze({disableWarnings:y})}),y||function Ql(){function c(){const o=document.createElement("p"),u=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",u.position="fixed",u.width="100%",u.backgroundColor="#ffffff",u.border=".1em solid #000000",u.color="#b50000",u.bottom="0px",u.left="0px",u.margin="0px",u.zIndex="10000",u.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}function os(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function Oo(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class as{constructor(o,u){this.providerId=o,this.signInMethod=u}toJSON(){return Lt("not implemented")}_getIdTokenResponse(o){return Lt("not implemented")}_linkToIdToken(o,u){return Lt("not implemented")}_getReauthenticationResolver(o){return Lt("not implemented")}}function Lo(c,o){return Mo.apply(this,arguments)}function Mo(){return(Mo=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:resetPassword",x(c,o))})).apply(this,arguments)}function qr(){return(qr=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Wr(c,o){return Vi.apply(this,arguments)}function Vi(){return(Vi=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:signUp",o)})).apply(this,arguments)}function Uo(){return(Uo=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:update",x(c,o))})).apply(this,arguments)}function pt(c,o){return us.apply(this,arguments)}function us(){return(us=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithPassword",x(c,o))})).apply(this,arguments)}function li(c,o){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:sendOobCode",x(c,o))})).apply(this,arguments)}function Ks(){return(Ks=(0,I.A)(function*(c,o){return li(c,o)})).apply(this,arguments)}function Xl(c,o){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,I.A)(function*(c,o){return li(c,o)})).apply(this,arguments)}function Zl(c,o){return zs.apply(this,arguments)}function zs(){return(zs=(0,I.A)(function*(c,o){return li(c,o)})).apply(this,arguments)}function tr(){return(tr=(0,I.A)(function*(c,o){return li(c,o)})).apply(this,arguments)}function Li(){return(Li=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithEmailLink",x(c,o))})).apply(this,arguments)}function kr(){return(kr=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithEmailLink",x(c,o))})).apply(this,arguments)}class Q extends as{constructor(o,u,h,y=null){super("password",h),this._email=o,this._password=u,this._tenantId=y}static _fromEmailAndPassword(o,u){return new Q(o,u,"password")}static _fromEmailAndCode(o,u,h=null){return new Q(o,u,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o;if(null!=u&&u.email&&null!=u&&u.password){if("password"===u.signInMethod)return this._fromEmailAndPassword(u.email,u.password);if("emailLink"===u.signInMethod)return this._fromEmailAndCode(u.email,u.password,u.tenantId)}return null}_getIdTokenResponse(o){var u=this;return(0,I.A)(function*(){switch(u.signInMethod){case"password":return ss(o,{returnSecureToken:!0,email:u._email,password:u._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",pt);case"emailLink":return function $s(c,o){return Li.apply(this,arguments)}(o,{email:u._email,oobCode:u._password});default:Le(o,"internal-error")}})()}_linkToIdToken(o,u){var h=this;return(0,I.A)(function*(){switch(h.signInMethod){case"password":return ss(o,{idToken:u,returnSecureToken:!0,email:h._email,password:h._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Wr);case"emailLink":return function za(c,o){return kr.apply(this,arguments)}(o,{idToken:u,email:h._email,oobCode:h._password});default:Le(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function gt(c,o){return Mi.apply(this,arguments)}function Mi(){return(Mi=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithIdp",x(c,o))})).apply(this,arguments)}class nr extends as{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const u=new nr(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(u.idToken=o.idToken),o.accessToken&&(u.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(u.nonce=o.nonce),o.pendingToken&&(u.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(u.accessToken=o.oauthToken,u.secret=o.oauthTokenSecret):Le("argument-error"),u}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:y}=u,E=(0,Re.Tt)(u,["providerId","signInMethod"]);if(!h||!y)return null;const C=new nr(h,y);return C.idToken=E.idToken||void 0,C.accessToken=E.accessToken||void 0,C.secret=E.secret,C.nonce=E.nonce,C.pendingToken=E.pendingToken||null,C}_getIdTokenResponse(o){return gt(o,this.buildRequest())}_linkToIdToken(o,u){const h=this.buildRequest();return h.idToken=u,gt(o,h)}_getReauthenticationResolver(o){const u=this.buildRequest();return u.autoCreate=!1,gt(o,u)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const u={};this.idToken&&(u.id_token=this.idToken),this.accessToken&&(u.access_token=this.accessToken),this.secret&&(u.oauth_token_secret=this.secret),u.providerId=this.providerId,this.nonce&&!this.pendingToken&&(u.nonce=this.nonce),o.postBody=(0,w.Am)(u)}return o}}function Fi(){return(Fi=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:sendVerificationCode",x(c,o))})).apply(this,arguments)}function Gr(){return(Gr=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithPhoneNumber",x(c,o))})).apply(this,arguments)}function Bo(){return(Bo=(0,I.A)(function*(c,o){const u=yield he(c,"POST","/v1/accounts:signInWithPhoneNumber",x(c,o));if(u.temporaryProof)throw Mt(c,"account-exists-with-different-credential",u);return u})).apply(this,arguments)}const Ju={USER_NOT_FOUND:"user-not-found"};function Ui(){return(Ui=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithPhoneNumber",x(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Ju)})).apply(this,arguments)}class mr extends as{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,u){return new mr({verificationId:o,verificationCode:u})}static _fromTokenResponse(o,u){return new mr({phoneNumber:o,temporaryProof:u})}_getIdTokenResponse(o){return function Hs(c,o){return Gr.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,u){return function Qs(c,o){return Bo.apply(this,arguments)}(o,Object.assign({idToken:u},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function $a(c,o){return Ui.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:u,verificationId:h,verificationCode:y}=this.params;return o&&u?{temporaryProof:o,phoneNumber:u}:{sessionInfo:h,code:y}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:u,verificationCode:h,phoneNumber:y,temporaryProof:E}=o;return h||u||y||E?new mr({verificationId:u,verificationCode:h,phoneNumber:y,temporaryProof:E}):null}}class An{constructor(o){var u,h,y,E,C,N;const G=(0,w.I9)((0,w.hp)(o)),le=null!==(u=G.apiKey)&&void 0!==u?u:null,pe=null!==(h=G.oobCode)&&void 0!==h?h:null,Oe=function Bi(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(y=G.mode)&&void 0!==y?y:null);X(le&&pe&&Oe,"argument-error"),this.apiKey=le,this.operation=Oe,this.code=pe,this.continueUrl=null!==(E=G.continueUrl)&&void 0!==E?E:null,this.languageCode=null!==(C=G.languageCode)&&void 0!==C?C:null,this.tenantId=null!==(N=G.tenantId)&&void 0!==N?N:null}static parseLink(o){const u=function ls(c){const o=(0,w.I9)((0,w.hp)(c)).link,u=o?(0,w.I9)((0,w.hp)(o)).deep_link_id:null,h=(0,w.I9)((0,w.hp)(c)).deep_link_id;return(h?(0,w.I9)((0,w.hp)(h)).link:null)||h||u||o||c}(o);try{return new An(u)}catch{return null}}}let wt=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(u,h){return Q._fromEmailAndPassword(u,h)}static credentialWithLink(u,h){const y=An.parseLink(h);return X(y,"argument-error"),Q._fromEmailAndCode(u,y.code,y.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class mn{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class hi extends mn{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class $e extends hi{static credentialFromJSON(o){const u="string"==typeof o?JSON.parse(o):o;return X("providerId"in u&&"signInMethod"in u,"argument-error"),nr._fromParams(u)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return X(o.idToken||o.accessToken,"argument-error"),nr._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return $e.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return $e.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:u,oauthAccessToken:h,oauthTokenSecret:y,pendingToken:E,nonce:C,providerId:N}=o;if(!h&&!y&&!u&&!E||!N)return null;try{return new $e(N)._credential({idToken:u,accessToken:h,nonce:C,pendingToken:E})}catch{return null}}}let qi=(()=>{class c extends hi{constructor(){super("facebook.com")}static credential(u){return nr._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return c.credential(u.oauthAccessToken)}catch{return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),on=(()=>{class c extends hi{constructor(){super("google.com"),this.addScope("profile")}static credential(u,h){return nr._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:u,accessToken:h})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthIdToken:h,oauthAccessToken:y}=u;if(!h&&!y)return null;try{return c.credential(h,y)}catch{return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),Yu=(()=>{class c extends hi{constructor(){super("github.com")}static credential(u){return nr._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return c.credential(u.oauthAccessToken)}catch{return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class On extends as{constructor(o,u){super(o,o),this.pendingToken=u}_getIdTokenResponse(o){return gt(o,this.buildRequest())}_linkToIdToken(o,u){const h=this.buildRequest();return h.idToken=u,gt(o,h)}_getReauthenticationResolver(o){const u=this.buildRequest();return u.autoCreate=!1,gt(o,u)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:y,pendingToken:E}=u;return h&&y&&E&&h===y?new On(h,E):null}static _create(o,u){return new On(o,u)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class di extends mn{constructor(o){X(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return di.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return di.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const u=On.fromJSON(o);return X(u,"argument-error"),u}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:u,providerId:h}=o;if(!u||!h)return null;try{return On._create(h,u)}catch{return null}}}let gr=(()=>{class c extends hi{constructor(){super("twitter.com")}static credential(u,h){return nr._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:u,oauthTokenSecret:h})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthAccessToken:h,oauthTokenSecret:y}=u;if(!h||!y)return null;try{return c.credential(h,y)}catch{return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function Wo(c,o){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signUp",x(c,o))})).apply(this,arguments)}class wn{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,u,h,y=!1){return(0,I.A)(function*(){const E=yield q._fromIdTokenResponse(o,h,y),C=ja(h);return new wn({user:E,providerId:C,_tokenResponse:h,operationType:u})})()}static _forOperation(o,u,h){return(0,I.A)(function*(){yield o._updateTokensIfNecessary(h,!0);const y=ja(h);return new wn({user:o,providerId:y,_tokenResponse:h,operationType:u})})()}}function ja(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function Go(c){return cs.apply(this,arguments)}function cs(){return(cs=(0,I.A)(function*(c){var o;if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const u=ft(c);if(yield u._initializationPromise,null!==(o=u.currentUser)&&void 0!==o&&o.isAnonymous)return new wn({user:u.currentUser,providerId:null,operationType:"signIn"});const h=yield Wo(u,{returnSecureToken:!0}),y=yield wn._fromIdTokenResponse(u,"signIn",h,!0);return yield u._updateCurrentUser(y.user),y})).apply(this,arguments)}class _r extends w.g{constructor(o,u,h,y){var E;super(u.code,u.message),this.operationType=h,this.user=y,Object.setPrototypeOf(this,_r.prototype),this.customData={appName:o.name,tenantId:null!==(E=o.tenantId)&&void 0!==E?E:void 0,_serverResponse:u.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(o,u,h,y){return new _r(o,u,h,y)}}function Js(c,o,u,h){return("reauthenticate"===o?u._getReauthenticationResolver(c):u._getIdTokenResponse(c)).catch(E=>{throw"auth/multi-factor-auth-required"===E.code?_r._fromErrorAndOperation(c,E,o,h):E})}function fi(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function hs(c,o){return Ys.apply(this,arguments)}function Ys(){return Ys=(0,I.A)(function*(c,o){const u=(0,w.Ku)(c);yield Wi(!0,u,o);const{providerUserInfo:h}=yield function Qn(c,o){return Jn.apply(this,arguments)}(u.auth,{idToken:yield u.getIdToken(),deleteProvider:[o]}),y=fi(h||[]);return u.providerData=u.providerData.filter(E=>y.has(E.providerId)),y.has("phone")||(u.phoneNumber=null),yield u.auth._persistUserIfCurrent(u),u}),Ys.apply(this,arguments)}function zr(c,o){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,I.A)(function*(c,o,u=!1){const h=yield Qe(c,o._linkToIdToken(c.auth,yield c.getIdToken()),u);return wn._forOperation(c,"link",h)})).apply(this,arguments)}function Wi(c,o,u){return $r.apply(this,arguments)}function $r(){return($r=(0,I.A)(function*(c,o,u){yield Je(o);const y=!1===c?"provider-already-linked":"no-such-provider";X(fi(o.providerData).has(u)===c,o.auth,y)})).apply(this,arguments)}function zo(c,o){return Xs.apply(this,arguments)}function Xs(){return(Xs=(0,I.A)(function*(c,o,u=!1){const{auth:h}=c;if((0,B._isFirebaseServerApp)(h.app))return Promise.reject(mt(h));const y="reauthenticate";try{const E=yield Qe(c,Js(h,y,o,c),u);X(E.idToken,h,"internal-error");const C=Yn(E.idToken);X(C,h,"internal-error");const{sub:N}=C;return X(c.uid===N,h,"user-mismatch"),wn._forOperation(c,y,E)}catch(E){throw"auth/user-not-found"===(null==E?void 0:E.code)&&Le(h,"user-mismatch"),E}})).apply(this,arguments)}function Zs(c,o){return ds.apply(this,arguments)}function ds(){return(ds=(0,I.A)(function*(c,o,u=!1){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const h="signIn",y=yield Js(c,h,o),E=yield wn._fromIdTokenResponse(c,h,y);return u||(yield c._updateCurrentUser(E.user)),E})).apply(this,arguments)}function fs(c,o){return pi.apply(this,arguments)}function pi(){return(pi=(0,I.A)(function*(c,o){return Zs(ft(c),o)})).apply(this,arguments)}function $o(c,o){return jo.apply(this,arguments)}function jo(){return(jo=(0,I.A)(function*(c,o){const u=(0,w.Ku)(c);return yield Wi(!1,u,o.providerId),zr(u,o)})).apply(this,arguments)}function jr(c,o){return eo.apply(this,arguments)}function eo(){return(eo=(0,I.A)(function*(c,o){return zo((0,w.Ku)(c),o)})).apply(this,arguments)}function ps(){return(ps=(0,I.A)(function*(c,o){return he(c,"POST","/v1/accounts:signInWithCustomToken",x(c,o))})).apply(this,arguments)}function Ho(c,o){return Gi.apply(this,arguments)}function Gi(){return Gi=(0,I.A)(function*(c,o){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const u=ft(c),h=yield function mi(c,o){return ps.apply(this,arguments)}(u,{token:o,returnSecureToken:!0}),y=yield wn._fromIdTokenResponse(u,"signIn",h);return yield u._updateCurrentUser(y.user),y}),Gi.apply(this,arguments)}class Kt{constructor(o,u){this.factorId=o,this.uid=u.mfaEnrollmentId,this.enrollmentTime=new Date(u.enrolledAt).toUTCString(),this.displayName=u.displayName}static _fromServerResponse(o,u){return"phoneInfo"in u?to._fromServerResponse(o,u):"totpInfo"in u?at._fromServerResponse(o,u):Le(o,"internal-error")}}class to extends Kt{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,u){return new to(u)}}class at extends Kt{constructor(o){super("totp",o)}static _fromServerResponse(o,u){return new at(u)}}function We(c,o,u){var h;X((null===(h=u.url)||void 0===h?void 0:h.length)>0,c,"invalid-continue-uri"),X(typeof u.dynamicLinkDomain>"u"||u.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=u.url,o.dynamicLinkDomain=u.dynamicLinkDomain,o.canHandleCodeInApp=u.handleCodeInApp,u.iOS&&(X(u.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=u.iOS.bundleId),u.android&&(X(u.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=u.android.installApp,o.androidMinimumVersionCode=u.android.minimumVersion,o.androidPackageName=u.android.packageName)}function ms(c){return an.apply(this,arguments)}function an(){return(an=(0,I.A)(function*(c){const o=ft(c);o._getPasswordPolicyInternal()&&(yield o._updatePasswordPolicy())})).apply(this,arguments)}function Qo(c,o,u){return ze.apply(this,arguments)}function ze(){return(ze=(0,I.A)(function*(c,o,u){const h=ft(c),y={requestType:"PASSWORD_RESET",email:o,clientType:"CLIENT_TYPE_WEB"};u&&We(h,y,u),yield ss(h,y,"getOobCode",Xl)})).apply(this,arguments)}function Xu(c,o,u){return gs.apply(this,arguments)}function gs(){return gs=(0,I.A)(function*(c,o,u){yield Lo((0,w.Ku)(c),{oobCode:o,newPassword:u}).catch(function(){var h=(0,I.A)(function*(y){throw"auth/password-does-not-meet-requirements"===y.code&&ms(c),y});return function(y){return h.apply(this,arguments)}}())}),gs.apply(this,arguments)}function yr(c,o){return _s.apply(this,arguments)}function _s(){return _s=(0,I.A)(function*(c,o){yield function Fo(c,o){return Uo.apply(this,arguments)}((0,w.Ku)(c),{oobCode:o})}),_s.apply(this,arguments)}function ys(c,o){return Hr.apply(this,arguments)}function Hr(){return(Hr=(0,I.A)(function*(c,o){const u=(0,w.Ku)(c),h=yield Lo(u,{oobCode:o}),y=h.requestType;switch(X(y,u,"internal-error"),y){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":X(h.newEmail,u,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":X(h.mfaInfo,u,"internal-error");default:X(h.email,u,"internal-error")}let E=null;return h.mfaInfo&&(E=Kt._fromServerResponse(ft(u),h.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.newEmail:h.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.email:h.newEmail)||null,multiFactorInfo:E},operation:y}})).apply(this,arguments)}function Jo(c,o){return no.apply(this,arguments)}function no(){return(no=(0,I.A)(function*(c,o){const{data:u}=yield ys((0,w.Ku)(c),o);return u.email})).apply(this,arguments)}function Ir(c,o,u){return gn.apply(this,arguments)}function gn(){return(gn=(0,I.A)(function*(c,o,u){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const h=ft(c),C=yield ss(h,{returnSecureToken:!0,email:o,password:u,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Wo).catch(G=>{throw"auth/password-does-not-meet-requirements"===G.code&&ms(c),G}),N=yield wn._fromIdTokenResponse(h,"signIn",C);return yield h._updateCurrentUser(N.user),N})).apply(this,arguments)}function zt(c,o,u){return(0,B._isFirebaseServerApp)(c.app)?Promise.reject(mt(c)):fs((0,w.Ku)(c),wt.credential(o,u)).catch(function(){var h=(0,I.A)(function*(y){throw"auth/password-does-not-meet-requirements"===y.code&&ms(c),y});return function(y){return h.apply(this,arguments)}}())}function ro(c,o,u){return rr.apply(this,arguments)}function rr(){return(rr=(0,I.A)(function*(c,o,u){const h=ft(c),y={requestType:"EMAIL_SIGNIN",email:o,clientType:"CLIENT_TYPE_WEB"};(function E(C,N){X(N.handleCodeInApp,h,"argument-error"),N&&We(h,C,N)})(y,u),yield ss(h,y,"getOobCode",Zl)})).apply(this,arguments)}function Ki(c,o){const u=An.parseLink(o);return"EMAIL_SIGNIN"===(null==u?void 0:u.operation)}function Is(c,o,u){return Qr.apply(this,arguments)}function Qr(){return(Qr=(0,I.A)(function*(c,o,u){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const h=(0,w.Ku)(c),y=wt.credentialWithLink(o,u||At());return X(y._tenantId===(h.tenantId||null),h,"tenant-id-mismatch"),fs(h,y)})).apply(this,arguments)}function Ut(){return(Ut=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:createAuthUri",x(c,o))})).apply(this,arguments)}function Zu(c,o){return vs.apply(this,arguments)}function vs(){return vs=(0,I.A)(function*(c,o){const h={identifier:o,continueUri:Jt()?At():"http://localhost"},{signinMethods:y}=yield function vr(c,o){return Ut.apply(this,arguments)}((0,w.Ku)(c),h);return y||[]}),vs.apply(this,arguments)}function el(c,o){return Yo.apply(this,arguments)}function Yo(){return Yo=(0,I.A)(function*(c,o){const u=(0,w.Ku)(c),y={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&We(u.auth,y,o);const{email:E}=yield function Yl(c,o){return Ks.apply(this,arguments)}(u.auth,y);E!==c.email&&(yield c.reload())}),Yo.apply(this,arguments)}function Ha(c,o,u){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c),E={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};u&&We(h.auth,E,u);const{email:C}=yield function ci(c,o){return tr.apply(this,arguments)}(h.auth,E);C!==c.email&&(yield c.reload())}),Xo.apply(this,arguments)}function io(){return(io=(0,I.A)(function*(c,o){return F(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Zo(c,o){return Er.apply(this,arguments)}function Er(){return Er=(0,I.A)(function*(c,{displayName:o,photoURL:u}){if(void 0===o&&void 0===u)return;const h=(0,w.Ku)(c),E={idToken:yield h.getIdToken(),displayName:o,photoUrl:u,returnSecureToken:!0},C=yield Qe(h,function gi(c,o){return io.apply(this,arguments)}(h.auth,E));h.displayName=C.displayName||null,h.photoURL=C.photoUrl||null;const N=h.providerData.find(({providerId:G})=>"password"===G);N&&(N.displayName=h.displayName,N.photoURL=h.photoURL),yield h._updateTokensIfNecessary(C)}),Er.apply(this,arguments)}function Tr(c,o){const u=(0,w.Ku)(c);return(0,B._isFirebaseServerApp)(u.auth.app)?Promise.reject(mt(u.auth)):Mn(u,o,null)}function Vt(c,o){return Mn((0,w.Ku)(c),null,o)}function Mn(c,o,u){return ir.apply(this,arguments)}function ir(){return ir=(0,I.A)(function*(c,o,u){const{auth:h}=c,E={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(E.email=o),u&&(E.password=u);const C=yield Qe(c,function Jl(c,o){return qr.apply(this,arguments)}(h,E));yield c._updateTokensIfNecessary(C,!0)}),ir.apply(this,arguments)}class Nr{constructor(o,u,h={}){this.isNewUser=o,this.providerId=u,this.profile=h}}class K extends Nr{constructor(o,u,h,y){super(o,u,h),this.username=y}}class Rt extends Nr{constructor(o,u){super(o,"facebook.com",u)}}class _n extends K{constructor(o,u){super(o,"github.com",u,"string"==typeof(null==u?void 0:u.login)?null==u?void 0:u.login:null)}}class ea extends Nr{constructor(o,u){super(o,"google.com",u)}}class ue extends K{constructor(o,u,h){super(o,"twitter.com",u,h)}}function de(c){const{user:o,_tokenResponse:u}=c;return o.isAnonymous&&!u?{providerId:null,isNewUser:!1,profile:null}:function zi(c){var o,u;if(!c)return null;const{providerId:h}=c,y=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},E=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!h&&null!=c&&c.idToken){const C=null===(u=null===(o=Yn(c.idToken))||void 0===o?void 0:o.firebase)||void 0===u?void 0:u.sign_in_provider;if(C)return new Nr(E,"anonymous"!==C&&"custom"!==C?C:null)}if(!h)return null;switch(h){case"facebook.com":return new Rt(E,y);case"github.com":return new _n(E,y);case"google.com":return new ea(E,y);case"twitter.com":return new ue(E,y,c.screenName||null);case"custom":case"anonymous":return new Nr(E,null);default:return new Nr(E,h,y)}}(u)}class un{constructor(o,u,h){this.type=o,this.credential=u,this.user=h}static _fromIdtoken(o,u){return new un("enroll",o,u)}static _fromMfaPendingCredential(o){return new un("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var u,h;if(null!=o&&o.multiFactorSession){if(null!==(u=o.multiFactorSession)&&void 0!==u&&u.pendingCredential)return un._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(h=o.multiFactorSession)&&void 0!==h&&h.idToken)return un._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Es{constructor(o,u,h){this.session=o,this.hints=u,this.signInResolver=h}static _fromError(o,u){const h=ft(o),y=u.customData._serverResponse,E=(y.mfaInfo||[]).map(N=>Kt._fromServerResponse(h,N));X(y.mfaPendingCredential,h,"internal-error");const C=un._fromMfaPendingCredential(y.mfaPendingCredential);return new Es(C,E,function(){var N=(0,I.A)(function*(G){const le=yield G._process(h,C);delete y.mfaInfo,delete y.mfaPendingCredential;const pe=Object.assign(Object.assign({},y),{idToken:le.idToken,refreshToken:le.refreshToken});switch(u.operationType){case"signIn":const Oe=yield wn._fromIdTokenResponse(h,u.operationType,pe);return yield h._updateCurrentUser(Oe.user),Oe;case"reauthenticate":return X(u.user,h,"internal-error"),wn._forOperation(u.user,u.operationType,pe);default:Le(h,"internal-error")}});return function(G){return N.apply(this,arguments)}}())}resolveSignIn(o){var u=this;return(0,I.A)(function*(){return u.signInResolver(o)})()}}function Qa(c,o){var u;const h=(0,w.Ku)(c),y=o;return X(o.customData.operationType,h,"argument-error"),X(null===(u=y.customData._serverResponse)||void 0===u?void 0:u.mfaPendingCredential,h,"argument-error"),Es._fromError(h,y)}class yi{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(u=>{u.mfaInfo&&(this.enrolledFactors=u.mfaInfo.map(h=>Kt._fromServerResponse(o.auth,h)))})}static _fromUser(o){return new yi(o)}getSession(){var o=this;return(0,I.A)(function*(){return un._fromIdtoken(yield o.user.getIdToken(),o.user)})()}enroll(o,u){var h=this;return(0,I.A)(function*(){const y=o,E=yield h.getSession(),C=yield Qe(h.user,y._process(h.user.auth,E,u));return yield h.user._updateTokensIfNecessary(C),h.user.reload()})()}unenroll(o){var u=this;return(0,I.A)(function*(){const h="string"==typeof o?o:o.uid,y=yield u.user.getIdToken();try{const E=yield Qe(u.user,function ce(c,o){return F(c,"POST","/v2/accounts/mfaEnrollment:withdraw",x(c,o))}(u.user.auth,{idToken:y,mfaEnrollmentId:h}));u.enrolledFactors=u.enrolledFactors.filter(({uid:C})=>C!==h),yield u.user._updateTokensIfNecessary(E),yield u.user.reload()}catch(E){throw E}})()}}const Se=new WeakMap;function ol(c){const o=(0,w.Ku)(c);return Se.has(o)||Se.set(o,yi._fromUser(o)),Se.get(o)}const tt="__sak";class ee{constructor(o,u){this.storageRetriever=o,this.type=u}_isAvailable(){try{return this.storage?(this.storage.setItem(tt,"1"),this.storage.removeItem(tt),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,u){return this.storage.setItem(o,JSON.stringify(u)),Promise.resolve()}_get(o){const u=this.storage.getItem(o);return Promise.resolve(u?JSON.parse(u):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Yr=(()=>{class c extends ee{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(u,h)=>this.onStorageEvent(u,h),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function $i(){const c=(0,w.ZQ)();return Nn(c)||Ls(c)}()&&function rs(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Ms(),this._shouldAllowMigration=!0}forAllChangedKeys(u){for(const h of Object.keys(this.listeners)){const y=this.storage.getItem(h),E=this.localCache[h];y!==E&&u(h,E,y)}}onStorageEvent(u,h=!1){if(!u.key)return void this.forAllChangedKeys((N,G,le)=>{this.notifyListeners(N,le)});const y=u.key;if(h?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const N=this.storage.getItem(y);if(u.newValue!==N)null!==u.newValue?this.storage.setItem(y,u.newValue):this.storage.removeItem(y);else if(this.localCache[y]===u.newValue&&!h)return}const E=()=>{const N=this.storage.getItem(y);!h&&this.localCache[y]===N||this.notifyListeners(y,N)},C=this.storage.getItem(y);!function Gu(){return(0,w.lT)()&&10===document.documentMode}()||C===u.newValue||u.newValue===u.oldValue?E():setTimeout(E,10)}notifyListeners(u,h){this.localCache[u]=h;const y=this.listeners[u];if(y)for(const E of Array.from(y))E(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((u,h,y)=>{this.onStorageEvent(new StorageEvent("storage",{key:u,oldValue:h,newValue:y}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(u,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[u]||(this.listeners[u]=new Set,this.localCache[u]=this.storage.getItem(u)),this.listeners[u].add(h)}_removeListener(u,h){this.listeners[u]&&(this.listeners[u].delete(h),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(u,h){var y=()=>super._set,E=this;return(0,I.A)(function*(){yield y().call(E,u,h),E.localCache[u]=JSON.stringify(h)})()}_get(u){var h=()=>super._get,y=this;return(0,I.A)(function*(){const E=yield h().call(y,u);return y.localCache[u]=JSON.stringify(E),E})()}_remove(u){var h=()=>super._remove,y=this;return(0,I.A)(function*(){yield h().call(y,u),delete y.localCache[u]})()}}return c.type="LOCAL",c})(),$t=(()=>{class c extends ee{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(u,h){}_removeListener(u,h){}}return c.type="SESSION",c})();let As=(()=>{class c{constructor(u){this.eventTarget=u,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(u){const h=this.receivers.find(E=>E.isListeningto(u));if(h)return h;const y=new c(u);return this.receivers.push(y),y}isListeningto(u){return this.eventTarget===u}handleEvent(u){var h=this;return(0,I.A)(function*(){const y=u,{eventId:E,eventType:C,data:N}=y.data,G=h.handlersMap[C];if(null==G||!G.size)return;y.ports[0].postMessage({status:"ack",eventId:E,eventType:C});const le=Array.from(G).map(function(){var Oe=(0,I.A)(function*(Pn){return Pn(y.origin,N)});return function(Pn){return Oe.apply(this,arguments)}}()),pe=yield function sr(c){return Promise.all(c.map(function(){var o=(0,I.A)(function*(u){try{return{fulfilled:!0,value:yield u}}catch(h){return{fulfilled:!1,reason:h}}});return function(u){return o.apply(this,arguments)}}()))}(le);y.ports[0].postMessage({status:"done",eventId:E,eventType:C,response:pe})})()}_subscribe(u,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[u]||(this.handlersMap[u]=new Set),this.handlersMap[u].add(h)}_unsubscribe(u,h){this.handlersMap[u]&&h&&this.handlersMap[u].delete(h),(!h||0===this.handlersMap[u].size)&&delete this.handlersMap[u],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function jt(c="",o=10){let u="";for(let h=0;h<o;h++)u+=Math.floor(10*Math.random());return c+u}class na{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,u,h=50){var y=this;return(0,I.A)(function*(){const E=typeof MessageChannel<"u"?new MessageChannel:null;if(!E)throw new Error("connection_unavailable");let C,N;return new Promise((G,le)=>{const pe=jt("",20);E.port1.start();const Oe=setTimeout(()=>{le(new Error("unsupported_event"))},h);N={messageChannel:E,onMessage(Pn){const cr=Pn;if(cr.data.eventId===pe)switch(cr.data.status){case"ack":clearTimeout(Oe),C=setTimeout(()=>{le(new Error("timeout"))},3e3);break;case"done":clearTimeout(C),G(cr.data.response);break;default:clearTimeout(Oe),clearTimeout(C),le(new Error("invalid_response"))}}},y.handlers.add(N),E.port1.addEventListener("message",N.onMessage),y.target.postMessage({eventType:o,eventId:pe,data:u},[E.port2])}).finally(()=>{N&&y.removeMessageHandler(N)})})()}}function ut(){return window}function or(){return typeof ut().WorkerGlobalScope<"u"&&"function"==typeof ut().importScripts}function D(){return(D=(0,I.A)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const ia="firebaseLocalStorageDb",Vr="firebaseLocalStorage",wr="fbase_key";class Xr{constructor(o){this.request=o}toPromise(){return new Promise((o,u)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{u(this.request.error)})})}}function Fn(c,o){return c.transaction([Vr],o?"readwrite":"readonly").objectStore(Vr)}function ws(){const c=indexedDB.open(ia,1);return new Promise((o,u)=>{c.addEventListener("error",()=>{u(c.error)}),c.addEventListener("upgradeneeded",()=>{const h=c.result;try{h.createObjectStore(Vr,{keyPath:wr})}catch(y){u(y)}}),c.addEventListener("success",(0,I.A)(function*(){const h=c.result;h.objectStoreNames.contains(Vr)?o(h):(h.close(),yield function Ja(){const c=indexedDB.deleteDatabase(ia);return new Xr(c).toPromise()}(),o(yield ws()))}))})}function sa(c,o,u){return oa.apply(this,arguments)}function oa(){return(oa=(0,I.A)(function*(c,o,u){const h=Fn(c,!0).put({[wr]:o,value:u});return new Xr(h).toPromise()})).apply(this,arguments)}function St(){return(St=(0,I.A)(function*(c,o){const u=Fn(c,!1).get(o),h=yield new Xr(u).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function Zr(c,o){const u=Fn(c,!0).delete(o);return new Xr(u).toPromise()}const aa=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var u=this;return(0,I.A)(function*(){return u.db||(u.db=yield ws()),u.db})()}_withRetries(u){var h=this;return(0,I.A)(function*(){let y=0;for(;;)try{const E=yield h._openDb();return yield u(E)}catch(E){if(y++>3)throw E;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var u=this;return(0,I.A)(function*(){return or()?u.initializeReceiver():u.initializeSender()})()}initializeReceiver(){var u=this;return(0,I.A)(function*(){u.receiver=As._getInstance(function Ar(){return or()?self:null}()),u.receiver._subscribe("keyChanged",function(){var h=(0,I.A)(function*(y,E){return{keyProcessed:(yield u._poll()).includes(E.key)}});return function(y,E){return h.apply(this,arguments)}}()),u.receiver._subscribe("ping",function(){var h=(0,I.A)(function*(y,E){return["keyChanged"]});return function(y,E){return h.apply(this,arguments)}}())})()}initializeSender(){var u=this;return(0,I.A)(function*(){var h,y;if(u.activeServiceWorker=yield function ra(){return D.apply(this,arguments)}(),!u.activeServiceWorker)return;u.sender=new na(u.activeServiceWorker);const E=yield u.sender._send("ping",{},800);E&&null!==(h=E[0])&&void 0!==h&&h.fulfilled&&null!==(y=E[0])&&void 0!==y&&y.value.includes("keyChanged")&&(u.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(u){var h=this;return(0,I.A)(function*(){if(h.sender&&h.activeServiceWorker&&function oo(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:u},h.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,I.A)(function*(){try{if(!indexedDB)return!1;const u=yield ws();return yield sa(u,tt,"1"),yield Zr(u,tt),!0}catch{}return!1})()}_withPendingWrite(u){var h=this;return(0,I.A)(function*(){h.pendingWrites++;try{yield u()}finally{h.pendingWrites--}})()}_set(u,h){var y=this;return(0,I.A)(function*(){return y._withPendingWrite((0,I.A)(function*(){return yield y._withRetries(E=>sa(E,u,h)),y.localCache[u]=h,y.notifyServiceWorker(u)}))})()}_get(u){var h=this;return(0,I.A)(function*(){const y=yield h._withRetries(E=>function Rn(c,o){return St.apply(this,arguments)}(E,u));return h.localCache[u]=y,y})()}_remove(u){var h=this;return(0,I.A)(function*(){return h._withPendingWrite((0,I.A)(function*(){return yield h._withRetries(y=>Zr(y,u)),delete h.localCache[u],h.notifyServiceWorker(u)}))})()}_poll(){var u=this;return(0,I.A)(function*(){const h=yield u._withRetries(C=>{const N=Fn(C,!1).getAll();return new Xr(N).toPromise()});if(!h)return[];if(0!==u.pendingWrites)return[];const y=[],E=new Set;if(0!==h.length)for(const{fbase_key:C,value:N}of h)E.add(C),JSON.stringify(u.localCache[C])!==JSON.stringify(N)&&(u.notifyListeners(C,N),y.push(C));for(const C of Object.keys(u.localCache))u.localCache[C]&&!E.has(C)&&(u.notifyListeners(C,null),y.push(C));return y})()}notifyListeners(u,h){this.localCache[u]=h;const y=this.listeners[u];if(y)for(const E of Array.from(y))E(h)}startPolling(){var u=this;this.stopPolling(),this.pollTimer=setInterval((0,I.A)(function*(){return u._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(u,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[u]||(this.listeners[u]=new Set,this._get(u)),this.listeners[u].add(h)}_removeListener(u,h){this.listeners[u]&&(this.listeners[u].delete(h),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})(),uo=1e12;class Za{constructor(o){this.auth=o,this.counter=uo,this._widgets=new Map}render(o,u){const h=this.counter;return this._widgets.set(h,new Ii(o,this.auth.name,u||{})),this.counter++,h}reset(o){var u;const h=o||uo;null===(u=this._widgets.get(h))||void 0===u||u.delete(),this._widgets.delete(h)}getResponse(o){var u;return(null===(u=this._widgets.get(o||uo))||void 0===u?void 0:u.getResponse())||""}execute(o){var u=this;return(0,I.A)(function*(){var h;return null===(h=u._widgets.get(o||uo))||void 0===h||h.execute(),""})()}}class Ii{constructor(o,u,h){this.params=h,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const y="string"==typeof o?document.getElementById(o):o;X(y,"argument-error",{appName:u}),this.container=y,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function hl(c){const o=[],u="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<c;h++)o.push(u.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":u}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,u)try{u()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const ua=er("rcb"),eu=new hr(3e4,6e4);class dl{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=ut().grecaptcha)||void 0===o||!o.render)}load(o,u=""){return X(function fl(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(u),o,"argument-error"),this.shouldResolveImmediately(u)&&fr(ut().grecaptcha)?Promise.resolve(ut().grecaptcha):new Promise((h,y)=>{const E=ut().setTimeout(()=>{y(ot(o,"network-request-failed"))},eu.get());ut()[ua]=()=>{ut().clearTimeout(E),delete ut()[ua];const N=ut().grecaptcha;if(!N||!fr(N))return void y(ot(o,"internal-error"));const G=N.render;N.render=(le,pe)=>{const Oe=G(le,pe);return this.counter++,Oe},this.hostLanguage=u,h(N)},Bs(`${function Ba(){return ki.recaptchaV2Script}()}?${(0,w.Am)({onload:ua,render:"explicit",hl:u})}`).catch(()=>{clearTimeout(E),y(ot(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var u;return!(null===(u=ut().grecaptcha)||void 0===u||!u.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class pl{load(o){return(0,I.A)(function*(){return new Za(o)})()}clearedOneInstance(){}}const la="recaptcha",ca={theme:"light",type:"image"};class tu{constructor(o,u,h=Object.assign({},ca)){this.parameters=h,this.type=la,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ft(o),this.isInvisible="invisible"===this.parameters.size,X(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const y="string"==typeof u?document.getElementById(u):u;X(y,this.auth,"argument-error"),this.container=y,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new pl:new dl,this.validateStartingState()}verify(){var o=this;return(0,I.A)(function*(){o.assertNotDestroyed();const u=yield o.render(),h=o.getAssertedRecaptcha();return h.getResponse(u)||new Promise(E=>{const C=N=>{N&&(o.tokenChangeListeners.delete(C),E(N))};o.tokenChangeListeners.add(C),o.isInvisible&&h.execute(u)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){X(!this.parameters.sitekey,this.auth,"argument-error"),X(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),X(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return u=>{if(this.tokenChangeListeners.forEach(h=>h(u)),"function"==typeof o)o(u);else if("string"==typeof o){const h=ut()[o];"function"==typeof h&&h(u)}}}assertNotDestroyed(){X(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.A)(function*(){if(yield o.init(),!o.widgetId){let u=o.container;if(!o.isInvisible){const h=document.createElement("div");u.appendChild(h),u=h}o.widgetId=o.getAssertedRecaptcha().render(u,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.A)(function*(){X(Jt()&&!or(),o.auth,"internal-error"),yield function ml(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const u=yield function Fr(c){return Ur.apply(this,arguments)}(o.auth);X(u,o.auth,"internal-error"),o.parameters.sitekey=u})()}getAssertedRecaptcha(){return X(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ha{constructor(o,u){this.verificationId=o,this.onConfirmation=u}confirm(o){const u=mr._fromVerification(this.verificationId,o);return this.onConfirmation(u)}}function nu(c,o,u){return da.apply(this,arguments)}function da(){return(da=(0,I.A)(function*(c,o,u){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const h=ft(c),y=yield Hi(h,o,(0,w.Ku)(u));return new ha(y,E=>fs(h,E))})).apply(this,arguments)}function fa(c,o,u){return lo.apply(this,arguments)}function lo(){return(lo=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c);yield Wi(!1,h,"phone");const y=yield Hi(h.auth,o,(0,w.Ku)(u));return new ha(y,E=>$o(h,E))})).apply(this,arguments)}function ru(c,o,u){return co.apply(this,arguments)}function co(){return(co=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c);if((0,B._isFirebaseServerApp)(h.auth.app))return Promise.reject(mt(h.auth));const y=yield Hi(h.auth,o,(0,w.Ku)(u));return new ha(y,E=>jr(h,E))})).apply(this,arguments)}function Hi(c,o,u){return Ct.apply(this,arguments)}function Ct(){return Ct=(0,I.A)(function*(c,o,u){var h;const y=yield u.verify();try{let E;if(X("string"==typeof y,c,"argument-error"),X(u.type===la,c,"argument-error"),E="string"==typeof o?{phoneNumber:o}:o,"session"in E){const C=E.session;if("phoneNumber"in E)return X("enroll"===C.type,c,"internal-error"),(yield function Ee(c,o){return F(c,"POST","/v2/accounts/mfaEnrollment:start",x(c,o))}(c,{idToken:C.credential,phoneEnrollmentInfo:{phoneNumber:E.phoneNumber,recaptchaToken:y}})).phoneSessionInfo.sessionInfo;{X("signin"===C.type,c,"internal-error");const N=(null===(h=E.multiFactorHint)||void 0===h?void 0:h.uid)||E.multiFactorUid;return X(N,c,"missing-multi-factor-info"),(yield function Rr(c,o){return F(c,"POST","/v2/accounts/mfaSignIn:start",x(c,o))}(c,{mfaPendingCredential:C.credential,mfaEnrollmentId:N,phoneSignInInfo:{recaptchaToken:y}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:C}=yield function js(c,o){return Fi.apply(this,arguments)}(c,{phoneNumber:E.phoneNumber,recaptchaToken:y});return C}}finally{u._reset()}}),Ct.apply(this,arguments)}function iu(c,o){return Bn.apply(this,arguments)}function Bn(){return(Bn=(0,I.A)(function*(c,o){const u=(0,w.Ku)(c);if((0,B._isFirebaseServerApp)(u.auth.app))return Promise.reject(mt(u.auth));yield zr(u,o)})).apply(this,arguments)}let pa=(()=>{class c{constructor(u){this.providerId=c.PROVIDER_ID,this.auth=ft(u)}verifyPhoneNumber(u,h){return Hi(this.auth,u,(0,w.Ku)(h))}static credential(u,h){return mr._fromVerification(u,h)}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{phoneNumber:h,temporaryProof:y}=u;return h&&y?mr._fromTokenResponse(h,y):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function Ue(c,o){return o?_e(o):(X(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class vi extends as{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return gt(o,this._buildIdpRequest())}_linkToIdToken(o,u){return gt(o,this._buildIdpRequest(u))}_getReauthenticationResolver(o){return gt(o,this._buildIdpRequest())}_buildIdpRequest(o){const u={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(u.idToken=o),u}}function nn(c){return Zs(c.auth,new vi(c),c.bypassAuthState)}function rt(c){const{auth:o,user:u}=c;return X(u,o,"internal-error"),zo(u,new vi(c),c.bypassAuthState)}function su(c){return ei.apply(this,arguments)}function ei(){return(ei=(0,I.A)(function*(c){const{auth:o,user:u}=c;return X(u,o,"internal-error"),zr(u,new vi(c),c.bypassAuthState)})).apply(this,arguments)}class ln{constructor(o,u,h,y,E=!1){this.auth=o,this.resolver=h,this.user=y,this.bypassAuthState=E,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(u)?u:[u]}execute(){var o=this;return new Promise(function(){var u=(0,I.A)(function*(h,y){o.pendingPromise={resolve:h,reject:y};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(E){o.reject(E)}});return function(h,y){return u.apply(this,arguments)}}())}onAuthEvent(o){var u=this;return(0,I.A)(function*(){const{urlResponse:h,sessionId:y,postBody:E,tenantId:C,error:N,type:G}=o;if(N)return void u.reject(N);const le={auth:u.auth,requestUri:h,sessionId:y,tenantId:C||void 0,postBody:E||void 0,user:u.user,bypassAuthState:u.bypassAuthState};try{u.resolve(yield u.getIdpTask(G)(le))}catch(pe){u.reject(pe)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return nn;case"linkViaPopup":case"linkViaRedirect":return su;case"reauthViaPopup":case"reauthViaRedirect":return rt;default:Le(this.auth,"internal-error")}}resolve(o){kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ou=new hr(2e3,1e4);function gl(c,o,u){return xt.apply(this,arguments)}function xt(){return(xt=(0,I.A)(function*(c,o,u){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(ot(c,"operation-not-supported-in-this-environment"));const h=ft(c);dn(c,o,mn);const y=Ue(h,u);return new Or(h,"signInViaPopup",o,y).executeNotNull()})).apply(this,arguments)}function au(c,o,u){return qn.apply(this,arguments)}function qn(){return(qn=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c);if((0,B._isFirebaseServerApp)(h.auth.app))return Promise.reject(ot(h.auth,"operation-not-supported-in-this-environment"));dn(h.auth,o,mn);const y=Ue(h.auth,u);return new Or(h.auth,"reauthViaPopup",o,y,h).executeNotNull()})).apply(this,arguments)}function it(c,o,u){return ar.apply(this,arguments)}function ar(){return(ar=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c);dn(h.auth,o,mn);const y=Ue(h.auth,u);return new Or(h.auth,"linkViaPopup",o,y,h).executeNotNull()})).apply(this,arguments)}let Or=(()=>{class c extends ln{constructor(u,h,y,E,C){super(u,h,E,C),this.provider=y,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var u=this;return(0,I.A)(function*(){const h=yield u.execute();return X(h,u.auth,"internal-error"),h})()}onExecution(){var u=this;return(0,I.A)(function*(){kt(1===u.filter.length,"Popup operations only handle one event");const h=jt();u.authWindow=yield u.resolver._openPopup(u.auth,u.provider,u.filter[0],h),u.authWindow.associatedEvent=h,u.resolver._originValidation(u.auth).catch(y=>{u.reject(y)}),u.resolver._isIframeWebStorageSupported(u.auth,y=>{y||u.reject(ot(u.auth,"web-storage-unsupported"))}),u.pollUserCancellation()})()}get eventId(){var u;return(null===(u=this.authWindow)||void 0===u?void 0:u.associatedEvent)||null}cancel(){this.reject(ot(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const u=()=>{var h,y;this.pollId=null!==(y=null===(h=this.authWindow)||void 0===h?void 0:h.window)&&void 0!==y&&y.closed?window.setTimeout(()=>{this.pollId=null,this.reject(ot(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(u,ou.get())};u()}}return c.currentPopupAction=null,c})();const Rs="pendingRedirect",ti=new Map;class ic extends ln{constructor(o,u,h=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],u,void 0,h),this.eventId=null}execute(){var o=()=>super.execute,u=this;return(0,I.A)(function*(){let h=ti.get(u.auth._key());if(!h){try{const E=(yield function ni(c,o){return Pr.apply(this,arguments)}(u.resolver,u.auth))?yield o().call(u):null;h=()=>Promise.resolve(E)}catch(y){h=()=>Promise.reject(y)}ti.set(u.auth._key(),h)}return u.bypassAuthState||ti.set(u.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(o){var u=()=>super.onAuthEvent,h=this;return(0,I.A)(function*(){if("signInViaRedirect"===o.type)return u().call(h,o);if("unknown"!==o.type){if(o.eventId){const y=yield h.auth._redirectUserForId(o.eventId);if(y)return h.user=y,u().call(h,o);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,I.A)(function*(){})()}cleanUp(){}}function Pr(){return(Pr=(0,I.A)(function*(c,o){const u=ho(o),h=Sr(c);if(!(yield h._isAvailable()))return!1;const y="true"===(yield h._get(u));return yield h._remove(u),y})).apply(this,arguments)}function Lr(c,o){return ur.apply(this,arguments)}function ur(){return(ur=(0,I.A)(function*(c,o){return Sr(c)._set(ho(o),"true")})).apply(this,arguments)}function lr(){ti.clear()}function yn(c,o){ti.set(c._key(),o)}function Sr(c){return _e(c._redirectPersistence)}function ho(c){return vt(Rs,c.config.apiKey,c.name)}function Qi(c,o,u){return function ma(c,o,u){return Ji.apply(this,arguments)}(c,o,u)}function Ji(){return(Ji=(0,I.A)(function*(c,o,u){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const h=ft(c);dn(c,o,mn),yield h._initializationPromise;const y=Ue(h,u);return yield Lr(y,h),y._openRedirect(h,o,"signInViaRedirect")})).apply(this,arguments)}function Ei(c,o,u){return function ga(c,o,u){return Ti.apply(this,arguments)}(c,o,u)}function Ti(){return(Ti=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c);if(dn(h.auth,o,mn),(0,B._isFirebaseServerApp)(h.auth.app))return Promise.reject(mt(h.auth));yield h.auth._initializationPromise;const y=Ue(h.auth,u);yield Lr(y,h.auth);const E=yield uu(h);return y._openRedirect(h.auth,o,"reauthViaRedirect",E)})).apply(this,arguments)}function _a(c,o,u){return function Ps(c,o,u){return Yi.apply(this,arguments)}(c,o,u)}function Yi(){return(Yi=(0,I.A)(function*(c,o,u){const h=(0,w.Ku)(c);dn(h.auth,o,mn),yield h.auth._initializationPromise;const y=Ue(h.auth,u);yield Wi(!1,h,o.providerId),yield Lr(y,h.auth);const E=yield uu(h);return y._openRedirect(h.auth,o,"linkViaRedirect",E)})).apply(this,arguments)}function Ss(c,o){return fo.apply(this,arguments)}function fo(){return(fo=(0,I.A)(function*(c,o){return yield ft(c)._initializationPromise,ya(c,o,!1)})).apply(this,arguments)}function ya(c,o){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,I.A)(function*(c,o,u=!1){if((0,B._isFirebaseServerApp)(c.app))return Promise.reject(mt(c));const h=ft(c),y=Ue(h,o),C=yield new ic(h,y,u).execute();return C&&!u&&(delete C.user._redirectEventId,yield h._persistUserIfCurrent(C.user),yield h._setRedirectUser(null,o)),C})).apply(this,arguments)}function uu(c){return va.apply(this,arguments)}function va(){return(va=(0,I.A)(function*(c){const o=jt(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class Ea{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let u=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(o,h)&&(u=!0,this.sendToConsumer(o,h),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function m(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return l(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,u||(this.queuedRedirectEvent=o,u=!0)),u}sendToConsumer(o,u){var h;if(o.error&&!l(o)){const y=(null===(h=o.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";u.onError(ot(this.auth,y))}else u.onAuthEvent(o)}isEventForConsumer(o,u){const h=null===u.eventId||!!o.eventId&&o.eventId===u.eventId;return u.filter.includes(o.type)&&h}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(f(o))}saveEventToCache(o){this.cachedEventUids.add(f(o)),this.lastProcessedEventTime=Date.now()}}function f(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function l({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function g(c){return T.apply(this,arguments)}function T(){return(T=(0,I.A)(function*(c,o={}){return F(c,"GET","/v1/projects",o)})).apply(this,arguments)}const R=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,O=/^https?/;function U(){return(U=(0,I.A)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield g(c);for(const u of o)try{if(se(u))return}catch{}Le(c,"unauthorized-domain")})).apply(this,arguments)}function se(c){const o=At(),{protocol:u,hostname:h}=new URL(o);if(c.startsWith("chrome-extension://")){const C=new URL(c);return""===C.hostname&&""===h?"chrome-extension:"===u&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===u&&C.hostname===h}if(!O.test(u))return!1;if(R.test(c))return h===c;const y=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+y+"|"+y+")$","i").test(h)}const fe=new hr(3e4,6e4);function De(){const c=ut().___jsl;if(null!=c&&c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let u=0;u<c.CP.length;u++)c.CP[u]=null}let Ve=null;const st=new hr(5e3,15e3),Ge="__/auth/iframe",ct="emulator/auth/iframe",Ot={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Dt=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function we(c){const o=c.config;X(o.authDomain,c,"auth-domain-config-required");const u=o.emulator?dr(o,ct):`https://${c.config.authDomain}/${Ge}`,h={apiKey:o.apiKey,appName:c.name,v:B.SDK_VERSION},y=Dt.get(c.config.apiHost);y&&(h.eid=y);const E=c._getFrameworks();return E.length&&(h.fw=E.join(",")),`${u}?${(0,w.Am)(h).slice(1)}`}function _t(){return _t=(0,I.A)(function*(c){const o=yield function Ye(c){return Ve=Ve||function je(c){return new Promise((o,u)=>{var h,y,E;function C(){De(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{De(),u(ot(c,"network-request-failed"))},timeout:fe.get()})}if(null!==(y=null===(h=ut().gapi)||void 0===h?void 0:h.iframes)&&void 0!==y&&y.Iframe)o(gapi.iframes.getContext());else{if(null===(E=ut().gapi)||void 0===E||!E.load){const N=er("iframefcb");return ut()[N]=()=>{gapi.load?C():u(ot(c,"network-request-failed"))},Bs(`${function ko(){return ki.gapiScript}()}?onload=${N}`).catch(G=>u(G))}C()}}).catch(o=>{throw Ve=null,o})}(c),Ve}(c),u=ut().gapi;return X(u,c,"internal-error"),o.open({where:document.body,url:we(c),messageHandlersFilter:u.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ot,dontclear:!0},h=>new Promise(function(){var y=(0,I.A)(function*(E,C){yield h.restyle({setHideOnLeave:!1});const N=ot(c,"network-request-failed"),G=ut().setTimeout(()=>{C(N)},st.get());function le(){ut().clearTimeout(G),E(h)}h.ping(le).then(le,()=>{C(N)})});return function(E,C){return y.apply(this,arguments)}}()))}),_t.apply(this,arguments)}const bs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class po{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const sc="__/auth/handler",oc="emulator/auth/handler",wi=encodeURIComponent("fac");function hu(c,o,u,h,y,E){return Xi.apply(this,arguments)}function Xi(){return(Xi=(0,I.A)(function*(c,o,u,h,y,E){X(c.config.authDomain,c,"auth-domain-config-required"),X(c.config.apiKey,c,"invalid-api-key");const C={apiKey:c.config.apiKey,appName:c.name,authType:u,redirectUrl:h,v:B.SDK_VERSION,eventId:y};if(o instanceof mn){o.setDefaultLanguage(c.languageCode),C.providerId=o.providerId||"",(0,w.Im)(o.getCustomParameters())||(C.customParameters=JSON.stringify(o.getCustomParameters()));for(const[pe,Oe]of Object.entries(E||{}))C[pe]=Oe}if(o instanceof hi){const pe=o.getScopes().filter(Oe=>""!==Oe);pe.length>0&&(C.scopes=pe.join(","))}c.tenantId&&(C.tid=c.tenantId);const N=C;for(const pe of Object.keys(N))void 0===N[pe]&&delete N[pe];const G=yield c._getAppCheckToken(),le=G?`#${wi}=${encodeURIComponent(G)}`:"";return`${function ac({config:c}){return c.emulator?dr(c,oc):`https://${c.authDomain}/${sc}`}(c)}?${(0,w.Am)(N).slice(1)}${le}`})).apply(this,arguments)}const Aa="webStorageSupport",In=class mo{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$t,this._completeRedirectFn=ya,this._overrideRedirectResult=yn}_openPopup(o,u,h,y){var E=this;return(0,I.A)(function*(){var C;kt(null===(C=E.eventManagers[o._key()])||void 0===C?void 0:C.manager,"_initialize() not called before _openPopup()");const N=yield hu(o,u,h,At(),y);return function lu(c,o,u,h=500,y=600){const E=Math.max((window.screen.availHeight-y)/2,0).toString(),C=Math.max((window.screen.availWidth-h)/2,0).toString();let N="";const G=Object.assign(Object.assign({},bs),{width:h.toString(),height:y.toString(),top:E,left:C}),le=(0,w.ZQ)().toLowerCase();u&&(N=ns(le)?"_blank":u),Fe(le)&&(o=o||"http://localhost",G.scrollbars="yes");const pe=Object.entries(G).reduce((Pn,[cr,ii])=>`${Pn}${cr}=${ii},`,"");if(function Di(c=(0,w.ZQ)()){var o;return Ls(c)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(le)&&"_self"!==N)return function cu(c,o){const u=document.createElement("a");u.href=c,u.target=o;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(h)}(o||"",N),new po(null);const Oe=window.open(o||"",N,pe);X(Oe,c,"popup-blocked");try{Oe.focus()}catch{}return new po(Oe)}(o,N,jt())})()}_openRedirect(o,u,h,y){var E=this;return(0,I.A)(function*(){return yield E._originValidation(o),function ji(c){ut().location.href=c}(yield hu(o,u,h,At(),y)),new Promise(()=>{})})()}_initialize(o){const u=o._key();if(this.eventManagers[u]){const{manager:y,promise:E}=this.eventManagers[u];return y?Promise.resolve(y):(kt(E,"If manager is not set, promise should be"),E)}const h=this.initAndGetManager(o);return this.eventManagers[u]={promise:h},h.catch(()=>{delete this.eventManagers[u]}),h}initAndGetManager(o){var u=this;return(0,I.A)(function*(){const h=yield function Nt(c){return _t.apply(this,arguments)}(o),y=new Ea(o);return h.register("authEvent",E=>(X(null==E?void 0:E.authEvent,o,"invalid-auth-event"),{status:y.onEvent(E.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),u.eventManagers[o._key()]={manager:y},u.iframes[o._key()]=h,y})()}_isIframeWebStorageSupported(o,u){this.iframes[o._key()].send(Aa,{type:Aa},y=>{var E;const C=null===(E=null==y?void 0:y[0])||void 0===E?void 0:E[Aa];void 0!==C&&u(!!C),Le(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const u=o._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function M(c){return U.apply(this,arguments)}(o)),this.originValidationPromises[u]}get _shouldInitProactively(){return Ms()||Nn()||Ls()}};class yl{constructor(o){this.factorId=o}_process(o,u,h){switch(u.type){case"enroll":return this._finalizeEnroll(o,u.credential,h);case"signin":return this._finalizeSignIn(o,u.credential);default:return Lt("unexpected MultiFactorSessionType")}}}class wa extends yl{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new wa(o)}_finalizeEnroll(o,u,h){return function _i(c,o){return F(c,"POST","/v2/accounts/mfaEnrollment:finalize",x(c,o))}(o,{idToken:u,displayName:h,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,u){return function Un(c,o){return F(c,"POST","/v2/accounts/mfaSignIn:finalize",x(c,o))}(o,{mfaPendingCredential:u,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let du=(()=>{class c{constructor(){}static assertion(u){return wa._fromCredential(u)}}return c.FACTOR_ID="phone",c})();var Il="@firebase/auth";class jc{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var u=this;return(0,I.A)(function*(){return u.assertAuthConfigured(),yield u.auth._initializationPromise,u.auth.currentUser?{accessToken:yield u.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const u=this.auth.onIdTokenChanged(h=>{o((null==h?void 0:h.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,u),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const u=this.internalListeners.get(o);u&&(this.internalListeners.delete(o),u(),this.updateProactiveRefresh())}assertAuthConfigured(){X(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const uc=(0,w.XA)("authIdTokenMaxAge")||300;let go=null;const lc=c=>function(){var o=(0,I.A)(function*(u){const h=u&&(yield u.getIdTokenResult()),y=h&&((new Date).getTime()-Date.parse(h.issuedAtTime))/1e3;if(y&&y>uc)return;const E=null==h?void 0:h.token;go!==E&&(go=E,yield fetch(c,{method:E?"POST":"DELETE",headers:E?{Authorization:`Bearer ${E}`}:{}}))});return function(u){return o.apply(this,arguments)}}();function ri(c=(0,B.getApp)()){const o=(0,B._getProvider)(c,"auth");if(o.isInitialized())return o.getImmediate();const u=function Ws(c,o){const u=(0,B._getProvider)(c,"auth");if(u.isInitialized()){const y=u.getImmediate(),E=u.getOptions();if((0,w.bD)(E,null!=o?o:{}))return y;Le(y,"already-initialized")}return u.initialize({options:o})}(c,{popupRedirectResolver:In,persistence:[aa,Yr,$t]}),h=(0,w.XA)("authTokenSyncURL");if(h&&"boolean"==typeof isSecureContext&&isSecureContext){const E=new URL(h,location.origin);if(location.origin===E.origin){const C=lc(E.toString());(function so(c,o,u){(0,w.Ku)(c).beforeAuthStateChanged(o,u)})(u,C,()=>C(u.currentUser)),function Pt(c,o,u,h){(0,w.Ku)(c).onIdTokenChanged(o,u,h)}(u,N=>C(N))}}const y=(0,w.Tj)("auth");return y&&Gs(u,`http://${y}`),u}(function Us(c){ki=c})({loadJS:c=>new Promise((o,u)=>{const h=document.createElement("script");h.setAttribute("src",c),h.onload=o,h.onerror=y=>{const E=ot("internal-error");E.customData=y,u(E)},h.type="text/javascript",h.charset="UTF-8",function cc(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(h)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function Hc(c){(0,B._registerComponent)(new ge.uA("auth",(o,{options:u})=>{const h=o.getProvider("app").getImmediate(),y=o.getProvider("heartbeat"),E=o.getProvider("app-check-internal"),{apiKey:C,authDomain:N}=h.options;X(C&&!C.includes(":"),"invalid-api-key",{appName:h.name});const G={apiKey:C,authDomain:N,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:is(c)},le=new zu(h,y,E,G);return function Hu(c,o){const u=(null==o?void 0:o.persistence)||[],h=(Array.isArray(u)?u:[u]).map(_e);null!=o&&o.errorMap&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(h,null==o?void 0:o.popupRedirectResolver)}(le,u),le},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,u,h)=>{o.getProvider("auth-internal").initialize()})),(0,B._registerComponent)(new ge.uA("auth-internal",o=>{const u=ft(o.getProvider("auth").getImmediate());return new jc(u)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,B.registerVersion)(Il,"1.7.2",function Ri(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(c)),(0,B.registerVersion)(Il,"1.7.2","esm2017")}("Browser")},99:(Si,Wt,j)=>{j.d(Wt,{J1:()=>I.a5,eJ:()=>I.aa,r7:()=>I.ak,x9:()=>I.ab,xI:()=>I.o});var I=j(8407);j(7852),j(1076),j(8041),j(1362)},2824:(Si,Wt,j)=>{j.d(Wt,{fS:()=>Jd,Ix:()=>Ro,H6:()=>k_,T1:()=>Bt,Wq:()=>La,uY:()=>Po,W6:()=>W,Ci:()=>Lc,YQ:()=>jl,NJ:()=>Ma,Dc:()=>xe,GA:()=>gm,cm:()=>ni,K$:()=>ee,FA:()=>tt,lo:()=>Be,bI:()=>ec,qG:()=>gl,qi:()=>_n,c8:()=>jp,gS:()=>gy,C3:()=>Ny,hq:()=>ky,me:()=>L_,rJ:()=>S_,Cs:()=>b_,vN:()=>Xp,kd:()=>my,CL:()=>xy,LA:()=>U_,H9:()=>Zp,ol:()=>V_,Q5:()=>O_,Os:()=>F_,FD:()=>ny,rf:()=>ty,Ws:()=>qt,z6:()=>Bu,x7:()=>ay,nY:()=>uy,_e:()=>ly,GG:()=>cy,kU:()=>hy,Rr:()=>dy,aU:()=>N_,GV:()=>Vy,AB:()=>Y_,$1:()=>X_,po:()=>B_,St:()=>q_,aQ:()=>_y,FC:()=>yy,My:()=>J_,P:()=>H_,B:()=>Ud,yx:()=>C_,c4:()=>Cy,O5:()=>Dy,BN:()=>fy,He:()=>Nr,lN:()=>oy,HM:()=>ey,EO:()=>Z_,mZ:()=>py,iB:()=>M_,_M:()=>Q_});var z,I=j(467),B=j(7852),w=j(1362),Ie=j(8041),Re=j(1076),ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ae={},Xe=Xe||{},ae=ge||self;function Pe(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Qt(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var oi="closure_uid_"+(1e9*Math.random()>>>0),$n=0;function jn(n,e,t){return n.call.apply(n.bind,arguments)}function ai(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function qe(n,e,t){return(qe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?jn:ai).apply(null,arguments)}function Ze(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ne(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var a=Array(arguments.length-2),d=2;d<arguments.length;d++)a[d-2]=arguments[d];return e.prototype[i].apply(r,a)}}function Le(){this.s=this.s,this.o=this.o}Le.prototype.s=!1,Le.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function zn(n){Object.prototype.hasOwnProperty.call(n,oi)&&n[oi]||(n[oi]=++$n)}(this)},Le.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const hn=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function mt(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function dn(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Pe(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let a=0;a<s;a++)n[i+a]=r[a]}else n.push(r)}}function lt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};var X=function(){if(!ae.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};ae.addEventListener("test",t,e),ae.removeEventListener("test",t,e)}catch{}return n}();function Lt(n){return/^[\s\xa0]*$/.test(n)}function kt(){var n=ae.navigator;return n&&(n=n.userAgent)?n:""}function At(n){return-1!=kt().indexOf(n)}function Jt(n){return Jt[" "](n),n}Jt[" "]=function(){};var x,n,br=At("Opera"),bn=At("Trident")||At("MSIE"),hr=At("Edge"),dr=hr||bn,Hn=At("Gecko")&&!(-1!=kt().toLowerCase().indexOf("webkit")&&!At("Edge"))&&!(At("Trident")||At("MSIE"))&&!At("Edge"),bi=-1!=kt().toLowerCase().indexOf("webkit")&&!At("Edge");function Z(){var n=ae.document;return n?n.documentMode:void 0}e:{var F="",$=(n=kt(),Hn?/rv:([^\);]+)(\)|;)/.exec(n):hr?/Edge\/([\d\.]+)/.exec(n):bn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):bi?/WebKit\/(\S+)/.exec(n):br?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if($&&(F=$?$[1]:""),bn){var H=Z();if(null!=H&&H>parseFloat(F)){x=String(H);break e}}x=F}var ie=ae.document&&bn&&(Z()||parseInt(x,10))||void 0;function Te(n,e){if(lt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Hn){e:{try{Jt(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Ce[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Te.$.h.call(this)}}Ne(Te,lt);var Ce={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Yt="closure_listenable_"+(1e6*Math.random()|0),Mt=0;function fr(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Mt,this.fa=this.ia=!1}function Cr(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function xr(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Ur(n){const e={};for(const t in n)e[t]=n[t];return e}const It="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Cn(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<It.length;s++)t=It[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Dr(n){this.src=n,this.g={},this.h=0}function xn(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=hn(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Cr(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Qn(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Dr.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var a=Qn(n,e,r,i);return-1<a?(e=n[a],t||(e.ia=!1)):((e=new fr(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var Jn="closure_lm_"+(1e6*Math.random()|0),et={};function nt(n,e,t,r,i){if(r&&r.once)return Dn(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)nt(n,e[s],t,r,i);return null}return t=Zn(t),n&&n[Yt]?n.O(e,t,Qt(r)?!!r.capture:!!r,i):fn(n,e,t,!1,r,i)}function fn(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var a=Qt(i)?!!i.capture:!!i,d=Qe(n);if(d||(n[Jn]=d=new Dr(n)),(t=d.add(e,t,r,a,s)).proxy)return t;if(r=function Xt(){const e=pr;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)X||(i=a),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Yn(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Dn(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Dn(n,e[s],t,r,i);return null}return t=Zn(t),n&&n[Yt]?n.P(e,t,Qt(r)?!!r.capture:!!r,i):fn(n,e,t,!0,r,i)}function Zt(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Zt(n,e[s],t,r,i);else r=Qt(r)?!!r.capture:!!r,t=Zn(t),n&&n[Yt]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Qn(s=n.g[e],t,r,i))&&(Cr(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Qe(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Qn(e,t,r,i)),(t=-1<n?e[n]:null)&&Br(t))}function Br(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[Yt])xn(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Yn(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Qe(e))?(xn(t,n),0==t.h&&(t.src=null,e[Jn]=null)):Cr(n)}}}function Yn(n){return n in et?et[n]:et[n]="on"+n}function pr(n,e){if(n.fa)n=!0;else{e=new Te(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Br(n),n=t.call(r,e)}return n}function Qe(n){return(n=n[Jn])instanceof Dr?n:null}var Xn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zn(n){return"function"==typeof n?n:(n[Xn]||(n[Xn]=function(e){return n.handleEvent(e)}),n[Xn])}function dt(){Le.call(this),this.i=new Dr(this),this.S=this,this.J=null}function ve(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new lt(e,n);else if(e instanceof lt)e.target=e.target||n;else{var i=e;Cn(e=new lt(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];i=Je(a,r,!0,e)&&i}if(i=Je(a=e.g=n,r,!0,e)&&i,i=Je(a,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Je(a=e.g=t[s],r,!1,e)&&i}function Je(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var d=a.listener,p=a.la||a.src;a.ia&&xn(n.i,a),i=!1!==d.call(p,r)&&i}}return i&&!r.defaultPrevented}Ne(dt,Le),dt.prototype[Yt]=!0,dt.prototype.removeEventListener=function(n,e,t,r){Zt(this,n,e,t,r)},dt.prototype.N=function(){if(dt.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Cr(t[r]);delete n.g[e],n.h--}}this.J=null},dt.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},dt.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Ft=ae.JSON.stringify;function Tn(){var n=P;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var kn=new class En{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new ui,n=>n.reset());class ui{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Os(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Co(n){ae.setTimeout(()=>{throw n},0)}let V,b=!1,P=new class en{constructor(){this.h=this.g=null}add(e,t){const r=kn.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},q=()=>{const n=ae.Promise.resolve(void 0);V=()=>{n.then(oe)}};var oe=()=>{for(var n;n=Tn();){try{n.h.call(n.g)}catch(t){Co(t)}var e=kn;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}b=!1};function _e(n,e){dt.call(this),this.h=n||1,this.g=e||ae,this.j=qe(this.qb,this),this.l=Date.now()}function Me(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Ke(n,e,t){if("function"==typeof n)t&&(n=qe(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=qe(n.handleEvent,n)}return 2147483647<Number(e)?-1:ae.setTimeout(n,e||0)}function vt(n){n.g=Ke(()=>{n.g=null,n.i&&(n.i=!1,vt(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Ne(_e,dt),(z=_e.prototype).ga=!1,z.T=null,z.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ve(this,"tick"),this.ga&&(Me(this),this.start()))}},z.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},z.N=function(){_e.$.N.call(this),Me(this),delete this.g};class Gt extends Le{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:vt(this)}N(){super.N(),this.g&&(ae.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function tn(n){Le.call(this),this.h=n,this.g={}}Ne(tn,Le);var Fe=[];function Nn(n,e,t,r){Array.isArray(t)||(t&&(Fe[0]=t.toString()),t=Fe);for(var i=0;i<t.length;i++){var s=nt(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function ns(n){xr(n.g,function(e,t){this.g.hasOwnProperty(t)&&Br(e)},n),n.g={}}function Ci(){this.g=!0}function xi(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Wu(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Ft(t)}catch{return e}}(n,t)+(r?" "+r:"")})}tn.prototype.N=function(){tn.$.N.call(this),ns(this)},tn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ci.prototype.Ea=function(){this.g=!1},Ci.prototype.info=function(){};var Di={},Gu=null;function Ms(){return Gu=Gu||new dt}function rs(n){lt.call(this,Di.Ta,n)}function is(n){const e=Ms();ve(e,new rs(e))}function Ku(n,e){lt.call(this,Di.STAT_EVENT,n),this.stat=e}function pn(n){const e=Ms();ve(e,new Ku(e,n))}function xo(n,e){lt.call(this,Di.Ua,n),this.size=e}function Fs(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return ae.setTimeout(function(){n()},e)}Di.Ta="serverreachability",Ne(rs,lt),Di.STAT_EVENT="statevent",Ne(Ku,lt),Di.Ua="timingevent",Ne(xo,lt);var Do={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},zu={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ft(){}function ki(){}ft.prototype.h=null;var qa,Us={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Bs(){lt.call(this,"d")}function Ba(){lt.call(this,"c")}function ko(){}function er(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new tn(this),this.P=Hl,this.V=new _e(n=dr?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new $u}function $u(){this.i=null,this.g="",this.h=!1}Ne(Bs,lt),Ne(Ba,lt),Ne(ko,ft),ko.prototype.g=function(){return new XMLHttpRequest},ko.prototype.i=function(){return{}},qa=new ko;var Hl=45e3,Wa={},No={};function qs(n,e,t){n.L=1,n.A=us(Wr(e)),n.u=t,n.S=!0,ss(n,null)}function ss(n,e){n.G=Date.now(),Ws(n),n.B=Wr(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),za(t.i,"t",r),n.o=0,t=n.l.J,n.h=new $u,n.g=ps(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Gt(qe(n.Pa,n,n.g),n.O)),Nn(n.U,n.g,"readystatechange",n.nb),e=n.I?Ur(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),is(),function Fa(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var a="",d=s.split("&"),p=0;p<d.length;p++){var _=d[p].split("=");if(1<_.length){var v=_[0];_=_[1];var A=v.split("_");a=2<=A.length&&"type"==A[1]?a+(v+"=")+_+"&":a+(v+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+a})}(n.j,n.v,n.B,n.m,n.W,n.u)}function Vo(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function ju(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=Ga(n,t),i==No){4==e&&(n.s=4,pn(14),r=!1),xi(n.j,n.m,null,"[Incomplete Response]");break}if(i==Wa){n.s=4,pn(15),xi(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}xi(n.j,n.m,i,null),Oo(n,i)}Vo(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,pn(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),ds(e),e.M=!0,pn(11))):(xi(n.j,n.m,t,"[Invalid Chunked Response]"),Ni(n),os(n))}function Ga(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?No:(t=Number(e.substring(t,r)),isNaN(t)?Wa:(r+=1)+t>e.length?No:(e=e.slice(r,r+t),n.o=r+t,e))}function Ws(n){n.Y=Date.now()+n.P,Hu(n,n.P)}function Hu(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=Fs(qe(n.lb,n),e)}function Gs(n){n.C&&(ae.clearTimeout(n.C),n.C=null)}function os(n){0==n.l.H||n.J||$o(n.l,n)}function Ni(n){Gs(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Me(n.V),ns(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Oo(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Fi(t.i,n)))if(!n.K&&Fi(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;pi(t),hs(t)}Zs(t),pn(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=Fs(qe(t.ib,t),6e3));if(1>=js(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else jr(t,11)}else if((n.K||t.g==n)&&pi(t),!Lt(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let _=i[e];if(t.V=_[0],_=_[1],2==t.H)if("c"==_[0]){t.K=_[1],t.pa=_[2];const v=_[3];null!=v&&(t.ra=v,t.l.info("VER="+t.ra));const A=_[4];null!=A&&(t.Ga=A,t.l.info("SVER="+t.Ga));const S=_[5];null!=S&&"number"==typeof S&&0<S&&(t.L=r=1.5*S,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const k=n.g;if(k){const Y=k.g?k.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Y){var s=r.i;s.g||-1==Y.indexOf("spdy")&&-1==Y.indexOf("quic")&&-1==Y.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Hs(s,s.h),s.h=null))}if(r.F){const re=k.g?k.g.getResponseHeader("X-HTTP-Session-Id"):null;re&&(r.Da=re,pt(r.I,r.F,re))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var a=n;if((r=t).wa=mi(r,r.J?r.pa:null,r.Y),a.K){Gr(r.i,a);var d=a,p=r.L;p&&d.setTimeout(p),d.C&&(Gs(d),Ws(d)),r.g=a}else Xs(r);0<t.j.length&&zr(t)}else"stop"!=_[0]&&"close"!=_[0]||jr(t,7);else 3==t.H&&("stop"==_[0]||"close"==_[0]?"stop"==_[0]?jr(t,7):fi(t):"noop"!=_[0]&&t.h&&t.h.Aa(_),t.A=0)}is()}catch{}}function Lo(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Pe(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function as(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Pe(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Ql(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Pe(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(z=er.prototype).setTimeout=function(n){this.P=n},z.nb=function(n){n=n.target;const e=this.M;e&&3==Ln(n)?e.l():this.Pa(n)},z.Pa=function(n){try{if(n==this.g)e:{const v=Ln(this.g);var e=this.g.Ia();if(this.g.da(),!(3>v)&&(3!=v||dr||this.g&&(this.h.h||this.g.ja()||wn(this.g)))){this.J||4!=v||7==e||is(),Gs(this);var t=this.g.da();this.ca=t;t:if(Vo(this)){var r=wn(this.g);n="";var i=r.length,s=4==Ln(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Ni(this),os(this);var a="";break t}this.h.i=new ae.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,a=this.h.g}else a=this.g.ja();if(this.i=200==t,function qu(n,e,t,r,i,s,a){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+a})}(this.j,this.v,this.B,this.m,this.W,v,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var d,p=this.g;if((d=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Lt(d)){var _=d;break t}}_=null}if(!(t=_)){this.i=!1,this.s=3,pn(12),Ni(this),os(this);break e}xi(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Oo(this,t)}this.S?(ju(this,v,a),dr&&this.i&&3==v&&(Nn(this.U,this.V,"tick",this.mb),this.V.start())):(xi(this.j,this.m,a,null),Oo(this,a)),4==v&&Ni(this),this.i&&!this.J&&(4==v?$o(this.l,this):(this.i=!1,Ws(this)))}else(function ja(n){const e={};n=(n.g&&2<=Ln(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Lt(n[r]))continue;var t=Os(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Fr(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<a.indexOf("Unknown SID")?(this.s=3,pn(12)):(this.s=0,pn(13)),Ni(this),os(this)}}}catch{}},z.mb=function(){if(this.g){var n=Ln(this.g),e=this.g.ja();this.o<e.length&&(Gs(this),ju(this,n,e),this.i&&4!=n&&Ws(this))}},z.cancel=function(){this.J=!0,Ni(this)},z.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function Ls(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(is(),pn(17)),Ni(this),this.s=2,os(this)):Hu(this,this.Y-n)};var Mo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof qr){this.h=n.h,Vi(this,n.j),this.s=n.s,this.g=n.g,Fo(this,n.m),this.l=n.l;var e=n.i,t=new ci;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Uo(this,t),this.o=n.o}else n&&(e=String(n).match(Mo))?(this.h=!1,Vi(this,e[1]||"",!0),this.s=li(e[2]||""),this.g=li(e[3]||"",!0),Fo(this,e[4]),this.l=li(e[5]||"",!0),Uo(this,e[6]||"",!0),this.o=li(e[7]||"")):(this.h=!1,this.i=new ci(null,this.h))}function Wr(n){return new qr(n)}function Vi(n,e,t){n.j=t?li(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Fo(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Uo(n,e,t){e instanceof ci?(n.i=e,function Q(n,e){e&&!n.j&&(tr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&($s(this,r),za(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Oi(e,Zl)),n.i=new ci(e,n.h))}function pt(n,e,t){n.i.set(e,t)}function us(n){return pt(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function li(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Oi(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Yl),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Yl(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}qr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Oi(e,Ks,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Oi(e,Ks,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Oi(t,"/"==t.charAt(0)?Ka:Xl,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Oi(t,zs)),n.join("")};var Ks=/[#\/\?@]/g,Xl=/[#\?:]/g,Ka=/[#\?]/g,Zl=/[#\?@]/g,zs=/#/g;function ci(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function tr(n){n.g||(n.g=new Map,n.h=0,n.i&&function Jl(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function $s(n,e){tr(n),e=kr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Li(n,e){return tr(n),e=kr(n,e),n.g.has(e)}function za(n,e,t){$s(n,e),0<t.length&&(n.i=null,n.g.set(kr(n,e),mt(t)),n.h+=t.length)}function kr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}(z=ci.prototype).add=function(n,e){tr(this),this.i=null,n=kr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},z.forEach=function(n,e){tr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},z.ta=function(){tr(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},z.Z=function(n){tr(this);let e=[];if("string"==typeof n)Li(this,n)&&(e=e.concat(this.g.get(kr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},z.set=function(n,e){return tr(this),this.i=null,Li(this,n=kr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},z.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},z.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),n.push(i)}}return this.i=n.join("&")};var gt=class{constructor(n,e){this.g=n,this.map=e}};function Mi(n){this.l=n||Qu,n=ae.PerformanceNavigationTiming?0<(n=ae.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(ae.g&&ae.g.Ka&&ae.g.Ka()&&ae.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Qu=10;function nr(n){return!!n.h||!!n.g&&n.g.size>=n.j}function js(n){return n.h?1:n.g?n.g.size:0}function Fi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Hs(n,e){n.g?n.g.add(e):n.h=e}function Gr(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Qs(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return mt(n.i)}Mi.prototype.cancel=function(){if(this.i=Qs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Bo=class{stringify(n){return ae.JSON.stringify(n,void 0)}parse(n){return ae.JSON.parse(n,void 0)}};function Ju(){this.g=new Bo}function $a(n,e,t){const r=t||"";try{Lo(n,function(i,s){let a=i;Qt(i)&&(a=Ft(i)),e.push(r+s+"="+encodeURIComponent(a))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function mr(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Bi(n){this.l=n.ec||null,this.j=n.ob||!1}function ls(n,e){dt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=An,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ne(Bi,ft),Bi.prototype.g=function(){return new ls(this.l,this.j)},Bi.prototype.i=function(n){return function(){return n}}({}),Ne(ls,dt);var An=0;function Vn(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function wt(n){n.readyState=4,n.l=null,n.j=null,n.A=null,mn(n)}function mn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(z=ls.prototype).open=function(n,e){if(this.readyState!=An)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,mn(this)},z.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||ae).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},z.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,wt(this)),this.readyState=An},z.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,mn(this)),this.g&&(this.readyState=3,mn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof ae.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Vn(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},z.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?wt(this):mn(this),3==this.readyState&&Vn(this)}},z.Za=function(n){this.g&&(this.response=this.responseText=n,wt(this))},z.Ya=function(n){this.g&&(this.response=n,wt(this))},z.ka=function(){this.g&&wt(this)},z.setRequestHeader=function(n,e){this.v.append(n,e)},z.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},z.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(ls.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var hi=ae.JSON.parse;function $e(n){dt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=qi,this.L=this.M=!1}Ne($e,dt);var qi="",on=/^https?$/i,Yu=["POST","PUT"];function On(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Kr(n),gr(n)}function Kr(n){n.F||(n.F=!0,ve(n,"complete"),ve(n,"error"))}function di(n){if(n.h&&typeof Xe<"u"&&(!n.C[1]||4!=Ln(n)||2!=n.da()))if(n.v&&4==Ln(n))Ke(n.La,0,n);else if(ve(n,"readystatechange"),4==Ln(n)){n.h=!1;try{const a=n.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var i=String(n.I).match(Mo)[1]||null;!i&&ae.self&&ae.self.location&&(i=ae.self.location.protocol.slice(0,-1)),r=!on.test(i?i.toLowerCase():"")}t=r}if(t)ve(n,"complete"),ve(n,"success");else{n.m=6;try{var s=2<Ln(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Kr(n)}}finally{gr(n)}}}function gr(n,e){if(n.g){Wo(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ve(n,"ready");try{t.onreadystatechange=r}catch{}}}function Wo(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(ae.clearTimeout(n.A),n.A=null)}function Ln(n){return n.g?n.g.readyState:0}function wn(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case qi:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Go(n){let e="";return xr(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function cs(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Go(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):pt(n,e,t))}function _r(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Js(n){this.Ga=0,this.j=[],this.l=new Ci,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=_r("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=_r("baseRetryDelayMs",5e3,n),this.hb=_r("retryDelaySeedMs",1e4,n),this.eb=_r("forwardChannelMaxRetries",2,n),this.xa=_r("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Mi(n&&n.concurrentRequestLimit),this.Ja=new Ju,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function fi(n){if(Ys(n),3==n.H){var e=n.W++,t=Wr(n.I);if(pt(t,"SID",n.K),pt(t,"RID",e),pt(t,"TYPE","terminate"),$r(n,t),(e=new er(n,n.l,e)).L=2,e.A=us(Wr(t)),t=!1,ae.navigator&&ae.navigator.sendBeacon)try{t=ae.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&ae.Image&&((new Image).src=e.A,t=!0),t||(e.g=ps(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ws(e)}eo(n)}function hs(n){n.g&&(ds(n),n.g.cancel(),n.g=null)}function Ys(n){hs(n),n.u&&(ae.clearTimeout(n.u),n.u=null),pi(n),n.i.cancel(),n.m&&("number"==typeof n.m&&ae.clearTimeout(n.m),n.m=null)}function zr(n){if(!nr(n.i)&&!n.m){n.m=!0;var e=n.Na;V||q(),b||(V(),b=!0),P.add(e,n),n.C=0}}function Wi(n,e){var t;t=e?e.m:n.W++;const r=Wr(n.I);pt(r,"SID",n.K),pt(r,"RID",t),pt(r,"AID",n.V),$r(n,r),n.o&&n.s&&cs(r,n.o,n.s),t=new er(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=zo(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Hs(n.i,t),qs(t,r,e)}function $r(n,e){n.na&&xr(n.na,function(t,r){pt(e,r,t)}),n.h&&Lo({},function(t,r){pt(e,r,t)})}function zo(n,e,t){t=Math.min(n.j.length,t);var r=n.h?qe(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const a=["count="+t];-1==s?0<t?(s=i[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let d=!0;for(let p=0;p<t;p++){let _=i[p].g;const v=i[p].map;if(_-=s,0>_)s=Math.max(0,i[p].g-100),d=!1;else try{$a(v,a,"req"+_+"_")}catch{r&&r(v)}}if(d){r=a.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Xs(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;V||q(),b||(V(),b=!0),P.add(e,n),n.A=0}}function Zs(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=Fs(qe(n.Ma,n),jo(n,n.A)),n.A++,0))}function ds(n){null!=n.B&&(ae.clearTimeout(n.B),n.B=null)}function fs(n){n.g=new er(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Wr(n.wa);pt(e,"RID","rpc"),pt(e,"SID",n.K),pt(e,"AID",n.V),pt(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&pt(e,"TO",n.qa),pt(e,"TYPE","xmlhttp"),$r(n,e),n.o&&n.s&&cs(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=us(Wr(e)),t.u=null,t.S=!0,ss(t,n)}function pi(n){null!=n.v&&(ae.clearTimeout(n.v),n.v=null)}function $o(n,e){var t=null;if(n.g==e){pi(n),ds(n),n.g=null;var r=2}else{if(!Fi(n.i,e))return;t=e.F,Gr(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;ve(r=Ms(),new xo(r,t)),zr(n)}else Xs(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function Ko(n,e){return!(js(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=Fs(qe(n.Na,n,e),jo(n,n.C)),n.C++,0)))}(n,e)||2==r&&Zs(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:jr(n,5);break;case 4:jr(n,10);break;case 3:jr(n,6);break;default:jr(n,2)}}function jo(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function jr(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=qe(n.pb,n);t||(t=new qr("//www.google.com/images/cleardot.gif"),ae.location&&"http"==ae.location.protocol||Vi(t,"https"),us(t)),function Ui(n,e){const t=new Ci;if(ae.Image){const r=new Image;r.onload=Ze(mr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ze(mr,t,r,"TestLoadImage: error",!1,e),r.onabort=Ze(mr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ze(mr,t,r,"TestLoadImage: timeout",!1,e),ae.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else pn(2);n.H=0,n.h&&n.h.za(e),eo(n),Ys(n)}function eo(n){if(n.H=0,n.ma=[],n.h){const e=Qs(n.i);(0!=e.length||0!=n.j.length)&&(dn(n.ma,e),dn(n.ma,n.j),n.i.i.length=0,mt(n.j),n.j.length=0),n.h.ya()}}function mi(n,e,t){var r=t instanceof qr?Wr(t):new qr(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Fo(r,r.m);else{var i=ae.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new qr(null);r&&Vi(s,r),e&&(s.g=e),i&&Fo(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&pt(r,t,e),pt(r,"VER",n.ra),$r(n,r),r}function ps(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new $e(n.Ha&&!n.va?new Bi({ob:t}):n.va)).Oa(n.J),e}function Ho(){}function Gi(){if(bn&&!(10<=Number(ie)))throw Error("Environmental error: no available transport.")}function Kt(n,e){dt.call(this),this.g=new Js(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Lt(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Lt(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new We(this)}function to(n){Bs.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function at(){Ba.call(this),this.status=1}function We(n){this.g=n}function an(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Qo(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],a=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;a=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(a<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(e=t+((a=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function ze(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(z=$e.prototype).Oa=function(n){this.M=n},z.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():qa.g(),this.C=function Ua(n){return n.h||(n.h=n.i())}(this.u?this.u:qa),this.g.onreadystatechange=qe(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void On(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=ae.FormData&&n instanceof ae.FormData,!(0<=hn(Yu,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Wo(this),0<this.B&&((this.L=function qo(n){return bn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=qe(this.ua,this)):this.A=Ke(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){On(this,s)}},z.ua=function(){typeof Xe<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ve(this,"timeout"),this.abort(8))},z.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ve(this,"complete"),ve(this,"abort"),gr(this))},z.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),gr(this,!0)),$e.$.N.call(this)},z.La=function(){this.s||(this.G||this.v||this.l?di(this):this.kb())},z.kb=function(){di(this)},z.isActive=function(){return!!this.g},z.da=function(){try{return 2<Ln(this)?this.g.status:-1}catch{return-1}},z.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},z.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),hi(e)}},z.Ia=function(){return this.m},z.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(z=Js.prototype).ra=8,z.H=1,z.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new er(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Ur(s),Cn(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=zo(this,i,e),pt(t=Wr(this.I),"RID",n),pt(t,"CVER",22),this.F&&pt(t,"X-HTTP-Session-Id",this.F),$r(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Go(s)))+"&"+e:this.o&&cs(t,this.o,s)),Hs(this.i,i),this.bb&&pt(t,"TYPE","init"),this.P?(pt(t,"$req",e),pt(t,"SID","null"),i.aa=!0,qs(i,t,null)):qs(i,t,e),this.H=2}}else 3==this.H&&(n?Wi(this,n):0==this.j.length||nr(this.i)||Wi(this))},z.Ma=function(){if(this.u=null,fs(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Fs(qe(this.jb,this),n)}},z.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,pn(10),hs(this),fs(this))},z.ib=function(){null!=this.v&&(this.v=null,hs(this),Zs(this),pn(19))},z.pb=function(n){n?(this.l.info("Successfully pinged google.com"),pn(2)):(this.l.info("Failed to ping google.com"),pn(1))},z.isActive=function(){return!!this.h&&this.h.isActive(this)},(z=Ho.prototype).Ba=function(){},z.Aa=function(){},z.za=function(){},z.ya=function(){},z.isActive=function(){return!0},z.Va=function(){},Gi.prototype.g=function(n,e){return new Kt(n,e)},Ne(Kt,dt),Kt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;pn(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=mi(n,null,n.Y),zr(n)},Kt.prototype.close=function(){fi(this.g)},Kt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Ft(n),n=t);e.j.push(new gt(e.fb++,n)),3==e.H&&zr(e)},Kt.prototype.N=function(){this.g.h=null,delete this.j,fi(this.g),delete this.g,Kt.$.N.call(this)},Ne(to,Bs),Ne(at,Ba),Ne(We,Ho),We.prototype.Ba=function(){ve(this.g,"a")},We.prototype.Aa=function(n){ve(this.g,new to(n))},We.prototype.za=function(n){ve(this.g,new at)},We.prototype.ya=function(){ve(this.g,"b")},Ne(an,function ms(){this.blockSize=-1}),an.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},an.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Qo(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Qo(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Qo(this,r),i=0;break}}this.h=i,this.i+=e},an.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Xu={};function gs(n){return-128<=n&&128>n?function Mr(n,e){var t=Xu;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new ze([0|e],0>e?-1:0)}):new ze([0|n],0>n?-1:0)}function yr(n){if(isNaN(n)||!isFinite(n))return Hr;if(0>n)return zt(yr(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=ys;return new ze(e,0)}var ys=4294967296,Hr=gs(0),Jo=gs(1),no=gs(16777216);function Ir(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function gn(n){return-1==n.h}function zt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new ze(t,~n.h).add(Jo)}function ro(n,e){return n.add(zt(e))}function rr(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ki(n,e){this.g=n,this.h=e}function Is(n,e){if(Ir(e))throw Error("division by zero");if(Ir(n))return new Ki(Hr,Hr);if(gn(n))return e=Is(zt(n),e),new Ki(zt(e.g),zt(e.h));if(gn(e))return e=Is(n,zt(e)),new Ki(zt(e.g),e.h);if(30<n.g.length){if(gn(n)||gn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Jo,r=e;0>=r.X(n);)t=Qr(t),r=Qr(r);var i=vr(t,1),s=vr(r,1);for(r=vr(r,2),t=vr(t,2);!Ir(r);){var a=s.add(r);0>=a.X(n)&&(i=i.add(t),s=a),r=vr(r,1),t=vr(t,1)}return e=ro(n,i.R(e)),new Ki(i,e)}for(i=Hr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),a=(s=yr(t)).R(e);gn(a)||0<a.X(n);)a=(s=yr(t-=r)).R(e);Ir(s)&&(s=Jo),i=i.add(s),n=ro(n,a)}return new Ki(i,n)}function Qr(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new ze(t,n.h)}function vr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new ze(i,n.h)}(z=ze.prototype).ea=function(){if(gn(this))return-zt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:ys+r)*e,e*=ys}return n},z.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(Ir(this))return"0";if(gn(this))return"-"+zt(this).toString(n);for(var e=yr(Math.pow(n,6)),t=this,r="";;){var i=Is(t,e).g,s=((0<(t=ro(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(Ir(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},z.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},z.X=function(n){return gn(n=ro(this,n))?-1:Ir(n)?0:1},z.abs=function(){return gn(this)?zt(this):this},z.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=a>>>16,t[i]=(a&=65535)<<16|(s&=65535)}return new ze(t,-2147483648&t[t.length-1]?-1:0)},z.R=function(n){if(Ir(this)||Ir(n))return Hr;if(gn(this))return gn(n)?zt(this).R(zt(n)):zt(zt(this).R(n));if(gn(n))return zt(this.R(zt(n)));if(0>this.X(no)&&0>n.X(no))return yr(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),d=n.D(i)>>>16,p=65535&n.D(i);t[2*r+2*i]+=a*p,rr(t,2*r+2*i),t[2*r+2*i+1]+=s*p,rr(t,2*r+2*i+1),t[2*r+2*i+1]+=a*d,rr(t,2*r+2*i+1),t[2*r+2*i+2]+=s*d,rr(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new ze(t,0)},z.gb=function(n){return Is(this,n).h},z.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new ze(t,this.h&n.h)},z.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new ze(t,this.h|n.h)},z.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new ze(t,this.h^n.h)},Gi.prototype.createWebChannel=Gi.prototype.g,Kt.prototype.send=Kt.prototype.u,Kt.prototype.open=Kt.prototype.m,Kt.prototype.close=Kt.prototype.close,Do.NO_ERROR=0,Do.TIMEOUT=8,Do.HTTP_ERROR=6,zu.COMPLETE="complete",ki.EventType=Us,Us.OPEN="a",Us.CLOSE="b",Us.ERROR="c",Us.MESSAGE="d",dt.prototype.listen=dt.prototype.O,$e.prototype.listenOnce=$e.prototype.P,$e.prototype.getLastError=$e.prototype.Sa,$e.prototype.getLastErrorCode=$e.prototype.Ia,$e.prototype.getStatus=$e.prototype.da,$e.prototype.getResponseJson=$e.prototype.Wa,$e.prototype.getResponseText=$e.prototype.ja,$e.prototype.send=$e.prototype.ha,$e.prototype.setWithCredentials=$e.prototype.Oa,an.prototype.digest=an.prototype.l,an.prototype.reset=an.prototype.reset,an.prototype.update=an.prototype.j,ze.prototype.add=ze.prototype.add,ze.prototype.multiply=ze.prototype.R,ze.prototype.modulo=ze.prototype.gb,ze.prototype.compare=ze.prototype.X,ze.prototype.toNumber=ze.prototype.ea,ze.prototype.toString=ze.prototype.toString,ze.prototype.getBits=ze.prototype.D,ze.fromNumber=yr,ze.fromString=function _s(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return zt(_s(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=yr(Math.pow(e,8)),r=Hr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),a=parseInt(n.substring(i,i+s),e);8>s?(s=yr(Math.pow(e,s)),r=r.R(s).add(yr(a))):r=(r=r.R(t)).add(yr(a))}return r};var Ut=Ae.createWebChannelTransport=function(){return new Gi},Zu=Ae.getStatEventTarget=function(){return Ms()},vs=Ae.ErrorCode=Do,el=Ae.EventType=zu,Yo=Ae.Event=Di,Ha=Ae.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Xo=Ae.FetchXmlHttpFactory=Bi,gi=Ae.WebChannel=ki,io=Ae.XhrIo=$e,Zo=Ae.Md5=an,Er=Ae.Integer=ze;const Tr="@firebase/firestore";class Vt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Vt.UNAUTHENTICATED=new Vt(null),Vt.GOOGLE_CREDENTIALS=new Vt("google-credentials-uid"),Vt.FIRST_PARTY=new Vt("first-party-uid"),Vt.MOCK_USER=new Vt("mock-user");let Mn="10.11.1";const ir=new Ie.Vy("@firebase/firestore");function zi(){return ir.logLevel}function Nr(n){ir.setLogLevel(n)}function K(n,...e){if(ir.logLevel<=Ie.$b.DEBUG){const t=e.map(ea);ir.debug(`Firestore (${Mn}): ${n}`,...t)}}function Rt(n,...e){if(ir.logLevel<=Ie.$b.ERROR){const t=e.map(ea);ir.error(`Firestore (${Mn}): ${n}`,...t)}}function _n(n,...e){if(ir.logLevel<=Ie.$b.WARN){const t=e.map(ea);ir.warn(`Firestore (${Mn}): ${n}`,...t)}}function ea(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function ue(n="Unexpected state"){const e=`FIRESTORE (${Mn}) INTERNAL ASSERTION FAILED: `+n;throw Rt(e),new Error(e)}function de(n,e){n||ue()}function ec(n,e){n||ue()}function ne(n,e){return n}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends Re.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Pt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class so{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tl{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Vt.UNAUTHENTICATED))}shutdown(){}}class tc{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class nl{constructor(e){this.t=e,this.currentUser=Vt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=_=>this.i!==i?(i=this.i,t(_)):Promise.resolve();let a=new Pt;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Pt,e.enqueueRetryable(()=>s(this.currentUser))};const d=()=>{const _=a;e.enqueueRetryable((0,I.A)(function*(){yield _.promise,yield s(r.currentUser)}))},p=_=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=_,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(_=>p(_)),setTimeout(()=>{if(!this.auth){const _=this.t.getImmediate({optional:!0});_?p(_):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Pt)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(de("string"==typeof r.accessToken),new so(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return de(null===e||"string"==typeof e),new Vt(e)}}class rl{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Vt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class nc{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new rl(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Vt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class il{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ta{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,K("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(de("string"==typeof t.token),this.R=t.token,new il(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Es(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Qa{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Es(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function Ee(n,e){return n<e?-1:n>e?1:0}function _i(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function sl(n){return n+"\0"}class xe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new W(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new W(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new W(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new W(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xe.fromMillis(Date.now())}static fromDate(e){return xe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new xe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ee(this.nanoseconds,e.nanoseconds):Ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ce{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ce(e)}static min(){return new ce(new xe(0,0))}static max(){return new ce(new xe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class yi{constructor(e,t,r){void 0===t?t=0:t>e.length&&ue(),void 0===r?r=e.length-t:r>e.length-t&&ue(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===yi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Se extends yi{construct(e,t,r){return new Se(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new W(L.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Se(t)}static emptyPath(){return new Se([])}}const ol=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tt extends yi{construct(e,t,r){return new tt(e,t,r)}static isValidIdentifier(e){return ol.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new tt(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new W(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const d=e[i];if("\\"===d){if(i+1===e.length)throw new W(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const p=e[i+1];if("\\"!==p&&"."!==p&&"`"!==p)throw new W(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=p,i+=2}else"`"===d?(a=!a,i++):"."!==d||a?(r+=d,i++):(s(),i++)}if(s(),a)throw new W(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tt(t)}static emptyPath(){return new tt([])}}class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Se.fromString(e))}static fromName(e){return new ee(Se.fromString(e).popFirst(5))}static empty(){return new ee(Se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Se.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Se(e.slice()))}}class $i{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Ts(n){return n.fields.find(e=>2===e.kind)}function Jr(n){return n.fields.filter(e=>2!==e.kind)}$i.UNKNOWN_ID=-1;class Yr{constructor(e,t){this.fieldPath=e,this.kind=t}}class $t{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new $t(0,jt.min())}}function sr(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ce.fromTimestamp(1e9===r?new xe(t+1,0):new xe(t,r));return new jt(i,ee.empty(),e)}function As(n){return new jt(n.readTime,n.key,-1)}class jt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new jt(ce.min(),ee.empty(),-1)}static max(){return new jt(ce.max(),ee.empty(),-1)}}function na(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=ee.comparator(n.documentKey,e.documentKey),0!==t?t:Ee(n.largestBatchId,e.largestBatchId))}const ut="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ji{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function or(n){return ra.apply(this,arguments)}function ra(){return ra=(0,I.A)(function*(n){if(n.code!==L.FAILED_PRECONDITION||n.message!==ut)throw n;K("LocalStore","Unexpectedly lost primary lease")}),ra.apply(this,arguments)}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ue(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,r)=>{t(e)})}static reject(e){return new D((t,r)=>{r(e)})}static waitFor(e){return new D((t,r)=>{let i=0,s=0,a=!1;e.forEach(d=>{++i,d.next(()=>{++s,a&&s===i&&t()},p=>r(p))}),a=!0,s===i&&t()})}static or(e){let t=D.resolve(!1);for(const r of e)t=t.next(i=>i?D.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new D((r,i)=>{const s=e.length,a=new Array(s);let d=0;for(let p=0;p<s;p++){const _=p;t(e[_]).next(v=>{a[_]=v,++d,d===s&&r(a)},v=>i(v))}})}static doWhile(e,t){return new D((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class oo{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Pt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Vr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=ws(r.target.error);this.V.reject(new Vr(e,i))}}static open(e,t,r,i){try{return new oo(t,e.transaction(i,r))}catch(s){throw new Vr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(K("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Xr(t)}}class Ar{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===Ar.S((0,Re.ZQ)())&&Rt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return K("SimpleDb","Removing database:",e),Fn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,Re.zW)())return!1;if(Ar.C())return!0;const e=(0,Re.ZQ)(),t=Ar.S(e),r=0<t&&t<10,i=ia(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){var t=this;return(0,I.A)(function*(){return t.db||(K("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{r(a.target.result)},s.onblocked=()=>{i(new Vr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const d=a.target.error;i("VersionError"===d.name?new W(L.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new W(L.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new Vr(e,d))},s.onupgradeneeded=a=>{K("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{K("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=r=>t.N(r)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,I.A)(function*(){const a="readonly"===t;let d=0;for(;;){++d;try{s.db=yield s.M(e);const p=oo.open(s.db,e,a?"readonly":"readwrite",r),_=i(p).next(v=>(p.g(),v)).catch(v=>(p.abort(v),D.reject(v))).toPromise();return _.catch(()=>{}),yield p.m,_}catch(p){const _=p,v="FirebaseError"!==_.name&&d<3;if(K("SimpleDb","Transaction failed with error:",_.message,"Retrying:",v),s.close(),!v)return Promise.reject(_)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function ia(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class ul{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Fn(this.B.delete())}}class Vr extends W{constructor(e,t){super(L.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wr(n){return"IndexedDbTransactionError"===n.name}class Xr{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(K("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(K("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Fn(r)}add(e){return K("SimpleDb","ADD",this.store.name,e,e),Fn(this.store.add(e))}get(e){return Fn(this.store.get(e)).next(t=>(void 0===t&&(t=null),K("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return K("SimpleDb","DELETE",this.store.name,e),Fn(this.store.delete(e))}count(){return K("SimpleDb","COUNT",this.store.name),Fn(this.store.count())}U(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new D((a,d)=>{s.onerror=p=>{d(p.target.error)},s.onsuccess=p=>{a(p.target.result)}})}{const s=this.cursor(r),a=[];return this.W(s,(d,p)=>{a.push(p)}).next(()=>a)}}G(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new D((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}j(e,t){K("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const i=this.cursor(r);return this.W(i,(s,a,d)=>d.delete())}J(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Y(e){const t=this.cursor({});return new D((r,i)=>{t.onerror=s=>{const a=ws(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(d=>{d?a.continue():r()}):r()}})}W(e,t){const r=[];return new D((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const d=a.target.result;if(!d)return void i();const p=new ul(d),_=t(d.primaryKey,d.value,p);if(_ instanceof D){const v=_.catch(A=>(p.done(),D.reject(A)));r.push(v)}p.isDone?i():null===p.K?d.continue():d.continue(p.K)}}).next(()=>D.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Fn(n){return new D((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=ws(r.target.error);t(i)}})}let Ja=!1;function ws(n){const e=Ar.S((0,Re.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new W("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ja||(Ja=!0,setTimeout(()=>{throw r},0)),r}}return n}class sa{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;K("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,I.A)(function*(){t.task=null;try{K("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(r){wr(r)?K("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield or(r)}yield t.X(6e4)}))}}class oa{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,I.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.te(r,e))})()}te(e,t){const r=new Set;let i=t,s=!0;return D.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!r.has(a))return K("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(d=>{i-=d,r.add(a)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(d=>(K("IndexBackfiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>a.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{const a=As(s);na(a,r)>0&&(r=a)}),new jt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Rn=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function St(n){return null==n}function Zr(n){return 0===n&&1/n==-1/0}function Ya(n){return"number"==typeof n&&Number.isInteger(n)&&!Zr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function bt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=aa(e)),e=ll(n.get(t),e);return aa(e)}function ll(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function aa(n){return n+"\x01\x01"}function Rr(n){const e=n.length;if(de(e>=2),2===e)return de("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),Se.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf("\x01",s);switch((a<0||a>t)&&ue(),n.charAt(a+1)){case"\x01":const d=n.substring(s,a);let p;0===i.length?p=d:(i+=d,p=i,i=""),r.push(p);break;case"\x10":i+=n.substring(s,a),i+="\0";break;case"\x11":i+=n.substring(s,a+1);break;default:ue()}s=a+2}return new Se(r)}const Un=["userId","batchId"];function ao(n,e){return[n,bt(e)]}function Xa(n,e,t){return[n,bt(e),t]}const cl={},uo=["prefixPath","collectionGroup","readTime","documentId"],Za=["prefixPath","collectionGroup","documentId"],Ii=["collectionGroup","readTime","prefixPath","documentId"],hl=["canonicalId","targetId"],ua=["targetId","path"],eu=["path","targetId"],dl=["collectionId","parent"],fl=["indexId","uid"],pl=["uid","sequenceNumber"],la=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ca=["indexId","uid","orderedDocumentKey"],tu=["userId","collectionPath","documentId"],ml=["userId","collectionPath","largestBatchId"],ha=["userId","collectionGroup","largestBatchId"],nu=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],da=[...nu,"documentOverlays"],fa=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],lo=fa,ru=[...lo,"indexConfiguration","indexState","indexEntries"],co=ru;class Hi extends ji{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ct(n,e){const t=ne(n);return Ar.F(t._e,e)}function iu(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Bn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function pa(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Ue{constructor(e,t){this.comparator=e,this.root=t||nn.EMPTY}insert(e,t){return new Ue(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nn.BLACK,null,null))}remove(e){return new Ue(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vi(this.root,e,this.comparator,!1)}getReverseIterator(){return new vi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vi(this.root,e,this.comparator,!0)}}class vi{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nn{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:nn.RED,this.left=null!=i?i:nn.EMPTY,this.right=null!=s?s:nn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new nn(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return nn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return nn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ue();const e=this.left.check();if(e!==this.right.check())throw ue();return e+(this.isRed()?0:1)}}nn.EMPTY=null,nn.RED=!0,nn.BLACK=!1,nn.EMPTY=new class{constructor(){this.size=0}get key(){throw ue()}get value(){throw ue()}get color(){throw ue()}get left(){throw ue()}get right(){throw ue()}copy(e,t,r,i,s){return this}insert(e,t,r){return new nn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rt{constructor(e){this.comparator=e,this.data=new Ue(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new su(this.data.getIterator())}getIteratorFrom(e){return new su(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof rt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new rt(this.comparator);return t.data=e,t}}class su{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ei(n){return n.hasNext()?n.getNext():void 0}class ln{constructor(e){this.fields=e,e.sort(tt.comparator)}static empty(){return new ln([])}unionWith(e){let t=new rt(tt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ln(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _i(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class ou extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function gl(){return typeof atob<"u"}class xt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ou("Invalid base64 string: "+s):s}}(e);return new xt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new xt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xt.EMPTY_BYTE_STRING=new xt("");const au=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qn(n){if(de(!!n),"string"==typeof n){let e=0;const t=au.exec(n);if(de(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:it(n.seconds),nanos:it(n.nanos)}}function it(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function ar(n){return"string"==typeof n?xt.fromBase64String(n):xt.fromUint8Array(n)}function Or(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Rs(n){const e=n.mapValue.fields.__previous_value__;return Or(e)?Rs(e):e}function ti(n){const e=qn(n.mapValue.fields.__local_write_time__.timestampValue);return new xe(e.seconds,e.nanos)}class ic{constructor(e,t,r,i,s,a,d,p,_){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=d,this.longPollingOptions=p,this.useFetchStreams=_}}class ni{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ni("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ni&&e.projectId===this.projectId&&e.database===this.database}}const Pr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Lr={nullValue:"NULL_VALUE"};function ur(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Or(n)?4:fo(n)?9007199254740991:10:ue()}function lr(n,e){if(n===e)return!0;const t=ur(n);if(t!==ur(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ti(n).isEqual(ti(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=qn(i.timestampValue),d=qn(s.timestampValue);return a.seconds===d.seconds&&a.nanos===d.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,ar(n.bytesValue).isEqual(ar(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return it(i.geoPointValue.latitude)===it(s.geoPointValue.latitude)&&it(i.geoPointValue.longitude)===it(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return it(i.integerValue)===it(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=it(i.doubleValue),d=it(s.doubleValue);return a===d?Zr(a)===Zr(d):isNaN(a)&&isNaN(d)}return!1}(n,e);case 9:return _i(n.arrayValue.values||[],e.arrayValue.values||[],lr);case 10:return function(i,s){const a=i.mapValue.fields||{},d=s.mapValue.fields||{};if(iu(a)!==iu(d))return!1;for(const p in a)if(a.hasOwnProperty(p)&&(void 0===d[p]||!lr(a[p],d[p])))return!1;return!0}(n,e);default:return ue()}var s}function yn(n,e){return void 0!==(n.values||[]).find(t=>lr(t,e))}function Sr(n,e){if(n===e)return 0;const t=ur(n),r=ur(e);if(t!==r)return Ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ee(n.booleanValue,e.booleanValue);case 2:return function(s,a){const d=it(s.integerValue||s.doubleValue),p=it(a.integerValue||a.doubleValue);return d<p?-1:d>p?1:d===p?0:isNaN(d)?isNaN(p)?0:-1:1}(n,e);case 3:return ho(n.timestampValue,e.timestampValue);case 4:return ho(ti(n),ti(e));case 5:return Ee(n.stringValue,e.stringValue);case 6:return function(s,a){const d=ar(s),p=ar(a);return d.compareTo(p)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const d=s.split("/"),p=a.split("/");for(let _=0;_<d.length&&_<p.length;_++){const v=Ee(d[_],p[_]);if(0!==v)return v}return Ee(d.length,p.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const d=Ee(it(s.latitude),it(a.latitude));return 0!==d?d:Ee(it(s.longitude),it(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,a){const d=s.values||[],p=a.values||[];for(let _=0;_<d.length&&_<p.length;++_){const v=Sr(d[_],p[_]);if(v)return v}return Ee(d.length,p.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===Pr.mapValue&&a===Pr.mapValue)return 0;if(s===Pr.mapValue)return 1;if(a===Pr.mapValue)return-1;const d=s.fields||{},p=Object.keys(d),_=a.fields||{},v=Object.keys(_);p.sort(),v.sort();for(let A=0;A<p.length&&A<v.length;++A){const S=Ee(p[A],v[A]);if(0!==S)return S;const k=Sr(d[p[A]],_[v[A]]);if(0!==k)return k}return Ee(p.length,v.length)}(n.mapValue,e.mapValue);default:throw ue()}}function ho(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return Ee(n,e);const t=qn(n),r=qn(e),i=Ee(t.seconds,r.seconds);return 0!==i?i:Ee(t.nanos,r.nanos)}function Qi(n){return ma(n)}function ma(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=qn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?ar(n.bytesValue).toBase64():"referenceValue"in n?ee.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=ma(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${ma(t.fields[a])}`;return i+"}"}(n.mapValue):ue()}function Ei(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ga(n){return!!n&&"integerValue"in n}function Ti(n){return!!n&&"arrayValue"in n}function _a(n){return!!n&&"nullValue"in n}function Ps(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yi(n){return!!n&&"mapValue"in n}function Ss(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Bn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ss(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ss(n.arrayValue.values[t]);return e}return Object.assign({},n)}function fo(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function ya(n){return"nullValue"in n?Lr:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ei(ni.empty(),ee.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:ue()}function Ia(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ei(ni.empty(),ee.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Pr:ue()}function uu(n,e){const t=Sr(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function va(n,e){const t=Sr(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class rn{constructor(e){this.value=e}static empty(){return new rn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Yi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ss(t)}setAll(e){let t=tt.emptyPath(),r={},i=[];e.forEach((a,d)=>{if(!t.isImmediateParentOf(d)){const p=this.getFieldsMap(t);this.applyChanges(p,r,i),r={},i=[],t=d.popLast()}a?r[d.lastSegment()]=Ss(a):i.push(d.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Yi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return lr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Yi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Bn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new rn(Ss(this.value))}}function Ea(n){const e=[];return Bn(n.fields,(t,r)=>{const i=new tt([t]);if(Yi(r)){const s=Ea(r.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new ln(e)}class f{constructor(e,t,r,i,s,a,d){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=d}static newInvalidDocument(e){return new f(e,0,ce.min(),ce.min(),ce.min(),rn.empty(),0)}static newFoundDocument(e,t,r,i){return new f(e,1,t,ce.min(),r,i,0)}static newNoDocument(e,t){return new f(e,2,t,ce.min(),ce.min(),rn.empty(),0)}static newUnknownDocument(e,t){return new f(e,3,t,ce.min(),ce.min(),rn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ce.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof f&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new f(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class l{constructor(e,t){this.position=e,this.inclusive=t}}function m(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(r=s.field.isKeyField()?ee.comparator(ee.fromName(a.referenceValue),t.key):Sr(a,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function g(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!lr(n.position[t],e.position[t]))return!1;return!0}class T{constructor(e,t="asc"){this.field=e,this.dir=t}}function R(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class O{}class M extends O{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new ct(e,t,r):"array-contains"===t?new Nt(e,r):"in"===t?new _t(e,r):"not-in"===t?new bs(e,r):"array-contains-any"===t?new Ai(e,r):new M(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Ot(e,r):new Dt(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Sr(t,this.value)):null!==t&&ur(this.value)===ur(t)&&this.matchesComparison(Sr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ue()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class U extends O{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new U(e,t)}matches(e){return se(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function se(n){return"and"===n.op}function fe(n){return"or"===n.op}function De(n){return je(n)&&se(n)}function je(n){for(const e of n.filters)if(e instanceof U)return!1;return!0}function Ve(n){if(n instanceof M)return n.field.canonicalString()+n.op.toString()+Qi(n.value);if(De(n))return n.filters.map(e=>Ve(e)).join(",");{const e=n.filters.map(t=>Ve(t)).join(",");return`${n.op}(${e})`}}function Ye(n,e){return n instanceof M?(r=n,(i=e)instanceof M&&r.op===i.op&&r.field.isEqual(i.field)&&lr(r.value,i.value)):n instanceof U?function(r,i){return i instanceof U&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,a,d)=>s&&Ye(a,i.filters[d]),!0)}(n,e):void ue();var r,i}function st(n,e){const t=n.filters.concat(e);return U.create(t,n.op)}function Ge(n){return n instanceof M?`${(t=n).field.canonicalString()} ${t.op} ${Qi(t.value)}`:n instanceof U?function(t){return t.op.toString()+" {"+t.getFilters().map(Ge).join(" ,")+"}"}(n):"Filter";var t}class ct extends M{constructor(e,t,r){super(e,t,r),this.key=ee.fromName(r.referenceValue)}matches(e){const t=ee.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ot extends M{constructor(e,t){super(e,"in",t),this.keys=we(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Dt extends M{constructor(e,t){super(e,"not-in",t),this.keys=we(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function we(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>ee.fromName(r.referenceValue))}class Nt extends M{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ti(t)&&yn(t.arrayValue,this.value)}}class _t extends M{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&yn(this.value.arrayValue,t)}}class bs extends M{constructor(e,t){super(e,"not-in",t)}matches(e){if(yn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!yn(this.value.arrayValue,t)}}class Ai extends M{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ti(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>yn(this.value.arrayValue,r))}}class Ta{constructor(e,t=null,r=[],i=[],s=null,a=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=d,this.ue=null}}function _l(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Ta(n,e,t,r,i,s,a)}function Cs(n){const e=ne(n);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ve(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),St(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Qi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Qi(r)).join(",")),e.ue=t}return e.ue}function po(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!R(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ye(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!g(n.startAt,e.startAt)&&g(n.endAt,e.endAt)}function lu(n){return ee.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function cu(n,e){return n.filters.filter(t=>t instanceof M&&t.field.isEqual(e))}function sc(n,e,t){let r=Lr,i=!0;for(const s of cu(n,e)){let a=Lr,d=!0;switch(s.op){case"<":case"<=":a=ya(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,d=!1;break;case"!=":case"not-in":a=Lr}uu({value:r,inclusive:i},{value:a,inclusive:d})<0&&(r=a,i=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];uu({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}function oc(n,e,t){let r=Pr,i=!0;for(const s of cu(n,e)){let a=Pr,d=!0;switch(s.op){case">=":case">":a=Ia(s.value),d=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,d=!1;break;case"!=":case"not-in":a=Pr}va({value:r,inclusive:i},{value:a,inclusive:d})>0&&(r=a,i=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];va({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}class wi{constructor(e,t=null,r=[],i=[],s=null,a="F",d=null,p=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=d,this.endAt=p,this.ce=null,this.le=null,this.he=null}}function hu(n,e,t,r,i,s,a,d){return new wi(n,e,t,r,i,s,a,d)}function Xi(n){return new wi(n)}function ac(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Aa(n){return null!==n.collectionGroup}function mo(n){const e=ne(n);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let d=new rt(tt.comparator);return a.filters.forEach(p=>{p.getFlattenedFilters().forEach(_=>{_.isInequality()&&(d=d.add(_.field))})}),d})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new T(s,r))}),t.has(tt.keyField().canonicalString())||e.ce.push(new T(tt.keyField(),r))}return e.ce}function In(n){const e=ne(n);return e.le||(e.le=function yl(n,e){if("F"===n.limitType)return _l(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new T(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new l(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new l(n.startAt.position,n.startAt.inclusive):null;return _l(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,mo(n))),e.le}function wa(n,e){const t=n.filters.concat([e]);return new wi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function du(n,e,t){return new wi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function fu(n,e){return po(In(n),In(e))&&n.limitType===e.limitType}function pu(n){return`${Cs(In(n))}|lt:${n.limitType}`}function xs(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Ge(i)).join(", ")}]`),St(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Qi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Qi(i)).join(",")),`Target(${r})`}(In(n))}; limitType=${n.limitType})`}function Zi(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):ee.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of mo(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(a,d,p){const _=m(a,d,p);return a.inclusive?_<=0:_<0}(r.startAt,mo(r),i)||r.endAt&&!function(a,d,p){const _=m(a,d,p);return a.inclusive?_>=0:_>0}(r.endAt,mo(r),i)));var r,i}function Il(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function vl(n){return(e,t)=>{let r=!1;for(const i of mo(n)){const s=jc(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function jc(n,e,t){const r=n.field.isKeyField()?ee.comparator(e.key,t.key):function(s,a,d){const p=a.data.field(s),_=d.data.field(s);return null!==p&&null!==_?Sr(p,_):ue()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ue()}}class Ri{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Bn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return pa(this.inner)}size(){return this.innerSize}}const Hc=new Ue(ee.comparator);function Wn(){return Hc}const uc=new Ue(ee.comparator);function go(...n){let e=uc;for(const t of n)e=e.insert(t.key,t);return e}function lc(n){let e=uc;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ri(){return c()}function cc(){return c()}function c(){return new Ri(n=>n.toString(),(n,e)=>n.isEqual(e))}const o=new Ue(ee.comparator),u=new rt(ee.comparator);function h(...n){let e=u;for(const t of n)e=e.add(t);return e}const y=new rt(Ee);function E(){return y}function C(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zr(e)?"-0":e}}function N(n){return{integerValue:""+n}}function G(n,e){return Ya(e)?N(e):C(n,e)}class le{constructor(){this._=void 0}}function pe(n,e,t){return n instanceof cr?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Or(s)&&(s=Rs(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof ii?El(n,e):n instanceof Pi?Tl(n,e):function(i,s){const a=Pn(i,s),d=mu(a)+mu(i.Pe);return ga(a)&&ga(i.Pe)?N(d):C(i.serializer,d)}(n,e)}function Oe(n,e,t){return n instanceof ii?El(n,e):n instanceof Pi?Tl(n,e):t}function Pn(n,e){return n instanceof Ds?ga(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class cr extends le{}class ii extends le{constructor(e){super(),this.elements=e}}function El(n,e){const t=Al(e);for(const r of n.elements)t.some(i=>lr(i,r))||t.push(r);return{arrayValue:{values:t}}}class Pi extends le{constructor(e){super(),this.elements=e}}function Tl(n,e){let t=Al(e);for(const r of n.elements)t=t.filter(i=>!lr(i,r));return{arrayValue:{values:t}}}class Ds extends le{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function mu(n){return it(n.integerValue||n.doubleValue)}function Al(n){return Ti(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class _o{constructor(e,t){this.field=e,this.transform=t}}class hc{constructor(e,t){this.version=e,this.transformResults=t}}class Et{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Et}static exists(e){return new Et(void 0,e)}static updateTime(e){return new Et(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yo(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class gu{}function Zd(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new yu(n.key,Et.none()):new _u(n.key,n.data,Et.none());{const t=n.data,r=rn.empty();let i=new rt(tt.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?r.delete(s):r.set(s,a),i=i.add(s)}return new ks(n.key,r,new ln(i.toArray()),Et.none())}}function Em(n,e,t){n instanceof _u?function(i,s,a){const d=i.value.clone(),p=nf(i.fieldTransforms,s,a.transformResults);d.setAll(p),s.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(n,e,t):n instanceof ks?function(i,s,a){if(!yo(i.precondition,s))return void s.convertToUnknownDocument(a.version);const d=nf(i.fieldTransforms,s,a.transformResults),p=s.data;p.setAll(tf(i)),p.setAll(d),s.convertToFoundDocument(a.version,p).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Rl(n,e,t,r){return n instanceof _u?function(s,a,d,p){if(!yo(s.precondition,a))return d;const _=s.value.clone(),v=rf(s.fieldTransforms,p,a);return _.setAll(v),a.convertToFoundDocument(a.version,_).setHasLocalMutations(),null}(n,e,t,r):n instanceof ks?function(s,a,d,p){if(!yo(s.precondition,a))return d;const _=rf(s.fieldTransforms,p,a),v=a.data;return v.setAll(tf(s)),v.setAll(_),a.convertToFoundDocument(a.version,v).setHasLocalMutations(),null===d?null:d.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(A=>A.field))}(n,e,t,r):(d=t,yo(n.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):d);var a,d}function Tm(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Pn(r.transform,i||null);null!=s&&(null===t&&(t=rn.empty()),t.set(r.field,s))}return t||null}function ef(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&_i(r,i,(s,a)=>function wl(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof ii&&i instanceof ii||r instanceof Pi&&i instanceof Pi?_i(r.elements,i.elements,lr):r instanceof Ds&&i instanceof Ds?lr(r.Pe,i.Pe):r instanceof cr&&i instanceof cr);var r,i}(s,a))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class _u extends gu{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ks extends gu{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function tf(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function nf(n,e,t){const r=new Map;de(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,d=e.data.field(s.field);r.set(s.field,Oe(a,d,t[i]))}return r}function rf(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,pe(s,a,e))}return r}class yu extends gu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qc extends gu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jc{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Em(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Rl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Rl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=cc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let d=this.applyToLocalView(a,s.mutatedFields);d=t.has(i.key)?null:d;const p=Zd(a,d);null!==p&&r.set(i.key,p),a.isValidDocument()||a.convertToNoDocument(ce.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),h())}isEqual(e){return this.batchId===e.batchId&&_i(this.mutations,e.mutations,(t,r)=>ef(t,r))&&_i(this.baseMutations,e.baseMutations,(t,r)=>ef(t,r))}}class Yc{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){de(e.mutations.length===r.length);let i=function(){return o}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new Yc(e,t,r,i)}}class Xc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class wm{constructor(e,t){this.count=e,this.unchangedNames=t}}var sn,He;function sf(n){switch(n){default:return ue();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}function af(n){if(void 0===n)return Rt("GRPC error has no .code"),L.UNKNOWN;switch(n){case sn.OK:return L.OK;case sn.CANCELLED:return L.CANCELLED;case sn.UNKNOWN:return L.UNKNOWN;case sn.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case sn.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case sn.INTERNAL:return L.INTERNAL;case sn.UNAVAILABLE:return L.UNAVAILABLE;case sn.UNAUTHENTICATED:return L.UNAUTHENTICATED;case sn.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case sn.NOT_FOUND:return L.NOT_FOUND;case sn.ALREADY_EXISTS:return L.ALREADY_EXISTS;case sn.PERMISSION_DENIED:return L.PERMISSION_DENIED;case sn.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case sn.ABORTED:return L.ABORTED;case sn.OUT_OF_RANGE:return L.OUT_OF_RANGE;case sn.UNIMPLEMENTED:return L.UNIMPLEMENTED;case sn.DATA_LOSS:return L.DATA_LOSS;default:return ue()}}(He=sn||(sn={}))[He.OK=0]="OK",He[He.CANCELLED=1]="CANCELLED",He[He.UNKNOWN=2]="UNKNOWN",He[He.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",He[He.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",He[He.NOT_FOUND=5]="NOT_FOUND",He[He.ALREADY_EXISTS=6]="ALREADY_EXISTS",He[He.PERMISSION_DENIED=7]="PERMISSION_DENIED",He[He.UNAUTHENTICATED=16]="UNAUTHENTICATED",He[He.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",He[He.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",He[He.ABORTED=10]="ABORTED",He[He.OUT_OF_RANGE=11]="OUT_OF_RANGE",He[He.UNIMPLEMENTED=12]="UNIMPLEMENTED",He[He.INTERNAL=13]="INTERNAL",He[He.UNAVAILABLE=14]="UNAVAILABLE",He[He.DATA_LOSS=15]="DATA_LOSS";function uf(){return new TextEncoder}const Rm=new Er([4294967295,4294967295],0);function lf(n){const e=uf().encode(n),t=new Zo;return t.update(e),new Uint8Array(t.digest())}function cf(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Er([t,r],0),new Er([i,s],0)]}class Zc{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Pl(`Invalid padding: ${t}`);if(r<0)throw new Pl(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Pl(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Pl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Er.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Er.fromNumber(r)));return 1===i.compare(Rm)&&(i=new Er([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=lf(e),[r,i]=cf(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(r,i,s);if(!this.de(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Zc(s,i,t);return r.forEach(d=>a.insert(d)),a}insert(e){if(0===this.Ie)return;const t=lf(e),[r,i]=cf(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(r,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Pl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Sl{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,bl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Sl(ce.min(),i,new Ue(Ee),Wn(),h())}}class bl{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new bl(r,t,h(),h(),h())}}class fc{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}}class hf{constructor(e,t){this.targetId=e,this.me=t}}class df{constructor(e,t,r=xt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class ff{constructor(){this.fe=0,this.ge=mf(),this.pe=xt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=h(),t=h(),r=h();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:ue()}}),new bl(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=mf()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,de(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Pm{constructor(e){this.Le=e,this.Be=new Map,this.ke=Wn(),this.qe=pf(),this.Qe=new Ue(Ee)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ue()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,r=e.me.count,i=this.Je(t);if(i){const s=i.target;if(lu(s))if(0===r){const a=new ee(s.path);this.Ue(t,a,f.newNoDocument(a,ce.min()))}else de(1===r);else{const a=this.Ye(t);if(a!==r){const d=this.Ze(e),p=d?this.Xe(d,e,a):1;0!==p&&(this.je(t),this.Qe=this.Qe.insert(t,2===p?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,d;try{a=ar(r).toUint8Array()}catch(p){if(p instanceof ou)return _n("Decoding the base64 bloom filter in existence filter failed ("+p.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw p}try{d=new Zc(a,i,s)}catch(p){return _n(p instanceof Pl?"BloomFilter error: ":"Applying bloom filter failed: ",p),null}return 0===d.Ie?null:d}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.Le.tt(),d=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(d)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const d=this.Je(a);if(d){if(s.current&&lu(d.target)){const p=new ee(d.target.path);null!==this.ke.get(p)||this.it(a,p)||this.Ue(a,p,f.newNoDocument(p,e))}s.be&&(t.set(a,s.Ce()),s.ve())}});let r=h();this.qe.forEach((s,a)=>{let d=!0;a.forEachWhile(p=>{const _=this.Je(p);return!_||"TargetPurposeLimboResolution"===_.purpose||(d=!1,!1)}),d&&(r=r.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new Sl(e,t,this.Qe,this.ke,r);return this.ke=Wn(),this.qe=pf(),this.Qe=new Ue(Ee),i}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ff,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new rt(Ee),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||K("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ff),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function pf(){return new Ue(ee.comparator)}function mf(){return new Ue(ee.comparator)}const Sm={asc:"ASCENDING",desc:"DESCENDING"},bm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cm={and:"AND",or:"OR"};class xm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function eh(n,e){return n.useProto3Json||St(e)?e:{value:e}}function Iu(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function gf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Dm(n,e){return Iu(n,e.toTimestamp())}function Ht(n){return de(!!n),ce.fromTimestamp(function(t){const r=qn(t);return new xe(r.seconds,r.nanos)}(n))}function th(n,e){return nh(n,e).canonicalString()}function nh(n,e){const t=(i=n,new Se(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function _f(n){const e=Se.fromString(n);return de(Sf(e)),e}function Cl(n,e){return th(n.databaseId,e.path)}function es(n,e){const t=_f(e);if(t.get(1)!==n.databaseId.projectId)throw new W(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new W(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ee(vf(t))}function yf(n,e){return th(n.databaseId,e)}function If(n){const e=_f(n);return 4===e.length?Se.emptyPath():vf(e)}function rh(n){return new Se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vf(n){return de(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Ef(n,e,t){return{name:Cl(n,e),fields:t.value.mapValue.fields}}function Tf(n,e,t){const r=es(n,e.name),i=Ht(e.updateTime),s=e.createTime?Ht(e.createTime):ce.min(),a=new rn({mapValue:{fields:e.fields}}),d=f.newFoundDocument(r,i,s,a);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function xl(n,e){let t;if(e instanceof _u)t={update:Ef(n,e.key,e.value)};else if(e instanceof yu)t={delete:Cl(n,e.key)};else if(e instanceof ks)t={update:Ef(n,e.key,e.data),updateMask:Um(e.fieldMask)};else{if(!(e instanceof Qc))return ue();t={verify:Cl(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const d=a.transform;if(d instanceof cr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof ii)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Pi)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Ds)return{fieldPath:a.field.canonicalString(),increment:d.Pe};throw ue()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Dm(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:ue()),t;var s}function ih(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Et.updateTime(Ht(s.updateTime)):void 0!==s.exists?Et.exists(s.exists):Et.none():Et.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(a,d){let p=null;"setToServerValue"in d?(de("REQUEST_TIME"===d.setToServerValue),p=new cr):"appendMissingElements"in d?p=new ii(d.appendMissingElements.values||[]):"removeAllFromArray"in d?p=new Pi(d.removeAllFromArray.values||[]):"increment"in d?p=new Ds(a,d.increment):ue();const _=tt.fromServerFormat(d.fieldPath);return new _o(_,p)}(n,i)):[];var s;if(e.update){const i=es(n,e.update.name),s=new rn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new ln((e.updateMask.fieldPaths||[]).map(v=>tt.fromServerFormat(v)));return new ks(i,s,a,t,r)}return new _u(i,s,t,r)}if(e.delete){const i=es(n,e.delete);return new yu(i,t)}if(e.verify){const i=es(n,e.verify);return new Qc(i,t)}return ue()}function Af(n,e){return{documents:[yf(n,e.path)]}}function sh(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=yf(n,i);const s=function(_){if(0!==_.length)return Pf(U.create(_,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(_){if(0!==_.length)return _.map(v=>{return{field:Io((S=v).field),direction:Lm(S.dir)};var S})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const d=eh(n,e.limit);return null!==d&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt={before:(_=e.startAt).inclusive,values:_.position}),e.endAt&&(t.structuredQuery.endAt=function(_){return{before:!_.inclusive,values:_.position}}(e.endAt)),{_t:t,parent:i};var _}function wf(n){let e=If(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){de(1===r);const v=t.from[0];v.allDescendants?i=v.collectionId:e=e.child(v.collectionId)}let s=[];t.where&&(s=function(A){const S=Rf(A);return S instanceof U&&De(S)?S.getFilters():[S]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(S=>{return new T(vu((Y=S).field),function(te){switch(te){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Y.direction));var Y}));let d=null;t.limit&&(d=function(A){let S;return S="object"==typeof A?A.value:A,St(S)?null:S}(t.limit));let p=null;var A;t.startAt&&(p=new l((A=t.startAt).values||[],!!A.before));let _=null;return t.endAt&&(_=function(A){return new l(A.values||[],!A.before)}(t.endAt)),hu(e,i,a,s,d,"F",p,_)}function Rf(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=vu(t.unaryFilter.field);return M.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=vu(t.unaryFilter.field);return M.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=vu(t.unaryFilter.field);return M.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=vu(t.unaryFilter.field);return M.create(a,"!=",{nullValue:"NULL_VALUE"});default:return ue()}}(n):void 0!==n.fieldFilter?M.create(vu((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ue()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return U.create(t.compositeFilter.filters.map(r=>Rf(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ue()}}(t.compositeFilter.op))}(n):ue();var t}function Lm(n){return Sm[n]}function Mm(n){return bm[n]}function Fm(n){return Cm[n]}function Io(n){return{fieldPath:n.canonicalString()}}function vu(n){return tt.fromServerFormat(n.fieldPath)}function Pf(n){return n instanceof M?function(t){if("=="===t.op){if(Ps(t.value))return{unaryFilter:{field:Io(t.field),op:"IS_NAN"}};if(_a(t.value))return{unaryFilter:{field:Io(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ps(t.value))return{unaryFilter:{field:Io(t.field),op:"IS_NOT_NAN"}};if(_a(t.value))return{unaryFilter:{field:Io(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Io(t.field),op:Mm(t.op),value:t.value}}}(n):n instanceof U?function(t){const r=t.getFilters().map(i=>Pf(i));return 1===r.length?r[0]:{compositeFilter:{op:Fm(t.op),filters:r}}}(n):ue()}function Um(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Sf(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Ns{constructor(e,t,r,i,s=ce.min(),a=ce.min(),d=xt.EMPTY_BYTE_STRING,p=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=d,this.expectedCount=p}withSequenceNumber(e){return new Ns(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ns(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ns(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ns(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bf{constructor(e){this.ut=e}}function Cf(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:pc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Cl(s=n.ut,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:Iu(s,a.version.toTimestamp()),createTime:Iu(s,a.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ra(e.version)};else{if(!e.isUnknownDocument())return ue();r.unknownDocument={path:t.path.toArray(),version:Ra(e.version)}}var s,a;return r}function pc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ra(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Pa(n){const e=new xe(n.seconds,n.nanoseconds);return ce.fromTimestamp(e)}function Sa(n,e){const t=(e.baseMutations||[]).map(s=>ih(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>ih(n.ut,s)),i=xe.fromMillis(e.localWriteTimeMs);return new Jc(e.batchId,i,t,r)}function Dl(n){const e=Pa(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Pa(n.lastLimboFreeSnapshotVersion):ce.min();let r;return r=void 0!==n.query.documents?(de(1===(s=n.query).documents.length),In(Xi(If(s.documents[0])))):function(s){return In(wf(s))}(n.query),new Ns(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,xt.fromBase64String(n.resumeToken));var s}function xf(n,e){const t=Ra(e.snapshotVersion),r=Ra(e.lastLimboFreeSnapshotVersion);let i;i=lu(e.target)?Af(n.ut,e.target):sh(n.ut,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Cs(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function oh(n){const e=wf({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?du(e,e.limit,"L"):e}function ah(n,e){return new Xc(e.largestBatchId,ih(n.ut,e.overlayMutation))}function Df(n,e){const t=e.path.lastSegment();return[n,bt(e.path.popLast()),t]}function kf(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ra(r.readTime),documentKey:bt(r.documentKey.path),largestBatchId:r.largestBatchId}}class qm{getBundleMetadata(e,t){return Nf(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Pa(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Nf(e).put({bundleId:(i=t).id,createTime:Ra(Ht(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Vf(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:oh(s.bundledQuery),readTime:Pa(s.readTime)};var s})}saveNamedQuery(e,t){return Vf(e).put({name:(i=t).name,readTime:Ra(Ht(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Nf(n){return Ct(n,"bundles")}function Vf(n){return Ct(n,"namedQueries")}class mc{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new mc(e,t.uid||"")}getOverlay(e,t){return kl(e).get(Df(this.userId,t)).next(r=>r?ah(this.serializer,r):null)}getOverlays(e,t){const r=ri();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,a)=>{const d=new Xc(t,a);i.push(this.lt(e,d))}),D.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(a=>i.add(bt(a.getCollectionPath())));const s=[];return i.forEach(a=>{const d=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(kl(e).j("collectionPathOverlayIndex",d))}),D.waitFor(s)}getOverlaysForCollection(e,t,r){const i=ri(),s=bt(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return kl(e).U("collectionPathOverlayIndex",a).next(d=>{for(const p of d){const _=ah(this.serializer,p);i.set(_.getKey(),_)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=ri();let a;const d=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return kl(e).J({index:"collectionGroupOverlayIndex",range:d},(p,_,v)=>{const A=ah(this.serializer,_);s.size()<i||A.largestBatchId===a?(s.set(A.getKey(),A),a=A.largestBatchId):v.done()}).next(()=>s)}lt(e,t){return kl(e).put(function(i,s,a){const[d,p,_]=Df(s,a.mutation.key);return{userId:s,collectionPath:p,documentId:_,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:xl(i.ut,a.mutation)}}(this.serializer,this.userId,t))}}function kl(n){return Ct(n,"documentOverlays")}class ba{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(it(e.integerValue));else if("doubleValue"in e){const r=it(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Zr(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),"string"==typeof r&&(r=qn(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(ar(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?fo(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):ue()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),ee.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function Wm(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Of(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const a=Wm(255&r[s]);if(i+=a,8!==a)break}return i}(n);return Math.ceil(e/8)}ba.St=new ba;class Gm{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Lt(e),r=Of(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Lt(e),r=Of(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Km{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class zm{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Nl{constructor(){this.Wt=new Gm,this.Gt=new Km(this.Wt),this.zt=new zm(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class Ca{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ca(this.indexId,this.documentKey,this.arrayValue,r)}}function vo(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Lf(n.arrayValue,e.arrayValue),0!==t?t:(t=Lf(n.directionalValue,e.directionalValue),0!==t?t:ee.comparator(n.documentKey,e.documentKey)))}function Lf(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Mf{constructor(e){this.Jt=new rt((t,r)=>tt.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(de(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Ts(e);if(void 0!==t&&!this.tn(t))return!1;const r=Jr(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const d=this.Jt.getIterator().getNext();if(!i.has(d.field.canonicalString())){const p=r[s];if(!this.nn(d,p)||!this.rn(this.Yt[a++],p))return!1}++s}for(;s<r.length;++s)if(a>=this.Yt.length||!this.rn(this.Yt[a++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new rt(tt.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new Yr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Yr(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Yr(r.field,"asc"===r.dir?0:1)));return new $i($i.UNKNOWN_ID,this.collectionId,t,$t.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Ff(n){var e,t;if(de(n instanceof M||n instanceof U),n instanceof M){if(n instanceof _t){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>M.create(n.field,"==",s)))||[];return U.create(i,"or")}return n}const r=n.filters.map(i=>Ff(i));return U.create(r,n.op)}function $m(n){if(0===n.getFilters().length)return[];const e=ch(Ff(n));return de(Uf(e)),uh(e)||lh(e)?[e]:e.getFilters()}function uh(n){return n instanceof M}function lh(n){return n instanceof U&&De(n)}function Uf(n){return uh(n)||lh(n)||function(t){if(t instanceof U&&fe(t)){for(const r of t.getFilters())if(!uh(r)&&!lh(r))return!1;return!0}return!1}(n)}function ch(n){if(de(n instanceof M||n instanceof U),n instanceof M)return n;if(1===n.filters.length)return ch(n.filters[0]);const e=n.filters.map(r=>ch(r));let t=U.create(e,n.op);return t=gc(t),Uf(t)?t:(de(t instanceof U),de(se(t)),de(t.filters.length>1),t.filters.reduce((r,i)=>hh(r,i)))}function hh(n,e){let t;return de(n instanceof M||n instanceof U),de(e instanceof M||e instanceof U),t=n instanceof M?e instanceof M?U.create([n,e],"and"):Bf(n,e):e instanceof M?Bf(e,n):function(i,s){if(de(i.filters.length>0&&s.filters.length>0),se(i)&&se(s))return st(i,s.getFilters());const a=fe(i)?i:s,d=fe(i)?s:i,p=a.filters.map(_=>hh(_,d));return U.create(p,"or")}(n,e),gc(t)}function Bf(n,e){if(se(e))return st(e,n.getFilters());{const t=e.filters.map(r=>hh(n,r));return U.create(t,"or")}}function gc(n){if(de(n instanceof M||n instanceof U),n instanceof M)return n;const e=n.getFilters();if(1===e.length)return gc(e[0]);if(je(n))return n;const t=e.map(i=>gc(i)),r=[];return t.forEach(i=>{i instanceof M?r.push(i):i instanceof U&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:U.create(r,n.op)}class jm{constructor(){this.on=new dh}addToCollectionParentIndex(e,t){return this.on.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(jt.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(jt.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class dh{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new rt(Se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new rt(Se.comparator)).toArray()}}const _c=new Uint8Array(0);class Hm{constructor(e,t){this.databaseId=t,this._n=new dh,this.an=new Ri(r=>Cs(r),(r,i)=>po(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:bt(i)};return qf(e).put(s)}return D.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[sl(t),""],!1,!0);return qf(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;r.push(Rr(a.parent))}return r})}addFieldIndex(e,t){const r=Vl(e),i={indexId:(d=t).indexId,collectionGroup:d.collectionGroup,fields:d.fields.map(p=>[p.fieldPath.canonicalString(),p.kind])};var d;delete i.indexId;const s=r.add(i);if(t.indexState){const a=Tu(e);return s.next(d=>{a.put(kf(d,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Vl(e),i=Tu(e),s=Eu(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Vl(e),r=Eu(e),i=Tu(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return D.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Mf(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Eu(e);let i=!0;const s=new Map;return D.forEach(this.un(t),a=>this.cn(e,a).next(d=>{i&&(i=!!d),s.set(a,d)})).next(()=>{if(i){let a=h();const d=[];return D.forEach(s,(p,_)=>{var ye;K("IndexedDbIndexManager",`Using index ${ye=p,`id=${ye.indexId}|cg=${ye.collectionGroup}|f=${ye.fields.map(ke=>`${ke.fieldPath}:${ke.kind}`).join(",")}`} to execute ${Cs(t)}`);const v=function(ye,ke){const yt=Ts(ke);if(void 0===yt)return null;for(const ht of cu(ye,yt.fieldPath))switch(ht.op){case"array-contains-any":return ht.value.arrayValue.values||[];case"array-contains":return[ht.value]}return null}(_,p),A=function(ye,ke){const yt=new Map;for(const ht of Jr(ke))for(const cn of cu(ye,ht.fieldPath))switch(cn.op){case"==":case"in":yt.set(ht.fieldPath.canonicalString(),cn.value);break;case"not-in":case"!=":return yt.set(ht.fieldPath.canonicalString(),cn.value),Array.from(yt.values())}return null}(_,p),S=function(ye,ke){const yt=[];let ht=!0;for(const cn of Jr(ke)){const si=0===cn.kind?sc(ye,cn.fieldPath,ye.startAt):oc(ye,cn.fieldPath,ye.startAt);yt.push(si.value),ht&&(ht=si.inclusive)}return new l(yt,ht)}(_,p),k=function(ye,ke){const yt=[];let ht=!0;for(const cn of Jr(ke)){const si=0===cn.kind?oc(ye,cn.fieldPath,ye.endAt):sc(ye,cn.fieldPath,ye.endAt);yt.push(si.value),ht&&(ht=si.inclusive)}return new l(yt,ht)}(_,p),Y=this.ln(p,_,S),re=this.ln(p,_,k),te=this.hn(p,_,A),me=this.Pn(p.indexId,v,Y,S.inclusive,re,k.inclusive,te);return D.forEach(me,be=>r.G(be,t.limit).next(ye=>{ye.forEach(ke=>{const yt=ee.fromSegments(ke.documentKey);a.has(yt)||(a=a.add(yt),d.push(yt))})}))}).next(()=>d)}return D.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:$m(U.create(e.filters,"and")).map(r=>_l(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,a,d){const p=(null!=t?t.length:1)*Math.max(r.length,s.length),_=p/(null!=t?t.length:1),v=[];for(let A=0;A<p;++A){const S=t?this.In(t[A/_]):_c,k=this.Tn(e,S,r[A%_],i),Y=this.En(e,S,s[A%_],a),re=d.map(te=>this.Tn(e,S,te,!0));v.push(...this.createRange(k,Y,re))}return v}Tn(e,t,r,i){const s=new Ca(e,ee.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new Ca(e,ee.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new Mf(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const d of s)r.en(d)&&(!a||d.fields.length>a.fields.length)&&(a=d);return a})}getIndexType(e,t){let r=2;const i=this.un(t);return D.forEach(i,s=>this.cn(e,s).next(a=>{a?0!==r&&a.fields.length<function(p){let _=new rt(tt.comparator),v=!1;for(const A of p.filters)for(const S of A.getFlattenedFilters())S.field.isKeyField()||("array-contains"===S.op||"array-contains-any"===S.op?v=!0:_=_.add(S.field));for(const A of p.orderBy)A.field.isKeyField()||(_=_.add(A.field));return _.size+(v?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new Nl;for(const i of Jr(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=r.jt(i.kind);ba.St.ht(s,a)}return r.Ut()}In(e){const t=new Nl;return ba.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Nl;return ba.St.ht(Ei(this.databaseId,t),r.jt(function(s){const a=Jr(s);return 0===a.length?0:a[a.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new Nl);let s=0;for(const a of Jr(e)){const d=r[s++];for(const p of i)if(this.Rn(t,a.fieldPath)&&Ti(d))i=this.Vn(i,a,d);else{const _=p.jt(a.kind);ba.St.ht(d,_)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const d of i){const p=new Nl;p.seed(d.Ut()),ba.St.ht(a,p.jt(t.kind)),s.push(p)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof M&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Vl(e),i=Tu(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{const a=[];return D.forEach(s,d=>i.get([d.indexId,this.uid]).next(p=>{a.push(function(v,A){const S=A?new $t(A.sequenceNumber,new jt(Pa(A.readTime),new ee(Rr(A.documentKey)),A.largestBatchId)):$t.empty(),k=v.fields.map(([Y,re])=>new Yr(tt.fromServerFormat(Y),re));return new $i(v.indexId,v.collectionGroup,k,S)}(d,p))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:Ee(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Vl(e),s=Tu(e);return this.fn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>D.forEach(d,p=>s.put(kf(p.indexId,this.uid,a,r)))))}updateIndexEntries(e,t){const r=new Map;return D.forEach(t,(i,s)=>{const a=r.get(i.collectionGroup);return(a?D.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(d=>(r.set(i.collectionGroup,d),D.forEach(d,p=>this.gn(e,i,p).next(_=>{const v=this.pn(s,p);return _.isEqual(v)?D.resolve():this.yn(e,s,p,_,v)}))))})}wn(e,t,r,i){return Eu(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return Eu(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=Eu(e);let s=new rt(vo);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(a,d)=>{s=s.add(new Ca(r.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>s)}pn(e,t){let r=new rt(vo);const i=this.dn(t,e);if(null==i)return r;const s=Ts(t);if(null!=s){const a=e.data.field(s.fieldPath);if(Ti(a))for(const d of a.arrayValue.values||[])r=r.add(new Ca(t.indexId,e.key,this.In(d),i))}else r=r.add(new Ca(t.indexId,e.key,_c,i));return r}yn(e,t,r,i,s){K("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(p,_,v,A,S){const k=p.getIterator(),Y=_.getIterator();let re=ei(k),te=ei(Y);for(;re||te;){let me=!1,be=!1;if(re&&te){const ye=v(re,te);ye<0?be=!0:ye>0&&(me=!0)}else null!=re?be=!0:me=!0;me?(A(te),te=ei(Y)):be?(S(re),re=ei(k)):(re=ei(k),te=ei(Y))}}(i,s,vo,d=>{a.push(this.wn(e,t,r,d))},d=>{a.push(this.Sn(e,t,r,d))}),D.waitFor(a)}fn(e){let t=1;return Tu(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,d)=>vo(a,d)).filter((a,d,p)=>!d||0!==vo(a,p[d-1]));const i=[];i.push(e);for(const a of r){const d=vo(a,e),p=vo(a,t);if(0===d)i[0]=e.Ht();else if(d>0&&p<0)i.push(a),i.push(a.Ht());else if(p>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.bn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,_c,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,_c,[]]))}return s}bn(e,t){return vo(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Wf)}getMinOffset(e,t){return D.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||ue())).next(Wf)}}function qf(n){return Ct(n,"collectionParents")}function Eu(n){return Ct(n,"indexEntries")}function Vl(n){return Ct(n,"indexConfiguration")}function Tu(n){return Ct(n,"indexState")}function Wf(n){de(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;na(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new jt(e.readTime,e.documentKey,t)}const Gf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Gn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Gn(e,Gn.DEFAULT_COLLECTION_PERCENTILE,Gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Kf(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let d=0;const p=r.J({range:a},(v,A,S)=>(d++,S.delete()));s.push(p.next(()=>{de(1===d)}));const _=[];for(const v of t.mutations){const A=Xa(e,v.key.path,t.batchId);s.push(i.delete(A)),_.push(v.key)}return D.waitFor(s).next(()=>_)}function yc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ue();e=n.noDocument}return JSON.stringify(e).length}Gn.DEFAULT_COLLECTION_PERCENTILE=10,Gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gn.DEFAULT=new Gn(41943040,Gn.DEFAULT_COLLECTION_PERCENTILE,Gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gn.DISABLED=new Gn(-1,0,0);class Ic{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){de(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Ic(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Eo(e).J({index:"userMutationsIndex",range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Au(e),a=Eo(e);return a.add({}).next(d=>{de("number"==typeof d);const p=new Jc(d,t,r,i),_=function(k,Y,re){const te=re.baseMutations.map(be=>xl(k.ut,be)),me=re.mutations.map(be=>xl(k.ut,be));return{userId:Y,batchId:re.batchId,localWriteTimeMs:re.localWriteTime.toMillis(),baseMutations:te,mutations:me}}(this.serializer,this.userId,p),v=[];let A=new rt((S,k)=>Ee(S.canonicalString(),k.canonicalString()));for(const S of i){const k=Xa(this.userId,S.key.path,d);A=A.add(S.key.path.popLast()),v.push(a.put(_)),v.push(s.put(k,cl))}return A.forEach(S=>{v.push(this.indexManager.addToCollectionParentIndex(e,S))}),e.addOnCommittedListener(()=>{this.Dn[d]=p.keys()}),D.waitFor(v).next(()=>p)})}lookupMutationBatch(e,t){return Eo(e).get(t).next(r=>r?(de(r.userId===this.userId),Sa(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?D.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Eo(e).J({index:"userMutationsIndex",range:i},(a,d,p)=>{d.userId===this.userId&&(de(d.batchId>=r),s=Sa(this.serializer,d)),p.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Eo(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Eo(e).U("userMutationsIndex",t).next(r=>r.map(i=>Sa(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=ao(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Au(e).J({range:i},(a,d,p)=>{const[_,v,A]=a,S=Rr(v);if(_===this.userId&&t.path.isEqual(S))return Eo(e).get(A).next(k=>{if(!k)throw ue();de(k.userId===this.userId),s.push(Sa(this.serializer,k))});p.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new rt(Ee);const i=[];return t.forEach(s=>{const a=ao(this.userId,s.path),d=IDBKeyRange.lowerBound(a),p=Au(e).J({range:d},(_,v,A)=>{const[S,k,Y]=_,re=Rr(k);S===this.userId&&s.path.isEqual(re)?r=r.add(Y):A.done()});i.push(p)}),D.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=ao(this.userId,r),a=IDBKeyRange.lowerBound(s);let d=new rt(Ee);return Au(e).J({range:a},(p,_,v)=>{const[A,S,k]=p,Y=Rr(S);A===this.userId&&r.isPrefixOf(Y)?Y.length===i&&(d=d.add(k)):v.done()}).next(()=>this.vn(e,d))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Eo(e).get(s).next(a=>{if(null===a)throw ue();de(a.userId===this.userId),r.push(Sa(this.serializer,a))}))}),D.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Kf(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),D.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return D.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Au(e).J({range:r},(s,a,d)=>{if(s[0]===this.userId){const p=Rr(s[1]);i.push(p)}else d.done()}).next(()=>{de(0===i.length)})})}containsKey(e,t){return zf(e,this.userId,t)}Mn(e){return $f(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function zf(n,e,t){const r=ao(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return Au(n).J({range:s,H:!0},(d,p,_)=>{const[v,A,S]=d;v===e&&A===i&&(a=!0),_.done()}).next(()=>a)}function Eo(n){return Ct(n,"mutations")}function Au(n){return Ct(n,"documentMutations")}function $f(n){return Ct(n,"mutationQueues")}class xa{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new xa(0)}static Nn(){return new xa(-1)}}class Qm{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{const r=new xa(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>ce.fromTimestamp(new xe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>wu(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(de(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return wu(e).J((a,d)=>{const p=Dl(d);p.sequenceNumber<=t&&null===r.get(p.targetId)&&(i++,s.push(this.removeTargetData(e,p)))}).next(()=>D.waitFor(s)).next(()=>i)}forEachTarget(e,t){return wu(e).J((r,i)=>{const s=Dl(i);t(s)})}Ln(e){return jf(e).get("targetGlobalKey").next(t=>(de(null!==t),t))}Bn(e,t){return jf(e).put("targetGlobalKey",t)}kn(e,t){return wu(e).put(xf(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Cs(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return wu(e).J({range:i,index:"queryTargetsIndex"},(a,d,p)=>{const _=Dl(d);po(t,_.target)&&(s=_,p.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=To(e);return t.forEach(a=>{const d=bt(a.path);i.push(s.put({targetId:r,path:d})),i.push(this.referenceDelegate.addReference(e,r,a))}),D.waitFor(i)}removeMatchingKeys(e,t,r){const i=To(e);return D.forEach(t,s=>{const a=bt(s.path);return D.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=To(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=To(e);let s=h();return i.J({range:r,H:!0},(a,d,p)=>{const _=Rr(a[1]),v=new ee(_);s=s.add(v)}).next(()=>s)}containsKey(e,t){const r=bt(t.path),i=IDBKeyRange.bound([r],[sl(r)],!1,!0);let s=0;return To(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,d],p,_)=>{0!==a&&(s++,_.done())}).next(()=>s>0)}ot(e,t){return wu(e).get(t).next(r=>r?Dl(r):null)}}function wu(n){return Ct(n,"targets")}function jf(n){return Ct(n,"targetGlobal")}function To(n){return Ct(n,"targetDocuments")}function Hf([n,e],[t,r]){const i=Ee(n,t);return 0===i?Ee(e,r):i}class Jm{constructor(e){this.Qn=e,this.buffer=new rt(Hf),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Hf(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qf{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;K("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,I.A)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){wr(r)?K("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield or(r)}yield t.Gn(3e5)}))}}class Ym{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return D.resolve(Rn.oe);const r=new Jm(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(Gf)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Gf):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,a,d,p,_;const v=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),i=this.params.maximumSequenceNumbersToCollect):i=A,a=Date.now(),this.nthSequenceNumber(e,i))).next(A=>(r=A,d=Date.now(),this.removeTargets(e,r,t))).next(A=>(s=A,p=Date.now(),this.removeOrphanedDocuments(e,r))).next(A=>(_=Date.now(),zi()<=Ie.$b.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-v}ms\n\tDetermined least recently used ${i} in `+(d-a)+`ms\n\tRemoved ${s} targets in `+(p-d)+`ms\n\tRemoved ${A} documents in `+(_-p)+`ms\nTotal Duration: ${_-v}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:A})))}}class Xm{constructor(e,t){this.db=e,this.garbageCollector=function Jf(n,e){return new Ym(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return vc(e,r)}removeReference(e,t,r){return vc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return vc(e,t)}Xn(e,t){return function(i,s){let a=!1;return $f(i).Y(d=>zf(i,d,s).next(p=>(p&&(a=!0),D.resolve(!p)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(a,d)=>{if(d<=t){const p=this.Xn(e,a).next(_=>{if(!_)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,ce.min()),To(e).delete([0,bt(a.path)])))});i.push(p)}}).next(()=>D.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return vc(e,t)}Zn(e,t){const r=To(e);let i,s=Rn.oe;return r.J({index:"documentTargetsIndex"},([a,d],{path:p,sequenceNumber:_})=>{0===a?(s!==Rn.oe&&t(new ee(Rr(i)),s),s=_,i=p):s=Rn.oe}).next(()=>{s!==Rn.oe&&t(new ee(Rr(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function vc(n,e){return To(n).put((i=n.currentSequenceNumber,{targetId:0,path:bt(e.path),sequenceNumber:i}));var i}class Yf{constructor(){this.changes=new Ri(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,f.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Zm{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Da(e).put(r)}removeEntry(e,t,r){return Da(e).delete(function(s,a){const d=s.path.toArray();return[d.slice(0,d.length-2),d[d.length-2],pc(a),d[d.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=f.newInvalidDocument(t);return Da(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ol(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:f.newInvalidDocument(t)};return Da(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ol(t))},(i,s)=>{r={document:this.tr(t,s),size:yc(s)}}).next(()=>r)}getEntries(e,t){let r=Wn();return this.rr(e,t,(i,s)=>{const a=this.tr(i,s);r=r.insert(i,a)}).next(()=>r)}ir(e,t){let r=Wn(),i=new Ue(ee.comparator);return this.rr(e,t,(s,a)=>{const d=this.tr(s,a);r=r.insert(s,d),i=i.insert(s,yc(a))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return D.resolve();let i=new rt(tp);t.forEach(p=>i=i.add(p));const s=IDBKeyRange.bound(Ol(i.first()),Ol(i.last())),a=i.getIterator();let d=a.getNext();return Da(e).J({index:"documentKeyIndex",range:s},(p,_,v)=>{const A=ee.fromSegments([..._.prefixPath,_.collectionGroup,_.documentId]);for(;d&&tp(d,A)<0;)r(d,null),d=a.getNext();d&&d.isEqual(A)&&(r(d,_),d=a.hasNext()?a.getNext():null),d?v.$(Ol(d)):v.done()}).next(()=>{for(;d;)r(d,null),d=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const a=t.path,d=[a.popLast().toArray(),a.lastSegment(),pc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],p=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Da(e).U(IDBKeyRange.bound(d,p,!0)).next(_=>{null==s||s.incrementDocumentReadCount(_.length);let v=Wn();for(const A of _){const S=this.tr(ee.fromSegments(A.prefixPath.concat(A.collectionGroup,A.documentId)),A);S.isFoundDocument()&&(Zi(t,S)||i.has(S.key))&&(v=v.insert(S.key,S))}return v})}getAllFromCollectionGroup(e,t,r,i){let s=Wn();const a=ep(t,r),d=ep(t,jt.max());return Da(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,d,!0)},(p,_,v)=>{const A=this.tr(ee.fromSegments(_.prefixPath.concat(_.collectionGroup,_.documentId)),_);s=s.insert(A.key,A),s.size===i&&v.done()}).next(()=>s)}newChangeBuffer(e){return new eg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Zf(e).get("remoteDocumentGlobalKey").next(t=>(de(!!t),t))}er(e,t){return Zf(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function Bm(n,e){let t;if(e.document)t=Tf(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ee.fromSegments(e.noDocument.path),i=Pa(e.noDocument.readTime);t=f.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ue();{const r=ee.fromSegments(e.unknownDocument.path),i=Pa(e.unknownDocument.version);t=f.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new xe(i[0],i[1]);return ce.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(ce.min()))return r}return f.newInvalidDocument(e)}}function Xf(n){return new Zm(n)}class eg extends Yf{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new Ri(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new rt((s,a)=>Ee(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const d=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,d.readTime)),a.isValidDocument()){const p=Cf(this._r.serializer,a);i=i.add(s.path.popLast());const _=yc(p);r+=_-d.size,t.push(this._r.addEntry(e,s,p))}else if(r-=d.size,this.trackRemovals){const p=Cf(this._r.serializer,a.convertToNoDocument(ce.min()));t.push(this._r.addEntry(e,s,p))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),D.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,a)=>{this.ar.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function Zf(n){return Ct(n,"remoteDocumentGlobal")}function Da(n){return Ct(n,"remoteDocumentsV14")}function Ol(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ep(n,e){const t=e.documentKey.path.toArray();return[n,pc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function tp(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Ee(t[s],r[s]),i)return i;return i=Ee(t.length,r.length),i||(i=Ee(t[t.length-2],r[r.length-2]),i||Ee(t[t.length-1],r[r.length-1]))}class tg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class np{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Rl(r.mutation,i,ln.empty(),xe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,h()).next(()=>r))}getLocalViewOfDocuments(e,t,r=h()){const i=ri();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=go();return s.forEach((d,p)=>{a=a.insert(d,p.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=ri();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,h()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,d)=>{t.set(a,d)})})}computeViews(e,t,r,i){let s=Wn();const a=c(),d=c();return t.forEach((p,_)=>{const v=r.get(_.key);i.has(_.key)&&(void 0===v||v.mutation instanceof ks)?s=s.insert(_.key,_):void 0!==v?(a.set(_.key,v.mutation.getFieldMask()),Rl(v.mutation,_,v.mutation.getFieldMask(),xe.now())):a.set(_.key,ln.empty())}),this.recalculateAndSaveOverlays(e,s).next(p=>(p.forEach((_,v)=>a.set(_,v)),t.forEach((_,v)=>{var A;return d.set(_,new tg(v,null!==(A=a.get(_))&&void 0!==A?A:null))}),d))}recalculateAndSaveOverlays(e,t){const r=c();let i=new Ue((a,d)=>a-d),s=h();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const d of a)d.keys().forEach(p=>{const _=t.get(p);if(null===_)return;let v=r.get(p)||ln.empty();v=d.applyToLocalView(_,v),r.set(p,v);const A=(i.get(d.batchId)||h()).add(p);i=i.insert(d.batchId,A)})}).next(()=>{const a=[],d=i.getReverseIterator();for(;d.hasNext();){const p=d.getNext(),_=p.key,v=p.value,A=cc();v.forEach(S=>{if(!s.has(S)){const k=Zd(t.get(S),r.get(S));null!==k&&A.set(S,k),s=s.add(S)}}),a.push(this.documentOverlayCache.saveOverlays(e,_,A))}return D.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return ee.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Aa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var a}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):D.resolve(ri());let d=-1,p=s;return a.next(_=>D.forEach(_,(v,A)=>(d<A.largestBatchId&&(d=A.largestBatchId),s.get(v)?D.resolve():this.remoteDocumentCache.getEntry(e,v).next(S=>{p=p.insert(v,S)}))).next(()=>this.populateOverlays(e,_,s)).next(()=>this.computeViews(e,p,_,h())).next(v=>({batchId:d,changes:lc(v)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ee(t)).next(r=>{let i=go();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=go();return this.indexManager.getCollectionParents(e,s).next(d=>D.forEach(d,p=>{const _=(A=t,S=p.child(s),new wi(S,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt));var A,S;return this.getDocumentsMatchingCollectionQuery(e,_,r,i).next(v=>{v.forEach((A,S)=>{a=a.insert(A,S)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((p,_)=>{const v=_.getKey();null===a.get(v)&&(a=a.insert(v,f.newInvalidDocument(v)))});let d=go();return a.forEach((p,_)=>{const v=s.get(p);void 0!==v&&Rl(v.mutation,_,ln.empty(),xe.now()),Zi(t,_)&&(d=d.insert(p,_))}),d})}}class ng{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return D.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:Ht(i.createTime)}),D.resolve();var i}getNamedQuery(e,t){return D.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:oh(i.bundledQuery),readTime:Ht(i.readTime)}),D.resolve();var i}}class rg{constructor(){this.overlays=new Ue(ee.comparator),this.lr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ri();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){const i=ri(),s=t.length+1,a=new ee(t.child("")),d=this.overlays.getIteratorFrom(a);for(;d.hasNext();){const p=d.getNext().value,_=p.getKey();if(!t.isPrefixOf(_.path))break;_.path.length===s&&p.largestBatchId>r&&i.set(p.getKey(),p)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ue((_,v)=>_-v);const a=this.overlays.getIterator();for(;a.hasNext();){const _=a.getNext().value;if(_.getKey().getCollectionGroup()===t&&_.largestBatchId>r){let v=s.get(_.largestBatchId);null===v&&(v=ri(),s=s.insert(_.largestBatchId,v)),v.set(_.getKey(),_)}}const d=ri(),p=s.getIterator();for(;p.hasNext()&&(p.getNext().value.forEach((_,v)=>d.set(_,v)),!(d.size()>=i)););return D.resolve(d)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const a=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Xc(t,r));let s=this.lr.get(t);void 0===s&&(s=h(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class fh{constructor(){this.hr=new rt(vn.Pr),this.Ir=new rt(vn.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new vn(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new vn(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new ee(new Se([])),r=new vn(t,e),i=new vn(t,e+1),s=[];return this.Ir.forEachInRange([r,i],a=>{this.dr(a),s.push(a.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new ee(new Se([])),r=new vn(t,e),i=new vn(t,e+1);let s=h();return this.Ir.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new vn(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class vn{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return ee.comparator(e.key,t.key)||Ee(e.gr,t.gr)}static Tr(e,t){return Ee(e.gr,t.gr)||ee.comparator(e.key,t.key)}}class ig{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new rt(vn.Pr)}checkEmpty(e){return D.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const a=new Jc(s,t,r,i);this.mutationQueue.push(a);for(const d of i)this.yr=this.yr.add(new vn(d.key,s)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new vn(t,0),i=new vn(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],a=>{const d=this.wr(a.gr);s.push(d)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new rt(Ee);return t.forEach(i=>{const s=new vn(i,0),a=new vn(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,a],d=>{r=r.add(d.gr)})}),D.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;ee.isDocumentKey(s)||(s=s.child(""));const a=new vn(new ee(s),0);let d=new rt(Ee);return this.yr.forEachWhile(p=>{const _=p.key.path;return!!r.isPrefixOf(_)&&(_.length===i&&(d=d.add(p.gr)),!0)},a),D.resolve(this.br(d))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){de(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return D.forEach(t.mutations,i=>{const s=new vn(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new vn(t,0),i=this.yr.firstAfterOrEqual(r);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return D.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sg{constructor(e){this.Cr=e,this.docs=new Ue(ee.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():f.newInvalidDocument(t))}getEntries(e,t){let r=Wn();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():f.newInvalidDocument(i))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Wn();const a=t.path,d=new ee(a.child("")),p=this.docs.getIteratorFrom(d);for(;p.hasNext();){const{key:_,value:{document:v}}=p.getNext();if(!a.isPrefixOf(_.path))break;_.path.length>a.length+1||na(As(v),r)<=0||(i.has(v.key)||Zi(t,v))&&(s=s.insert(v.key,v.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(e,t,r,i){ue()}vr(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new og(this)}getSize(e){return D.resolve(this.size)}}class og extends Yf{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class ag{constructor(e){this.persistence=e,this.Fr=new Ri(t=>Cs(t),po),this.lastRemoteSnapshotVersion=ce.min(),this.highestTargetId=0,this.Mr=0,this.Or=new fh,this.targetCount=0,this.Nr=xa.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),D.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new xa(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.kn(t),D.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((a,d)=>{d.sequenceNumber<=t&&null===r.get(d.targetId)&&(this.Fr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),D.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this.Or.containsKey(t))}}class ph{constructor(e,t){this.Lr={},this.overlays={},this.Br=new Rn(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new ag(this),this.indexManager=new jm,this.remoteDocumentCache=new sg(r=>this.referenceDelegate.Qr(r)),this.serializer=new bf(t),this.Kr=new ng(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new rg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new ig(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){K("MemoryPersistence","Starting transaction:",e);const i=new ug(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return D.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}}class ug extends ji{constructor(e){super(),this.currentSequenceNumber=e}}class Ec{constructor(e){this.persistence=e,this.Gr=new fh,this.zr=null}static jr(e){return new Ec(e)}get Hr(){if(this.zr)return this.zr;throw ue()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),D.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.Hr,r=>{const i=ee.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,ce.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return D.or([()=>D.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class lg{constructor(e){this.serializer=e}O(e,t,r,i){const s=new oo("createOrUpgrade",t);var p;r<1&&i>=1&&(e.createObjectStore("owner"),(p=e).createObjectStore("mutationQueues",{keyPath:"userId"}),p.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Un,{unique:!0}),p.createObjectStore("documentMutations"),rp(e),function(p){p.createObjectStore("remoteDocuments")}(e));let a=D.resolve();return r<3&&i>=3&&(0!==r&&(function(p){p.deleteObjectStore("targetDocuments"),p.deleteObjectStore("targets"),p.deleteObjectStore("targetGlobal")}(e),rp(e)),a=a.next(()=>function(p){const _=p.store("targetGlobal"),v={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ce.min().toTimestamp(),targetCount:0};return _.put("targetGlobalKey",v)}(s))),r<4&&i>=4&&(0!==r&&(a=a.next(()=>function(p,_){return _.store("mutations").U().next(v=>{p.deleteObjectStore("mutations"),p.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Un,{unique:!0});const A=_.store("mutations"),S=v.map(k=>A.put(k));return D.waitFor(S)})}(e,s))),a=a.next(()=>{!function(p){p.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(a=a.next(()=>this.Zr(s))),r<6&&i>=6&&(a=a.next(()=>(function(p){p.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(a=a.next(()=>this.ei(s))),r<8&&i>=8&&(a=a.next(()=>this.ti(e,s))),r<9&&i>=9&&(a=a.next(()=>{!function(p){p.objectStoreNames.contains("remoteDocumentChanges")&&p.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(a=a.next(()=>this.ni(s))),r<11&&i>=11&&(a=a.next(()=>{(function(p){p.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(p){p.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{!function(p){const _=p.createObjectStore("documentOverlays",{keyPath:tu});_.createIndex("collectionPathOverlayIndex",ml,{unique:!1}),_.createIndex("collectionGroupOverlayIndex",ha,{unique:!1})}(e)})),r<13&&i>=13&&(a=a.next(()=>function(p){const _=p.createObjectStore("remoteDocumentsV14",{keyPath:uo});_.createIndex("documentKeyIndex",Za),_.createIndex("collectionGroupIndex",Ii)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.ii(e,s))),r<15&&i>=15&&(a=a.next(()=>function(p){p.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),p.createObjectStore("indexState",{keyPath:fl}).createIndex("sequenceNumberIndex",pl,{unique:!1}),p.createObjectStore("indexEntries",{keyPath:la}).createIndex("documentKeyIndex",ca,{unique:!1})}(e))),r<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),a}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=yc(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>D.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(d=>D.forEach(d,p=>{de(p.userId===s.userId);const _=Sa(this.serializer,p);return Kf(e,s.userId,_).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((a,d)=>{const p=new Se(a),_=[0,bt(p)];s.push(t.get(_).next(v=>v?D.resolve():t.put({targetId:0,path:bt(p),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>D.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:dl});const r=t.store("collectionParents"),i=new dh,s=a=>{if(i.add(a)){const d=a.lastSegment(),p=a.popLast();return r.put({collectionId:d,parent:bt(p)})}};return t.store("remoteDocuments").J({H:!0},(a,d)=>{const p=new Se(a);return s(p.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,d,p],_)=>{const v=Rr(d);return s(v.popLast())}))}ni(e){const t=e.store("targets");return t.J((r,i)=>{const s=Dl(i),a=xf(this.serializer,s);return t.put(a)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.J((s,a)=>{const d=t.store("remoteDocumentsV14"),p=(A=a,A.document?new ee(Se.fromString(A.document.name).popFirst(5)):A.noDocument?ee.fromSegments(A.noDocument.path):A.unknownDocument?ee.fromSegments(A.unknownDocument.path):ue()).path.toArray(),_={prefixPath:p.slice(0,p.length-2),collectionGroup:p[p.length-2],documentId:p[p.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var A;i.push(d.put(_))}).next(()=>D.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=Xf(this.serializer),s=new ph(Ec.jr,this.serializer.ut);return r.U().next(a=>{const d=new Map;return a.forEach(p=>{var _;let v=null!==(_=d.get(p.userId))&&void 0!==_?_:h();Sa(this.serializer,p).keys().forEach(A=>v=v.add(A)),d.set(p.userId,v)}),D.forEach(d,(p,_)=>{const v=new Vt(_),A=mc.ct(this.serializer,v),S=s.getIndexManager(v),k=Ic.ct(v,this.serializer,S,s.referenceDelegate);return new np(i,k,A,S).recalculateAndSaveOverlaysForDocumentKeys(new Hi(t,Rn.oe),p).next()})})}}function rp(n){n.createObjectStore("targetDocuments",{keyPath:ua}).createIndex("documentTargetsIndex",eu,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",hl,{unique:!0}),n.createObjectStore("targetGlobal")}const mh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class gh{constructor(e,t,r,i,s,a,d,p,_,v,A=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=a,this.document=d,this.oi=_,this._i=v,this.ai=A,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=S=>Promise.resolve(),!gh.D())throw new W(L.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xm(this,i),this.Ii=t+"main",this.serializer=new bf(p),this.Ti=new Ar(this.Ii,this.ai,new lg(this.serializer)),this.qr=new Qm(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Xf(this.serializer),this.Kr=new qm,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===v&&Rt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new W(L.FAILED_PRECONDITION,mh);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new Rn(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,I.A)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,I.A)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,I.A)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ac(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(wr(e))return K("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return K("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Ll(e).get("owner").next(t=>D.resolve(this.wi(t)))}Si(e){return Ac(e).delete(this.clientId)}bi(){var e=this;return(0,I.A)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Ct(r,"clientMetadata");return i.U().next(s=>{const a=e.Ci(s,18e5),d=s.filter(p=>-1===a.indexOf(p));return D.forEach(d,p=>i.delete(p.clientId)).next(()=>d)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?D.resolve(!0):Ll(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new W(L.FAILED_PRECONDITION,mh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ac(e).U().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&K("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,I.A)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Hi(t,Rn.oe);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Ac(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Ic.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Hm(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return mc.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){K("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(p=this.ai)?co:15===p?ru:14===p?lo:13===p?fa:12===p?da:11===p?nu:void ue();var p;let a;return this.Ti.runTransaction(e,i,s,d=>(a=new Hi(d,this.Br?this.Br.next():Rn.oe),"readwrite-primary"===t?this.fi(a).next(p=>!!p||this.gi(a)).next(p=>{if(!p)throw Rt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new W(L.FAILED_PRECONDITION,ut);return r(a)}).next(p=>this.yi(a).next(()=>p)):this.Bi(a).next(()=>r(a)))).then(d=>(a.raiseOnCommittedEvent(),d))}Bi(e){return Ll(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new W(L.FAILED_PRECONDITION,mh)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ll(e).put("owner",t)}static D(){return Ar.D()}pi(e){const t=Ll(e);return t.get("owner").next(r=>this.wi(r)?(K("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):D.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(Rt(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,Re.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return K("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Rt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){Rt("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ll(n){return Ct(n,"owner")}function Ac(n){return Ct(n,"clientMetadata")}function _h(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class yh{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=h(),i=h();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new yh(e,t.fromCache,r,i)}}class cg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ip{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=(0,Re.nr)()?8:ia((0,Re.ZQ)())>0?6:4}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new cg;return this.Hi(e,t,a).next(d=>{if(s.result=d,this.$i)return this.Ji(e,t,a,d.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(zi()<=Ie.$b.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",xs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),D.resolve()):(zi()<=Ie.$b.DEBUG&&K("QueryEngine","Query:",xs(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(zi()<=Ie.$b.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",xs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,In(t))):D.resolve())}zi(e,t){if(ac(t))return D.resolve(null);let r=In(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=du(t,null,"F"),r=In(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=h(...s);return this.Gi.getDocuments(e,a).next(d=>this.indexManager.getMinOffset(e,r).next(p=>{const _=this.Yi(t,d);return this.Zi(t,_,a,p.readTime)?this.zi(e,du(t,null,"F")):this.Xi(e,_,t,p)}))})))}ji(e,t,r,i){return ac(t)||i.isEqual(ce.min())?D.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const a=this.Yi(t,s);return this.Zi(t,a,r,i)?D.resolve(null):(zi()<=Ie.$b.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),xs(t)),this.Xi(e,a,t,sr(i,-1)).next(d=>d))})}Yi(e,t){let r=new rt(vl(e));return t.forEach((i,s)=>{Zi(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return zi()<=Ie.$b.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",xs(t)),this.Gi.getDocumentsMatchingQuery(e,t,jt.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class hg{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Ue(Ee),this.ns=new Ri(s=>Cs(s),po),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new np(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function sp(n,e,t,r){return new hg(n,e,t,r)}function op(n,e){return Ih.apply(this,arguments)}function Ih(){return Ih=(0,I.A)(function*(n,e){const t=ne(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],d=[];let p=h();for(const _ of i){a.push(_.batchId);for(const v of _.mutations)p=p.add(v.key)}for(const _ of s){d.push(_.batchId);for(const v of _.mutations)p=p.add(v.key)}return t.localDocuments.getDocuments(r,p).next(_=>({_s:_,removedBatchIds:a,addedBatchIds:d}))})})}),Ih.apply(this,arguments)}function ap(n){const e=ne(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function up(n,e,t){let r=h(),i=h();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Wn();return t.forEach((d,p)=>{const _=s.get(d);p.isFoundDocument()!==_.isFoundDocument()&&(i=i.add(d)),p.isNoDocument()&&p.version.isEqual(ce.min())?(e.removeEntry(d,p.readTime),a=a.insert(d,p)):!_.isValidDocument()||p.version.compareTo(_.version)>0||0===p.version.compareTo(_.version)&&_.hasPendingWrites?(e.addEntry(p),a=a.insert(d,p)):K("LocalStore","Ignoring outdated watch update for ",d,". Current version:",_.version," Watch version:",p.version)}),{us:a,cs:i}})}function pg(n,e){const t=ne(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ru(n,e){const t=ne(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,D.resolve(i)):t.qr.allocateTargetId(r).next(a=>(i=new Ns(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Pu(n,e,t){return vh.apply(this,arguments)}function vh(){return vh=(0,I.A)(function*(n,e,t){const r=ne(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!wr(a))throw a;K("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),vh.apply(this,arguments)}function wc(n,e,t){const r=ne(n);let i=ce.min(),s=h();return r.persistence.runTransaction("Execute query","readwrite",a=>function(p,_,v){const A=ne(p),S=A.ns.get(v);return void 0!==S?D.resolve(A.ts.get(S)):A.qr.getTargetData(_,v)}(r,a,In(e)).next(d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(a,d.targetId).next(p=>{s=p})}).next(()=>r.es.getDocumentsMatchingQuery(a,e,t?i:ce.min(),t?s:h())).next(d=>(hp(r,Il(e),d),{documents:d,ls:s})))}function lp(n,e){const t=ne(n),r=ne(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(a=>a?a.target:null))}function cp(n,e){const t=ne(n),r=t.rs.get(e)||ce.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,sr(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(hp(t,e,i),i))}function hp(n,e,t){let r=n.rs.get(e)||ce.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Eh(){return Eh=(0,I.A)(function*(n,e,t,r){const i=ne(n);let s=h(),a=Wn();for(const _ of t){const v=e.hs(_.metadata.name);_.document&&(s=s.add(v));const A=e.Ps(_);A.setReadTime(e.Is(_.metadata.readTime)),a=a.insert(v,A)}const d=i.ss.newChangeBuffer({trackRemovals:!0}),p=yield Ru(i,(v=r,In(Xi(Se.fromString(`__bundle__/docs/${v}`)))));var v;return i.persistence.runTransaction("Apply bundle documents","readwrite",_=>up(_,d,a).next(v=>(d.apply(_),v)).next(v=>i.qr.removeMatchingKeysForTargetId(_,p.targetId).next(()=>i.qr.addMatchingKeys(_,s,p.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(_,v.us,v.cs)).next(()=>v.us)))}),Eh.apply(this,arguments)}function gg(n,e){return Th.apply(this,arguments)}function Th(){return Th=(0,I.A)(function*(n,e,t=h()){const r=yield Ru(n,In(oh(e.bundledQuery))),i=ne(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ht(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Kr.saveNamedQuery(s,e);const d=r.withResumeToken(xt.EMPTY_BYTE_STRING,a);return i.ts=i.ts.insert(d.targetId,d),i.qr.updateTargetData(s,d).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),Th.apply(this,arguments)}function dp(n,e){return`firestore_clients_${n}_${e}`}function fp(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ah(n,e){return`firestore_targets_${n}_${e}`}class Rc{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new W(i.error.code,i.error.message))),a?new Rc(e,t,i.state,s):(Rt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ml{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new W(r.error.code,r.error.message))),s?new Ml(e,r.state,i):(Rt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Pc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=E();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=Ya(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new Pc(e,s):(Rt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class wh{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new wh(t.clientId,t.onlineState):(Rt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Rh{constructor(){this.activeTargetIds=E()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ph{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Ue(Ee),this.started=!1,this.ps=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=dp(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new Rh),this.Ss=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(p){return`firestore_bundle_loaded_v2_${p}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,I.A)(function*(){const t=yield e.syncEngine.Li();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(dp(e.persistenceKey,i));if(s){const a=Pc.Ts(i,s);a&&(e.gs=e.gs.insert(a.clientId,a))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Ah(this.persistenceKey,e));if(r){const i=Ml.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ah(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return K("SharedClientState","READ",e,t),t}setItem(e,t){K("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){K("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(K("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void Rt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,I.A)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(a){let d=Rn.oe;if(null!=a)try{const p=JSON.parse(a);de("number"==typeof p),d=p}catch(p){Rt("SharedClientState","Failed to read sequence number from WebStorage",p)}return d}(r.newValue);i!==Rn.oe&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){const i=new Rc(this.currentUser,e,t,r),s=fp(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){const t=fp(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=Ah(this.persistenceKey,e),s=new Ml(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return Pc.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return Rc.Ts(new Vt(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return Ml.Ts(i,t)}Ms(e){return wh.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,I.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);K("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),a=[],d=[];return s.forEach(p=>{i.has(p)||a.push(p)}),i.forEach(p=>{s.has(p)||d.push(p)}),this.syncEngine.Xs(a,d).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=E();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class pp{constructor(){this.eo=new Rh,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Rh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class _g{ro(e){}shutdown(){}}class mp{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){K("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){K("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Sc=null;function Sh(){return null===Sc?Sc=268435456+Math.round(2147483648*Math.random()):Sc++,"0x"+Sc.toString(16)}const yg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ig{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}}const Kn="WebChannelConnection";class vg extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,a){const d=Sh(),p=this.Co(t,r.toUriEncodedString());K("RestConnection",`Sending RPC '${t}' ${d}:`,p,i);const _={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(_,s,a),this.Fo(t,p,_,i).then(v=>(K("RestConnection",`Received RPC '${t}' ${d}: `,v),v),v=>{throw _n("RestConnection",`RPC '${t}' ${d} failed with error: `,v,"url: ",p,"request:",i),v})}Mo(t,r,i,s,a,d){return this.Do(t,r,i,s,a)}vo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Mn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}Co(t,r){return`${this.yo}/v1/${r}:${yg[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){const s=Sh();return new Promise((a,d)=>{const p=new io;p.setWithCredentials(!0),p.listenOnce(el.COMPLETE,()=>{try{switch(p.getLastErrorCode()){case vs.NO_ERROR:const v=p.getResponseJson();K(Kn,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(v)),a(v);break;case vs.TIMEOUT:K(Kn,`RPC '${e}' ${s} timed out`),d(new W(L.DEADLINE_EXCEEDED,"Request time out"));break;case vs.HTTP_ERROR:const A=p.getStatus();if(K(Kn,`RPC '${e}' ${s} failed with status:`,A,"response text:",p.getResponseText()),A>0){let S=p.getResponseJson();Array.isArray(S)&&(S=S[0]);const k=null==S?void 0:S.error;if(k&&k.status&&k.message){const Y=function(te){const me=te.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(me)>=0?me:L.UNKNOWN}(k.status);d(new W(Y,k.message))}else d(new W(L.UNKNOWN,"Server responded with status "+p.getStatus()))}else d(new W(L.UNAVAILABLE,"Connection failed."));break;default:ue()}}finally{K(Kn,`RPC '${e}' ${s} completed.`)}});const _=JSON.stringify(i);K(Kn,`RPC '${e}' ${s} sending request:`,i),p.send(t,"POST",_,r,15)})}xo(e,t,r){const i=Sh(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ut(),d=Zu(),p={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},_=this.longPollingOptions.timeoutSeconds;void 0!==_&&(p.longPollingTimeout=Math.round(1e3*_)),this.useFetchStreams&&(p.xmlHttpFactory=new Xo({})),this.vo(p.initMessageHeaders,t,r),p.encodeInitMessageHeaders=!0;const v=s.join("");K(Kn,`Creating RPC '${e}' stream ${i}: ${v}`,p);const A=a.createWebChannel(v,p);let S=!1,k=!1;const Y=new Ig({co:te=>{k?K(Kn,`Not sending because RPC '${e}' stream ${i} is closed:`,te):(S||(K(Kn,`Opening RPC '${e}' stream ${i} transport.`),A.open(),S=!0),K(Kn,`RPC '${e}' stream ${i} sending:`,te),A.send(te))},lo:()=>A.close()}),re=(te,me,be)=>{te.listen(me,ye=>{try{be(ye)}catch(ke){setTimeout(()=>{throw ke},0)}})};return re(A,gi.EventType.OPEN,()=>{k||(K(Kn,`RPC '${e}' stream ${i} transport opened.`),Y.Vo())}),re(A,gi.EventType.CLOSE,()=>{k||(k=!0,K(Kn,`RPC '${e}' stream ${i} transport closed`),Y.fo())}),re(A,gi.EventType.ERROR,te=>{k||(k=!0,_n(Kn,`RPC '${e}' stream ${i} transport errored:`,te),Y.fo(new W(L.UNAVAILABLE,"The operation could not be completed")))}),re(A,gi.EventType.MESSAGE,te=>{var me;if(!k){const be=te.data[0];de(!!be);const ke=be.error||(null===(me=be[0])||void 0===me?void 0:me.error);if(ke){K(Kn,`RPC '${e}' stream ${i} received error:`,ke);const yt=ke.status;let ht=function(Ly){const vm=sn[Ly];if(void 0!==vm)return af(vm)}(yt),cn=ke.message;void 0===ht&&(ht=L.INTERNAL,cn="Unknown error status: "+yt+" with message "+ke.message),k=!0,Y.fo(new W(ht,cn)),A.close()}else K(Kn,`RPC '${e}' stream ${i} received:`,be),Y.po(be)}}),re(d,Yo.STAT_EVENT,te=>{te.stat===Ha.PROXY?K(Kn,`RPC '${e}' stream ${i} detected buffering proxy`):te.stat===Ha.NOPROXY&&K(Kn,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{Y.mo()},0),Y}}function gp(){return typeof window<"u"?window:null}function bc(){return typeof document<"u"?document:null}function Fl(n){return new xm(n,!0)}class bh{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();const t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&K("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class _p{constructor(e,t,r,i,s,a,d,p){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=d,this.listener=p,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new bh(e,t)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}stop(){var e=this;return(0,I.A)(function*(){e.Yo()&&(yield e.close(0))})()}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){var e=this;return(0,I.A)(function*(){if(e.Zo())return e.close(0)})()}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){var r=this;return(0,I.A)(function*(){r.i_(),r.s_(),r.Jo.cancel(),r.zo++,4!==e?r.Jo.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(Rt(t.toString()),Rt("Using maximum backoff delay to prevent overloading the backend."),r.Jo.Qo()):t&&t.code===L.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.o_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Eo(t)})()}o_(){}auth(){this.state=1;const e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{const i=new W(L.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){const r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){var e=this;this.state=5,this.Jo.Ko((0,I.A)(function*(){e.state=0,e.start()}))}u_(e){return K("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(K("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Eg extends _p{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();const t=function Nm(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(_=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===_?1:"REMOVE"===_?2:"CURRENT"===_?3:"RESET"===_?4:ue(),i=e.targetChange.targetIds||[],s=function(_,v){return _.useProto3Json?(de(void 0===v||"string"==typeof v),xt.fromBase64String(v||"")):(de(void 0===v||v instanceof Buffer||v instanceof Uint8Array),xt.fromUint8Array(v||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,d=a&&function(_){const v=void 0===_.code?L.UNKNOWN:af(_.code);return new W(v,_.message||"")}(a);t=new df(r,i,s,d||null)}else if("documentChange"in e){const r=e.documentChange,i=es(n,r.document.name),s=Ht(r.document.updateTime),a=r.document.createTime?Ht(r.document.createTime):ce.min(),d=new rn({mapValue:{fields:r.document.fields}}),p=f.newFoundDocument(i,s,a,d);t=new fc(r.targetIds||[],r.removedTargetIds||[],p.key,p)}else if("documentDelete"in e){const r=e.documentDelete,i=es(n,r.document),s=r.readTime?Ht(r.readTime):ce.min(),a=f.newNoDocument(i,s);t=new fc([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const r=e.documentRemove,i=es(n,r.document);t=new fc([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return ue();{const r=e.filter,{count:i=0,unchangedNames:s}=r,a=new wm(i,s);t=new hf(r.targetId,a)}}var _;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return ce.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?ce.min():a.readTime?Ht(a.readTime):ce.min()}(e);return this.listener.l_(t,r)}h_(e){const t={};t.database=rh(this.serializer),t.addTarget=function(s,a){let d;const p=a.target;if(d=lu(p)?{documents:Af(s,p)}:{query:sh(s,p)._t},d.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){d.resumeToken=gf(s,a.resumeToken);const _=eh(s,a.expectedCount);null!==_&&(d.expectedCount=_)}else if(a.snapshotVersion.compareTo(ce.min())>0){d.readTime=Iu(s,a.snapshotVersion.toTimestamp());const _=eh(s,a.expectedCount);null!==_&&(d.expectedCount=_)}return d}(this.serializer,e);const r=function Om(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ue()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.r_(t)}P_(e){const t={};t.database=rh(this.serializer),t.removeTarget=e,this.r_(t)}}class Tg extends _p{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(de(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();const t=function Vm(n,e){return n&&n.length>0?(de(void 0!==e),n.map(t=>function(i,s){let a=Ht(i.updateTime?i.updateTime:s);return a.isEqual(ce.min())&&(a=Ht(s)),new hc(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Ht(e.commitTime);return this.listener.d_(r,t)}return de(!e.writeResults||0===e.writeResults.length),this.I_=!0,this.listener.A_()}R_(){const e={};e.database=rh(this.serializer),this.r_(e)}E_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>xl(this.serializer,r))};this.r_(t)}}class Ag extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new W(L.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Do(e,nh(t,r),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new W(L.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.connection.Mo(e,nh(t,r),i,a,d,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new W(L.UNKNOWN,a.toString())})}terminate(){this.V_=!0,this.connection.terminate()}}class Rg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Rt(t),this.y_=!1):K("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Pg{constructor(e,t,r,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(d=>{r.enqueueAndForget((0,I.A)(function*(){var p;Ao(a)&&(K("RemoteStore","Restarting streams for network reachability change."),yield(p=(0,I.A)(function*(v){const A=ne(v);A.M_.add(4),yield Su(A),A.N_.set("Unknown"),A.M_.delete(4),yield Ul(A)}),function _(v){return p.apply(this,arguments)})(a))}))}),this.N_=new Rg(r,i)}}function Ul(n){return xh.apply(this,arguments)}function xh(){return xh=(0,I.A)(function*(n){if(Ao(n))for(const e of n.x_)yield e(!0)}),xh.apply(this,arguments)}function Su(n){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,I.A)(function*(n){for(const e of n.x_)yield e(!1)}),Dh.apply(this,arguments)}function Cc(n,e){const t=ne(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Vh(t)?Nh(t):xu(t).Zo()&&kh(t,e))}function bu(n,e){const t=ne(n),r=xu(t);t.F_.delete(e),r.Zo()&&yp(t,e),0===t.F_.size&&(r.Zo()?r.t_():Ao(t)&&t.N_.set("Unknown"))}function kh(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ce.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xu(n).h_(e)}function yp(n,e){n.L_.xe(e),xu(n).P_(e)}function Nh(n){n.L_=new Pm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),xu(n).start(),n.N_.w_()}function Vh(n){return Ao(n)&&!xu(n).Yo()&&n.F_.size>0}function Ao(n){return 0===ne(n).M_.size}function Ip(n){n.L_=void 0}function Sg(n){return Oh.apply(this,arguments)}function Oh(){return Oh=(0,I.A)(function*(n){n.N_.set("Online")}),Oh.apply(this,arguments)}function bg(n){return Lh.apply(this,arguments)}function Lh(){return Lh=(0,I.A)(function*(n){n.F_.forEach((e,t)=>{kh(n,e)})}),Lh.apply(this,arguments)}function Cg(n,e){return Mh.apply(this,arguments)}function Mh(){return Mh=(0,I.A)(function*(n,e){Ip(n),Vh(n)?(n.N_.D_(e),Nh(n)):n.N_.set("Unknown")}),Mh.apply(this,arguments)}function xg(n,e,t){return Fh.apply(this,arguments)}function Fh(){return Fh=(0,I.A)(function*(n,e,t){if(n.N_.set("Online"),e instanceof df&&2===e.state&&e.cause)try{yield(r=(0,I.A)(function*(s,a){const d=a.cause;for(const p of a.targetIds)s.F_.has(p)&&(yield s.remoteSyncer.rejectListen(p,d),s.F_.delete(p),s.L_.removeTarget(p))}),function i(s,a){return r.apply(this,arguments)})(n,e)}catch(r){K("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield xc(n,r)}else if(e instanceof fc?n.L_.Ke(e):e instanceof hf?n.L_.He(e):n.L_.We(e),!t.isEqual(ce.min()))try{const r=yield ap(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){const d=s.L_.rt(a);return d.targetChanges.forEach((p,_)=>{if(p.resumeToken.approximateByteSize()>0){const v=s.F_.get(_);v&&s.F_.set(_,v.withResumeToken(p.resumeToken,a))}}),d.targetMismatches.forEach((p,_)=>{const v=s.F_.get(p);if(!v)return;s.F_.set(p,v.withResumeToken(xt.EMPTY_BYTE_STRING,v.snapshotVersion)),yp(s,p);const A=new Ns(v.target,p,_,v.sequenceNumber);kh(s,A)}),s.remoteSyncer.applyRemoteEvent(d)}(n,t))}catch(r){K("RemoteStore","Failed to raise snapshot:",r),yield xc(n,r)}var r}),Fh.apply(this,arguments)}function xc(n,e,t){return Uh.apply(this,arguments)}function Uh(){return Uh=(0,I.A)(function*(n,e,t){if(!wr(e))throw e;n.M_.add(1),yield Su(n),n.N_.set("Offline"),t||(t=()=>ap(n.localStore)),n.asyncQueue.enqueueRetryable((0,I.A)(function*(){K("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield Ul(n)}))}),Uh.apply(this,arguments)}function vp(n,e){return e().catch(t=>xc(n,t,e))}function Cu(n){return Bh.apply(this,arguments)}function Bh(){return Bh=(0,I.A)(function*(n){const e=ne(n),t=wo(e);let r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Dg(e);)try{const i=yield pg(e.localStore,r);if(null===i){0===e.v_.length&&t.t_();break}r=i.batchId,kg(e,i)}catch(i){yield xc(e,i)}Ep(e)&&Tp(e)}),Bh.apply(this,arguments)}function Dg(n){return Ao(n)&&n.v_.length<10}function kg(n,e){n.v_.push(e);const t=wo(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function Ep(n){return Ao(n)&&!wo(n).Yo()&&n.v_.length>0}function Tp(n){wo(n).start()}function Ng(n){return qh.apply(this,arguments)}function qh(){return qh=(0,I.A)(function*(n){wo(n).R_()}),qh.apply(this,arguments)}function Vg(n){return Wh.apply(this,arguments)}function Wh(){return Wh=(0,I.A)(function*(n){const e=wo(n);for(const t of n.v_)e.E_(t.mutations)}),Wh.apply(this,arguments)}function Og(n,e,t){return Gh.apply(this,arguments)}function Gh(){return Gh=(0,I.A)(function*(n,e,t){const r=n.v_.shift(),i=Yc.from(r,e,t);yield vp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Cu(n)}),Gh.apply(this,arguments)}function Lg(n,e){return Kh.apply(this,arguments)}function Kh(){return Kh=(0,I.A)(function*(n,e){var t;e&&wo(n).T_&&(yield(t=(0,I.A)(function*(i,s){if(sf(d=s.code)&&d!==L.ABORTED){const a=i.v_.shift();wo(i).e_(),yield vp(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Cu(i)}var d}),function r(i,s){return t.apply(this,arguments)})(n,e)),Ep(n)&&Tp(n)}),Kh.apply(this,arguments)}function Ap(n,e){return zh.apply(this,arguments)}function zh(){return zh=(0,I.A)(function*(n,e){const t=ne(n);t.asyncQueue.verifyOperationInProgress(),K("RemoteStore","RemoteStore received new credentials");const r=Ao(t);t.M_.add(3),yield Su(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Ul(t)}),zh.apply(this,arguments)}function $h(n,e){return jh.apply(this,arguments)}function jh(){return jh=(0,I.A)(function*(n,e){const t=ne(n);e?(t.M_.delete(2),yield Ul(t)):e||(t.M_.add(2),yield Su(t),t.N_.set("Unknown"))}),jh.apply(this,arguments)}function xu(n){return n.B_||(n.B_=function(t,r,i){const s=ne(t);return s.m_(),new Eg(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:Sg.bind(null,n),Io:bg.bind(null,n),Eo:Cg.bind(null,n),l_:xg.bind(null,n)}),n.x_.push(function(){var e=(0,I.A)(function*(t){t?(n.B_.e_(),Vh(n)?Nh(n):n.N_.set("Unknown")):(yield n.B_.stop(),Ip(n))});return function(t){return e.apply(this,arguments)}}())),n.B_}function wo(n){return n.k_||(n.k_=function(t,r,i){const s=ne(t);return s.m_(),new Tg(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:Ng.bind(null,n),Eo:Lg.bind(null,n),A_:Vg.bind(null,n),d_:Og.bind(null,n)}),n.x_.push(function(){var e=(0,I.A)(function*(t){t?(n.k_.e_(),yield Cu(n)):(yield n.k_.stop(),n.v_.length>0&&(K("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))});return function(t){return e.apply(this,arguments)}}())),n.k_}class Hh{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Pt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,d=new Hh(e,t,a,i,s);return d.start(r),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new W(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Du(n,e){if(Rt("AsyncQueue",`${e}: ${n}`),wr(n))return new W(L.UNAVAILABLE,`${e}: ${n}`);throw n}class ku{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ee.comparator(t.key,r.key):(t,r)=>ee.comparator(t.key,r.key),this.keyedMap=go(),this.sortedSet=new Ue(this.comparator)}static emptySet(e){return new ku(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ku)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new ku;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class wp{constructor(){this.q_=new Ue(ee.comparator)}track(e){const t=e.doc.key,r=this.q_.get(t);r?0!==e.type&&3===r.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==r.type?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.q_=this.q_.remove(t):1===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):ue():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Nu{constructor(e,t,r,i,s,a,d,p,_){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=d,this.excludesMetadataChanges=p,this.hasCachedResults=_}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(d=>{a.push({type:0,doc:d})}),new Nu(e,t,ku.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Mg{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class Fg{constructor(){this.queries=new Ri(e=>pu(e),fu),this.onlineState="Unknown",this.z_=new Set}}function Qh(n,e){return Jh.apply(this,arguments)}function Jh(){return Jh=(0,I.A)(function*(n,e){const t=ne(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new Mg,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const d=Du(a,`Initialization of query '${xs(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&Zh(t)}),Jh.apply(this,arguments)}function Yh(n,e){return Xh.apply(this,arguments)}function Xh(){return Xh=(0,I.A)(function*(n,e){const t=ne(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const a=s.U_.indexOf(e);a>=0&&(s.U_.splice(a,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}),Xh.apply(this,arguments)}function Ug(n,e){const t=ne(n);let r=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const d of a.U_)d.H_(i)&&(r=!0);a.K_=i}}r&&Zh(t)}function Bg(n,e,t){const r=ne(n),i=r.queries.get(e);if(i)for(const s of i.U_)s.onError(t);r.queries.delete(e)}function Zh(n){n.z_.forEach(e=>{e.next()})}var ed,Rp;(Rp=ed||(ed={})).J_="default",Rp.Cache="cache";class td{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Nu(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=Nu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==ed.Cache}}class qg{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class Pp{constructor(e){this.serializer=e}hs(e){return es(this.serializer,e)}Ps(e){return e.metadata.exists?Tf(this.serializer,e.document,!1):f.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return Ht(e)}}class Wg{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Sp(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const r=Se.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,r=new Pp(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const a of i.metadata.queries){const d=(t.get(a)||h()).add(s);t.set(a,d)}}return t}complete(){var e=this;return(0,I.A)(function*(){const t=yield function mg(n,e,t,r){return Eh.apply(this,arguments)}(e.localStore,new Pp(e.serializer),e.documents,e.oa.id),r=e.aa(e.documents);for(const i of e.queries)yield gg(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function Sp(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class bp{constructor(e){this.key=e}}class Cp{constructor(e){this.key=e}}class xp{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=h(),this.mutatedKeys=h(),this.Ia=vl(e),this.Ta=new ku(this.Ia)}get Ea(){return this.la}da(e,t){const r=t?t.Aa:new wp,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,d=!1;const p="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,_="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((v,A)=>{const S=i.get(v),k=Zi(this.query,A)?A:null,Y=!!S&&this.mutatedKeys.has(S.key),re=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let te=!1;S&&k?S.data.isEqual(k.data)?Y!==re&&(r.track({type:3,doc:k}),te=!0):this.Ra(S,k)||(r.track({type:2,doc:k}),te=!0,(p&&this.Ia(k,p)>0||_&&this.Ia(k,_)<0)&&(d=!0)):!S&&k?(r.track({type:0,doc:k}),te=!0):S&&!k&&(r.track({type:1,doc:S}),te=!0,(p||_)&&(d=!0)),te&&(k?(a=a.add(k),s=re?s.add(v):s.delete(v)):(a=a.delete(v),s=s.delete(v)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const v="F"===this.query.limitType?a.last():a.first();a=a.delete(v.key),s=s.delete(v.key),r.track({type:1,doc:v})}return{Ta:a,Aa:r,Zi:d,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const a=e.Aa.Q_();a.sort((v,A)=>function(k,Y){const re=te=>{switch(te){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ue()}};return re(k)-re(Y)}(v.type,A.type)||this.Ia(v.doc,A.doc)),this.Va(r),i=null!=i&&i;const d=t&&!i?this.ma():[],p=0===this.Pa.size&&this.current&&!i?1:0,_=p!==this.ha;return this.ha=p,0!==a.length||_?{snapshot:new Nu(this.query,e.Ta,s,a,e.mutatedKeys,0===p,_,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:d}:{fa:d}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new wp,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=h(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});const t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new Cp(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new bp(r))}),t}pa(e){this.la=e.ls,this.Pa=h();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Nu.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class Gg{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Kg{constructor(e){this.key=e,this.wa=!1}}class zg{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new Ri(d=>pu(d),fu),this.Da=new Map,this.Ca=new Set,this.va=new Ue(ee.comparator),this.Fa=new Map,this.Ma=new fh,this.xa={},this.Oa=new Map,this.Na=xa.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function $g(n,e){return nd.apply(this,arguments)}function nd(){return nd=(0,I.A)(function*(n,e,t=!0){const r=Dc(n);let i;const s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Dp(r,e,t,!0),i}),nd.apply(this,arguments)}function jg(n,e){return rd.apply(this,arguments)}function rd(){return rd=(0,I.A)(function*(n,e){const t=Dc(n);yield Dp(t,e,!0,!1)}),rd.apply(this,arguments)}function Dp(n,e,t,r){return id.apply(this,arguments)}function id(){return id=(0,I.A)(function*(n,e,t,r){const i=yield Ru(n.localStore,In(e)),s=i.targetId,a=t?n.sharedClientState.addLocalQueryTarget(s):"not-current";let d;return r&&(d=yield sd(n,e,s,"current"===a,i.resumeToken)),n.isPrimaryClient&&t&&Cc(n.remoteStore,i),d}),id.apply(this,arguments)}function sd(n,e,t,r,i){return od.apply(this,arguments)}function od(){return od=(0,I.A)(function*(n,e,t,r,i){n.Ba=(A,S,k)=>{return(Y=(0,I.A)(function*(te,me,be,ye){let ke=me.view.da(be);ke.Zi&&(ke=yield wc(te.localStore,me.query,!1).then(({documents:si})=>me.view.da(si,ke)));const yt=ye&&ye.targetChanges.get(me.targetId),ht=ye&&null!=ye.targetMismatches.get(me.targetId),cn=me.view.applyChanges(ke,te.isPrimaryClient,yt,ht);return _d(te,me.targetId,cn.fa),cn.snapshot}),function re(te,me,be,ye){return Y.apply(this,arguments)})(n,A,S,k);var Y};const s=yield wc(n.localStore,e,!0),a=new xp(e,s.ls),d=a.da(s.documents),p=bl.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),_=a.applyChanges(d,n.isPrimaryClient,p);_d(n,t,_.fa);const v=new Gg(e,t,a);return n.ba.set(e,v),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),_.snapshot}),od.apply(this,arguments)}function Hg(n,e,t){return ad.apply(this,arguments)}function ad(){return ad=(0,I.A)(function*(n,e,t){const r=ne(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(a=>!fu(a,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Pu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&bu(r.remoteStore,i.targetId),Vu(r,i.targetId)}).catch(or))):(Vu(r,i.targetId),yield Pu(r.localStore,i.targetId,!0))}),ad.apply(this,arguments)}function Qg(n,e){return ud.apply(this,arguments)}function ud(){return ud=(0,I.A)(function*(n,e){const t=ne(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),bu(t.remoteStore,r.targetId))}),ud.apply(this,arguments)}function ld(){return ld=(0,I.A)(function*(n,e,t){const r=bd(n);try{const i=yield function(a,d){const p=ne(a),_=xe.now(),v=d.reduce((k,Y)=>k.add(Y.key),h());let A,S;return p.persistence.runTransaction("Locally write mutations","readwrite",k=>{let Y=Wn(),re=h();return p.ss.getEntries(k,v).next(te=>{Y=te,Y.forEach((me,be)=>{be.isValidDocument()||(re=re.add(me))})}).next(()=>p.localDocuments.getOverlayedDocuments(k,Y)).next(te=>{A=te;const me=[];for(const be of d){const ye=Tm(be,A.get(be.key).overlayedDocument);null!=ye&&me.push(new ks(be.key,ye,Ea(ye.value.mapValue),Et.exists(!0)))}return p.mutationQueue.addMutationBatch(k,_,me,d)}).next(te=>{S=te;const me=te.applyToLocalDocumentSet(A,re);return p.documentOverlayCache.saveOverlays(k,te.batchId,me)})}).then(()=>({batchId:S.batchId,changes:lc(A)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,d,p){let _=a.xa[a.currentUser.toKey()];_||(_=new Ue(Ee)),_=_.insert(d,p),a.xa[a.currentUser.toKey()]=_}(r,i.batchId,t),yield Vs(r,i.changes),yield Cu(r.remoteStore)}catch(i){const s=Du(i,"Failed to persist write");t.reject(s)}}),ld.apply(this,arguments)}function kp(n,e){return cd.apply(this,arguments)}function cd(){return cd=(0,I.A)(function*(n,e){const t=ne(n);try{const r=yield function fg(n,e){const t=ne(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const d=[];e.targetChanges.forEach((v,A)=>{const S=i.get(A);if(!S)return;d.push(t.qr.removeMatchingKeys(s,v.removedDocuments,A).next(()=>t.qr.addMatchingKeys(s,v.addedDocuments,A)));let k=S.withSequenceNumber(s.currentSequenceNumber);var re,te,me;null!==e.targetMismatches.get(A)?k=k.withResumeToken(xt.EMPTY_BYTE_STRING,ce.min()).withLastLimboFreeSnapshotVersion(ce.min()):v.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(v.resumeToken,r)),i=i.insert(A,k),te=k,me=v,(0===(re=S).resumeToken.approximateByteSize()||te.snapshotVersion.toMicroseconds()-re.snapshotVersion.toMicroseconds()>=3e8||me.addedDocuments.size+me.modifiedDocuments.size+me.removedDocuments.size>0)&&d.push(t.qr.updateTargetData(s,k))});let p=Wn(),_=h();if(e.documentUpdates.forEach(v=>{e.resolvedLimboDocuments.has(v)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(s,v))}),d.push(up(s,a,e.documentUpdates).next(v=>{p=v.us,_=v.cs})),!r.isEqual(ce.min())){const v=t.qr.getLastRemoteSnapshotVersion(s).next(A=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));d.push(v)}return D.waitFor(d).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,p,_)).next(()=>p)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Fa.get(s);a&&(de(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?de(a.wa):i.removedDocuments.size>0&&(de(a.wa),a.wa=!1))}),yield Vs(t,r,e)}catch(r){yield or(r)}}),cd.apply(this,arguments)}function Np(n,e,t){const r=ne(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ba.forEach((s,a)=>{const d=a.view.j_(e);d.snapshot&&i.push(d.snapshot)}),function(a,d){const p=ne(a);p.onlineState=d;let _=!1;p.queries.forEach((v,A)=>{for(const S of A.U_)S.j_(d)&&(_=!0)}),_&&Zh(p)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Yg(n,e,t){return hd.apply(this,arguments)}function hd(){return hd=(0,I.A)(function*(n,e,t){const r=ne(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Fa.get(e),s=i&&i.key;if(s){let a=new Ue(ee.comparator);a=a.insert(s,f.newNoDocument(s,ce.min()));const d=h().add(s),p=new Sl(ce.min(),new Map,new Ue(Ee),a,d);yield kp(r,p),r.va=r.va.remove(s),r.Fa.delete(e),yd(r)}else yield Pu(r.localStore,e,!1).then(()=>Vu(r,e,t)).catch(or)}),hd.apply(this,arguments)}function Xg(n,e){return dd.apply(this,arguments)}function dd(){return dd=(0,I.A)(function*(n,e){const t=ne(n),r=e.batch.batchId;try{const i=yield function dg(n,e){const t=ne(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(d,p,_,v){const A=_.batch,S=A.keys();let k=D.resolve();return S.forEach(Y=>{k=k.next(()=>v.getEntry(p,Y)).next(re=>{const te=_.docVersions.get(Y);de(null!==te),re.version.compareTo(te)<0&&(A.applyToRemoteDocument(re,_),re.isValidDocument()&&(re.setReadTime(_.commitVersion),v.addEntry(re)))})}),k.next(()=>d.mutationQueue.removeMutationBatch(p,A))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(d){let p=h();for(let _=0;_<d.mutationResults.length;++_)d.mutationResults[_].transformResults.length>0&&(p=p.add(d.batch.mutations[_].key));return p}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);gd(t,r,null),md(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Vs(t,i)}catch(i){yield or(i)}}),dd.apply(this,arguments)}function Zg(n,e,t){return fd.apply(this,arguments)}function fd(){return fd=(0,I.A)(function*(n,e,t){const r=ne(n);try{const i=yield function(a,d){const p=ne(a);return p.persistence.runTransaction("Reject batch","readwrite-primary",_=>{let v;return p.mutationQueue.lookupMutationBatch(_,d).next(A=>(de(null!==A),v=A.keys(),p.mutationQueue.removeMutationBatch(_,A))).next(()=>p.mutationQueue.performConsistencyCheck(_)).next(()=>p.documentOverlayCache.removeOverlaysForBatchId(_,v,d)).next(()=>p.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(_,v)).next(()=>p.localDocuments.getDocuments(_,v))})}(r.localStore,e);gd(r,e,t),md(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Vs(r,i)}catch(i){yield or(i)}}),fd.apply(this,arguments)}function pd(){return pd=(0,I.A)(function*(n,e){const t=ne(n);Ao(t.remoteStore)||K("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(a){const d=ne(a);return d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",p=>d.mutationQueue.getHighestUnacknowledgedBatchId(p))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){const i=Du(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),pd.apply(this,arguments)}function md(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function gd(n,e,t){const r=ne(n);let i=r.xa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Vu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||Vp(n,r)})}function Vp(n,e){n.Ca.delete(e.path.canonicalString());const t=n.va.get(e);null!==t&&(bu(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),yd(n))}function _d(n,e,t){for(const r of t)r instanceof bp?(n.Ma.addReference(r.key,e),t_(n,r)):r instanceof Cp?(K("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||Vp(n,r.key)):ue()}function t_(n,e){const t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(K("SyncEngine","New document in limbo: "+t),n.Ca.add(r),yd(n))}function yd(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){const e=n.Ca.values().next().value;n.Ca.delete(e);const t=new ee(Se.fromString(e)),r=n.Na.next();n.Fa.set(r,new Kg(t)),n.va=n.va.insert(t,r),Cc(n.remoteStore,new Ns(In(Xi(t.path)),r,"TargetPurposeLimboResolution",Rn.oe))}}function Vs(n,e,t){return Id.apply(this,arguments)}function Id(){return Id=(0,I.A)(function*(n,e,t){const r=ne(n),i=[],s=[],a=[];var d;r.ba.isEmpty()||(r.ba.forEach((d,p)=>{a.push(r.Ba(p,e,t).then(_=>{if((_||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(p.targetId,null!=_&&_.fromCache?"not-current":"current"),_){i.push(_);const v=yh.Qi(p.targetId,_);s.push(v)}}))}),yield Promise.all(a),r.Sa.l_(i),yield(d=(0,I.A)(function*(_,v){const A=ne(_);try{yield A.persistence.runTransaction("notifyLocalViewChanges","readwrite",S=>D.forEach(v,k=>D.forEach(k.ki,Y=>A.persistence.referenceDelegate.addReference(S,k.targetId,Y)).next(()=>D.forEach(k.qi,Y=>A.persistence.referenceDelegate.removeReference(S,k.targetId,Y)))))}catch(S){if(!wr(S))throw S;K("LocalStore","Failed to update sequence numbers: "+S)}for(const S of v){const k=S.targetId;if(!S.fromCache){const Y=A.ts.get(k),te=Y.withLastLimboFreeSnapshotVersion(Y.snapshotVersion);A.ts=A.ts.insert(k,te)}}}),function p(_,v){return d.apply(this,arguments)})(r.localStore,s))}),Id.apply(this,arguments)}function n_(n,e){return vd.apply(this,arguments)}function vd(){return vd=(0,I.A)(function*(n,e){const t=ne(n);if(!t.currentUser.isEqual(e)){K("SyncEngine","User change. New user:",e.toKey());const r=yield op(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(d=>{d.forEach(p=>{p.reject(new W(L.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Vs(t,r._s)}var s}),vd.apply(this,arguments)}function r_(n,e){const t=ne(n),r=t.Fa.get(e);if(r&&r.wa)return h().add(r.key);{let i=h();const s=t.Da.get(e);if(!s)return i;for(const a of s){const d=t.ba.get(a);i=i.unionWith(d.view.Ea)}return i}}function i_(n,e){return Ed.apply(this,arguments)}function Ed(){return Ed=(0,I.A)(function*(n,e){const t=ne(n),r=yield wc(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&_d(t,e.targetId,i.fa),i}),Ed.apply(this,arguments)}function s_(n,e){return Td.apply(this,arguments)}function Td(){return Td=(0,I.A)(function*(n,e){const t=ne(n);return cp(t.localStore,e).then(r=>Vs(t,r))}),Td.apply(this,arguments)}function o_(n,e,t,r){return Ad.apply(this,arguments)}function Ad(){return Ad=(0,I.A)(function*(n,e,t,r){const i=ne(n),s=yield function(d,p){const _=ne(d),v=ne(_.mutationQueue);return _.persistence.runTransaction("Lookup mutation documents","readonly",A=>v.Cn(A,p).next(S=>S?_.localDocuments.getDocuments(A,S):D.resolve(null)))}(i.localStore,e);var p;null!==s?("pending"===t?yield Cu(i.remoteStore):"acknowledged"===t||"rejected"===t?(gd(i,e,r||null),md(i,e),p=e,ne(ne(i.localStore).mutationQueue).Fn(p)):ue(),yield Vs(i,s)):K("SyncEngine","Cannot apply mutation batch with id: "+e)}),Ad.apply(this,arguments)}function wd(){return wd=(0,I.A)(function*(n,e){const t=ne(n);if(Dc(t),bd(t),!0===e&&!0!==t.La){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Op(t,r.toArray());t.La=!0,yield $h(t.remoteStore,!0);for(const s of i)Cc(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const r=[];let i=Promise.resolve();t.Da.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(Vu(t,a),Pu(t.localStore,a,!0))),bu(t.remoteStore,a)}),yield i,yield Op(t,r),function(a){const d=ne(a);d.Fa.forEach((p,_)=>{bu(d.remoteStore,_)}),d.Ma.Vr(),d.Fa=new Map,d.va=new Ue(ee.comparator)}(t),t.La=!1,yield $h(t.remoteStore,!1)}}),wd.apply(this,arguments)}function Op(n,e,t){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,I.A)(function*(n,e,t){const r=ne(n),i=[],s=[];for(const a of e){let d;const p=r.Da.get(a);if(p&&0!==p.length){d=yield Ru(r.localStore,In(p[0]));for(const _ of p){const v=r.ba.get(_),A=yield i_(r,v);A.snapshot&&s.push(A.snapshot)}}else{const _=yield lp(r.localStore,a);d=yield Ru(r.localStore,_),yield sd(r,Lp(_),a,!1,d.resumeToken)}i.push(d)}return r.Sa.l_(s),i}),Rd.apply(this,arguments)}function Lp(n){return hu(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function u_(n){return t=ne(n).localStore,ne(ne(t).persistence).Li();var t}function l_(n,e,t,r){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,I.A)(function*(n,e,t,r){const i=ne(n);if(i.La)return void K("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield cp(i.localStore,Il(s[0])),d=Sl.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,xt.EMPTY_BYTE_STRING);yield Vs(i,a,d);break}case"rejected":yield Pu(i.localStore,e,!0),Vu(i,e,r);break;default:ue()}}),Pd.apply(this,arguments)}function c_(n,e,t){return Sd.apply(this,arguments)}function Sd(){return Sd=(0,I.A)(function*(n,e,t){const r=Dc(n);if(r.La){for(const i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){K("SyncEngine","Adding an already active target "+i);continue}const s=yield lp(r.localStore,i),a=yield Ru(r.localStore,s);yield sd(r,Lp(s),a.targetId,!1,a.resumeToken),Cc(r.remoteStore,a)}for(const i of t)r.Da.has(i)&&(yield Pu(r.localStore,i,!1).then(()=>{bu(r.remoteStore,i),Vu(r,i)}).catch(or))}}),Sd.apply(this,arguments)}function Dc(n){const e=ne(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=kp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=r_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yg.bind(null,e),e.Sa.l_=Ug.bind(null,e.eventManager),e.Sa.ka=Bg.bind(null,e.eventManager),e}function bd(n){const e=ne(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zg.bind(null,e),e}class Ou{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,I.A)(function*(){t.serializer=Fl(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return sp(this.persistence,new ip,e.initialUser,this.serializer)}createPersistence(e){return new ph(Ec.jr,this.serializer)}createSharedClientState(e){return new pp}terminate(){var e=this;return(0,I.A)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Cd extends Ou{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,I.A)(function*(){yield t().call(r,e),yield r.Qa.initialize(r,e),yield bd(r.Qa.syncEngine),yield Cu(r.Qa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return sp(this.persistence,new ip,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Qf(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new oa(t,this.persistence);return new sa(e.asyncQueue,r)}createPersistence(e){const t=_h(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Gn.withCacheSize(this.cacheSizeBytes):Gn.DEFAULT;return new gh(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,gp(),bc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new pp}}class Mp extends Cd{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,I.A)(function*(){yield t().call(r,e);const i=r.Qa.syncEngine;r.sharedClientState instanceof Ph&&(r.sharedClientState.syncEngine={Ys:o_.bind(null,i),Zs:l_.bind(null,i),Xs:c_.bind(null,i),Li:u_.bind(null,i),Js:s_.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,I.A)(function*(a){yield function a_(n,e){return wd.apply(this,arguments)}(r.Qa.syncEngine,a),r.gcScheduler&&(a&&!r.gcScheduler.started?r.gcScheduler.start():a||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(a&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():a||r.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=gp();if(!Ph.D(t))throw new W(L.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=_h(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ph(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Lu{initialize(e,t){var r=this;return(0,I.A)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Np(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=n_.bind(null,r.syncEngine),yield $h(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Fg}createDatastore(e){const t=Fl(e.databaseInfo.databaseId),r=new vg(e.databaseInfo);return new Ag(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Np(this.syncEngine,t,0),d=mp.D()?new mp:new _g,new Pg(r,i,s,a,d);var r,i,s,a,d}createSyncEngine(e,t){return function(i,s,a,d,p,_,v){const A=new zg(i,s,a,d,p,_);return v&&(A.La=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,I.A)(function*(){var t,r;yield(r=(0,I.A)(function*(s){const a=ne(s);K("RemoteStore","RemoteStore shutting down."),a.M_.add(5),yield Su(a),a.O_.shutdown(),a.N_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function Fp(n,e=10240){let t=0;return{read:()=>(0,I.A)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,I.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class kc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Rt("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class f_{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Pt,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,I.A)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,I.A)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,I.A)(function*(){const t=yield e.za();if(null===t)return null;const r=e.Wa.decode(t),i=Number(r);isNaN(i)&&e.ja(`length string (${r}) is not valid number`);const s=yield e.Ha(i);return new qg(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>123===e)}za(){var e=this;return(0,I.A)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ha(e){var t=this;return(0,I.A)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const r=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,I.A)(function*(){const t=yield e.Ua.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class p_{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,I.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new W(L.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const r=yield(i=(0,I.A)(function*(a,d){const p=ne(a),_={documents:d.map(k=>Cl(p.serializer,k))},v=yield p.Mo("BatchGetDocuments",p.serializer.databaseId,Se.emptyPath(),_,d.length),A=new Map;v.forEach(k=>{const Y=function km(n,e){return"found"in e?function(r,i){de(!!i.found);const s=es(r,i.found.name),a=Ht(i.found.updateTime),d=i.found.createTime?Ht(i.found.createTime):ce.min(),p=new rn({mapValue:{fields:i.found.fields}});return f.newFoundDocument(s,a,d,p)}(n,e):"missing"in e?function(r,i){de(!!i.missing),de(!!i.readTime);const s=es(r,i.missing),a=Ht(i.readTime);return f.newNoDocument(s,a)}(n,e):ue()}(p.serializer,k);A.set(Y.key.toString(),Y)});const S=[];return d.forEach(k=>{const Y=A.get(k.toString());de(!!Y),S.push(Y)}),S}),function s(a,d){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new yu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,I.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=ee.fromPath(i);e.mutations.push(new Qc(s,e.precondition(s)))}),yield(r=(0,I.A)(function*(s,a){const d=ne(s),p={writes:a.map(_=>xl(d.serializer,_))};yield d.Do("Commit",d.serializer.databaseId,Se.emptyPath(),p)}),function i(s,a){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ue();t=ce.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new W(L.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ce.min())?Et.exists(!1):Et.updateTime(t):Et.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ce.min()))throw new W(L.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Et.updateTime(t)}return Et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class m_{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new bh(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Jo.Ko((0,I.A)(function*(){const t=new p_(e.datastore),r=e.tu(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!St(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!sf(t)}return!1}}class g_{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Vt.UNAUTHENTICATED,this.clientId=Qa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var a=(0,I.A)(function*(d){K("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d});return function(d){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(r,a=>(K("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new W(L.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Pt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,I.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Du(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Nc(n,e){return xd.apply(this,arguments)}function xd(){return xd=(0,I.A)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),K("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,I.A)(function*(s){r.isEqual(s)||(yield op(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),xd.apply(this,arguments)}function Dd(n,e){return kd.apply(this,arguments)}function kd(){return kd=(0,I.A)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Nd(n);K("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Ap(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Ap(e.remoteStore,i)),n._onlineComponents=e}),kd.apply(this,arguments)}function Up(n){return"FirebaseError"===n.name?n.code===L.FAILED_PRECONDITION||n.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Nd(n){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,I.A)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){K("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Nc(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Up(t))throw t;_n("Error using user provided cache. Falling back to memory cache: "+t),yield Nc(n,new Ou)}}else K("FirestoreClient","Using default OfflineComponentProvider"),yield Nc(n,new Ou);return n._offlineComponents}),Vd.apply(this,arguments)}function Vc(n){return Od.apply(this,arguments)}function Od(){return Od=(0,I.A)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(K("FirestoreClient","Using user provided OnlineComponentProvider"),yield Dd(n,n._uninitializedComponentsProvider._online)):(K("FirestoreClient","Using default OnlineComponentProvider"),yield Dd(n,new Lu))),n._onlineComponents}),Od.apply(this,arguments)}function Bp(n){return Nd(n).then(e=>e.persistence)}function Mu(n){return Nd(n).then(e=>e.localStore)}function qp(n){return Vc(n).then(e=>e.remoteStore)}function Ld(n){return Vc(n).then(e=>e.syncEngine)}function Fu(n){return Md.apply(this,arguments)}function Md(){return Md=(0,I.A)(function*(n){const e=yield Vc(n),t=e.eventManager;return t.onListen=$g.bind(null,e.syncEngine),t.onUnlisten=Hg.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=jg.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Qg.bind(null,e.syncEngine),t}),Md.apply(this,arguments)}function Gp(n,e,t={}){const r=new Pt;return n.asyncQueue.enqueueAndForget((0,I.A)(function*(){return function(s,a,d,p,_){const v=new kc({next:S=>{a.enqueueAndForget(()=>Yh(s,A));const k=S.docs.has(d);!k&&S.fromCache?_.reject(new W(L.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&S.fromCache&&p&&"server"===p.source?_.reject(new W(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):_.resolve(S)},error:S=>_.reject(S)}),A=new td(Xi(d.path),v,{includeMetadataChanges:!0,ra:!0});return Qh(s,A)}(yield Fu(n),n.asyncQueue,e,t,r)})),r.promise}function Kp(n,e,t={}){const r=new Pt;return n.asyncQueue.enqueueAndForget((0,I.A)(function*(){return function(s,a,d,p,_){const v=new kc({next:S=>{a.enqueueAndForget(()=>Yh(s,A)),S.fromCache&&"server"===p.source?_.reject(new W(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):_.resolve(S)},error:S=>_.reject(S)}),A=new td(d,v,{includeMetadataChanges:!0,ra:!0});return Qh(s,A)}(yield Fu(n),n.asyncQueue,e,t,r)})),r.promise}function zp(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const $p=new Map;function Fd(n,e,t){if(!t)throw new W(L.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function jp(n,e,t,r){if(!0===e&&!0===r)throw new W(L.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Hp(n){if(!ee.isDocumentKey(n))throw new W(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Qp(n){if(ee.isDocumentKey(n))throw new W(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Oc(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":ue()}function Be(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new W(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Oc(n);throw new W(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Jp(n,e){if(e<=0)throw new W(L.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Yp{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new W(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new W(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=zp(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new W(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new W(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new W(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bl{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new W(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new W(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yp(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new tl;switch(r.type){case"firstParty":return new nc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=$p.get(t);r&&(K("ComponentProvider","Removing Datastore"),$p.delete(t),r.terminate())}(this),Promise.resolve()}}function Xp(n,e,t,r={}){var i;const s=(n=Be(n,Bl))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&_n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let d,p;if("string"==typeof r.mockUserToken)d=r.mockUserToken,p=Vt.MOCK_USER;else{d=(0,Re.Fy)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new W(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Vt(_)}n._authCredentials=new tc(new so(d,p))}}class Sn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Sn(this.firestore,e,this._query)}}class Bt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ts(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Bt(this.firestore,e,this._key)}}class ts extends Sn{constructor(e,t,r){super(e,t,Xi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Bt(this.firestore,null,new ee(e))}withConverter(e){return new ts(this.firestore,e,this._path)}}function S_(n,e,...t){if(n=(0,Re.Ku)(n),Fd("collection","path",e),n instanceof Bl){const r=Se.fromString(e,...t);return Qp(r),new ts(n,null,r)}{if(!(n instanceof Bt||n instanceof ts))throw new W(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Se.fromString(e,...t));return Qp(r),new ts(n.firestore,null,r)}}function b_(n,e){if(n=Be(n,Bl),Fd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new W(L.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Sn(n,null,(r=e,new wi(Se.emptyPath(),r)));var r}function Zp(n,e,...t){if(n=(0,Re.Ku)(n),1===arguments.length&&(e=Qa.newId()),Fd("doc","path",e),n instanceof Bl){const r=Se.fromString(e,...t);return Hp(r),new Bt(n,null,new ee(r))}{if(!(n instanceof Bt||n instanceof ts))throw new W(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Se.fromString(e,...t));return Hp(r),new Bt(n.firestore,n instanceof ts?n.converter:null,new ee(r))}}function C_(n,e){return n=(0,Re.Ku)(n),e=(0,Re.Ku)(e),(n instanceof Bt||n instanceof ts)&&(e instanceof Bt||e instanceof ts)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Ud(n,e){return n=(0,Re.Ku)(n),e=(0,Re.Ku)(e),n instanceof Sn&&e instanceof Sn&&n.firestore===e.firestore&&fu(n._query,e._query)&&n.converter===e.converter}class x_{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new bh(this,"async_queue_retry"),this.hu=()=>{const t=bc();t&&K("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const e=bc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=bc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new Pt;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,I.A)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Jo.reset()}catch(t){if(!wr(t))throw t;K("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Jo.Ko(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{throw this.au=r,this.uu=!1,Rt("INTERNAL UNHANDLED ERROR: ",function(a){let d=a.message||"";return a.stack&&(d=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),d}(r)),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=Hh.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&ue()}verifyOperationInProgress(){}du(){var e=this;return(0,I.A)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Bd(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class D_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Pt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const k_=-1;class Tt extends Bl{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new x_,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||em(this),this._firestoreClient.terminate()}}function N_(n,e){const t="object"==typeof n?n:(0,B.getApp)(),r="string"==typeof n?n:e||"(default)",i=(0,B._getProvider)(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(0,Re.yU)("firestore");s&&Xp(i,...s)}return i}function qt(n){return n._firestoreClient||em(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function em(n){var e,t,r;const i=n._freezeSettings(),s=(p=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new ic(n._databaseId,p,n._persistenceKey,(v=i).host,v.ssl,v.experimentalForceLongPolling,v.experimentalAutoDetectLongPolling,zp(v.experimentalLongPollingOptions),v.useFetchStreams));var p,v;n._firestoreClient=new g_(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function V_(n,e){nm(n=Be(n,Tt));const t=qt(n);if(t._uninitializedComponentsProvider)throw new W(L.FAILED_PRECONDITION,"SDK cache is already specified.");_n("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Lu;return tm(t,i,new Cd(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function O_(n){nm(n=Be(n,Tt));const e=qt(n);if(e._uninitializedComponentsProvider)throw new W(L.FAILED_PRECONDITION,"SDK cache is already specified.");_n("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Lu;return tm(e,r,new Mp(r,t.cacheSizeBytes))}function tm(n,e,t){const r=new Pt;return n.asyncQueue.enqueue((0,I.A)(function*(){try{yield Nc(n,t),yield Dd(n,e),r.resolve()}catch(i){const s=i;if(!Up(s))throw s;_n("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function L_(n){if(n._initialized&&!n._terminated)throw new W(L.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Pt;return n._queue.enqueueAndForgetEvenWhileRestricted((0,I.A)(function*(){try{yield(t=(0,I.A)(function*(i){if(!Ar.D())return Promise.resolve();const s=i+"main";yield Ar.delete(s)}),function r(i){return t.apply(this,arguments)})(_h(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}function M_(n){return function(t){const r=new Pt;return t.asyncQueue.enqueueAndForget((0,I.A)(function*(){return function e_(n,e){return pd.apply(this,arguments)}(yield Ld(t),r)})),r.promise}(qt(n=Be(n,Tt)))}function F_(n){return function __(n){return n.asyncQueue.enqueue((0,I.A)(function*(){const e=yield Bp(n),t=yield qp(n);return e.setNetworkEnabled(!0),function(i){const s=ne(i);return s.M_.delete(0),Ul(s)}(t)}))}(qt(n=Be(n,Tt)))}function U_(n){return function y_(n){return n.asyncQueue.enqueue((0,I.A)(function*(){const e=yield Bp(n),t=yield qp(n);return e.setNetworkEnabled(!1),(r=(0,I.A)(function*(s){const a=ne(s);a.M_.add(0),yield Su(a),a.N_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(qt(n=Be(n,Tt)))}function B_(n,e){const t=qt(n=Be(n,Tt)),r=new D_;return function T_(n,e,t,r){const i=function(a,d){let p;return p="string"==typeof a?uf().encode(a):a,v=function(v,A){if(v instanceof Uint8Array)return Fp(v,A);if(v instanceof ArrayBuffer)return Fp(new Uint8Array(v),A);if(v instanceof ReadableStream)return v.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(p),new f_(v,d);var v}(t,Fl(e));n.asyncQueue.enqueueAndForget((0,I.A)(function*(){!function h_(n,e,t){const r=ne(n);var i;(i=(0,I.A)(function*(a,d,p){try{const _=yield d.getMetadata();if(yield function(Y,re){const te=ne(Y),me=Ht(re.createTime);return te.persistence.runTransaction("hasNewerBundle","readonly",be=>te.Kr.getBundleMetadata(be,re.id)).then(be=>!!be&&be.createTime.compareTo(me)>=0)}(a.localStore,_))return yield d.close(),p._completeWith({taskState:"Success",documentsLoaded:(Y=_).totalDocuments,bytesLoaded:Y.totalBytes,totalDocuments:Y.totalDocuments,totalBytes:Y.totalBytes}),Promise.resolve(new Set);p._updateProgress(Sp(_));const v=new Wg(_,a.localStore,d.serializer);let A=yield d.qa();for(;A;){const k=yield v._a(A);k&&p._updateProgress(k),A=yield d.qa()}const S=yield v.complete();return yield Vs(a,S.ca,void 0),yield function(Y,re){const te=ne(Y);return te.persistence.runTransaction("Save bundle","readwrite",me=>te.Kr.saveBundleMetadata(me,re))}(a.localStore,_),p._completeWith(S.progress),Promise.resolve(S.ua)}catch(_){return _n("SyncEngine",`Loading bundle failed with ${_}`),p._failWith(_),Promise.resolve(new Set)}var Y}),function s(a,d,p){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Ld(n),i,r)}))}(t,n._databaseId,e,r),r}function q_(n,e){return function A_(n,e){return n.asyncQueue.enqueue((0,I.A)(function*(){return function(r,i){const s=ne(r);return s.persistence.runTransaction("Get named query","readonly",a=>s.Kr.getNamedQuery(a,i))}(yield Mu(n),e)}))}(qt(n=Be(n,Tt)),e).then(t=>t?new Sn(n,null,t.query):null)}function nm(n){if(n._initialized||n._terminated)throw new W(L.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ro{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ro(xt.fromBase64String(e))}catch(t){throw new W(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ro(xt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Po{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new W(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ka{constructor(e){this._methodName=e}}class Lc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new W(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new W(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ee(this._lat,e._lat)||Ee(this._long,e._long)}}const G_=/^__.*__$/;class K_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ks(e,this.data,this.fieldMask,t,this.fieldTransforms):new _u(e,this.data,t,this.fieldTransforms)}}class rm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ks(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function im(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ue()}}class Mc{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new Mc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Bc(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(im(this.fu)&&G_.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class z_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Fl(e)}Fu(e,t,r,i=!1){return new Mc({fu:e,methodName:t,vu:r,path:tt.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Na(n){const e=n._freezeSettings(),t=Fl(n._databaseId);return new z_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Fc(n,e,t,r,i,s={}){const a=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);jd("Data must be an object, but it was:",a,r);const d=am(r,a);let p,_;if(s.merge)p=new ln(a.fieldMask),_=a.fieldTransforms;else if(s.mergeFields){const v=[];for(const A of s.mergeFields){const S=Gl(e,A,t);if(!a.contains(S))throw new W(L.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);lm(v,S)||v.push(S)}p=new ln(v),_=a.fieldTransforms.filter(A=>p.covers(A.field))}else p=null,_=a.fieldTransforms;return new K_(new rn(d),p,_)}class Wl extends ka{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Wl}}function sm(n,e,t){return new Mc({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class qd extends ka{_toFieldTransform(e){return new _o(e.path,new cr)}isEqual(e){return e instanceof qd}}class Wd extends ka{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=sm(this,e,!0),r=this.Mu.map(s=>Va(s,t)),i=new ii(r);return new _o(e.path,i)}isEqual(e){return e instanceof Wd&&(0,Re.bD)(this.Mu,e.Mu)}}class Gd extends ka{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=sm(this,e,!0),r=this.Mu.map(s=>Va(s,t)),i=new Pi(r);return new _o(e.path,i)}isEqual(e){return e instanceof Gd&&(0,Re.bD)(this.Mu,e.Mu)}}class Kd extends ka{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new Ds(e.serializer,G(e.serializer,this.xu));return new _o(e.path,t)}isEqual(e){return e instanceof Kd&&this.xu===e.xu}}function zd(n,e,t,r){const i=n.Fu(1,e,t);jd("Data must be an object, but it was:",i,r);const s=[],a=rn.empty();Bn(r,(p,_)=>{const v=Uc(e,p,t);_=(0,Re.Ku)(_);const A=i.Su(v);if(_ instanceof Wl)s.push(v);else{const S=Va(_,A);null!=S&&(s.push(v),a.set(v,S))}});const d=new ln(s);return new rm(a,d,i.fieldTransforms)}function $d(n,e,t,r,i,s){const a=n.Fu(1,e,t),d=[Gl(e,r,t)],p=[i];if(s.length%2!=0)throw new W(L.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let S=0;S<s.length;S+=2)d.push(Gl(e,s[S])),p.push(s[S+1]);const _=[],v=rn.empty();for(let S=d.length-1;S>=0;--S)if(!lm(_,d[S])){const k=d[S];let Y=p[S];Y=(0,Re.Ku)(Y);const re=a.Su(k);if(Y instanceof Wl)_.push(k);else{const te=Va(Y,re);null!=te&&(_.push(k),v.set(k,te))}}const A=new ln(_);return new rm(v,A,a.fieldTransforms)}function om(n,e,t,r=!1){return Va(t,n.Fu(r?4:3,e))}function Va(n,e){if(um(n=(0,Re.Ku)(n)))return jd("Unsupported field value:",e,n),am(n,e);if(n instanceof ka)return function(r,i){if(!im(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const d of r){let p=Va(d,i.bu(a));null==p&&(p={nullValue:"NULL_VALUE"}),s.push(p),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,Re.Ku)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return G(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=xe.fromDate(r);return{timestampValue:Iu(i.serializer,s)}}if(r instanceof xe){const s=new xe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Iu(i.serializer,s)}}if(r instanceof Lc)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ro)return{bytesValue:gf(i.serializer,r._byteString)};if(r instanceof Bt){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:th(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Oc(r)}`)}(n,e)}function am(n,e){const t={};return pa(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bn(n,(r,i)=>{const s=Va(i,e.pu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function um(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof xe||n instanceof Lc||n instanceof Ro||n instanceof Bt||n instanceof ka)}function jd(n,e,t){if(!um(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Oc(t);throw e.Du("an object"===r?n+" a custom object":n+" "+r)}var i}function Gl(n,e,t){if((e=(0,Re.Ku)(e))instanceof Po)return e._internalPath;if("string"==typeof e)return Uc(n,e);throw Bc("Field path arguments must be of type string or ",n,!1,void 0,t)}const $_=new RegExp("[~\\*/\\[\\]]");function Uc(n,e,t){if(e.search($_)>=0)throw Bc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Po(...e.split("."))._internalPath}catch{throw Bc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Bc(n,e,t,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let p="";return(s||a)&&(p+=" (found",s&&(p+=` in field ${r}`),a&&(p+=` in document ${i}`),p+=")"),new W(L.INVALID_ARGUMENT,d+n+p)}function lm(n,e){return n.some(t=>t.isEqual(e))}class Kl{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Bt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new j_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(qc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class j_ extends Kl{data(){return super.data()}}function qc(n,e){return"string"==typeof e?Uc(n,e):e instanceof Po?e._internalPath:e._delegate._internalPath}function cm(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new W(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hd{}class zl extends Hd{}function H_(n,e,...t){let r=[];e instanceof Hd&&r.push(e),r=r.concat(t),function(s){const a=s.filter(p=>p instanceof Uu).length,d=s.filter(p=>p instanceof $l).length;if(a>1||a>0&&d>0)throw new W(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class $l extends zl{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new $l(e,t,r)}_apply(e){const t=this._parse(e);return pm(e._query,t),new Sn(e.firestore,e.converter,wa(e._query,t))}_parse(e){const t=Na(e.firestore);return function(s,a,d,p,_,v,A){let S;if(_.isKeyField()){if("array-contains"===v||"array-contains-any"===v)throw new W(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${v}' queries on documentId().`);if("in"===v||"not-in"===v){fm(A,v);const k=[];for(const Y of A)k.push(dm(p,s,Y));S={arrayValue:{values:k}}}else S=dm(p,s,A)}else"in"!==v&&"not-in"!==v&&"array-contains-any"!==v||fm(A,v),S=om(d,"where",A,"in"===v||"not-in"===v);return M.create(_,v,S)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function Q_(n,e,t){const r=e,i=qc("where",n);return $l._create(i,r,t)}class Uu extends Hd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Uu(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:U.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const d=s.getFlattenedFilters();for(const p of d)pm(a,p),a=wa(a,p)}(e._query,t),new Sn(e.firestore,e.converter,wa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Qd extends zl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Qd(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new W(L.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new W(L.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new T(s,a)}(e._query,this._field,this._direction);return new Sn(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new wi(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function J_(n,e="asc"){const t=e,r=qc("orderBy",n);return Qd._create(r,t)}class Wc extends zl{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Wc(e,t,r)}_apply(e){return new Sn(e.firestore,e.converter,du(e._query,this._limit,this._limitType))}}function Y_(n){return Jp("limit",n),Wc._create("limit",n,"F")}function X_(n){return Jp("limitToLast",n),Wc._create("limitToLast",n,"L")}class Gc extends zl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Gc(e,t,r)}_apply(e){const t=hm(e,this.type,this._docOrFields,this._inclusive);return new Sn(e.firestore,e.converter,(s=t,new wi((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}function Z_(...n){return Gc._create("startAt",n,!0)}function ey(...n){return Gc._create("startAfter",n,!1)}class Kc extends zl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Kc(e,t,r)}_apply(e){const t=hm(e,this.type,this._docOrFields,this._inclusive);return new Sn(e.firestore,e.converter,(s=t,new wi((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function ty(...n){return Kc._create("endBefore",n,!1)}function ny(...n){return Kc._create("endAt",n,!0)}function hm(n,e,t,r){if(t[0]=(0,Re.Ku)(t[0]),t[0]instanceof Kl)return function(s,a,d,p,_){if(!p)throw new W(L.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${d}().`);const v=[];for(const A of mo(s))if(A.field.isKeyField())v.push(Ei(a,p.key));else{const S=p.data.field(A.field);if(Or(S))throw new W(L.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+A.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===S){const k=A.field.canonicalString();throw new W(L.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${k}' (used as the orderBy) does not exist.`)}v.push(S)}return new l(v,_)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Na(n.firestore);return function(a,d,p,_,v,A){const S=a.explicitOrderBy;if(v.length>S.length)throw new W(L.INVALID_ARGUMENT,`Too many arguments provided to ${_}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const k=[];for(let Y=0;Y<v.length;Y++){const re=v[Y];if(S[Y].field.isKeyField()){if("string"!=typeof re)throw new W(L.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${_}(), but got a ${typeof re}`);if(!Aa(a)&&-1!==re.indexOf("/"))throw new W(L.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${_}() must be a plain document ID, but '${re}' contains a slash.`);const te=a.path.child(Se.fromString(re));if(!ee.isDocumentKey(te))throw new W(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${_}() must result in a valid document path, but '${te}' is not because it contains an odd number of segments.`);const me=new ee(te);k.push(Ei(d,me))}else{const te=om(p,_,re);k.push(te)}}return new l(k,A)}(n._query,n.firestore._databaseId,i,e,t,r)}}function dm(n,e,t){if("string"==typeof(t=(0,Re.Ku)(t))){if(""===t)throw new W(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Aa(e)&&-1!==t.indexOf("/"))throw new W(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Se.fromString(t));if(!ee.isDocumentKey(r))throw new W(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ei(n,new ee(r))}if(t instanceof Bt)return Ei(n,t._key);throw new W(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Oc(t)}.`)}function fm(n,e){if(!Array.isArray(n)||0===n.length)throw new W(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function pm(n,e){const t=function(i,s){for(const a of i)for(const d of a.getFlattenedFilters())if(s.indexOf(d.op)>=0)return d.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new W(L.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Jd{convertValue(e,t="none"){switch(ur(e)){case 0:return null;case 1:return e.booleanValue;case 2:return it(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ar(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ue()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Bn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Lc(it(e.latitude),it(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Rs(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ti(e));default:return null}}convertTimestamp(e){const t=qn(e);return new xe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Se.fromString(e);de(Sf(r));const i=new ni(r.get(1),r.get(3)),s=new ee(r.popFirst(5));return i.isEqual(t)||Rt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function zc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ry extends Jd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ro(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Bt(this.firestore,null,t)}}class Oa{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class La extends Kl{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new jl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(qc("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class jl extends La{data(e={}){return super.data(e)}}class Ma{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Oa(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new jl(this._firestore,this._userDataWriter,r.key,r,new Oa(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(d=>({type:"added",doc:new jl(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Oa(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(d=>s||3!==d.type).map(d=>{const p=new jl(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Oa(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let _=-1,v=-1;return 0!==d.type&&(_=a.indexOf(d.doc.key),a=a.delete(d.doc.key)),1!==d.type&&(a=a.add(d.doc),v=a.indexOf(d.doc.key)),{type:sy(d.type),doc:p,oldIndex:_,newIndex:v}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function sy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ue()}}function oy(n,e){return n instanceof La&&e instanceof La?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ma&&e instanceof Ma&&n._firestore===e._firestore&&Ud(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function ay(n){n=Be(n,Bt);const e=Be(n.firestore,Tt);return Gp(qt(e),n._key).then(t=>Yd(e,n,t))}class So extends Jd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ro(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Bt(this.firestore,null,t)}}function uy(n){n=Be(n,Bt);const e=Be(n.firestore,Tt),t=qt(e),r=new So(e);return function I_(n,e){const t=new Pt;return n.asyncQueue.enqueueAndForget((0,I.A)(function*(){return(r=(0,I.A)(function*(s,a,d){try{const p=yield function(v,A){const S=ne(v);return S.persistence.runTransaction("read document","readonly",k=>S.localDocuments.getDocument(k,A))}(s,a);p.isFoundDocument()?d.resolve(p):p.isNoDocument()?d.resolve(null):d.reject(new W(L.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(p){const _=Du(p,`Failed to get document '${a} from cache`);d.reject(_)}}),function i(s,a,d){return r.apply(this,arguments)})(yield Mu(n),e,t);var r})),t.promise}(t,n._key).then(i=>new La(e,r,n._key,i,new Oa(null!==i&&i.hasLocalMutations,!0),n.converter))}function ly(n){n=Be(n,Bt);const e=Be(n.firestore,Tt);return Gp(qt(e),n._key,{source:"server"}).then(t=>Yd(e,n,t))}function cy(n){n=Be(n,Sn);const e=Be(n.firestore,Tt),t=qt(e),r=new So(e);return cm(n._query),Kp(t,n._query).then(i=>new Ma(e,r,n,i))}function hy(n){n=Be(n,Sn);const e=Be(n.firestore,Tt),t=qt(e),r=new So(e);return function v_(n,e){const t=new Pt;return n.asyncQueue.enqueueAndForget((0,I.A)(function*(){return(r=(0,I.A)(function*(s,a,d){try{const p=yield wc(s,a,!0),_=new xp(a,p.ls),v=_.da(p.documents),A=_.applyChanges(v,!1);d.resolve(A.snapshot)}catch(p){const _=Du(p,`Failed to execute query '${a} against cache`);d.reject(_)}}),function i(s,a,d){return r.apply(this,arguments)})(yield Mu(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Ma(e,r,n,i))}function dy(n){n=Be(n,Sn);const e=Be(n.firestore,Tt),t=qt(e),r=new So(e);return Kp(t,n._query,{source:"server"}).then(i=>new Ma(e,r,n,i))}function fy(n,e,t){n=Be(n,Bt);const r=Be(n.firestore,Tt),i=zc(n.converter,e,t);return Bu(r,[Fc(Na(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Et.none())])}function py(n,e,t,...r){n=Be(n,Bt);const i=Be(n.firestore,Tt),s=Na(i);let a;return a="string"==typeof(e=(0,Re.Ku)(e))||e instanceof Po?$d(s,"updateDoc",n._key,e,t,r):zd(s,"updateDoc",n._key,e),Bu(i,[a.toMutation(n._key,Et.exists(!0))])}function my(n){return Bu(Be(n.firestore,Tt),[new yu(n._key,Et.none())])}function gy(n,e){const t=Be(n.firestore,Tt),r=Zp(n),i=zc(n.converter,e);return Bu(t,[Fc(Na(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Et.exists(!1))]).then(()=>r)}function _y(n,...e){var t,r,i;n=(0,Re.Ku)(n);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Bd(e[a])||(s=e[a],a++);const d={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Bd(e[a])){const A=e[a];e[a]=null===(t=A.next)||void 0===t?void 0:t.bind(A),e[a+1]=null===(r=A.error)||void 0===r?void 0:r.bind(A),e[a+2]=null===(i=A.complete)||void 0===i?void 0:i.bind(A)}let p,_,v;if(n instanceof Bt)_=Be(n.firestore,Tt),v=Xi(n._key.path),p={next:A=>{e[a]&&e[a](Yd(_,n,A))},error:e[a+1],complete:e[a+2]};else{const A=Be(n,Sn);_=Be(A.firestore,Tt),v=A._query;const S=new So(_);p={next:k=>{e[a]&&e[a](new Ma(_,S,A,k))},error:e[a+1],complete:e[a+2]},cm(n._query)}return function(S,k,Y,re){const te=new kc(re),me=new td(k,te,Y);return S.asyncQueue.enqueueAndForget((0,I.A)(function*(){return Qh(yield Fu(S),me)})),()=>{te.$a(),S.asyncQueue.enqueueAndForget((0,I.A)(function*(){return Yh(yield Fu(S),me)}))}}(qt(_),v,d,p)}function yy(n,e){return function E_(n,e){const t=new kc(e);return n.asyncQueue.enqueueAndForget((0,I.A)(function*(){return i=yield Fu(n),s=t,ne(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),n.asyncQueue.enqueueAndForget((0,I.A)(function*(){return i=yield Fu(n),s=t,void ne(i).z_.delete(s);var i,s}))}}(qt(n=Be(n,Tt)),Bd(e)?e:{next:e})}function Bu(n,e){return function(r,i){const s=new Pt;return r.asyncQueue.enqueueAndForget((0,I.A)(function*(){return function Jg(n,e,t){return ld.apply(this,arguments)}(yield Ld(r),i,s)})),s.promise}(qt(n),e)}function Yd(n,e,t){const r=t.docs.get(e._key),i=new So(n);return new La(n,i,e._key,r,new Oa(t.hasPendingWrites,t.fromCache),e.converter)}const Sy={maxAttempts:5};class gm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Na(e)}set(e,t,r){this._verifyNotCommitted();const i=bo(e,this._firestore),s=zc(i.converter,t,r),a=Fc(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(a.toMutation(i._key,Et.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=bo(e,this._firestore);let a;return a="string"==typeof(t=(0,Re.Ku)(t))||t instanceof Po?$d(this._dataReader,"WriteBatch.update",s._key,t,r,i):zd(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Et.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=bo(e,this._firestore);return this._mutations=this._mutations.concat(new yu(t._key,Et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new W(L.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function bo(n,e){if((n=(0,Re.Ku)(n)).firestore!==e)throw new W(L.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class by extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Na(t)}get(t){const r=bo(t,this._firestore),i=new ry(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return ue();const a=s[0];if(a.isFoundDocument())return new Kl(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new Kl(this._firestore,i,r._key,null,r.converter);throw ue()})}set(t,r,i){const s=bo(t,this._firestore),a=zc(s.converter,r,i),d=Fc(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,d),this}update(t,r,i,...s){const a=bo(t,this._firestore);let d;return d="string"==typeof(r=(0,Re.Ku)(r))||r instanceof Po?$d(this._dataReader,"Transaction.update",a._key,r,i,s):zd(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,d),this}delete(t){const r=bo(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=bo(e,this._firestore),r=new So(this._firestore);return super.get(e).then(i=>new La(this._firestore,r,t._key,i._document,new Oa(!1,!1),t.converter))}}function Cy(n,e,t){n=Be(n,Tt);const r=Object.assign(Object.assign({},Sy),t);return function(s){if(s.maxAttempts<1)throw new W(L.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,a,d){const p=new Pt;return s.asyncQueue.enqueueAndForget((0,I.A)(function*(){const _=yield function Wp(n){return Vc(n).then(e=>e.datastore)}(s);new m_(s.asyncQueue,_,d,a,p).Xa()})),p.promise}(qt(n),i=>e(new by(n,i)),r)}function xy(){return new Wl("deleteField")}function Dy(){return new qd("serverTimestamp")}function ky(...n){return new Wd("arrayUnion",n)}function Ny(...n){return new Gd("arrayRemove",n)}function Vy(n){return new Kd("increment",n)}!function(e,t=!0){Mn=B.SDK_VERSION,(0,B._registerComponent)(new w.uA("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),d=new Tt(new nl(r.getProvider("auth-internal")),new ta(r.getProvider("app-check-internal")),function(_,v){if(!Object.prototype.hasOwnProperty.apply(_.options,["projectId"]))throw new W(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ni(_.options.projectId,v)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),d._setSettings(s),d},"PUBLIC").setMultipleInstances(!0)),(0,B.registerVersion)(Tr,"4.6.1",e),(0,B.registerVersion)(Tr,"4.6.1","esm2017")}()},1738:(Si,Wt,j)=>{j.d(Wt,{f:()=>Ea});var I=j(467),B=j(4438),w=j(9842),Re=(j(2438),j(177)),ge=j(5407),Ae=j(9253),z=j(1413),Xe=j(7673),ae=j(1985),Pe=j(8455),Qt=j(6365),zn=j(8750),oi=j(983),$n=j(3794),ai=j(941),qe=j(5558),Ze=j(6354),Ne=j(6129);class Le extends z.B{constructor(l=1/0,m=1/0,g=Ne.U){super(),this._bufferSize=l,this._windowTime=m,this._timestampProvider=g,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=m===1/0,this._bufferSize=Math.max(1,l),this._windowTime=Math.max(1,m)}next(l){const{isStopped:m,_buffer:g,_infiniteTimeWindow:T,_timestampProvider:R,_windowTime:O}=this;m||(g.push(l),!T&&g.push(R.now()+O)),this._trimBuffer(),super.next(l)}_subscribe(l){this._throwIfClosed(),this._trimBuffer();const m=this._innerSubscribe(l),{_infiniteTimeWindow:g,_buffer:T}=this,R=T.slice();for(let O=0;O<R.length&&!l.closed;O+=g?1:2)l.next(R[O]);return this._checkFinalizedStatuses(l),m}_trimBuffer(){const{_bufferSize:l,_timestampProvider:m,_buffer:g,_infiniteTimeWindow:T}=this,R=(T?1:2)*l;if(l<1/0&&R<g.length&&g.splice(0,g.length-R),!T){const O=m.now();let M=0;for(let U=1;U<g.length&&g[U]<=O;U+=2)M=U;M&&g.splice(0,M+1)}}}var ot=j(7707),hn=j(9974);function dn(f,l,...m){if(!0===l)return void f();if(!1===l)return;const g=new ot.Ms({next:()=>{g.unsubscribe(),f()}});return(0,zn.Tg)(l(...m)).subscribe(g)}function lt(f,l,m){let g,T=!1;return f&&"object"==typeof f?({bufferSize:g=1/0,windowTime:l=1/0,refCount:T=!1,scheduler:m}=f):g=null!=f?f:1/0,function mt(f={}){const{connector:l=(()=>new z.B),resetOnError:m=!0,resetOnComplete:g=!0,resetOnRefCountZero:T=!0}=f;return R=>{let O,M,U,se=0,fe=!1,De=!1;const je=()=>{null==M||M.unsubscribe(),M=void 0},Ve=()=>{je(),O=U=void 0,fe=De=!1},Ye=()=>{const st=O;Ve(),null==st||st.unsubscribe()};return(0,hn.N)((st,Ge)=>{se++,!De&&!fe&&je();const ct=U=null!=U?U:l();Ge.add(()=>{se--,0===se&&!De&&!fe&&(M=dn(Ye,T))}),ct.subscribe(Ge),!O&&se>0&&(O=new ot.Ms({next:Ot=>ct.next(Ot),error:Ot=>{De=!0,je(),M=dn(Ve,m,Ot),ct.error(Ot)},complete:()=>{fe=!0,je(),M=dn(Ve,g),ct.complete()}}),(0,zn.Tg)(st).subscribe(O))})(R)}}({connector:()=>new Le(g,l,m),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:T})}var X=j(1594),Lt=j(8071);function kt(f,l){return(0,Lt.T)(l)?(0,qe.n)(()=>f,l):(0,qe.n)(()=>f)}var At=j(6745),Jt=j(5964);j(7935);const bn=new B.nKC("angularfire2.auth.use-emulator"),hr=new B.nKC("angularfire2.auth.settings"),dr=new B.nKC("angularfire2.auth.tenant-id"),Hn=new B.nKC("angularfire2.auth.langugage-code"),bi=new B.nKC("angularfire2.auth.use-device-language"),Z=new B.nKC("angularfire.auth.persistence"),x=(f,l,m,g,T,R,O,M)=>(0,Ae.BM)(`${f.name}.auth`,"AngularFireAuth",f.name,()=>{const U=l.runOutsideAngular(()=>f.auth());if(m&&U.useEmulator(...m),g&&(U.tenantId=g),U.languageCode=T,R&&U.useDeviceLanguage(),O)for(const[se,fe]of Object.entries(O))U.settings[se]=fe;return M&&U.setPersistence(M),U},[m,g,T,R,O,M]);let F=(()=>{var f;class l{constructor(g,T,R,O,M,U,se,fe,De,je,Ve,Ye){(0,w.A)(this,"authState",void 0),(0,w.A)(this,"idToken",void 0),(0,w.A)(this,"user",void 0),(0,w.A)(this,"idTokenResult",void 0),(0,w.A)(this,"credential",void 0);const st=new z.B,Ge=(0,Xe.of)(void 0).pipe((0,ai.Q)(M.outsideAngular),(0,qe.n)(()=>O.runOutsideAngular(()=>Promise.resolve().then(j.bind(j,2438)))),(0,Ze.T)(()=>(0,Ae.iB)(g,O,T)),(0,Ze.T)(ct=>x(ct,O,U,fe,De,je,se,Ve)),lt({bufferSize:1,refCount:!1}));if((0,Re.Vy)(R))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Xe.of)(null);else{Ge.pipe((0,X.$)()).subscribe();const ct=Ge.pipe((0,qe.n)(we=>we.getRedirectResult().then(Nt=>Nt,()=>null)),ge.U0,lt({bufferSize:1,refCount:!1})),Ot=Ge.pipe((0,qe.n)(we=>new ae.c(Nt=>({unsubscribe:O.runOutsideAngular(()=>we.onAuthStateChanged(_t=>Nt.next(_t),_t=>Nt.error(_t),()=>Nt.complete()))})))),Dt=Ge.pipe((0,qe.n)(we=>new ae.c(Nt=>({unsubscribe:O.runOutsideAngular(()=>we.onIdTokenChanged(_t=>Nt.next(_t),_t=>Nt.error(_t),()=>Nt.complete()))}))));this.authState=ct.pipe(kt(Ot),(0,At._)(M.outsideAngular),(0,ai.Q)(M.insideAngular)),this.user=ct.pipe(kt(Dt),(0,At._)(M.outsideAngular),(0,ai.Q)(M.insideAngular)),this.idToken=this.user.pipe((0,qe.n)(we=>we?(0,Pe.H)(we.getIdToken()):(0,Xe.of)(null))),this.idTokenResult=this.user.pipe((0,qe.n)(we=>we?(0,Pe.H)(we.getIdTokenResult()):(0,Xe.of)(null))),this.credential=function jn(...f){const l=(0,$n.lI)(f),m=(0,$n.R0)(f,1/0),g=f;return g.length?1===g.length?(0,zn.Tg)(g[0]):(0,Qt.U)(m)((0,Pe.H)(g,l)):oi.w}(ct,st,this.authState.pipe((0,Jt.p)(we=>!we))).pipe((0,Ze.T)(we=>null!=we&&we.user?we:null),(0,At._)(M.outsideAngular),(0,ai.Q)(M.insideAngular))}return(0,Ae.Gt)(this,Ge,O,{spy:{apply:(ct,Ot,Dt)=>{(ct.startsWith("signIn")||ct.startsWith("createUser"))&&Dt.then(we=>st.next(we))}}})}}return f=l,(0,w.A)(l,"\u0275fac",function(g){return new(g||f)(B.KVO(Ae.rx),B.KVO(Ae.uP,8),B.KVO(B.Agw),B.KVO(B.SKi),B.KVO(ge.u0),B.KVO(bn,8),B.KVO(hr,8),B.KVO(dr,8),B.KVO(Hn,8),B.KVO(bi,8),B.KVO(Z,8),B.KVO(ge.Jv,8))}),(0,w.A)(l,"\u0275prov",B.jDH({token:f,factory:f.\u0275fac,providedIn:"any"})),l})();var H=j(99),ie=(j(7440),j(2214),j(2784)),Te=function(){return Te=Object.assign||function(l){for(var m,g=1,T=arguments.length;g<T;g++)for(var R in m=arguments[g])Object.prototype.hasOwnProperty.call(m,R)&&(l[R]=m[R]);return l},Te.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var Yt={includeMetadataChanges:!1};function Dn(f,l){return void 0===l&&(l={}),function nt(f){return function Mt(f,l){return void 0===l&&(l=Yt),new ae.c(function(m){return{unsubscribe:(0,ie.aQ)(f,l,{next:m.next.bind(m),error:m.error.bind(m),complete:m.complete.bind(m)})}})}(f,{includeMetadataChanges:!0}).pipe((0,Ze.T)(function(l){return l.docs}))}(f).pipe((0,Ze.T)(function(m){return m.map(function(g){return function xr(f,l){var m;void 0===l&&(l={});var g=f.data(l);return f.exists()&&"object"==typeof g&&null!==g&&l.idField?Te(Te({},g),((m={})[l.idField]=f.id,m)):g}(g,l)})}))}const Co=(0,ge.S3)(Dn,!0),Me=(0,ge.S3)(ie.gS,!0),Ci=(0,ge.S3)(ie.rJ,!0),Wu=(0,ge.S3)(ie.kd,!0),rs=(0,ge.S3)(ie.H9,!0),ki=(0,ge.S3)(ie.x7,!0),er=(0,ge.S3)(ie.aU,!0),Lo=(0,ge.S3)(ie.P,!0),Vi=(0,ge.S3)(ie.BN,!0),Ks=(0,ge.S3)(ie.mZ,!0);var zs=j(3236),ci=j(9172),tr=j(4360);function $s(){return(0,hn.N)((f,l)=>{let m,g=!1;f.subscribe((0,tr._)(l,T=>{const R=m;m=T,g&&l.next([R,T]),g=!0}))})}var Li=j(2816),za=j(3294),kr=j(3345),Q=j(2824),gt=j(1076),Mi=j(1362);function js(f,l){if(void 0===l)return{merge:!1};if(void 0!==l.mergeFields&&void 0!==l.merge)throw new Q.W6("invalid-argument",`Invalid options passed to function ${f}(): You cannot specify both "merge" and "mergeFields".`);return l}function Fi(){if(typeof Uint8Array>"u")throw new Q.W6("unimplemented","Uint8Arrays are not available in this environment.")}function Hs(){if(!(0,Q.qG)())throw new Q.W6("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Gr{constructor(l){this._delegate=l}static fromBase64String(l){return Hs(),new Gr(Q.Ix.fromBase64String(l))}static fromUint8Array(l){return Fi(),new Gr(Q.Ix.fromUint8Array(l))}toBase64(){return Hs(),this._delegate.toBase64()}toUint8Array(){return Fi(),this._delegate.toUint8Array()}isEqual(l){return this._delegate.isEqual(l._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Qs(f){return function Bo(f,l){if("object"!=typeof f||null===f)return!1;const m=f;for(const g of l)if(g in m&&"function"==typeof m[g])return!0;return!1}(f,["next","error","complete"])}class Ju{enableIndexedDbPersistence(l,m){return(0,Q.ol)(l._delegate,{forceOwnership:m})}enableMultiTabIndexedDbPersistence(l){return(0,Q.Q5)(l._delegate)}clearIndexedDbPersistence(l){return(0,Q.me)(l._delegate)}}class $a{constructor(l,m,g){this._delegate=m,this._persistenceProvider=g,this.INTERNAL={delete:()=>this.terminate()},l instanceof Q.cm||(this._appCompat=l)}get _databaseId(){return this._delegate._databaseId}settings(l){const m=this._delegate._getSettings();!l.merge&&m.host!==l.host&&(0,Q.qi)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),l.merge&&delete(l=Object.assign(Object.assign({},m),l)).merge,this._delegate._setSettings(l)}useEmulator(l,m,g={}){(0,Q.vN)(this._delegate,l,m,g)}enableNetwork(){return(0,Q.Os)(this._delegate)}disableNetwork(){return(0,Q.LA)(this._delegate)}enablePersistence(l){let m=!1,g=!1;return l&&(m=!!l.synchronizeTabs,g=!!l.experimentalForceOwningTab,(0,Q.c8)("synchronizeTabs",m,"experimentalForceOwningTab",g)),m?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,g)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return(0,Q.iB)(this._delegate)}onSnapshotsInSync(l){return(0,Q.FC)(this._delegate,l)}get app(){if(!this._appCompat)throw new Q.W6("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(l){try{return new On(this,(0,Q.rJ)(this._delegate,l))}catch(m){throw wt(m,"collection()","Firestore.collection()")}}doc(l){try{return new Vn(this,(0,Q.H9)(this._delegate,l))}catch(m){throw wt(m,"doc()","Firestore.doc()")}}collectionGroup(l){try{return new on(this,(0,Q.Cs)(this._delegate,l))}catch(m){throw wt(m,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(l){return(0,Q.c4)(this._delegate,m=>l(new Bi(this,m)))}batch(){return(0,Q.Ws)(this._delegate),new ls(new Q.GA(this._delegate,l=>(0,Q.z6)(this._delegate,l)))}loadBundle(l){return(0,Q.po)(this._delegate,l)}namedQuery(l){return(0,Q.St)(this._delegate,l).then(m=>m?new on(this,m):null)}}class Ui extends Q.fS{constructor(l){super(),this.firestore=l}convertBytes(l){return new Gr(new Q.Ix(l))}convertReference(l){const m=this.convertDocumentKey(l,this.firestore._databaseId);return Vn.forKey(m,this.firestore,null)}}class Bi{constructor(l,m){this._firestore=l,this._delegate=m,this._userDataWriter=new Ui(l)}get(l){const m=Kr(l);return this._delegate.get(m).then(g=>new $e(this._firestore,new Q.Wq(this._firestore._delegate,this._userDataWriter,g._key,g._document,g.metadata,m.converter)))}set(l,m,g){const T=Kr(l);return g?(js("Transaction.set",g),this._delegate.set(T,m,g)):this._delegate.set(T,m),this}update(l,m,g,...T){const R=Kr(l);return 2===arguments.length?this._delegate.update(R,m):this._delegate.update(R,m,g,...T),this}delete(l){const m=Kr(l);return this._delegate.delete(m),this}}class ls{constructor(l){this._delegate=l}set(l,m,g){const T=Kr(l);return g?(js("WriteBatch.set",g),this._delegate.set(T,m,g)):this._delegate.set(T,m),this}update(l,m,g,...T){const R=Kr(l);return 2===arguments.length?this._delegate.update(R,m):this._delegate.update(R,m,g,...T),this}delete(l){const m=Kr(l);return this._delegate.delete(m),this}commit(){return this._delegate.commit()}}class An{constructor(l,m,g){this._firestore=l,this._userDataWriter=m,this._delegate=g}fromFirestore(l,m){const g=new Q.YQ(this._firestore._delegate,this._userDataWriter,l._key,l._document,l.metadata,null);return this._delegate.fromFirestore(new qi(this._firestore,g),null!=m?m:{})}toFirestore(l,m){return m?this._delegate.toFirestore(l,m):this._delegate.toFirestore(l)}static getInstance(l,m){const g=An.INSTANCES;let T=g.get(l);T||(T=new WeakMap,g.set(l,T));let R=T.get(m);return R||(R=new An(l,new Ui(l),m),T.set(m,R)),R}}An.INSTANCES=new WeakMap;class Vn{constructor(l,m){this.firestore=l,this._delegate=m,this._userDataWriter=new Ui(l)}static forPath(l,m,g){if(l.length%2!=0)throw new Q.W6("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${l.canonicalString()} has ${l.length}`);return new Vn(m,new Q.T1(m._delegate,g,new Q.K$(l)))}static forKey(l,m,g){return new Vn(m,new Q.T1(m._delegate,g,l))}get id(){return this._delegate.id}get parent(){return new On(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(l){try{return new On(this.firestore,(0,Q.rJ)(this._delegate,l))}catch(m){throw wt(m,"collection()","DocumentReference.collection()")}}isEqual(l){return(l=(0,gt.Ku)(l))instanceof Q.T1&&(0,Q.yx)(this._delegate,l)}set(l,m){m=js("DocumentReference.set",m);try{return m?(0,Q.BN)(this._delegate,l,m):(0,Q.BN)(this._delegate,l)}catch(g){throw wt(g,"setDoc()","DocumentReference.set()")}}update(l,m,...g){try{return 1===arguments.length?(0,Q.mZ)(this._delegate,l):(0,Q.mZ)(this._delegate,l,m,...g)}catch(T){throw wt(T,"updateDoc()","DocumentReference.update()")}}delete(){return(0,Q.kd)(this._delegate)}onSnapshot(...l){const m=mn(l),g=hi(l,T=>new $e(this.firestore,new Q.Wq(this.firestore._delegate,this._userDataWriter,T._key,T._document,T.metadata,this._delegate.converter)));return(0,Q.aQ)(this._delegate,m,g)}get(l){let m;return m="cache"===(null==l?void 0:l.source)?(0,Q.nY)(this._delegate):"server"===(null==l?void 0:l.source)?(0,Q._e)(this._delegate):(0,Q.x7)(this._delegate),m.then(g=>new $e(this.firestore,new Q.Wq(this.firestore._delegate,this._userDataWriter,g._key,g._document,g.metadata,this._delegate.converter)))}withConverter(l){return new Vn(this.firestore,this._delegate.withConverter(l?An.getInstance(this.firestore,l):null))}}function wt(f,l,m){return f.message=f.message.replace(l,m),f}function mn(f){for(const l of f)if("object"==typeof l&&!Qs(l))return l;return{}}function hi(f,l){var m,g;let T;return T=Qs(f[0])?f[0]:Qs(f[1])?f[1]:"function"==typeof f[0]?{next:f[0],error:f[1],complete:f[2]}:{next:f[1],error:f[2],complete:f[3]},{next:R=>{T.next&&T.next(l(R))},error:null===(m=T.error)||void 0===m?void 0:m.bind(T),complete:null===(g=T.complete)||void 0===g?void 0:g.bind(T)}}class $e{constructor(l,m){this._firestore=l,this._delegate=m}get ref(){return new Vn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(l){return this._delegate.data(l)}get(l,m){return this._delegate.get(l,m)}isEqual(l){return(0,Q.lN)(this._delegate,l._delegate)}}class qi extends $e{data(l){const m=this._delegate.data(l);return this._delegate._converter||(0,Q.bI)(void 0!==m,"Document in a QueryDocumentSnapshot should exist"),m}}class on{constructor(l,m){this.firestore=l,this._delegate=m,this._userDataWriter=new Ui(l)}where(l,m,g){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q._M)(l,m,g)))}catch(T){throw wt(T,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(l,m){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.My)(l,m)))}catch(g){throw wt(g,/(orderBy|where)\(\)/,"Query.$1()")}}limit(l){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.AB)(l)))}catch(m){throw wt(m,"limit()","Query.limit()")}}limitToLast(l){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.$1)(l)))}catch(m){throw wt(m,"limitToLast()","Query.limitToLast()")}}startAt(...l){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.EO)(...l)))}catch(m){throw wt(m,"startAt()","Query.startAt()")}}startAfter(...l){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.HM)(...l)))}catch(m){throw wt(m,"startAfter()","Query.startAfter()")}}endBefore(...l){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.rf)(...l)))}catch(m){throw wt(m,"endBefore()","Query.endBefore()")}}endAt(...l){try{return new on(this.firestore,(0,Q.P)(this._delegate,(0,Q.FD)(...l)))}catch(m){throw wt(m,"endAt()","Query.endAt()")}}isEqual(l){return(0,Q.B)(this._delegate,l._delegate)}get(l){let m;return m="cache"===(null==l?void 0:l.source)?(0,Q.kU)(this._delegate):"server"===(null==l?void 0:l.source)?(0,Q.Rr)(this._delegate):(0,Q.GG)(this._delegate),m.then(g=>new qo(this.firestore,new Q.NJ(this.firestore._delegate,this._userDataWriter,this._delegate,g._snapshot)))}onSnapshot(...l){const m=mn(l),g=hi(l,T=>new qo(this.firestore,new Q.NJ(this.firestore._delegate,this._userDataWriter,this._delegate,T._snapshot)));return(0,Q.aQ)(this._delegate,m,g)}withConverter(l){return new on(this.firestore,this._delegate.withConverter(l?An.getInstance(this.firestore,l):null))}}class Yu{constructor(l,m){this._firestore=l,this._delegate=m}get type(){return this._delegate.type}get doc(){return new qi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class qo{constructor(l,m){this._firestore=l,this._delegate=m}get query(){return new on(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(l=>new qi(this._firestore,l))}docChanges(l){return this._delegate.docChanges(l).map(m=>new Yu(this._firestore,m))}forEach(l,m){this._delegate.forEach(g=>{l.call(m,new qi(this._firestore,g))})}isEqual(l){return(0,Q.lN)(this._delegate,l._delegate)}}class On extends on{constructor(l,m){super(l,m),this.firestore=l,this._delegate=m}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const l=this._delegate.parent;return l?new Vn(this.firestore,l):null}doc(l){try{return new Vn(this.firestore,void 0===l?(0,Q.H9)(this._delegate):(0,Q.H9)(this._delegate,l))}catch(m){throw wt(m,"doc()","CollectionReference.doc()")}}add(l){return(0,Q.gS)(this._delegate,l).then(m=>new Vn(this.firestore,m))}isEqual(l){return(0,Q.yx)(this._delegate,l._delegate)}withConverter(l){return new On(this.firestore,this._delegate.withConverter(l?An.getInstance(this.firestore,l):null))}}function Kr(f){return(0,Q.lo)(f,Q.T1)}class di{constructor(...l){this._delegate=new Q.uY(...l)}static documentId(){return new di(Q.FA.keyField().canonicalString())}isEqual(l){return(l=(0,gt.Ku)(l))instanceof Q.uY&&this._delegate._internalPath.isEqual(l._internalPath)}}class gr{constructor(l){this._delegate=l}static serverTimestamp(){const l=(0,Q.O5)();return l._methodName="FieldValue.serverTimestamp",new gr(l)}static delete(){const l=(0,Q.CL)();return l._methodName="FieldValue.delete",new gr(l)}static arrayUnion(...l){const m=(0,Q.hq)(...l);return m._methodName="FieldValue.arrayUnion",new gr(m)}static arrayRemove(...l){const m=(0,Q.C3)(...l);return m._methodName="FieldValue.arrayRemove",new gr(m)}static increment(l){const m=(0,Q.GV)(l);return m._methodName="FieldValue.increment",new gr(m)}isEqual(l){return this._delegate.isEqual(l._delegate)}}const Wo={Firestore:$a,GeoPoint:Q.Ci,Timestamp:Q.Dc,Blob:Gr,Transaction:Bi,WriteBatch:ls,DocumentReference:Vn,DocumentSnapshot:$e,Query:on,QueryDocumentSnapshot:qi,QuerySnapshot:qo,CollectionReference:On,FieldPath:di,FieldValue:gr,setLogLevel:function mr(f){(0,Q.He)(f)},CACHE_SIZE_UNLIMITED:Q.H6};function Go(f,l){return function ja(f,l=zs.E){return new ae.c(m=>{let g;return null!=l?l.schedule(()=>{g=f.onSnapshot({includeMetadataChanges:!0},m)}):g=f.onSnapshot({includeMetadataChanges:!0},m),()=>{null!=g&&g()}})}(f,l)}function _r(f,l){return Go(f,l).pipe((0,Ze.T)(m=>({payload:m,type:"query"})))}!function wn(f){(function Ln(f,l){f.INTERNAL.registerComponent(new Mi.uA("firestore-compat",m=>{const g=m.getProvider("app-compat").getImmediate(),T=m.getProvider("firestore").getImmediate();return l(g,T)},"PUBLIC").setServiceProps(Object.assign({},Wo)))})(f,(l,m)=>new $a(l,m,new Ju)),f.registerVersion("@firebase/firestore-compat","0.3.30")}(kr.A);class Js{constructor(l,m){(0,w.A)(this,"ref",void 0),(0,w.A)(this,"afs",void 0),this.ref=l,this.afs=m}set(l,m){return this.ref.set(l,m)}update(l){return this.ref.update(l)}delete(){return this.ref.delete()}collection(l,m){const g=this.ref.collection(l),{ref:T,query:R}=pi(g,m);return new $r(T,R,this.afs)}snapshotChanges(){return function cs(f,l){return Go(f,l).pipe((0,ci.Z)(void 0),$s(),(0,Ze.T)(m=>{const[g,T]=m;return T.exists?null!=g&&g.exists?{payload:T,type:"modified"}:{payload:T,type:"added"}:{payload:T,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ge.U0)}valueChanges(l={}){return this.snapshotChanges().pipe((0,Ze.T)(({payload:m})=>l.idField?{...m.data(),[l.idField]:m.id}:m.data()))}get(l){return(0,Pe.H)(this.ref.get(l)).pipe(ge.U0)}}function fi(f,l){return _r(f,l).pipe((0,ci.Z)(void 0),$s(),(0,Ze.T)(m=>{const[g,T]=m,R=T.payload.docChanges(),O=R.map(M=>({type:M.type,payload:M}));return g&&JSON.stringify(g.payload.metadata)!==JSON.stringify(T.payload.metadata)&&T.payload.docs.forEach((M,U)=>{const se=R.find(De=>De.doc.ref.isEqual(M.ref)),fe=null==g?void 0:g.payload.docs.find(De=>De.ref.isEqual(M.ref));se&&JSON.stringify(se.doc.metadata)===JSON.stringify(M.metadata)||!se&&fe&&JSON.stringify(fe.metadata)===JSON.stringify(M.metadata)||O.push({type:"modified",payload:{oldIndex:U,newIndex:U,type:"modified",doc:M}})}),O}))}function hs(f,l,m){return fi(f,m).pipe((0,Li.S)((g,T)=>function Ys(f,l,m){return l.forEach(g=>{m.indexOf(g.type)>-1&&(f=function Ko(f,l){switch(l.type){case"added":if(!f[l.newIndex]||!f[l.newIndex].doc.ref.isEqual(l.doc.ref))return zr(f,l.newIndex,0,l);break;case"modified":if(null==f[l.oldIndex]||f[l.oldIndex].doc.ref.isEqual(l.doc.ref)){if(l.oldIndex!==l.newIndex){const m=f.slice();return m.splice(l.oldIndex,1),m.splice(l.newIndex,0,l),m}return zr(f,l.newIndex,1,l)}break;case"removed":if(f[l.oldIndex]&&f[l.oldIndex].doc.ref.isEqual(l.doc.ref))return zr(f,l.oldIndex,1)}return f}(f,g))}),f}(g,T.map(R=>R.payload),l),[]),(0,za.F)(),(0,Ze.T)(g=>g.map(T=>({type:T.type,payload:T}))))}function zr(f,l,m,...g){const T=f.slice();return T.splice(l,m,...g),T}function Wi(f){return(!f||0===f.length)&&(f=["added","removed","modified"]),f}class $r{constructor(l,m,g){(0,w.A)(this,"ref",void 0),(0,w.A)(this,"query",void 0),(0,w.A)(this,"afs",void 0),this.ref=l,this.query=m,this.afs=g}stateChanges(l){let m=fi(this.query,this.afs.schedulers.outsideAngular);return l&&l.length>0&&(m=m.pipe((0,Ze.T)(g=>g.filter(T=>l.indexOf(T.type)>-1)))),m.pipe((0,ci.Z)(void 0),$s(),(0,Jt.p)(([g,T])=>T.length>0||!g),(0,Ze.T)(([,g])=>g),ge.U0)}auditTrail(l){return this.stateChanges(l).pipe((0,Li.S)((m,g)=>[...m,...g],[]))}snapshotChanges(l){const m=Wi(l);return hs(this.query,m,this.afs.schedulers.outsideAngular).pipe(ge.U0)}valueChanges(l={}){return _r(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.T)(m=>m.payload.docs.map(g=>l.idField?{...g.data(),[l.idField]:g.id}:g.data())),ge.U0)}get(l){return(0,Pe.H)(this.query.get(l)).pipe(ge.U0)}add(l){return this.ref.add(l)}doc(l){return new Js(this.ref.doc(l),this.afs)}}class zo{constructor(l,m){(0,w.A)(this,"query",void 0),(0,w.A)(this,"afs",void 0),this.query=l,this.afs=m}stateChanges(l){return l&&0!==l.length?fi(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.T)(m=>m.filter(g=>l.indexOf(g.type)>-1)),(0,Jt.p)(m=>m.length>0),ge.U0):fi(this.query,this.afs.schedulers.outsideAngular).pipe(ge.U0)}auditTrail(l){return this.stateChanges(l).pipe((0,Li.S)((m,g)=>[...m,...g],[]))}snapshotChanges(l){const m=Wi(l);return hs(this.query,m,this.afs.schedulers.outsideAngular).pipe(ge.U0)}valueChanges(l={}){return _r(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.T)(g=>g.payload.docs.map(T=>l.idField?{[l.idField]:T.id,...T.data()}:T.data())),ge.U0)}get(l){return(0,Pe.H)(this.query.get(l)).pipe(ge.U0)}}const Xs=new B.nKC("angularfire2.enableFirestorePersistence"),Zs=new B.nKC("angularfire2.firestore.persistenceSettings"),ds=new B.nKC("angularfire2.firestore.settings"),fs=new B.nKC("angularfire2.firestore.use-emulator");function pi(f,l=(m=>m)){return{query:l(f),ref:f}}let $o=(()=>{var f;class l{constructor(g,T,R,O,M,U,se,fe,De,je,Ve,Ye,st,Ge,ct,Ot,Dt){(0,w.A)(this,"schedulers",void 0),(0,w.A)(this,"firestore",void 0),(0,w.A)(this,"persistenceEnabled$",void 0),this.schedulers=se;const we=(0,Ae.iB)(g,U,T),Nt=De;je&&x(we,U,Ve,st,Ge,ct,Ye,Ot),[this.firestore,this.persistenceEnabled$]=(0,Ae.BM)(`${we.name}.firestore`,"AngularFirestore",we.name,()=>{const _t=U.runOutsideAngular(()=>we.firestore());if(O&&_t.settings(O),Nt&&_t.useEmulator(...Nt),R&&!(0,Re.Vy)(M)){const bs=()=>{try{return(0,Pe.H)(_t.enablePersistence(fe||void 0).then(()=>!0,()=>!1))}catch(Ai){return typeof console<"u"&&console.warn(Ai),(0,Xe.of)(!1)}};return[_t,U.runOutsideAngular(bs)]}return[_t,(0,Xe.of)(!1)]},[O,Nt,R])}collection(g,T){let R;R="string"==typeof g?this.firestore.collection(g):g;const{ref:O,query:M}=pi(R,T),U=this.schedulers.ngZone.run(()=>O);return new $r(U,M,this)}collectionGroup(g,T){const R=T||(M=>M),O=this.firestore.collectionGroup(g);return new zo(R(O),this)}doc(g){let T;T="string"==typeof g?this.firestore.doc(g):g;const R=this.schedulers.ngZone.run(()=>T);return new Js(R,this)}createId(){return this.firestore.collection("_").doc().id}}return f=l,(0,w.A)(l,"\u0275fac",function(g){return new(g||f)(B.KVO(Ae.rx),B.KVO(Ae.uP,8),B.KVO(Xs,8),B.KVO(ds,8),B.KVO(B.Agw),B.KVO(B.SKi),B.KVO(ge.u0),B.KVO(Zs,8),B.KVO(fs,8),B.KVO(F,8),B.KVO(bn,8),B.KVO(hr,8),B.KVO(dr,8),B.KVO(Hn,8),B.KVO(bi,8),B.KVO(Z,8),B.KVO(ge.Jv,8))}),(0,w.A)(l,"\u0275prov",B.jDH({token:f,factory:f.\u0275fac,providedIn:"any"})),l})();var jr=j(5265),mi=j(7852);const ps="firebasestorage.googleapis.com",Ho="storageBucket";class at extends gt.g{constructor(l,m,g=0){super(ms(l),`Firebase Storage: ${m} (${ms(l)})`),this.status_=g,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,at.prototype)}get status(){return this.status_}set status(l){this.status_=l}_codeEquals(l){return ms(l)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(l){this.customData.serverResponse=l,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var We=function(f){return f.UNKNOWN="unknown",f.OBJECT_NOT_FOUND="object-not-found",f.BUCKET_NOT_FOUND="bucket-not-found",f.PROJECT_NOT_FOUND="project-not-found",f.QUOTA_EXCEEDED="quota-exceeded",f.UNAUTHENTICATED="unauthenticated",f.UNAUTHORIZED="unauthorized",f.UNAUTHORIZED_APP="unauthorized-app",f.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",f.INVALID_CHECKSUM="invalid-checksum",f.CANCELED="canceled",f.INVALID_EVENT_NAME="invalid-event-name",f.INVALID_URL="invalid-url",f.INVALID_DEFAULT_BUCKET="invalid-default-bucket",f.NO_DEFAULT_BUCKET="no-default-bucket",f.CANNOT_SLICE_BLOB="cannot-slice-blob",f.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",f.NO_DOWNLOAD_URL="no-download-url",f.INVALID_ARGUMENT="invalid-argument",f.INVALID_ARGUMENT_COUNT="invalid-argument-count",f.APP_DELETED="app-deleted",f.INVALID_ROOT_OPERATION="invalid-root-operation",f.INVALID_FORMAT="invalid-format",f.INTERNAL_ERROR="internal-error",f.UNSUPPORTED_ENVIRONMENT="unsupported-environment",f}(We||{});function ms(f){return"storage/"+f}function an(){return new at(We.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function _s(){return new at(We.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ys(){return new at(We.CANCELED,"User canceled the upload/download.")}function Ir(){return new at(We.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function rr(f){return new at(We.INVALID_ARGUMENT,f)}function Ki(){return new at(We.APP_DELETED,"The Firebase app was deleted.")}function Is(f){return new at(We.INVALID_ROOT_OPERATION,"The operation '"+f+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Qr(f,l){return new at(We.INVALID_FORMAT,"String does not match format '"+f+"': "+l)}function vr(f){throw new at(We.INTERNAL_ERROR,"Internal error: "+f)}class Ut{constructor(l,m){this.bucket=l,this.path_=m}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const l=encodeURIComponent;return"/b/"+l(this.bucket)+"/o/"+l(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(l,m){let g;try{g=Ut.makeFromUrl(l,m)}catch{return new Ut(l,"")}if(""===g.path)return g;throw function Jo(f){return new at(We.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+f+"'.")}(l)}static makeFromUrl(l,m){let g=null;const T="([A-Za-z0-9.\\-_]+)",M=new RegExp("^gs://"+T+"(/(.*))?$","i");function se(we){we.path_=decodeURIComponent(we.path)}const De=m.replace(/[.]/g,"\\."),Dt=[{regex:M,indices:{bucket:1,path:3},postModify:function R(we){"/"===we.path.charAt(we.path.length-1)&&(we.path_=we.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${De}/v[A-Za-z0-9_]+/b/${T}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:se},{regex:new RegExp(`^https?://${m===ps?"(?:storage.googleapis.com|storage.cloud.google.com)":m}/${T}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:se}];for(let we=0;we<Dt.length;we++){const Nt=Dt[we],_t=Nt.regex.exec(l);if(_t){let Ai=_t[Nt.indices.path];Ai||(Ai=""),g=new Ut(_t[Nt.indices.bucket],Ai),Nt.postModify(g);break}}if(null==g)throw function Hr(f){return new at(We.INVALID_URL,"Invalid URL '"+f+"'.")}(l);return g}}class Zu{constructor(l){this.promise_=Promise.reject(l)}getPromise(){return this.promise_}cancel(l=!1){}}function gi(f){return"string"==typeof f||f instanceof String}function io(f){return Zo()&&f instanceof Blob}function Zo(){return typeof Blob<"u"}function Er(f,l,m,g){if(g<l)throw rr(`Invalid value for '${f}'. Expected ${l} or greater.`);if(g>m)throw rr(`Invalid value for '${f}'. Expected ${m} or less.`)}function Tr(f,l,m){let g=l;return null==m&&(g=`https://${l}`),`${m}://${g}/v0${f}`}function Vt(f){const l=encodeURIComponent;let m="?";for(const g in f)f.hasOwnProperty(g)&&(m=m+(l(g)+"=")+l(f[g])+"&");return m=m.slice(0,-1),m}var Mn=function(f){return f[f.NO_ERROR=0]="NO_ERROR",f[f.NETWORK_ERROR=1]="NETWORK_ERROR",f[f.ABORT=2]="ABORT",f}(Mn||{});function ir(f,l){const m=f>=500&&f<600,T=-1!==[408,429].indexOf(f),R=-1!==l.indexOf(f);return m||T||R}class zi{constructor(l,m,g,T,R,O,M,U,se,fe,De,je=!0){this.url_=l,this.method_=m,this.headers_=g,this.body_=T,this.successCodes_=R,this.additionalRetryCodes_=O,this.callback_=M,this.errorCallback_=U,this.timeout_=se,this.progressCallback_=fe,this.connectionFactory_=De,this.retry=je,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Ve,Ye)=>{this.resolve_=Ve,this.reject_=Ye,this.start_()})}start_(){const m=(g,T)=>{const R=this.resolve_,O=this.reject_,M=T.connection;if(T.wasSuccessCode)try{const U=this.callback_(M,M.getResponse());!function Yo(f){return void 0!==f}(U)?R():R(U)}catch(U){O(U)}else if(null!==M){const U=an();U.serverResponse=M.getErrorText(),O(this.errorCallback_?this.errorCallback_(M,U):U)}else O(T.canceled?this.appDelete_?Ki():ys():_s())};this.canceled_?m(0,new Nr(!1,null,!0)):this.backoffId_=function vs(f,l,m){let g=1,T=null,R=null,O=!1,M=0;function U(){return 2===M}let se=!1;function fe(...Ge){se||(se=!0,l.apply(null,Ge))}function De(Ge){T=setTimeout(()=>{T=null,f(Ve,U())},Ge)}function je(){R&&clearTimeout(R)}function Ve(Ge,...ct){if(se)return void je();if(Ge)return je(),void fe.call(null,Ge,...ct);if(U()||O)return je(),void fe.call(null,Ge,...ct);let Dt;g<64&&(g*=2),1===M?(M=2,Dt=0):Dt=1e3*(g+Math.random()),De(Dt)}let Ye=!1;function st(Ge){Ye||(Ye=!0,je(),!se&&(null!==T?(Ge||(M=2),clearTimeout(T),De(0)):Ge||(M=1)))}return De(0),R=setTimeout(()=>{O=!0,st(!0)},m),st}((g,T)=>{if(T)return void g(!1,new Nr(!1,null,!0));const R=this.connectionFactory_();this.pendingConnection_=R;const O=M=>{null!==this.progressCallback_&&this.progressCallback_(M.loaded,M.lengthComputable?M.total:-1)};null!==this.progressCallback_&&R.addUploadProgressListener(O),R.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&R.removeUploadProgressListener(O),this.pendingConnection_=null;const M=R.getErrorCode()===Mn.NO_ERROR,U=R.getStatus();if(!M||ir(U,this.additionalRetryCodes_)&&this.retry){const fe=R.getErrorCode()===Mn.ABORT;return void g(!1,new Nr(!1,null,fe))}const se=-1!==this.successCodes_.indexOf(U);g(!0,new Nr(se,R))})},m,this.timeout_)}getPromise(){return this.promise_}cancel(l){this.canceled_=!0,this.appDelete_=l||!1,null!==this.backoffId_&&function el(f){f(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Nr{constructor(l,m,g){this.wasSuccessCode=l,this.connection=m,this.canceled=!!g}}function ec(...f){const l=function de(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}();if(void 0!==l){const m=new l;for(let g=0;g<f.length;g++)m.append(f[g]);return m.getBlob()}if(Zo())return new Blob(f);throw new at(We.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const W={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Pt{constructor(l,m){this.data=l,this.contentType=m||null}}function so(f,l){switch(f){case W.RAW:return new Pt(tl(l));case W.BASE64:case W.BASE64URL:return new Pt(nl(f,l));case W.DATA_URL:return new Pt(function nc(f){const l=new rl(f);return l.base64?nl(W.BASE64,l.rest):function tc(f){let l;try{l=decodeURIComponent(f)}catch{throw Qr(W.DATA_URL,"Malformed data URL.")}return tl(l)}(l.rest)}(l),function il(f){return new rl(f).contentType}(l))}throw an()}function tl(f){const l=[];for(let m=0;m<f.length;m++){let g=f.charCodeAt(m);g<=127?l.push(g):g<=2047?l.push(192|g>>6,128|63&g):55296==(64512&g)?m<f.length-1&&56320==(64512&f.charCodeAt(m+1))?(g=65536|(1023&g)<<10|1023&f.charCodeAt(++m),l.push(240|g>>18,128|g>>12&63,128|g>>6&63,128|63&g)):l.push(239,191,189):56320==(64512&g)?l.push(239,191,189):l.push(224|g>>12,128|g>>6&63,128|63&g)}return new Uint8Array(l)}function nl(f,l){switch(f){case W.BASE64:{const T=-1!==l.indexOf("-"),R=-1!==l.indexOf("_");if(T||R)throw Qr(f,"Invalid character '"+(T?"-":"_")+"' found: is it base64url encoded?");break}case W.BASE64URL:{const T=-1!==l.indexOf("+"),R=-1!==l.indexOf("/");if(T||R)throw Qr(f,"Invalid character '"+(T?"+":"/")+"' found: is it base64 encoded?");l=l.replace(/-/g,"+").replace(/_/g,"/");break}}let m;try{m=function L(f){if(typeof atob>"u")throw function ro(f){return new at(We.UNSUPPORTED_ENVIRONMENT,`${f} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}("base-64");return atob(f)}(l)}catch(T){throw T.message.includes("polyfill")?T:Qr(f,"Invalid character found")}const g=new Uint8Array(m.length);for(let T=0;T<m.length;T++)g[T]=m.charCodeAt(T);return g}class rl{constructor(l){this.base64=!1,this.contentType=null;const m=l.match(/^data:([^,]+)?,/);if(null===m)throw Qr(W.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const g=m[1]||null;null!=g&&(this.base64=function ta(f,l){return f.length>=l.length&&f.substring(f.length-l.length)===l}(g,";base64"),this.contentType=this.base64?g.substring(0,g.length-7):g),this.rest=l.substring(l.indexOf(",")+1)}}class un{constructor(l,m){let g=0,T="";io(l)?(this.data_=l,g=l.size,T=l.type):l instanceof ArrayBuffer?(m?this.data_=new Uint8Array(l):(this.data_=new Uint8Array(l.byteLength),this.data_.set(new Uint8Array(l))),g=this.data_.length):l instanceof Uint8Array&&(m?this.data_=l:(this.data_=new Uint8Array(l.length),this.data_.set(l)),g=l.length),this.size_=g,this.type_=T}size(){return this.size_}type(){return this.type_}slice(l,m){if(io(this.data_)){const T=function ne(f,l,m){return f.webkitSlice?f.webkitSlice(l,m):f.mozSlice?f.mozSlice(l,m):f.slice?f.slice(l,m):null}(this.data_,l,m);return null===T?null:new un(T)}{const g=new Uint8Array(this.data_.buffer,l,m-l);return new un(g,!0)}}static getBlob(...l){if(Zo()){const m=l.map(g=>g instanceof un?g.data_:g);return new un(ec.apply(null,m))}{const m=l.map(O=>gi(O)?so(W.RAW,O).data:O.data_);let g=0;m.forEach(O=>{g+=O.byteLength});const T=new Uint8Array(g);let R=0;return m.forEach(O=>{for(let M=0;M<O.length;M++)T[R++]=O[M]}),new un(T,!0)}}uploadData(){return this.data_}}function Es(f){let l;try{l=JSON.parse(f)}catch{return null}return function Xo(f){return"object"==typeof f&&!Array.isArray(f)}(l)?l:null}function _i(f){const l=f.lastIndexOf("/",f.length-2);return-1===l?f:f.slice(l+1)}function sl(f,l){return l}class xe{constructor(l,m,g,T){this.server=l,this.local=m||l,this.writable=!!g,this.xform=T||sl}}let ce=null;function Se(){if(ce)return ce;const f=[];f.push(new xe("bucket")),f.push(new xe("generation")),f.push(new xe("metageneration")),f.push(new xe("name","fullPath",!0));const m=new xe("name");m.xform=function l(R,O){return function yi(f){return!gi(f)||f.length<2?f:_i(f)}(O)},f.push(m);const T=new xe("size");return T.xform=function g(R,O){return void 0!==O?Number(O):O},f.push(T),f.push(new xe("timeCreated")),f.push(new xe("updated")),f.push(new xe("md5Hash",null,!0)),f.push(new xe("cacheControl",null,!0)),f.push(new xe("contentDisposition",null,!0)),f.push(new xe("contentEncoding",null,!0)),f.push(new xe("contentLanguage",null,!0)),f.push(new xe("contentType",null,!0)),f.push(new xe("metadata","customMetadata",!0)),ce=f,ce}function ee(f,l,m){const g=Es(l);return null===g?null:function tt(f,l,m){const g={type:"file"},T=m.length;for(let R=0;R<T;R++){const O=m[R];g[O.local]=O.xform(g,l[O.server])}return function ol(f,l){Object.defineProperty(f,"ref",{get:function m(){const R=new Ut(f.bucket,f.fullPath);return l._makeStorageReference(R)}})}(g,f),g}(f,g,m)}function Ts(f,l){const m={},g=l.length;for(let T=0;T<g;T++){const R=l[T];R.writable&&(m[R.server]=f[R.local])}return JSON.stringify(m)}const Jr="prefixes",al="items";class $t{constructor(l,m,g,T){this.url=l,this.method=m,this.handler=g,this.timeout=T,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function sr(f){if(!f)throw an()}function As(f,l){return function m(g,T){const R=ee(f,T,l);return sr(null!==R),R}}function ut(f){return function l(m,g){let T;return T=401===m.getStatus()?m.getErrorText().includes("Firebase App Check token is invalid")?function gs(){return new at(We.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}():function Xu(){return new at(We.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===m.getStatus()?function ze(f){return new at(We.QUOTA_EXCEEDED,"Quota for bucket '"+f+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(f.bucket):403===m.getStatus()?function yr(f){return new at(We.UNAUTHORIZED,"User does not have permission to access '"+f+"'.")}(f.path):g,T.status=m.getStatus(),T.serverResponse=g.serverResponse,T}}function ji(f){const l=ut(f);return function m(g,T){let R=l(g,T);return 404===g.getStatus()&&(R=function Qo(f){return new at(We.OBJECT_NOT_FOUND,"Object '"+f+"' does not exist.")}(f.path)),R.serverResponse=T.serverResponse,R}}function or(f,l,m){const T=Tr(l.fullServerUrl(),f.host,f._protocol),O=f.maxOperationRetryTime,M=new $t(T,"GET",As(f,m),O);return M.errorHandler=ji(l),M}function ra(f,l,m,g,T){const R={};R.prefix=l.isRoot?"":l.path+"/",m&&m.length>0&&(R.delimiter=m),g&&(R.pageToken=g),T&&(R.maxResults=T);const M=Tr(l.bucketOnlyServerUrl(),f.host,f._protocol),se=f.maxOperationRetryTime,fe=new $t(M,"GET",function jt(f,l){return function m(g,T){const R=function rc(f,l,m){const g=Es(m);return null===g?null:function Yr(f,l,m){const g={prefixes:[],items:[],nextPageToken:m.nextPageToken};if(m[Jr])for(const T of m[Jr]){const R=T.replace(/\/$/,""),O=f._makeStorageReference(new Ut(l,R));g.prefixes.push(O)}if(m[al])for(const T of m[al]){const R=f._makeStorageReference(new Ut(l,T.name));g.items.push(R)}return g}(f,l,g)}(f,l,T);return sr(null!==R),R}}(f,l.bucket),se);return fe.urlParams=R,fe.errorHandler=ut(l),fe}function Vr(f,l,m){const g=Object.assign({},m);return g.fullPath=f.path,g.size=l.size(),g.contentType||(g.contentType=function ul(f,l){return f&&f.contentType||l&&l.type()||"application/octet-stream"}(null,l)),g}function wr(f,l,m,g,T){const R=l.bucketOnlyServerUrl(),O={"X-Goog-Upload-Protocol":"multipart"},U=function M(){let Dt="";for(let we=0;we<2;we++)Dt+=Math.random().toString().slice(2);return Dt}();O["Content-Type"]="multipart/related; boundary="+U;const se=Vr(l,g,T),fe=Ts(se,m),Ve=un.getBlob("--"+U+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+fe+"\r\n--"+U+"\r\nContent-Type: "+se.contentType+"\r\n\r\n",g,"\r\n--"+U+"--");if(null===Ve)throw Ir();const Ye={name:se.fullPath},st=Tr(R,f.host,f._protocol),ct=f.maxUploadRetryTime,Ot=new $t(st,"POST",As(f,m),ct);return Ot.urlParams=Ye,Ot.headers=O,Ot.body=Ve.uploadData(),Ot.errorHandler=ut(l),Ot}class Xr{constructor(l,m,g,T){this.current=l,this.total=m,this.finalized=!!g,this.metadata=T||null}}function Fn(f,l){let m=null;try{m=f.getResponseHeader("X-Goog-Upload-Status")}catch{sr(!1)}return sr(!!m&&-1!==(l||["active"]).indexOf(m)),m}const Rn={STATE_CHANGED:"state_changed"},St={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Zr(f){switch(f){case"running":case"pausing":case"canceling":return St.RUNNING;case"paused":return St.PAUSED;case"success":return St.SUCCESS;case"canceled":return St.CANCELED;default:return St.ERROR}}class Ya{constructor(l,m,g){if(function Ha(f){return"function"==typeof f}(l)||null!=m||null!=g)this.next=l,this.error=null!=m?m:void 0,this.complete=null!=g?g:void 0;else{const R=l;this.next=R.next,this.error=R.error,this.complete=R.complete}}}function bt(f){return(...l)=>{Promise.resolve().then(()=>f(...l))}}let ll=null;class aa{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Mn.NO_ERROR,this.sendPromise_=new Promise(l=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Mn.ABORT,l()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Mn.NETWORK_ERROR,l()}),this.xhr_.addEventListener("load",()=>{l()})})}send(l,m,g,T){if(this.sent_)throw vr("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(m,l,!0),void 0!==T)for(const R in T)T.hasOwnProperty(R)&&this.xhr_.setRequestHeader(R,T[R].toString());return void 0!==g?this.xhr_.send(g):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw vr("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw vr("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw vr("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw vr("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(l){return this.xhr_.getResponseHeader(l)}addUploadProgressListener(l){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",l)}removeUploadProgressListener(l){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",l)}}class Rr extends aa{initXhr(){this.xhr_.responseType="text"}}function Un(){return ll?ll():new Rr}class Za{constructor(l,m,g=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=l,this._blob=m,this._metadata=g,this._mappings=Se(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=T=>{if(this._request=void 0,this._chunkMultiplier=1,T._codeEquals(We.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const R=this.isExponentialBackoffExpired();if(ir(T.status,[])){if(!R)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();T=_s()}this._error=T,this._transition("error")}},this._metadataErrorHandler=T=>{this._request=void 0,T._codeEquals(We.CANCELED)?this.completeTransitions_():(this._error=T,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((T,R)=>{this._resolve=T,this._reject=R,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const l=this._transferred;return m=>this._updateProgress(l+m)}_shouldDoResumable(l){return l.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(l){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([m,g])=>{switch(this._state){case"running":l(m,g);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((l,m)=>{const g=function Ja(f,l,m,g,T){const R=l.bucketOnlyServerUrl(),O=Vr(l,g,T),M={name:O.fullPath},U=Tr(R,f.host,f._protocol),fe={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${g.size()}`,"X-Goog-Upload-Header-Content-Type":O.contentType,"Content-Type":"application/json; charset=utf-8"},De=Ts(O,m),Ye=new $t(U,"POST",function Ve(st){let Ge;Fn(st);try{Ge=st.getResponseHeader("X-Goog-Upload-URL")}catch{sr(!1)}return sr(gi(Ge)),Ge},f.maxUploadRetryTime);return Ye.urlParams=M,Ye.headers=fe,Ye.body=De,Ye.errorHandler=ut(l),Ye}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),T=this._ref.storage._makeRequest(g,Un,l,m);this._request=T,T.getPromise().then(R=>{this._request=void 0,this._uploadUrl=R,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const l=this._uploadUrl;this._resolveToken((m,g)=>{const T=function ws(f,l,m,g){const U=new $t(m,"POST",function R(se){const fe=Fn(se,["active","final"]);let De=null;try{De=se.getResponseHeader("X-Goog-Upload-Size-Received")}catch{sr(!1)}De||sr(!1);const je=Number(De);return sr(!isNaN(je)),new Xr(je,g.size(),"final"===fe)},f.maxUploadRetryTime);return U.headers={"X-Goog-Upload-Command":"query"},U.errorHandler=ut(l),U}(this._ref.storage,this._ref._location,l,this._blob),R=this._ref.storage._makeRequest(T,Un,m,g);this._request=R,R.getPromise().then(O=>{this._request=void 0,this._updateProgress(O.current),this._needToFetchStatus=!1,O.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const l=262144*this._chunkMultiplier,m=new Xr(this._transferred,this._blob.size()),g=this._uploadUrl;this._resolveToken((T,R)=>{let O;try{O=function oa(f,l,m,g,T,R,O,M){const U=new Xr(0,0);if(O?(U.current=O.current,U.total=O.total):(U.current=0,U.total=g.size()),g.size()!==U.total)throw function gn(){return new at(We.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}();const se=U.total-U.current;let fe=se;T>0&&(fe=Math.min(fe,T));const De=U.current;let Ve="";Ve=0===fe?"finalize":se===fe?"upload, finalize":"upload";const Ye={"X-Goog-Upload-Command":Ve,"X-Goog-Upload-Offset":`${U.current}`},st=g.slice(De,De+fe);if(null===st)throw Ir();const Dt=new $t(m,"POST",function Ge(we,Nt){const _t=Fn(we,["active","final"]),bs=U.current+fe,Ai=g.size();let Ta;return Ta="final"===_t?As(l,R)(we,Nt):null,new Xr(bs,Ai,"final"===_t,Ta)},l.maxUploadRetryTime);return Dt.headers=Ye,Dt.body=st.uploadData(),Dt.progressCallback=M||null,Dt.errorHandler=ut(f),Dt}(this._ref._location,this._ref.storage,g,this._blob,l,this._mappings,m,this._makeProgressCallback())}catch(U){return this._error=U,void this._transition("error")}const M=this._ref.storage._makeRequest(O,Un,T,R,!1);this._request=M,M.getPromise().then(U=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(U.current),U.finalized?(this._metadata=U.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((l,m)=>{const g=or(this._ref.storage,this._ref._location,this._mappings),T=this._ref.storage._makeRequest(g,Un,l,m);this._request=T,T.getPromise().then(R=>{this._request=void 0,this._metadata=R,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((l,m)=>{const g=wr(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),T=this._ref.storage._makeRequest(g,Un,l,m);this._request=T,T.getPromise().then(R=>{this._request=void 0,this._metadata=R,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(l){const m=this._transferred;this._transferred=l,this._transferred!==m&&this._notifyObservers()}_transition(l){if(this._state!==l)switch(l){case"canceling":case"pausing":this._state=l,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const m="paused"===this._state;this._state=l,m&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=l,this._notifyObservers();break;case"canceled":this._error=ys(),this._state=l,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const l=Zr(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:l,metadata:this._metadata,task:this,ref:this._ref}}on(l,m,g,T){const R=new Ya(m||void 0,g||void 0,T||void 0);return this._addObserver(R),()=>{this._removeObserver(R)}}then(l,m){return this._promise.then(l,m)}catch(l){return this.then(null,l)}_addObserver(l){this._observers.push(l),this._notifyObserver(l)}_removeObserver(l){const m=this._observers.indexOf(l);-1!==m&&this._observers.splice(m,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(m=>{this._notifyObserver(m)})}_finishPromise(){if(void 0!==this._resolve){let l=!0;switch(Zr(this._state)){case St.SUCCESS:bt(this._resolve.bind(null,this.snapshot))();break;case St.CANCELED:case St.ERROR:bt(this._reject.bind(null,this._error))();break;default:l=!1}l&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(l){switch(Zr(this._state)){case St.RUNNING:case St.PAUSED:l.next&&bt(l.next.bind(l,this.snapshot))();break;case St.SUCCESS:l.complete&&bt(l.complete.bind(l))();break;default:l.error&&bt(l.error.bind(l,this._error))()}}resume(){const l="paused"===this._state||"pausing"===this._state;return l&&this._transition("running"),l}pause(){const l="running"===this._state;return l&&this._transition("pausing"),l}cancel(){const l="running"===this._state||"pausing"===this._state;return l&&this._transition("canceling"),l}}class Ii{constructor(l,m){this._service=l,this._location=m instanceof Ut?m:Ut.makeFromUrl(m,l.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(l,m){return new Ii(l,m)}get root(){const l=new Ut(this._location.bucket,"");return this._newRef(this._service,l)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return _i(this._location.path)}get storage(){return this._service}get parent(){const l=function Qa(f){if(0===f.length)return null;const l=f.lastIndexOf("/");return-1===l?"":f.slice(0,l)}(this._location.path);if(null===l)return null;const m=new Ut(this._location.bucket,l);return new Ii(this._service,m)}_throwIfRoot(l){if(""===this._location.path)throw Is(l)}}function la(f,l,m){return ca.apply(this,arguments)}function ca(){return(ca=(0,I.A)(function*(f,l,m){const T=yield tu(f,{pageToken:m});l.prefixes.push(...T.prefixes),l.items.push(...T.items),null!=T.nextPageToken&&(yield la(f,l,T.nextPageToken))})).apply(this,arguments)}function tu(f,l){null!=l&&"number"==typeof l.maxResults&&Er("options.maxResults",1,1e3,l.maxResults);const m=l||{},g=ra(f.storage,f._location,"/",m.pageToken,m.maxResults);return f.storage.makeRequestWithTokens(g,Un)}function nu(f){f._throwIfRoot("getDownloadURL");const l=function oo(f,l,m){const T=Tr(l.fullServerUrl(),f.host,f._protocol),O=f.maxOperationRetryTime,M=new $t(T,"GET",function na(f,l){return function m(g,T){const R=ee(f,T,l);return sr(null!==R),function $i(f,l,m,g){const T=Es(l);if(null===T||!gi(T.downloadTokens))return null;const R=T.downloadTokens;if(0===R.length)return null;const O=encodeURIComponent;return R.split(",").map(se=>{const De=f.fullPath;return Tr("/b/"+O(f.bucket)+"/o/"+O(De),m,g)+Vt({alt:"media",token:se})})[0]}(R,T,f.host,f._protocol)}}(f,m),O);return M.errorHandler=ji(l),M}(f.storage,f._location,Se());return f.storage.makeRequestWithTokens(l,Un).then(m=>{if(null===m)throw function zt(){return new at(We.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}();return m})}function fa(f,l){const m=function Ee(f,l){const m=l.split("/").filter(g=>g.length>0).join("/");return 0===f.length?m:f+"/"+m}(f._location.path,l),g=new Ut(f._location.bucket,m);return new Ii(f.storage,g)}function co(f,l){if(f instanceof Bn){const m=f;if(null==m._bucket)throw function no(){return new at(We.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ho+"' property when initializing the app?")}();const g=new Ii(m,m._bucket);return null!=l?co(g,l):g}return void 0!==l?fa(f,l):f}function Hi(f,l){if(l&&function lo(f){return/^[A-Za-z]+:\/\//.test(f)}(l)){if(f instanceof Bn)return function ru(f,l){return new Ii(f,l)}(f,l);throw rr("To use ref(service, url), the first argument must be a Storage instance.")}return co(f,l)}function Ct(f,l){const m=null==l?void 0:l[Ho];return null==m?null:Ut.makeFromBucketSpec(m,f)}class Bn{constructor(l,m,g,T,R){this.app=l,this._authProvider=m,this._appCheckProvider=g,this._url=T,this._firebaseVersion=R,this._bucket=null,this._host=ps,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=T?Ut.makeFromBucketSpec(T,this._host):Ct(this._host,this.app.options)}get host(){return this._host}set host(l){this._host=l,this._bucket=null!=this._url?Ut.makeFromBucketSpec(this._url,l):Ct(l,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(l){Er("time",0,Number.POSITIVE_INFINITY,l),this._maxUploadRetryTime=l}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(l){Er("time",0,Number.POSITIVE_INFINITY,l),this._maxOperationRetryTime=l}_getAuthToken(){var l=this;return(0,I.A)(function*(){if(l._overrideAuthToken)return l._overrideAuthToken;const m=l._authProvider.getImmediate({optional:!0});if(m){const g=yield m.getToken();if(null!==g)return g.accessToken}return null})()}_getAppCheckToken(){var l=this;return(0,I.A)(function*(){const m=l._appCheckProvider.getImmediate({optional:!0});return m?(yield m.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(l=>l.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(l){return new Ii(this,l)}_makeRequest(l,m,g,T,R=!0){if(this._deleted)return new Zu(Ki());{const O=function ue(f,l,m,g,T,R,O=!0){const M=Vt(f.urlParams),U=f.url+M,se=Object.assign({},f.headers);return function _n(f,l){l&&(f["X-Firebase-GMPID"]=l)}(se,l),function K(f,l){null!==l&&l.length>0&&(f.Authorization="Firebase "+l)}(se,m),function Rt(f,l){f["X-Firebase-Storage-Version"]="webjs/"+(null!=l?l:"AppManager")}(se,R),function ea(f,l){null!==l&&(f["X-Firebase-AppCheck"]=l)}(se,g),new zi(U,f.method,se,f.body,f.successCodes,f.additionalRetryCodes,f.handler,f.errorHandler,f.timeout,f.progressCallback,T,O)}(l,this._appId,g,T,m,this._firebaseVersion,R);return this._requests.add(O),O.getPromise().then(()=>this._requests.delete(O),()=>this._requests.delete(O)),O}}makeRequestWithTokens(l,m){var g=this;return(0,I.A)(function*(){const[T,R]=yield Promise.all([g._getAuthToken(),g._getAppCheckToken()]);return g._makeRequest(l,m,T,R).getPromise()})()}}const pa="@firebase/storage",vi="storage";function su(f,l,m,g){return function fl(f,l,m=W.RAW,g){f._throwIfRoot("uploadString");const T=so(m,l),R=Object.assign({},g);return null==R.contentType&&null!=T.contentType&&(R.contentType=T.contentType),function eu(f,l,m){f._throwIfRoot("uploadBytes");const g=wr(f.storage,f._location,Se(),new un(l,!0),m);return f.storage.makeRequestWithTokens(g,Un).then(T=>({metadata:T,ref:f}))}(f,T.data,R)}(f=(0,gt.Ku)(f),l,m,g)}function au(f){return nu(f=(0,gt.Ku)(f))}function qn(f){return function da(f){f._throwIfRoot("deleteObject");const l=function ia(f,l){const g=Tr(l.fullServerUrl(),f.host,f._protocol),M=new $t(g,"DELETE",function O(U,se){},f.maxOperationRetryTime);return M.successCodes=[200,204],M.errorHandler=ji(l),M}(f.storage,f._location);return f.storage.makeRequestWithTokens(l,Un)}(f=(0,gt.Ku)(f))}function it(f,l){return Hi(f=(0,gt.Ku)(f),l)}function Or(f=(0,mi.getApp)(),l){f=(0,gt.Ku)(f);const g=(0,mi._getProvider)(f,vi).getImmediate({identifier:l}),T=(0,gt.yU)("storage");return T&&Rs(g,...T),g}function Rs(f,l,m,g={}){!function iu(f,l,m,g={}){f.host=`${l}:${m}`,f._protocol="http";const{mockUserToken:T}=g;T&&(f._overrideAuthToken="string"==typeof T?T:(0,gt.Fy)(T,f.app.options.projectId))}(f,l,m,g)}function ni(f,{instanceIdentifier:l}){const m=f.getProvider("app").getImmediate(),g=f.getProvider("auth-internal"),T=f.getProvider("app-check-internal");return new Bn(m,g,T,l,mi.SDK_VERSION)}!function Pr(){(0,mi._registerComponent)(new Mi.uA(vi,ni,"PUBLIC").setMultipleInstances(!0)),(0,mi.registerVersion)(pa,"0.12.4",""),(0,mi.registerVersion)(pa,"0.12.4","esm2017")}();class Lr{constructor(l,m,g){this._delegate=l,this.task=m,this.ref=g}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class ur{constructor(l,m){this._delegate=l,this._ref=m,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Lr(this._delegate.snapshot,this,this._ref)}then(l,m){return this._delegate.then(g=>{if(l)return l(new Lr(g,this,this._ref))},m)}on(l,m,g,T){let R;return m&&(R="function"==typeof m?O=>m(new Lr(O,this,this._ref)):{next:m.next?O=>m.next(new Lr(O,this,this._ref)):void 0,complete:m.complete||void 0,error:m.error||void 0}),this._delegate.on(l,R,g||void 0,T||void 0)}}class lr{constructor(l,m){this._delegate=l,this._service=m}get prefixes(){return this._delegate.prefixes.map(l=>new yn(l,this._service))}get items(){return this._delegate.items.map(l=>new yn(l,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class yn{constructor(l,m){this._delegate=l,this.storage=m}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(l){const m=function ar(f,l){return fa(f,l)}(this._delegate,l);return new yn(m,this.storage)}get root(){return new yn(this._delegate.root,this.storage)}get parent(){const l=this._delegate.parent;return null==l?null:new yn(l,this.storage)}put(l,m){return this._throwIfRoot("put"),new ur(function ei(f,l,m){return function dl(f,l,m){return f._throwIfRoot("uploadBytesResumable"),new Za(f,new un(l),m)}(f=(0,gt.Ku)(f),l,m)}(this._delegate,l,m),this)}putString(l,m=W.RAW,g){this._throwIfRoot("putString");const T=so(m,l),R=Object.assign({},g);return null==R.contentType&&null!=T.contentType&&(R.contentType=T.contentType),new ur(new Za(this._delegate,new un(T.data,!0),R),this)}listAll(){return function xt(f){return function pl(f){const l={prefixes:[],items:[]};return la(f,l).then(()=>l)}(f=(0,gt.Ku)(f))}(this._delegate).then(l=>new lr(l,this.storage))}list(l){return function gl(f,l){return tu(f=(0,gt.Ku)(f),l)}(this._delegate,l||void 0).then(m=>new lr(m,this.storage))}getMetadata(){return function ln(f){return function ml(f){f._throwIfRoot("getMetadata");const l=or(f.storage,f._location,Se());return f.storage.makeRequestWithTokens(l,Un)}(f=(0,gt.Ku)(f))}(this._delegate)}updateMetadata(l){return function ou(f,l){return function ha(f,l){f._throwIfRoot("updateMetadata");const m=function Ar(f,l,m,g){const R=Tr(l.fullServerUrl(),f.host,f._protocol),M=Ts(m,g),se=f.maxOperationRetryTime,fe=new $t(R,"PATCH",As(f,g),se);return fe.headers={"Content-Type":"application/json; charset=utf-8"},fe.body=M,fe.errorHandler=ji(l),fe}(f.storage,f._location,l,Se());return f.storage.makeRequestWithTokens(m,Un)}(f=(0,gt.Ku)(f),l)}(this._delegate,l)}getDownloadURL(){return au(this._delegate)}delete(){return this._throwIfRoot("delete"),qn(this._delegate)}_throwIfRoot(l){if(""===this._delegate._location.path)throw Is(l)}}class Sr{constructor(l,m){this.app=l,this._delegate=m}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(l){if(ho(l))throw rr("ref() expected a child path but got a URL, use refFromURL instead.");return new yn(it(this._delegate,l),this)}refFromURL(l){if(!ho(l))throw rr("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Ut.makeFromUrl(l,this._delegate.host)}catch{throw rr("refFromUrl() expected a valid full URL but got an invalid one.")}return new yn(it(this._delegate,l),this)}setMaxUploadRetryTime(l){this._delegate.maxUploadRetryTime=l}setMaxOperationRetryTime(l){this._delegate.maxOperationRetryTime=l}useEmulator(l,m,g={}){Rs(this._delegate,l,m,g)}}function ho(f){return/^[A-Za-z]+:\/\//.test(f)}function Ei(f,{instanceIdentifier:l}){const m=f.getProvider("app-compat").getImmediate(),g=f.getProvider("storage").getImmediate({identifier:l});return new Sr(m,g)}function _a(f){const l=function Ti(f){return new ae.c(l=>{const m=O=>l.next(O);m(f.snapshot);const R=f.on("state_changed",m);return f.then(O=>{m(O),l.complete()},O=>{m(f.snapshot),(O=>{l.error(O)})(O)}),function(){R()}}).pipe(function eo(f,l=zs.E){return(0,hn.N)((m,g)=>{let T=null,R=null,O=null;const M=()=>{if(T){T.unsubscribe(),T=null;const se=R;R=null,g.next(se)}};function U(){const se=O+f,fe=l.now();if(fe<se)return T=this.schedule(void 0,se-fe),void g.add(T);M()}m.subscribe((0,tr._)(g,se=>{R=se,O=l.now(),T||(T=l.schedule(U,f),g.add(T))},()=>{M(),g.complete()},void 0,()=>{R=T=null}))})}(0))}(f);return{task:f,then:f.then.bind(f),catch:f.catch.bind(f),pause:f.pause.bind(f),cancel:f.cancel.bind(f),resume:f.resume.bind(f),snapshotChanges:()=>l,percentageChanges:()=>l.pipe((0,Ze.T)(m=>m.bytesTransferred/m.totalBytes*100))}}function Ps(f){return{getDownloadURL:()=>(0,Xe.of)(void 0).pipe(ge.Oe,(0,qe.n)(()=>f.getDownloadURL()),ge.U0),getMetadata:()=>(0,Xe.of)(void 0).pipe(ge.Oe,(0,qe.n)(()=>f.getMetadata()),ge.U0),delete:()=>(0,Pe.H)(f.delete()),child:l=>Ps(f.child(l)),updateMetadata:l=>(0,Pe.H)(f.updateMetadata(l)),put:(l,m)=>_a(f.put(l,m)),putString:(l,m,g)=>_a(f.putString(l,m,g)),list:l=>(0,Pe.H)(f.list(l)),listAll:()=>(0,Pe.H)(f.listAll())}}!function ga(f){const l={TaskState:St,TaskEvent:Rn,StringFormat:W,Storage:Sr,Reference:yn};f.INTERNAL.registerComponent(new Mi.uA("storage-compat",Ei,"PUBLIC").setServiceProps(l).setMultipleInstances(!0)),f.registerVersion("@firebase/storage-compat","0.3.7")}(kr.A);const Yi=new B.nKC("angularfire2.storageBucket"),Ss=new B.nKC("angularfire2.storage.maxUploadRetryTime"),fo=new B.nKC("angularfire2.storage.maxOperationRetryTime"),ya=new B.nKC("angularfire2.storage.use-emulator");let Ia=(()=>{var f;class l{constructor(g,T,R,O,M,U,se,fe,De,je){(0,w.A)(this,"storage",void 0);const Ve=(0,Ae.iB)(g,M,T);this.storage=(0,Ae.BM)(`${Ve.name}.storage.${R}`,"AngularFireStorage",Ve.name,()=>{const Ye=M.runOutsideAngular(()=>Ve.storage(R||void 0)),st=De;return st&&Ye.useEmulator(...st),se&&Ye.setMaxUploadRetryTime(se),fe&&Ye.setMaxOperationRetryTime(fe),Ye},[se,fe])}ref(g){return Ps(this.storage.ref(g))}refFromURL(g){return Ps(this.storage.refFromURL(g))}upload(g,T,R){return Ps(this.storage.ref(g)).put(T,R)}}return f=l,(0,w.A)(l,"\u0275fac",function(g){return new(g||f)(B.KVO(Ae.rx),B.KVO(Ae.uP,8),B.KVO(Yi,8),B.KVO(B.Agw),B.KVO(B.SKi),B.KVO(ge.u0),B.KVO(Ss,8),B.KVO(fo,8),B.KVO(ya,8),B.KVO(ge.Jv,8))}),(0,w.A)(l,"\u0275prov",B.jDH({token:f,factory:f.\u0275fac,providedIn:"any"})),l})(),Ea=(()=>{var f;class l{constructor(){this.auth=(0,B.WQX)(F),this.firestore=(0,B.WQX)($o),this.utils=(0,B.WQX)(jr.T),this.storage=(0,B.WQX)(Ia)}signIn(g){return(0,H.x9)((0,H.xI)(),g.email,g.password)}signUp(g){return(0,H.eJ)((0,H.xI)(),g.email,g.password)}updateProfile(g){return(0,H.r7)((0,H.xI)().currentUser,{displayName:g})}sendRecoveryEmail(g){return(0,H.J1)((0,H.xI)(),g)}setDocument(g,T){return Vi(rs(er(),g),T)}signOut(){(0,H.xI)().signOut(),localStorage.removeItem("user"),this.utils.routerLink("/auth")}getUserInfo(g){var T=this;return(0,I.A)(function*(){return T.getDocument(`users/${g}`)})()}getCollectionData(g,T){const R=Ci(er(),g);return Co(Lo(R,...T),{idField:"id"})}updateDocument(g,T){return Ks(rs(er(),g),T)}getDocument(g){return(0,I.A)(function*(){return(yield ki(rs(er(),g))).data()})()}addDocument(g,T){return Me(Ci(er(),g),T)}deleteDocument(g){return Wu(rs(er(),g))}uploadImage(g,T){return(0,I.A)(function*(){return su(it(Or(),g),T,"data_url").then(()=>au(it(Or(),g)))})()}getFilePath(g){return(0,I.A)(function*(){return it(Or(),g).fullPath})()}deleteFile(g){return qn(it(Or(),g))}}return(f=l).\u0275fac=function(g){return new(g||f)},f.\u0275prov=B.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),l})()},5265:(Si,Wt,j)=>{j.d(Wt,{T:()=>bi});var I=j(467),B=j(4438),w=j(4964);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var ae=function(Z){return Z.Unimplemented="UNIMPLEMENTED",Z.Unavailable="UNAVAILABLE",Z}(ae||{});class Pe extends Error{constructor(x,F,$){super(x),this.message=x,this.code=F,this.data=$}}const zn=Z=>{var x,F,$,H,J;const he=Z.CapacitorCustomPlatform||null,ie=Z.Capacitor||{},Te=ie.Plugins=ie.Plugins||{},Ce=Z.CapacitorPlatforms,Mt=(null===(x=null==Ce?void 0:Ce.currentPlatform)||void 0===x?void 0:x.getPlatform)||(()=>null!==he?he.name:(Z=>{var x,F;return null!=Z&&Z.androidBridge?"android":null!==(F=null===(x=null==Z?void 0:Z.webkit)||void 0===x?void 0:x.messageHandlers)&&void 0!==F&&F.bridge?"ios":"web"})(Z)),Cr=(null===(F=null==Ce?void 0:Ce.currentPlatform)||void 0===F?void 0:F.isNativePlatform)||(()=>"web"!==Mt()),Fr=(null===($=null==Ce?void 0:Ce.currentPlatform)||void 0===$?void 0:$.isPluginAvailable)||(et=>{const nt=xn.get(et);return!!(null!=nt&&nt.platforms.has(Mt())||It(et))}),It=(null===(H=null==Ce?void 0:Ce.currentPlatform)||void 0===H?void 0:H.getPluginHeader)||(et=>{var nt;return null===(nt=ie.PluginHeaders)||void 0===nt?void 0:nt.find(fn=>fn.name===et)}),xn=new Map,Jn=(null===(J=null==Ce?void 0:Ce.currentPlatform)||void 0===J?void 0:J.registerPlugin)||((et,nt={})=>{const fn=xn.get(et);if(fn)return console.warn(`Capacitor plugin "${et}" already registered. Cannot register plugins twice.`),fn.proxy;const Xt=Mt(),Dn=It(et);let Zt;const Br=function(){var ve=(0,I.A)(function*(){return!Zt&&Xt in nt?Zt=Zt="function"==typeof nt[Xt]?yield nt[Xt]():nt[Xt]:null!==he&&!Zt&&"web"in nt&&(Zt=Zt="function"==typeof nt.web?yield nt.web():nt.web),Zt});return function(){return ve.apply(this,arguments)}}(),pr=ve=>{let Je;const Ft=(...En)=>{const Tn=Br().then(en=>{const kn=((ve,Je)=>{var Ft,En;if(!Dn){if(ve)return null===(En=ve[Je])||void 0===En?void 0:En.bind(ve);throw new Pe(`"${et}" plugin is not implemented on ${Xt}`,ae.Unimplemented)}{const Tn=null==Dn?void 0:Dn.methods.find(en=>Je===en.name);if(Tn)return"promise"===Tn.rtype?en=>ie.nativePromise(et,Je.toString(),en):(en,kn)=>ie.nativeCallback(et,Je.toString(),en,kn);if(ve)return null===(Ft=ve[Je])||void 0===Ft?void 0:Ft.bind(ve)}})(en,ve);if(kn){const ui=kn(...En);return Je=null==ui?void 0:ui.remove,ui}throw new Pe(`"${et}.${ve}()" is not implemented on ${Xt}`,ae.Unimplemented)});return"addListener"===ve&&(Tn.remove=(0,I.A)(function*(){return Je()})),Tn};return Ft.toString=()=>`${ve.toString()}() { [capacitor code] }`,Object.defineProperty(Ft,"name",{value:ve,writable:!1,configurable:!1}),Ft},Qe=pr("addListener"),Xn=pr("removeListener"),Zn=(ve,Je)=>{const Ft=Qe({eventName:ve},Je),En=function(){var en=(0,I.A)(function*(){const kn=yield Ft;Xn({eventName:ve,callbackId:kn},Je)});return function(){return en.apply(this,arguments)}}(),Tn=new Promise(en=>Ft.then(()=>en({remove:En})));return Tn.remove=(0,I.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield En()}),Tn},dt=new Proxy({},{get(ve,Je){switch(Je){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return Dn?Zn:Qe;case"removeListener":return Xn;default:return pr(Je)}}});return Te[et]=dt,xn.set(et,{name:et,proxy:dt,platforms:new Set([...Object.keys(nt),...Dn?[Xt]:[]])}),dt});return ie.convertFileSrc||(ie.convertFileSrc=et=>et),ie.getPlatform=Mt,ie.handleError=et=>Z.console.error(et),ie.isNativePlatform=Cr,ie.isPluginAvailable=Fr,ie.pluginMethodNoop=(et,nt,fn)=>Promise.reject(`${fn} does not have an implementation of "${nt}".`),ie.registerPlugin=Jn,ie.Exception=Pe,ie.DEBUG=!!ie.DEBUG,ie.isLoggingEnabled=!!ie.isLoggingEnabled,ie.platform=ie.getPlatform(),ie.isNative=ie.isNativePlatform(),ie},$n=(Z=>Z.Capacitor=zn(Z))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),jn=$n.registerPlugin;class Ze{constructor(x){this.listeners={},this.retainedEventArguments={},this.windowListeners={},x&&(console.warn(`Capacitor WebPlugin "${x.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=x)}addListener(x,F){var $=this;let H=!1;this.listeners[x]||(this.listeners[x]=[],H=!0),this.listeners[x].push(F);const he=this.windowListeners[x];he&&!he.registered&&this.addWindowListener(he),H&&this.sendRetainedArgumentsForEvent(x);const ie=function(){var Ce=(0,I.A)(function*(){return $.removeListener(x,F)});return function(){return Ce.apply(this,arguments)}}();return Promise.resolve({remove:ie})}removeAllListeners(){var x=this;return(0,I.A)(function*(){x.listeners={};for(const F in x.windowListeners)x.removeWindowListener(x.windowListeners[F]);x.windowListeners={}})()}notifyListeners(x,F,$){const H=this.listeners[x];if(H)H.forEach(J=>J(F));else if($){let J=this.retainedEventArguments[x];J||(J=[]),J.push(F),this.retainedEventArguments[x]=J}}hasListeners(x){return!!this.listeners[x].length}registerWindowListener(x,F){this.windowListeners[F]={registered:!1,windowEventName:x,pluginEventName:F,handler:$=>{this.notifyListeners(F,$)}}}unimplemented(x="not implemented"){return new $n.Exception(x,ae.Unimplemented)}unavailable(x="not available"){return new $n.Exception(x,ae.Unavailable)}removeListener(x,F){var $=this;return(0,I.A)(function*(){const H=$.listeners[x];if(!H)return;const J=H.indexOf(F);$.listeners[x].splice(J,1),$.listeners[x].length||$.removeWindowListener($.windowListeners[x])})()}addWindowListener(x){window.addEventListener(x.windowEventName,x.handler),x.registered=!0}removeWindowListener(x){x&&(window.removeEventListener(x.windowEventName,x.handler),x.registered=!1)}sendRetainedArgumentsForEvent(x){const F=this.retainedEventArguments[x];F&&(delete this.retainedEventArguments[x],F.forEach($=>{this.notifyListeners(x,$)}))}}const Le=Z=>encodeURIComponent(Z).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),ot=Z=>Z.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class hn extends Ze{getCookies(){return(0,I.A)(function*(){const x=document.cookie,F={};return x.split(";").forEach($=>{if($.length<=0)return;let[H,J]=$.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");H=ot(H).trim(),J=ot(J).trim(),F[H]=J}),F})()}setCookie(x){return(0,I.A)(function*(){try{const F=Le(x.key),$=Le(x.value),H=`; expires=${(x.expires||"").replace("expires=","")}`,J=(x.path||"/").replace("path=",""),he=null!=x.url&&x.url.length>0?`domain=${x.url}`:"";document.cookie=`${F}=${$||""}${H}; path=${J}; ${he};`}catch(F){return Promise.reject(F)}})()}deleteCookie(x){return(0,I.A)(function*(){try{document.cookie=`${x.key}=; Max-Age=0`}catch(F){return Promise.reject(F)}})()}clearCookies(){return(0,I.A)(function*(){try{const x=document.cookie.split(";")||[];for(const F of x)document.cookie=F.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(x){return Promise.reject(x)}})()}clearAllCookies(){var x=this;return(0,I.A)(function*(){try{yield x.clearCookies()}catch(F){return Promise.reject(F)}})()}}jn("CapacitorCookies",{web:()=>new hn});const dn=function(){var Z=(0,I.A)(function*(x){return new Promise((F,$)=>{const H=new FileReader;H.onload=()=>{const J=H.result;F(J.indexOf(",")>=0?J.split(",")[1]:J)},H.onerror=J=>$(J),H.readAsDataURL(x)})});return function(F){return Z.apply(this,arguments)}}();class kt extends Ze{request(x){return(0,I.A)(function*(){const F=((Z,x={})=>{const F=Object.assign({method:Z.method||"GET",headers:Z.headers},x),H=((Z={})=>{const x=Object.keys(Z);return Object.keys(Z).map(H=>H.toLocaleLowerCase()).reduce((H,J,he)=>(H[J]=Z[x[he]],H),{})})(Z.headers)["content-type"]||"";if("string"==typeof Z.data)F.body=Z.data;else if(H.includes("application/x-www-form-urlencoded")){const J=new URLSearchParams;for(const[he,ie]of Object.entries(Z.data||{}))J.set(he,ie);F.body=J.toString()}else if(H.includes("multipart/form-data")||Z.data instanceof FormData){const J=new FormData;if(Z.data instanceof FormData)Z.data.forEach((ie,Te)=>{J.append(Te,ie)});else for(const ie of Object.keys(Z.data))J.append(ie,Z.data[ie]);F.body=J;const he=new Headers(F.headers);he.delete("content-type"),F.headers=he}else(H.includes("application/json")||"object"==typeof Z.data)&&(F.body=JSON.stringify(Z.data));return F})(x,x.webFetchExtra),$=((Z,x=!0)=>Z?Object.entries(Z).reduce(($,H)=>{const[J,he]=H;let ie,Te;return Array.isArray(he)?(Te="",he.forEach(Ce=>{ie=x?encodeURIComponent(Ce):Ce,Te+=`${J}=${ie}&`}),Te.slice(0,-1)):(ie=x?encodeURIComponent(he):he,Te=`${J}=${ie}`),`${$}&${Te}`},"").substr(1):null)(x.params,x.shouldEncodeUrlParams),H=$?`${x.url}?${$}`:x.url,J=yield fetch(H,F),he=J.headers.get("content-type")||"";let Te,Ce,{responseType:ie="text"}=J.ok?x:{};switch(he.includes("application/json")&&(ie="json"),ie){case"arraybuffer":case"blob":Ce=yield J.blob(),Te=yield dn(Ce);break;case"json":Te=yield J.json();break;default:Te=yield J.text()}const Yt={};return J.headers.forEach((Mt,fr)=>{Yt[fr]=Mt}),{data:Te,headers:Yt,status:J.status,url:J.url}})()}get(x){var F=this;return(0,I.A)(function*(){return F.request(Object.assign(Object.assign({},x),{method:"GET"}))})()}post(x){var F=this;return(0,I.A)(function*(){return F.request(Object.assign(Object.assign({},x),{method:"POST"}))})()}put(x){var F=this;return(0,I.A)(function*(){return F.request(Object.assign(Object.assign({},x),{method:"PUT"}))})()}patch(x){var F=this;return(0,I.A)(function*(){return F.request(Object.assign(Object.assign({},x),{method:"PATCH"}))})()}delete(x){var F=this;return(0,I.A)(function*(){return F.request(Object.assign(Object.assign({},x),{method:"DELETE"}))})()}}jn("CapacitorHttp",{web:()=>new kt});var Jt=function(Z){return Z.Prompt="PROMPT",Z.Camera="CAMERA",Z.Photos="PHOTOS",Z}(Jt||{}),Mr=function(Z){return Z.Rear="REAR",Z.Front="FRONT",Z}(Mr||{}),br=function(Z){return Z.Uri="uri",Z.Base64="base64",Z.DataUrl="dataUrl",Z}(br||{});class bn extends Ze{getPhoto(x){var F=this;return(0,I.A)(function*(){return new Promise(function(){var $=(0,I.A)(function*(H,J){if(x.webUseInput||x.source===Jt.Photos)F.fileInputExperience(x,H,J);else if(x.source===Jt.Prompt){let he=document.querySelector("pwa-action-sheet");he||(he=document.createElement("pwa-action-sheet"),document.body.appendChild(he)),he.header=x.promptLabelHeader||"Photo",he.cancelable=!1,he.options=[{title:x.promptLabelPhoto||"From Photos"},{title:x.promptLabelPicture||"Take Picture"}],he.addEventListener("onSelection",function(){var ie=(0,I.A)(function*(Te){0===Te.detail?F.fileInputExperience(x,H,J):F.cameraExperience(x,H,J)});return function(Te){return ie.apply(this,arguments)}}())}else F.cameraExperience(x,H,J)});return function(H,J){return $.apply(this,arguments)}}())})()}pickImages(x){var F=this;return(0,I.A)(function*(){return new Promise(function(){var $=(0,I.A)(function*(H,J){F.multipleFileInputExperience(H,J)});return function(H,J){return $.apply(this,arguments)}}())})()}cameraExperience(x,F,$){var H=this;return(0,I.A)(function*(){if(customElements.get("pwa-camera-modal")){const J=document.createElement("pwa-camera-modal");J.facingMode=x.direction===Mr.Front?"user":"environment",document.body.appendChild(J);try{yield J.componentOnReady(),J.addEventListener("onPhoto",function(){var he=(0,I.A)(function*(ie){const Te=ie.detail;null===Te?$(new Pe("User cancelled photos app")):Te instanceof Error?$(Te):F(yield H._getCameraPhoto(Te,x)),J.dismiss(),document.body.removeChild(J)});return function(ie){return he.apply(this,arguments)}}()),J.present()}catch{H.fileInputExperience(x,F,$)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),H.fileInputExperience(x,F,$)})()}fileInputExperience(x,F,$){let H=document.querySelector("#_capacitor-camera-input");const J=()=>{var he;null===(he=H.parentNode)||void 0===he||he.removeChild(H)};H||(H=document.createElement("input"),H.id="_capacitor-camera-input",H.type="file",H.hidden=!0,document.body.appendChild(H),H.addEventListener("change",he=>{const ie=H.files[0];let Te="jpeg";if("image/png"===ie.type?Te="png":"image/gif"===ie.type&&(Te="gif"),"dataUrl"===x.resultType||"base64"===x.resultType){const Ce=new FileReader;Ce.addEventListener("load",()=>{if("dataUrl"===x.resultType)F({dataUrl:Ce.result,format:Te});else if("base64"===x.resultType){const Yt=Ce.result.split(",")[1];F({base64String:Yt,format:Te})}J()}),Ce.readAsDataURL(ie)}else F({webPath:URL.createObjectURL(ie),format:Te}),J()}),H.addEventListener("cancel",he=>{$(new Pe("User cancelled photos app")),J()})),H.accept="image/*",H.capture=!0,x.source===Jt.Photos||x.source===Jt.Prompt?H.removeAttribute("capture"):x.direction===Mr.Front?H.capture="user":x.direction===Mr.Rear&&(H.capture="environment"),H.click()}multipleFileInputExperience(x,F){let $=document.querySelector("#_capacitor-camera-input-multiple");const H=()=>{var J;null===(J=$.parentNode)||void 0===J||J.removeChild($)};$||($=document.createElement("input"),$.id="_capacitor-camera-input-multiple",$.type="file",$.hidden=!0,$.multiple=!0,document.body.appendChild($),$.addEventListener("change",J=>{const he=[];for(let ie=0;ie<$.files.length;ie++){const Te=$.files[ie];let Ce="jpeg";"image/png"===Te.type?Ce="png":"image/gif"===Te.type&&(Ce="gif"),he.push({webPath:URL.createObjectURL(Te),format:Ce})}x({photos:he}),H()}),$.addEventListener("cancel",J=>{F(new Pe("User cancelled photos app")),H()})),$.accept="image/*",$.click()}_getCameraPhoto(x,F){return new Promise(($,H)=>{const J=new FileReader,he=x.type.split("/")[1];"uri"===F.resultType?$({webPath:URL.createObjectURL(x),format:he,saved:!1}):(J.readAsDataURL(x),J.onloadend=()=>{const ie=J.result;$("dataUrl"===F.resultType?{dataUrl:ie,format:he,saved:!1}:{base64String:ie.split(",")[1],format:he,saved:!1})},J.onerror=ie=>{H(ie)})})}checkPermissions(){var x=this;return(0,I.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw x.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw x.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var x=this;return(0,I.A)(function*(){throw x.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var x=this;return(0,I.A)(function*(){throw x.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var x=this;return(0,I.A)(function*(){throw x.unavailable("Not implemented on web.")})()}}new bn;const dr=jn("Camera",{web:()=>new bn});var Hn=j(1075);let bi=(()=>{var Z;class x{constructor(){this.loadingController=(0,B.WQX)(Hn.Xi),this.toastController=(0,B.WQX)(Hn.K_),this.router=(0,B.WQX)(w.Ix),this.modalController=(0,B.WQX)(Hn.W3)}loading(){return this.loadingController.create({message:"Loading..."})}showToast($){var H=this;return(0,I.A)(function*(){(yield H.toastController.create($)).present()})()}routerLink($){return this.router.navigateByUrl($)}saveInLocalStorage($,H){return localStorage.setItem($,JSON.stringify(H))}getFromLocalStorage($){return JSON.parse(localStorage.getItem($))}presentModal($){var H=this;return(0,I.A)(function*(){yield(yield H.modalController.create($)).present()})()}dismissModal($){return this.modalController.dismiss($)}takePicture($){return(0,I.A)(function*(){return yield dr.getPhoto({quality:90,allowEditing:!0,resultType:br.DataUrl,source:Jt.Prompt,promptLabelHeader:$,promptLabelPicture:"Toma una foto :3",promptLabelPhoto:"Selecciona una imagen :3"})})()}}return(Z=x).\u0275fac=function($){return new($||Z)},Z.\u0275prov=B.jDH({token:Z,factory:Z.\u0275fac,providedIn:"root"}),x})()},3683:(Si,Wt,j)=>{j.d(Wt,{H:()=>ge});var I=j(4438),B=j(177),w=j(1075),Ie=j(4341);function Re(Ae,z){if(1&Ae){const Xe=I.RV6();I.j41(0,"ion-button",4),I.bIt("click",function(){I.eBV(Xe);const Pe=I.XpG();return I.Njj(Pe.showOrHidePassword())}),I.nrm(1,"ion-icon",5),I.k0s()}if(2&Ae){const Xe=I.XpG();I.R7$(),I.Y8G("name",Xe.hide?"eye-outline":"eye-off-outline")}}let ge=(()=>{var Ae;class z{constructor(){this.disabled=!1,this.hide=!0}ngOnInit(){"password"===this.type&&(this.isPassword=!0)}showOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(Ae=z).\u0275fac=function(ae){return new(ae||Ae)},Ae.\u0275cmp=I.VBU({type:Ae,selectors:[["app-custom-input"]],inputs:{icon:"icon",type:"type",label:"label",autocomplete:"autocomplete",control:"control",required:"required",disabled:"disabled"},decls:4,vars:7,consts:[["lines","none",1,"custom-input"],["color","primary","slot","start",3,"icon","name"],["labelPlacement","floating",3,"type","label","autocomplete","formControl"],["expand","block","fill","clear","shape","round","slot","end",3,"click",4,"ngIf"],["expand","block","fill","clear","shape","round","slot","end",3,"click"],["slot","icon-only",3,"name"]],template:function(ae,Pe){1&ae&&(I.j41(0,"ion-item",0),I.nrm(1,"ion-icon",1)(2,"ion-input",2),I.DNE(3,Re,2,1,"ion-button",3),I.k0s()),2&ae&&(I.R7$(),I.Y8G("icon",Pe.icon)("name",Pe.icon),I.R7$(),I.Y8G("type",Pe.type)("label",Pe.label)("autocomplete",Pe.autocomplete)("formControl",Pe.control),I.R7$(),I.Y8G("ngIf",Pe.isPassword))},dependencies:[B.bT,w.Jm,w.iq,w.$w,w.uz,w.Gw,Ie.BC,Ie.l_]}),z})()},9381:(Si,Wt,j)=>{j.d(Wt,{l:()=>Ae});var I=j(4438),B=j(5265),w=j(177),Ie=j(1075);function Re(z,Xe){if(1&z){const ae=I.RV6();I.j41(0,"ion-button",6),I.bIt("click",function(){I.eBV(ae);const Qt=I.XpG();return I.Njj(Qt.dismissModal())}),I.nrm(1,"ion-icon",7),I.k0s()}}function ge(z,Xe){1&z&&I.nrm(0,"ion-menu-button",8)}let Ae=(()=>{var z;class Xe{constructor(){this.utilsSrv=(0,I.WQX)(B.T)}ngOnInit(){}dismissModal(){this.utilsSrv.dismissModal()}}return(z=Xe).\u0275fac=function(Pe){return new(Pe||z)},z.\u0275cmp=I.VBU({type:z,selectors:[["app-header"]],inputs:{title:"title",isModal:"isModal",showMenu:"showMenu"},decls:10,vars:3,consts:[[1,"ion-no-border"],["color","primary"],["slot","start"],[3,"click",4,"ngIf"],["menu","menu-content",4,"ngIf"],[1,"admin"],[3,"click"],["slot","start","name","close-circle-outline"],["menu","menu-content"]],template:function(Pe,Qt){1&Pe&&(I.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),I.DNE(3,Re,2,0,"ion-button",3)(4,ge,1,0,"ion-menu-button",4),I.k0s(),I.j41(5,"ion-title")(6,"strong"),I.EFF(7),I.k0s(),I.j41(8,"div",5),I.EFF(9,"A D M I N :3"),I.k0s()()()()),2&Pe&&(I.R7$(3),I.Y8G("ngIf",Qt.isModal),I.R7$(),I.Y8G("ngIf",Qt.showMenu),I.R7$(3),I.JRh(Qt.title))},dependencies:[w.bT,Ie.Jm,Ie.QW,Ie.eU,Ie.iq,Ie.MC,Ie.BC,Ie.ai],styles:[".admin[_ngcontent-%COMP%]{font-size:15px}"]}),Xe})()},3887:(Si,Wt,j)=>{j.d(Wt,{G:()=>Re});var I=j(177),B=j(1075),w=j(4341),Ie=j(4438);let Re=(()=>{var ge;class Ae{}return(ge=Ae).\u0275fac=function(Xe){return new(Xe||ge)},ge.\u0275mod=Ie.$C({type:ge}),ge.\u0275inj=Ie.G2t({imports:[I.MD,B.bv,w.X1,w.YN,w.X1,w.YN]}),Ae})()},7440:(Si,Wt,j)=>{j.d(Wt,{XU:()=>w}),j(2214),j(4438);class w{constructor(Le){return Le}}},2438:(Si,Wt,j)=>{j.r(Wt);var I=j(467),B=j(3345),w=j(8407),Ie=j(1076),Ae=(j(7852),j(8041),j(1362));function z(){return window}function Pe(){return Pe=(0,I.A)(function*(V,b,P){var q;const{BuildInfo:oe}=z();(0,w.au)(b.sessionId,"AuthEvent did not contain a session ID");const _e=yield function qe(V){return Ze.apply(this,arguments)}(b.sessionId),Me={};return(0,w.av)()?Me.ibi=oe.packageName:(0,w.aw)()?Me.apn=oe.packageName:(0,w.ax)(V,"operation-not-supported-in-this-environment"),oe.displayName&&(Me.appDisplayName=oe.displayName),Me.sessionId=_e,(0,w.ay)(V,P,b.type,void 0,null!==(q=b.eventId)&&void 0!==q?q:void 0,Me)}),Pe.apply(this,arguments)}function zn(){return(zn=(0,I.A)(function*(V){const{BuildInfo:b}=z(),P={};(0,w.av)()?P.iosBundleId=b.packageName:(0,w.aw)()?P.androidPackageName=b.packageName:(0,w.ax)(V,"operation-not-supported-in-this-environment"),yield(0,w.az)(V,P)})).apply(this,arguments)}function jn(){return(jn=(0,I.A)(function*(V,b,P){const{cordova:q}=z();let oe=()=>{};try{yield new Promise((_e,Me)=>{let Ke=null;function vt(){var Fe;_e();const Nn=null===(Fe=q.plugins.browsertab)||void 0===Fe?void 0:Fe.close;"function"==typeof Nn&&Nn(),"function"==typeof(null==P?void 0:P.close)&&P.close()}function Gt(){Ke||(Ke=window.setTimeout(()=>{Me((0,w.aB)(V,"redirect-cancelled-by-user"))},2e3))}function tn(){"visible"===(null==document?void 0:document.visibilityState)&&Gt()}b.addPassiveListener(vt),document.addEventListener("resume",Gt,!1),(0,w.aw)()&&document.addEventListener("visibilitychange",tn,!1),oe=()=>{b.removePassiveListener(vt),document.removeEventListener("resume",Gt,!1),document.removeEventListener("visibilitychange",tn,!1),Ke&&window.clearTimeout(Ke)}})}finally{oe()}})).apply(this,arguments)}function Ze(){return(Ze=(0,I.A)(function*(V){const b=function Ne(V){if((0,w.au)(/[0-9a-zA-Z]+/.test(V),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(V);const b=new ArrayBuffer(V.length),P=new Uint8Array(b);for(let q=0;q<V.length;q++)P[q]=V.charCodeAt(q);return P}(V),P=yield crypto.subtle.digest("SHA-256",b);return Array.from(new Uint8Array(P)).map(oe=>oe.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class ot extends w.aD{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(b=>{this.resolveInialized=b})}addPassiveListener(b){this.passiveListeners.add(b)}removePassiveListener(b){this.passiveListeners.delete(b)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(b){return this.resolveInialized(),this.passiveListeners.forEach(P=>P(b)),super.onEvent(b)}initialized(){var b=this;return(0,I.A)(function*(){yield b.initPromise})()}}function dn(V){return lt.apply(this,arguments)}function lt(){return(lt=(0,I.A)(function*(V){const b=yield kt()._get(At(V));return b&&(yield kt()._remove(At(V))),b})).apply(this,arguments)}function Lt(){const V=[];for(let P=0;P<20;P++){const q=Math.floor(62*Math.random());V.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(q))}return V.join("")}function kt(){return(0,w.aE)(w.b)}function At(V){return(0,w.aF)("authEvent",V.config.apiKey,V.name)}function br(V){if(null==V||!V.includes("?"))return{};const[b,...P]=V.split("?");return(0,Ie.I9)(P.join("?"))}const dr=class hr{constructor(){this._redirectPersistence=w.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=w.aG,this._overrideRedirectResult=w.aH}_initialize(b){var P=this;return(0,I.A)(function*(){const q=b._key();let oe=P.eventManagers.get(q);return oe||(oe=new ot(b),P.eventManagers.set(q,oe),P.attachCallbackListeners(b,oe)),oe})()}_openPopup(b){(0,w.ax)(b,"operation-not-supported-in-this-environment")}_openRedirect(b,P,q,oe){var _e=this;return(0,I.A)(function*(){!function ai(V){var b,P,q,oe,_e,Me,Ke,vt,Gt,tn;const Fe=z();(0,w.aC)("function"==typeof(null===(b=null==Fe?void 0:Fe.universalLinks)||void 0===b?void 0:b.subscribe),V,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,w.aC)(typeof(null===(P=null==Fe?void 0:Fe.BuildInfo)||void 0===P?void 0:P.packageName)<"u",V,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,w.aC)("function"==typeof(null===(_e=null===(oe=null===(q=null==Fe?void 0:Fe.cordova)||void 0===q?void 0:q.plugins)||void 0===oe?void 0:oe.browsertab)||void 0===_e?void 0:_e.openUrl),V,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,w.aC)("function"==typeof(null===(vt=null===(Ke=null===(Me=null==Fe?void 0:Fe.cordova)||void 0===Me?void 0:Me.plugins)||void 0===Ke?void 0:Ke.browsertab)||void 0===vt?void 0:vt.isAvailable),V,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,w.aC)("function"==typeof(null===(tn=null===(Gt=null==Fe?void 0:Fe.cordova)||void 0===Gt?void 0:Gt.InAppBrowser)||void 0===tn?void 0:tn.open),V,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(b);const Me=yield _e._initialize(b);yield Me.initialized(),Me.resetRedirect(),(0,w.aI)(),yield _e._originValidation(b);const Ke=function hn(V,b,P=null){return{type:b,eventId:P,urlResponse:null,sessionId:Lt(),postBody:null,tenantId:V.tenantId,error:(0,w.aB)(V,"no-auth-event")}}(b,q,oe);yield function mt(V,b){return kt()._set(At(V),b)}(b,Ke);const vt=yield function ae(V,b,P){return Pe.apply(this,arguments)}(b,Ke,P),Gt=yield function oi(V){const{cordova:b}=z();return new Promise(P=>{b.plugins.browsertab.isAvailable(q=>{let oe=null;q?b.plugins.browsertab.openUrl(V):oe=b.InAppBrowser.open(V,(0,w.aA)()?"_blank":"_system","location=yes"),P(oe)})})}(vt);return function $n(V,b,P){return jn.apply(this,arguments)}(b,Me,Gt)})()}_isIframeWebStorageSupported(b,P){throw new Error("Method not implemented.")}_originValidation(b){const P=b._key();return this.originValidationPromises[P]||(this.originValidationPromises[P]=function Qt(V){return zn.apply(this,arguments)}(b)),this.originValidationPromises[P]}attachCallbackListeners(b,P){const{universalLinks:q,handleOpenURL:oe,BuildInfo:_e}=z(),Me=setTimeout((0,I.A)(function*(){yield dn(b),P.onEvent(Hn())}),500),Ke=function(){var tn=(0,I.A)(function*(Fe){clearTimeout(Me);const Nn=yield dn(b);let ns=null;Nn&&null!=Fe&&Fe.url&&(ns=function X(V,b){var P,q;const oe=function Mr(V){const b=br(V),P=b.link?decodeURIComponent(b.link):void 0,q=br(P).link,oe=b.deep_link_id?decodeURIComponent(b.deep_link_id):void 0;return br(oe).link||oe||q||P||V}(b);if(oe.includes("/__/auth/callback")){const _e=br(oe),Me=_e.firebaseError?function Jt(V){try{return JSON.parse(V)}catch{return null}}(decodeURIComponent(_e.firebaseError)):null,Ke=null===(q=null===(P=null==Me?void 0:Me.code)||void 0===P?void 0:P.split("auth/"))||void 0===q?void 0:q[1],vt=Ke?(0,w.aB)(Ke):null;return vt?{type:V.type,eventId:V.eventId,tenantId:V.tenantId,error:vt,urlResponse:null,sessionId:null,postBody:null}:{type:V.type,eventId:V.eventId,tenantId:V.tenantId,sessionId:V.sessionId,urlResponse:oe,postBody:null}}return null}(Nn,Fe.url)),P.onEvent(ns||Hn())});return function(Nn){return tn.apply(this,arguments)}}();typeof q<"u"&&"function"==typeof q.subscribe&&q.subscribe(null,Ke);const vt=oe,Gt=`${_e.packageName.toLowerCase()}://`;z().handleOpenURL=function(){var tn=(0,I.A)(function*(Fe){if(Fe.toLowerCase().startsWith(Gt)&&Ke({url:Fe}),"function"==typeof vt)try{vt(Fe)}catch(Nn){console.error(Nn)}});return function(Fe){return tn.apply(this,arguments)}}()}};function Hn(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,w.aB)("no-auth-event")}}function $(){var V;return(null===(V=null==self?void 0:self.location)||void 0===V?void 0:V.protocol)||null}function J(V=(0,Ie.ZQ)()){return!("file:"!==$()&&"ionic:"!==$()&&"capacitor:"!==$()||!V.toLowerCase().match(/iphone|ipad|ipod|android/))}function Yt(){try{const V=self.localStorage,b=w.aN();if(V)return V.setItem(b,"1"),V.removeItem(b),!function Ce(V=(0,Ie.ZQ)()){return function ie(){return(0,Ie.lT)()&&11===(null==document?void 0:document.documentMode)}()||function Te(V=(0,Ie.ZQ)()){return/Edge\/\d+/.test(V)}(V)}()||(0,Ie.zW)()}catch{return Mt()&&(0,Ie.zW)()}return!1}function Mt(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function fr(){return(function H(){return"http:"===$()||"https:"===$()}()||(0,Ie.sr)()||J())&&!function he(){return(0,Ie.lV)()||(0,Ie.Ll)()}()&&Yt()&&!Mt()}function Cr(){return J()&&typeof document<"u"}function Fr(){return(Fr=(0,I.A)(function*(){return!!Cr()&&new Promise(V=>{const b=setTimeout(()=>{V(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(b),V(!0)})})})).apply(this,arguments)}const It={LOCAL:"local",NONE:"none",SESSION:"session"},Cn=w.aC,Dr="persistence";function Qn(V){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,I.A)(function*(V){yield V._initializationPromise;const b=nt(),P=w.aF(Dr,V.config.apiKey,V.name);b&&b.setItem(P,V._getPersistence())})).apply(this,arguments)}function nt(){var V;try{return(null===(V=function Ur(){return typeof window<"u"?window:null}())||void 0===V?void 0:V.sessionStorage)||null}catch{return null}}const fn=w.aC;class Xt{constructor(){this.browserResolver=w.aE(w.k),this.cordovaResolver=w.aE(dr),this.underlyingResolver=null,this._redirectPersistence=w.a,this._completeRedirectFn=w.aG,this._overrideRedirectResult=w.aH}_initialize(b){var P=this;return(0,I.A)(function*(){return yield P.selectUnderlyingResolver(),P.assertedUnderlyingResolver._initialize(b)})()}_openPopup(b,P,q,oe){var _e=this;return(0,I.A)(function*(){return yield _e.selectUnderlyingResolver(),_e.assertedUnderlyingResolver._openPopup(b,P,q,oe)})()}_openRedirect(b,P,q,oe){var _e=this;return(0,I.A)(function*(){return yield _e.selectUnderlyingResolver(),_e.assertedUnderlyingResolver._openRedirect(b,P,q,oe)})()}_isIframeWebStorageSupported(b,P){this.assertedUnderlyingResolver._isIframeWebStorageSupported(b,P)}_originValidation(b){return this.assertedUnderlyingResolver._originValidation(b)}get _shouldInitProactively(){return Cr()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return fn(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var b=this;return(0,I.A)(function*(){if(b.underlyingResolver)return;const P=yield function xr(){return Fr.apply(this,arguments)}();b.underlyingResolver=P?b.cordovaResolver:b.browserResolver})()}}function Dn(V){return V.unwrap()}function Br(V){return pr(V)}function pr(V){const{_tokenResponse:b}=V instanceof Ie.g?V.customData:V;if(!b)return null;if(!(V instanceof Ie.g)&&"temporaryProof"in b&&"phoneNumber"in b)return w.P.credentialFromResult(V);const P=b.providerId;if(!P||P===w.p.PASSWORD)return null;let q;switch(P){case w.p.GOOGLE:q=w.X;break;case w.p.FACEBOOK:q=w.W;break;case w.p.GITHUB:q=w.Y;break;case w.p.TWITTER:q=w.$;break;default:const{oauthIdToken:oe,oauthAccessToken:_e,oauthTokenSecret:Me,pendingToken:Ke,nonce:vt}=b;return _e||Me||oe||Ke?Ke?P.startsWith("saml.")?w.aQ._create(P,Ke):w.N._fromParams({providerId:P,signInMethod:P,pendingToken:Ke,idToken:oe,accessToken:_e}):new w.Z(P).credential({idToken:oe,accessToken:_e,rawNonce:vt}):null}return V instanceof Ie.g?q.credentialFromError(V):q.credentialFromResult(V)}function Qe(V,b){return b.catch(P=>{throw P instanceof Ie.g&&function Yn(V,b){var P;const q=null===(P=b.customData)||void 0===P?void 0:P._tokenResponse;if("auth/multi-factor-auth-required"===(null==b?void 0:b.code))b.resolver=new dt(V,w.as(V,b));else if(q){const oe=pr(b),_e=b;oe&&(_e.credential=oe,_e.tenantId=q.tenantId||void 0,_e.email=q.email||void 0,_e.phoneNumber=q.phoneNumber||void 0)}}(V,P),P}).then(P=>{const oe=P.user;return{operationType:P.operationType,credential:Br(P),additionalUserInfo:w.aq(P),user:ve.getOrCreate(oe)}})}function Xn(V,b){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,I.A)(function*(V,b){const P=yield b;return{verificationId:P.verificationId,confirm:q=>Qe(V,P.confirm(q))}})).apply(this,arguments)}class dt{constructor(b,P){this.resolver=P,this.auth=function Zt(V){return V.wrapped()}(b)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(b){return Qe(Dn(this.auth),this.resolver.resolveSignIn(b))}}class ve{constructor(b){this._delegate=b,this.multiFactor=w.at(b)}static getOrCreate(b){return ve.USER_MAP.has(b)||ve.USER_MAP.set(b,new ve(b)),ve.USER_MAP.get(b)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(b){return this._delegate.getIdTokenResult(b)}getIdToken(b){return this._delegate.getIdToken(b)}linkAndRetrieveDataWithCredential(b){return this.linkWithCredential(b)}linkWithCredential(b){var P=this;return(0,I.A)(function*(){return Qe(P.auth,w.a2(P._delegate,b))})()}linkWithPhoneNumber(b,P){var q=this;return(0,I.A)(function*(){return Xn(q.auth,w.l(q._delegate,b,P))})()}linkWithPopup(b){var P=this;return(0,I.A)(function*(){return Qe(P.auth,w.d(P._delegate,b,Xt))})()}linkWithRedirect(b){var P=this;return(0,I.A)(function*(){return yield Qn(w.aJ(P.auth)),w.g(P._delegate,b,Xt)})()}reauthenticateAndRetrieveDataWithCredential(b){return this.reauthenticateWithCredential(b)}reauthenticateWithCredential(b){var P=this;return(0,I.A)(function*(){return Qe(P.auth,w.a3(P._delegate,b))})()}reauthenticateWithPhoneNumber(b,P){return Xn(this.auth,w.r(this._delegate,b,P))}reauthenticateWithPopup(b){return Qe(this.auth,w.e(this._delegate,b,Xt))}reauthenticateWithRedirect(b){var P=this;return(0,I.A)(function*(){return yield Qn(w.aJ(P.auth)),w.h(P._delegate,b,Xt)})()}sendEmailVerification(b){return w.ag(this._delegate,b)}unlink(b){var P=this;return(0,I.A)(function*(){return yield w.ap(P._delegate,b),P})()}updateEmail(b){return w.al(this._delegate,b)}updatePassword(b){return w.am(this._delegate,b)}updatePhoneNumber(b){return w.u(this._delegate,b)}updateProfile(b){return w.ak(this._delegate,b)}verifyBeforeUpdateEmail(b,P){return w.ah(this._delegate,b,P)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}ve.USER_MAP=new WeakMap;const Je=w.aC;let Ft=(()=>{class V{constructor(P,q){if(this.app=P,q.isInitialized())return this._delegate=q.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:oe}=P.options;Je(oe,"invalid-api-key",{appName:P.name}),Je(oe,"invalid-api-key",{appName:P.name});const _e=typeof window<"u"?Xt:void 0;this._delegate=q.initialize({options:{persistence:Tn(oe,P.name),popupRedirectResolver:_e}}),this._delegate._updateErrorMap(w.G),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?ve.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(P){this._delegate.languageCode=P}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(P){this._delegate.tenantId=P}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(P,q){w.K(this._delegate,P,q)}applyActionCode(P){return w.a7(this._delegate,P)}checkActionCode(P){return w.a8(this._delegate,P)}confirmPasswordReset(P,q){return w.a6(this._delegate,P,q)}createUserWithEmailAndPassword(P,q){var oe=this;return(0,I.A)(function*(){return Qe(oe._delegate,w.aa(oe._delegate,P,q))})()}fetchProvidersForEmail(P){return this.fetchSignInMethodsForEmail(P)}fetchSignInMethodsForEmail(P){return w.af(this._delegate,P)}isSignInWithEmailLink(P){return w.ad(this._delegate,P)}getRedirectResult(){var P=this;return(0,I.A)(function*(){Je(fr(),P._delegate,"operation-not-supported-in-this-environment");const q=yield w.j(P._delegate,Xt);return q?Qe(P._delegate,Promise.resolve(q)):{credential:null,user:null}})()}addFrameworkForLogging(P){!function bi(V,b){(0,w.aJ)(V)._logFramework(b)}(this._delegate,P)}onAuthStateChanged(P,q,oe){const{next:_e,error:Me,complete:Ke}=En(P,q,oe);return this._delegate.onAuthStateChanged(_e,Me,Ke)}onIdTokenChanged(P,q,oe){const{next:_e,error:Me,complete:Ke}=En(P,q,oe);return this._delegate.onIdTokenChanged(_e,Me,Ke)}sendSignInLinkToEmail(P,q){return w.ac(this._delegate,P,q)}sendPasswordResetEmail(P,q){return w.a5(this._delegate,P,q||void 0)}setPersistence(P){var q=this;return(0,I.A)(function*(){let oe;switch(function xn(V,b){Cn(Object.values(It).includes(b),V,"invalid-persistence-type"),(0,Ie.lV)()?Cn(b!==It.SESSION,V,"unsupported-persistence-type"):(0,Ie.Ll)()?Cn(b===It.NONE,V,"unsupported-persistence-type"):Mt()?Cn(b===It.NONE||b===It.LOCAL&&(0,Ie.zW)(),V,"unsupported-persistence-type"):Cn(b===It.NONE||Yt(),V,"unsupported-persistence-type")}(q._delegate,P),P){case It.SESSION:oe=w.a;break;case It.LOCAL:oe=(yield w.aE(w.i)._isAvailable())?w.i:w.b;break;case It.NONE:oe=w.U;break;default:return w.ax("argument-error",{appName:q._delegate.name})}return q._delegate.setPersistence(oe)})()}signInAndRetrieveDataWithCredential(P){return this.signInWithCredential(P)}signInAnonymously(){return Qe(this._delegate,w.a0(this._delegate))}signInWithCredential(P){return Qe(this._delegate,w.a1(this._delegate,P))}signInWithCustomToken(P){return Qe(this._delegate,w.a4(this._delegate,P))}signInWithEmailAndPassword(P,q){return Qe(this._delegate,w.ab(this._delegate,P,q))}signInWithEmailLink(P,q){return Qe(this._delegate,w.ae(this._delegate,P,q))}signInWithPhoneNumber(P,q){return Xn(this._delegate,w.s(this._delegate,P,q))}signInWithPopup(P){var q=this;return(0,I.A)(function*(){return Je(fr(),q._delegate,"operation-not-supported-in-this-environment"),Qe(q._delegate,w.c(q._delegate,P,Xt))})()}signInWithRedirect(P){var q=this;return(0,I.A)(function*(){return Je(fr(),q._delegate,"operation-not-supported-in-this-environment"),yield Qn(q._delegate),w.f(q._delegate,P,Xt)})()}updateCurrentUser(P){return this._delegate.updateCurrentUser(P)}verifyPasswordResetCode(P){return w.a9(this._delegate,P)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return V.Persistence=It,V})();function En(V,b,P){let q=V;"function"!=typeof V&&({next:q,error:b,complete:P}=V);const oe=q;return{next:Me=>oe(Me&&ve.getOrCreate(Me)),error:b,complete:P}}function Tn(V,b){const P=function et(V,b){const P=nt();if(!P)return[];const q=w.aF(Dr,V,b);switch(P.getItem(q)){case It.NONE:return[w.U];case It.LOCAL:return[w.i,w.a];case It.SESSION:return[w.a];default:return[]}}(V,b);if(typeof self<"u"&&!P.includes(w.i)&&P.push(w.i),typeof window<"u")for(const q of[w.b,w.a])P.includes(q)||P.push(q);return P.includes(w.U)||P.push(w.U),P}class en{constructor(){this.providerId="phone",this._delegate=new w.P(Dn(B.A.auth()))}static credential(b,P){return w.P.credential(b,P)}verifyPhoneNumber(b,P){return this._delegate.verifyPhoneNumber(b,P)}unwrap(){return this._delegate}}en.PHONE_SIGN_IN_METHOD=w.P.PHONE_SIGN_IN_METHOD,en.PROVIDER_ID=w.P.PROVIDER_ID;const kn=w.aC;class ui{constructor(b,P,q=B.A.app()){var oe;kn(null===(oe=q.options)||void 0===oe?void 0:oe.apiKey,"invalid-api-key",{appName:q.name}),this._delegate=new w.R(q.auth(),b,P),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Co(V){V.INTERNAL.registerComponent(new Ae.uA("auth-compat",b=>{const P=b.getProvider("app-compat").getImmediate(),q=b.getProvider("auth");return new Ft(P,q)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:w.A.EMAIL_SIGNIN,PASSWORD_RESET:w.A.PASSWORD_RESET,RECOVER_EMAIL:w.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:w.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:w.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:w.A.VERIFY_EMAIL}},EmailAuthProvider:w.V,FacebookAuthProvider:w.W,GithubAuthProvider:w.Y,GoogleAuthProvider:w.X,OAuthProvider:w.Z,SAMLAuthProvider:w._,PhoneAuthProvider:en,PhoneMultiFactorGenerator:w.m,RecaptchaVerifier:ui,TwitterAuthProvider:w.$,Auth:Ft,AuthCredential:w.L,Error:Ie.g}).setInstantiationMode("LAZY").setMultipleInstances(!1)),V.registerVersion("@firebase/auth-compat","0.5.7")}(B.A)},2784:(Si,Wt,j)=>{j.d(Wt,{BN:()=>I.BN,H9:()=>I.H9,My:()=>I.My,P:()=>I.P,aQ:()=>I.aQ,aU:()=>I.aU,gS:()=>I.gS,kd:()=>I.kd,mZ:()=>I.mZ,rJ:()=>I.rJ,x7:()=>I.x7});var I=j(2824)}}]);