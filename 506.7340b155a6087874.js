"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[506],{8407:(ai,Ut,q)=>{q.d(Ut,{$:()=>es,A:()=>ge,G:()=>Wi,K:()=>qs,L:()=>xr,N:()=>kn,P:()=>fs,R:()=>nc,U:()=>xe,V:()=>Ma,W:()=>Ur,X:()=>Qn,Y:()=>Hs,Z:()=>Zi,_:()=>qr,a:()=>Eo,a0:()=>Ch,a1:()=>_i,a2:()=>za,a3:()=>Nl,a4:()=>no,a5:()=>st,a6:()=>Dh,a7:()=>kh,a8:()=>Qa,a9:()=>ao,aA:()=>Ta,aB:()=>qe,aC:()=>K,aD:()=>Xn,aE:()=>le,aF:()=>We,aG:()=>Po,aH:()=>hc,aI:()=>$h,aJ:()=>Ge,aN:()=>gn,aQ:()=>Br,aa:()=>On,ab:()=>Nh,ac:()=>Vl,ad:()=>is,ae:()=>Ol,af:()=>fo,ag:()=>Ll,ah:()=>Ml,ak:()=>Fl,al:()=>Ul,am:()=>Bl,ap:()=>kl,aq:()=>Ii,as:()=>_o,at:()=>ru,au:()=>bt,av:()=>br,aw:()=>Fs,ax:()=>Oe,ay:()=>Oo,az:()=>wt,b:()=>Jl,c:()=>ps,d:()=>zh,e:()=>uc,f:()=>jh,g:()=>Yh,h:()=>Qh,i:()=>he,j:()=>mc,k:()=>Ec,l:()=>ic,m:()=>kt,o:()=>Ac,p:()=>ke,r:()=>uu,s:()=>au,u:()=>sc});var m=q(467),D=q(7852),I=q(1076),me=q(8041),Kt=q(1635),ue=q(1362);const ke={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ge={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const Wi=function fn(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},En=function vn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Tn=new I.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),St=new me.Vy("@firebase/auth");function yt(l,...a){St.logLevel<=me.$b.ERROR&&St.error(`Auth (${D.SDK_VERSION}): ${l}`,...a)}function Oe(l,...a){throw bn(l,...a)}function qe(l,...a){return bn(l,...a)}function tn(l,a,u){const h=Object.assign(Object.assign({},En()),{[a]:u});return new I.FA("auth","Firebase",h).create(a,{appName:l.name})}function ut(l){return tn(l,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nn(l,a,u){if(!(a instanceof u))throw u.name!==a.constructor.name&&Oe(l,"argument-error"),tn(l,"argument-error",`Type of ${a.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function bn(l,...a){if("string"!=typeof l){const u=a[0],h=[...a.slice(1)];return h[0]&&(h[0].appName=l.name),l._errorFactory.create(u,...h)}return Tn.create(l,...a)}function K(l,a,...u){if(!l)throw bn(a,...u)}function zt(l){const a="INTERNAL ASSERTION FAILED: "+l;throw yt(a),new Error(a)}function bt(l,a){l||zt(a)}function pn(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function Gt(){return"http:"===rr()||"https:"===rr()}function rr(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class Wn{constructor(a,u){this.shortDelay=a,this.longDelay=u,bt(u>a,"Short delay should be less than long delay!"),this.isMobile=(0,I.jZ)()||(0,I.lV)()}get(){return function qn(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Gt()||(0,I.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ir(l,a){bt(l.emulator,"Emulator should always be set here");const{url:u}=l.emulator;return a?`${u}${a.startsWith("/")?a.slice(1):a}`:u}class Cn{static initialize(a,u,h){this.fetchImpl=a,u&&(this.headersImpl=u),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void zt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void zt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void zt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ui={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},z=new Wn(3e4,6e4);function R(l,a){return l.tenantId&&!a.tenantId?Object.assign(Object.assign({},a),{tenantId:l.tenantId}):a}function x(l,a,u,h){return U.apply(this,arguments)}function U(){return(U=(0,m.A)(function*(l,a,u,h,p={}){return B(l,p,(0,m.A)(function*(){let _={},T={};h&&("GET"===a?T=h:_={body:JSON.stringify(h)});const S=(0,I.Am)(Object.assign({key:l.config.apiKey},T)).slice(1),L=yield l._getAdditionalHeaders();return L["Content-Type"]="application/json",l.languageCode&&(L["X-Firebase-Locale"]=l.languageCode),Cn.fetch()(pe(l,l.config.apiHost,u,S),Object.assign({method:a,headers:L,referrerPolicy:"no-referrer"},_))}))})).apply(this,arguments)}function B(l,a,u){return W.apply(this,arguments)}function W(){return(W=(0,m.A)(function*(l,a,u){l._canInitEmulator=!1;const h=Object.assign(Object.assign({},ui),a);try{const p=new oe(l),_=yield Promise.race([u(),p.promise]);p.clearNetworkTimeout();const T=yield _.json();if("needConfirmation"in T)throw Vt(l,"account-exists-with-different-credential",T);if(_.ok&&!("errorMessage"in T))return T;{const S=_.ok?T.errorMessage:T.error.message,[L,ee]=S.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===L)throw Vt(l,"credential-already-in-use",T);if("EMAIL_EXISTS"===L)throw Vt(l,"email-already-in-use",T);if("USER_DISABLED"===L)throw Vt(l,"user-disabled",T);const se=h[L]||L.toLowerCase().replace(/[_\s]+/g,"-");if(ee)throw tn(l,se,ee);Oe(l,se)}}catch(p){if(p instanceof I.g)throw p;Oe(l,"network-request-failed",{message:String(p)})}})).apply(this,arguments)}function re(l,a,u,h){return J.apply(this,arguments)}function J(){return(J=(0,m.A)(function*(l,a,u,h,p={}){const _=yield x(l,a,u,h,p);return"mfaPendingCredential"in _&&Oe(l,"multi-factor-auth-required",{_serverResponse:_}),_})).apply(this,arguments)}function pe(l,a,u,h){const p=`${a}${u}?${h}`;return l.config.emulator?ir(l.config,p):`${l.config.apiScheme}://${p}`}function de(l){switch(l){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class oe{constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((u,h)=>{this.timer=setTimeout(()=>h(qe(this.auth,"network-request-failed")),z.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Vt(l,a,u){const h={appName:l.name};u.email&&(h.email=u.email),u.phoneNumber&&(h.phoneNumber=u.phoneNumber);const p=qe(l,a,h);return p.customData._tokenResponse=u,p}function ct(l){return void 0!==l&&void 0!==l.getResponse}function $(l){return void 0!==l&&void 0!==l.enterprise}class sr{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===a.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const u of this.recaptchaEnforcementState)if(u.provider&&u.provider===a)return de(u.enforcementState);return null}isProviderEnabled(a){return"ENFORCE"===this.getProviderEnforcementState(a)||"AUDIT"===this.getProviderEnforcementState(a)}}function xn(){return(xn=(0,m.A)(function*(l){return(yield x(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Ze(l,a){return An.apply(this,arguments)}function An(){return(An=(0,m.A)(function*(l,a){return x(l,"GET","/v2/recaptchaConfig",R(l,a))})).apply(this,arguments)}function Kn(){return(Kn=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:delete",a)})).apply(this,arguments)}function zn(){return(zn=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:update",a)})).apply(this,arguments)}function _e(l,a){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:lookup",a)})).apply(this,arguments)}function be(l){if(l)try{const a=new Date(Number(l));if(!isNaN(a.getTime()))return a.toUTCString()}catch{}}function Ot(){return(Ot=(0,m.A)(function*(l,a=!1){const u=(0,I.Ku)(l),h=yield u.getIdToken(a),p=$n(h);K(p&&p.exp&&p.auth_time&&p.iat,u.auth,"internal-error");const _="object"==typeof p.firebase?p.firebase:void 0,T=null==_?void 0:_.sign_in_provider;return{claims:p,token:h,authTime:be(Gn(p.auth_time)),issuedAtTime:be(Gn(p.iat)),expirationTime:be(Gn(p.exp)),signInProvider:T||null,signInSecondFactor:(null==_?void 0:_.sign_in_second_factor)||null}})).apply(this,arguments)}function Gn(l){return 1e3*Number(l)}function $n(l){const[a,u,h]=l.split(".");if(void 0===a||void 0===u||void 0===h)return yt("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,I.u)(u);return p?JSON.parse(p):(yt("Failed to decode base64 JWT payload"),null)}catch(p){return yt("Caught error parsing JWT payload as JSON",null==p?void 0:p.toString()),null}}function Je(l){const a=$n(l);return K(a,"internal-error"),K(typeof a.exp<"u","internal-error"),K(typeof a.iat<"u","internal-error"),Number(a.exp)-Number(a.iat)}function Le(l,a){return $t.apply(this,arguments)}function $t(){return($t=(0,m.A)(function*(l,a,u=!1){if(u)return a;try{return yield a}catch(h){throw h instanceof I.g&&function Dn({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(h)&&l.auth.currentUser===l&&(yield l.auth.signOut()),h}})).apply(this,arguments)}class Lt{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(a){var u;if(a){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const p=(null!==(u=this.user.stsTokenManager.expirationTime)&&void 0!==u?u:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(a=!1){var u=this;if(!this.isRunning)return;const h=this.getInterval(a);this.timerId=setTimeout((0,m.A)(function*(){yield u.iteration()}),h)}iteration(){var a=this;return(0,m.A)(function*(){try{yield a.user.getIdToken(!0)}catch(u){return void("auth/network-request-failed"===(null==u?void 0:u.code)&&a.schedule(!0))}a.schedule()})()}}class Pe{constructor(a,u){this.createdAt=a,this.lastLoginAt=u,this._initializeTime()}_initializeTime(){this.lastSignInTime=be(this.lastLoginAt),this.creationTime=be(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Me(l){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,m.A)(function*(l){var a;const u=l.auth,h=yield l.getIdToken(),p=yield Le(l,_e(u,{idToken:h}));K(null==p?void 0:p.users.length,u,"internal-error");const _=p.users[0];l._notifyReloadListener(_);const T=null!==(a=_.providerUserInfo)&&void 0!==a&&a.length?rn(_.providerUserInfo):[],S=function pt(l,a){return[...l.filter(h=>!a.some(p=>p.providerId===h.providerId)),...a]}(l.providerData,T),se=!!l.isAnonymous&&!(l.email&&_.passwordHash||null!=S&&S.length),ve={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:S,metadata:new Pe(_.createdAt,_.lastLoginAt),isAnonymous:se};Object.assign(l,ve)})).apply(this,arguments)}function Bt(){return(Bt=(0,m.A)(function*(l){const a=(0,I.Ku)(l);yield Me(a),yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)})).apply(this,arguments)}function rn(l){return l.map(a=>{var{providerId:u}=a,h=(0,Kt.Tt)(a,["providerId"]);return{providerId:u,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function li(){return(li=(0,m.A)(function*(l,a){const u=yield B(l,{},(0,m.A)(function*(){const h=(0,I.Am)({grant_type:"refresh_token",refresh_token:a}).slice(1),{tokenApiHost:p,apiKey:_}=l.config,T=pe(l,p,"/v1/token",`key=${_}`),S=yield l._getAdditionalHeaders();return S["Content-Type"]="application/x-www-form-urlencoded",Cn.fetch()(T,{method:"POST",headers:S,body:h})}));return{accessToken:u.access_token,expiresIn:u.expires_in,refreshToken:u.refresh_token}})).apply(this,arguments)}function C(){return(C=(0,m.A)(function*(l,a){return x(l,"POST","/v2/accounts:revokeToken",R(l,a))})).apply(this,arguments)}class A{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){K(a.idToken,"internal-error"),K(typeof a.idToken<"u","internal-error"),K(typeof a.refreshToken<"u","internal-error");const u="expiresIn"in a&&typeof a.expiresIn<"u"?Number(a.expiresIn):Je(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,u)}updateFromIdToken(a){K(0!==a.length,"internal-error");const u=Je(a);this.updateTokensAndExpiration(a,null,u)}getToken(a,u=!1){var h=this;return(0,m.A)(function*(){return u||!h.accessToken||h.isExpired?(K(h.refreshToken,a,"user-token-expired"),h.refreshToken?(yield h.refresh(a,h.refreshToken),h.accessToken):null):h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(a,u){var h=this;return(0,m.A)(function*(){const{accessToken:p,refreshToken:_,expiresIn:T}=yield function ar(l,a){return li.apply(this,arguments)}(a,u);h.updateTokensAndExpiration(p,_,Number(T))})()}updateTokensAndExpiration(a,u,h){this.refreshToken=u||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(a,u){const{refreshToken:h,accessToken:p,expirationTime:_}=u,T=new A;return h&&(K("string"==typeof h,"internal-error",{appName:a}),T.refreshToken=h),p&&(K("string"==typeof p,"internal-error",{appName:a}),T.accessToken=p),_&&(K("number"==typeof _,"internal-error",{appName:a}),T.expirationTime=_),T}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new A,this.toJSON())}_performRefresh(){return zt("not implemented")}}function E(l,a){K("string"==typeof l||typeof l>"u","internal-error",{appName:a})}class k{constructor(a){var{uid:u,auth:h,stsTokenManager:p}=a,_=(0,Kt.Tt)(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Lt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=u,this.auth=h,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=_.displayName||null,this.email=_.email||null,this.emailVerified=_.emailVerified||!1,this.phoneNumber=_.phoneNumber||null,this.photoURL=_.photoURL||null,this.isAnonymous=_.isAnonymous||!1,this.tenantId=_.tenantId||null,this.providerData=_.providerData?[..._.providerData]:[],this.metadata=new Pe(_.createdAt||void 0,_.lastLoginAt||void 0)}getIdToken(a){var u=this;return(0,m.A)(function*(){const h=yield Le(u,u.stsTokenManager.getToken(u.auth,a));return K(h,u.auth,"internal-error"),u.accessToken!==h&&(u.accessToken=h,yield u.auth._persistUserIfCurrent(u),u.auth._notifyListenersIfCurrent(u)),h})()}getIdTokenResult(a){return function wn(l){return Ot.apply(this,arguments)}(this,a)}reload(){return function It(l){return Bt.apply(this,arguments)}(this)}_assign(a){this!==a&&(K(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(u=>Object.assign({},u)),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){const u=new k(Object.assign(Object.assign({},this),{auth:a,stsTokenManager:this.stsTokenManager._clone()}));return u.metadata._copy(this.metadata),u}_onReload(a){K(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(a,u=!1){var h=this;return(0,m.A)(function*(){let p=!1;a.idToken&&a.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(a),p=!0),u&&(yield Me(h)),yield h.auth._persistUserIfCurrent(h),p&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var a=this;return(0,m.A)(function*(){if((0,D._isFirebaseServerApp)(a.auth.app))return Promise.reject(ut(a.auth));const u=yield a.getIdToken();return yield Le(a,function or(l,a){return Kn.apply(this,arguments)}(a.auth,{idToken:u})),a.stsTokenManager.clearRefreshToken(),a.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>Object.assign({},a)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,u){var h,p,_,T,S,L,ee,se;const ve=null!==(h=u.displayName)&&void 0!==h?h:void 0,Mt=null!==(p=u.email)&&void 0!==p?p:void 0,Yt=null!==(_=u.phoneNumber)&&void 0!==_?_:void 0,_r=null!==(T=u.photoURL)&&void 0!==T?T:void 0,vs=null!==(S=u.tenantId)&&void 0!==S?S:void 0,xi=null!==(L=u._redirectEventId)&&void 0!==L?L:void 0,Pu=null!==(ee=u.createdAt)&&void 0!==ee?ee:void 0,Su=null!==(se=u.lastLoginAt)&&void 0!==se?se:void 0,{uid:Pn,emailVerified:bu,isAnonymous:Xr,providerData:Uo,stsTokenManager:Bo}=u;K(Pn&&Bo,a,"internal-error");const Di=A.fromJSON(this.name,Bo);K("string"==typeof Pn,a,"internal-error"),E(ve,a.name),E(Mt,a.name),K("boolean"==typeof bu,a,"internal-error"),K("boolean"==typeof Xr,a,"internal-error"),E(Yt,a.name),E(_r,a.name),E(vs,a.name),E(xi,a.name),E(Pu,a.name),E(Su,a.name);const Nt=new k({uid:Pn,auth:a,email:Mt,emailVerified:bu,displayName:ve,isAnonymous:Xr,photoURL:_r,phoneNumber:Yt,tenantId:vs,stsTokenManager:Di,createdAt:Pu,lastLoginAt:Su});return Uo&&Array.isArray(Uo)&&(Nt.providerData=Uo.map(wc=>Object.assign({},wc))),xi&&(Nt._redirectEventId=xi),Nt}static _fromIdTokenResponse(a,u,h=!1){return(0,m.A)(function*(){const p=new A;p.updateFromServerResponse(u);const _=new k({uid:u.localId,auth:a,stsTokenManager:p,isAnonymous:h});return yield Me(_),_})()}static _fromGetAccountInfoResponse(a,u,h){return(0,m.A)(function*(){const p=u.users[0];K(void 0!==p.localId,"internal-error");const _=void 0!==p.providerUserInfo?rn(p.providerUserInfo):[],T=!(p.email&&p.passwordHash||null!=_&&_.length),S=new A;S.updateFromIdToken(h);const L=new k({uid:p.localId,auth:a,stsTokenManager:S,isAnonymous:T}),ee={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:_,metadata:new Pe(p.createdAt,p.lastLoginAt),isAnonymous:!(p.email&&p.passwordHash||null!=_&&_.length)};return Object.assign(L,ee),L})()}}const Y=new Map;function le(l){bt(l instanceof Function,"Expected a class definition");let a=Y.get(l);return a?(bt(a instanceof l,"Instance stored in cache mismatched with class"),a):(a=new l,Y.set(l,a),a)}const xe=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,m.A)(function*(){return!0})()}_set(u,h){var p=this;return(0,m.A)(function*(){p.storage[u]=h})()}_get(u){var h=this;return(0,m.A)(function*(){const p=h.storage[u];return void 0===p?null:p})()}_remove(u){var h=this;return(0,m.A)(function*(){delete h.storage[u]})()}_addListener(u,h){}_removeListener(u,h){}}return l.type="NONE",l})();function We(l,a,u){return`firebase:${l}:${a}:${u}`}class vt{constructor(a,u,h){this.persistence=a,this.auth=u,this.userKey=h;const{config:p,name:_}=this.auth;this.fullUserKey=We(this.userKey,p.apiKey,_),this.fullPersistenceKey=We("persistence",p.apiKey,_),this.boundEventHandler=u._onStorageEvent.bind(u),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}getCurrentUser(){var a=this;return(0,m.A)(function*(){const u=yield a.persistence._get(a.fullUserKey);return u?k._fromJSON(a.auth,u):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(a){var u=this;return(0,m.A)(function*(){if(u.persistence===a)return;const h=yield u.getCurrentUser();return yield u.removeCurrentUser(),u.persistence=a,h?u.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(a,u,h="authUser"){return(0,m.A)(function*(){if(!u.length)return new vt(le(xe),a,h);const p=(yield Promise.all(u.map(function(){var ee=(0,m.A)(function*(se){if(yield se._isAvailable())return se});return function(se){return ee.apply(this,arguments)}}()))).filter(ee=>ee);let _=p[0]||le(xe);const T=We(h,a.config.apiKey,a.name);let S=null;for(const ee of u)try{const se=yield ee._get(T);if(se){const ve=k._fromJSON(a,se);ee!==_&&(S=ve),_=ee;break}}catch{}const L=p.filter(ee=>ee._shouldAllowMigration);return _._shouldAllowMigration&&L.length?(_=L[0],S&&(yield _._set(T,S.toJSON())),yield Promise.all(u.map(function(){var ee=(0,m.A)(function*(se){if(se!==_)try{yield se._remove(T)}catch{}});return function(se){return ee.apply(this,arguments)}}())),new vt(_,a,h)):new vt(_,a,h)})()}}function sn(l){const a=l.toLowerCase();if(a.includes("opera/")||a.includes("opr/")||a.includes("opios/"))return"Opera";if(va(a))return"IEMobile";if(a.includes("msie")||a.includes("trident/"))return"IE";if(a.includes("edge/"))return"Edge";if(Ee(a))return"Firefox";if(a.includes("silk/"))return"Silk";if(Ea(a))return"Blackberry";if(Gi(a))return"Webos";if(jt(a))return"Safari";if((a.includes("chrome/")||zi(a))&&!a.includes("edge/"))return"Chrome";if(Fs(a))return"Android";{const h=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==h?void 0:h.length))return h[1]}return"Other"}function Ee(l=(0,I.ZQ)()){return/firefox\//i.test(l)}function jt(l=(0,I.ZQ)()){const a=l.toLowerCase();return a.includes("safari/")&&!a.includes("chrome/")&&!a.includes("crios/")&&!a.includes("android")}function zi(l=(0,I.ZQ)()){return/crios\//i.test(l)}function va(l=(0,I.ZQ)()){return/iemobile/i.test(l)}function Fs(l=(0,I.ZQ)()){return/android/i.test(l)}function Ea(l=(0,I.ZQ)()){return/blackberry/i.test(l)}function Gi(l=(0,I.ZQ)()){return/webos/i.test(l)}function br(l=(0,I.ZQ)()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function Ta(l=(0,I.ZQ)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}function Ra(l=(0,I.ZQ)()){return br(l)||Fs(l)||Gi(l)||Ea(l)||/windows phone/i.test(l)||va(l)}function pl(l,a=[]){let u;switch(l){case"Browser":u=sn((0,I.ZQ)());break;case"Worker":u=`${sn((0,I.ZQ)())}-${l}`;break;default:u=l}const h=a.length?a.join(","):"FirebaseCore-web";return`${u}/JsCore/${D.SDK_VERSION}/${h}`}class ml{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,u){const h=_=>new Promise((T,S)=>{try{T(a(_))}catch(L){S(L)}});h.onAbort=u,this.queue.push(h);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(a){var u=this;return(0,m.A)(function*(){if(u.auth.currentUser===a)return;const h=[];try{for(const p of u.queue)yield p(a),p.onAbort&&h.push(p.onAbort)}catch(p){h.reverse();for(const _ of h)try{_()}catch{}throw u.auth._errorFactory.create("login-blocked",{originalMessage:null==p?void 0:p.message})}})()}}function $i(){return($i=(0,m.A)(function*(l,a={}){return x(l,"GET","/v2/passwordPolicy",R(l,a))})).apply(this,arguments)}class Eh{constructor(a){var u,h,p,_;const T=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(u=T.minPasswordLength)&&void 0!==u?u:6,T.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=T.maxPasswordLength),void 0!==T.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=T.containsLowercaseCharacter),void 0!==T.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=T.containsUppercaseCharacter),void 0!==T.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=T.containsNumericCharacter),void 0!==T.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=T.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(p=null===(h=a.allowedNonAlphanumericCharacters)||void 0===h?void 0:h.join(""))&&void 0!==p?p:"",this.forceUpgradeOnSignin=null!==(_=a.forceUpgradeOnSignin)&&void 0!==_&&_,this.schemaVersion=a.schemaVersion}validatePassword(a){var u,h,p,_,T,S;const L={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,L),this.validatePasswordCharacterOptions(a,L),L.isValid&&(L.isValid=null===(u=L.meetsMinPasswordLength)||void 0===u||u),L.isValid&&(L.isValid=null===(h=L.meetsMaxPasswordLength)||void 0===h||h),L.isValid&&(L.isValid=null===(p=L.containsLowercaseLetter)||void 0===p||p),L.isValid&&(L.isValid=null===(_=L.containsUppercaseLetter)||void 0===_||_),L.isValid&&(L.isValid=null===(T=L.containsNumericCharacter)||void 0===T||T),L.isValid&&(L.isValid=null===(S=L.containsNonAlphanumericCharacter)||void 0===S||S),L}validatePasswordLengthOptions(a,u){const h=this.customStrengthOptions.minPasswordLength,p=this.customStrengthOptions.maxPasswordLength;h&&(u.meetsMinPasswordLength=a.length>=h),p&&(u.meetsMaxPasswordLength=a.length<=p)}validatePasswordCharacterOptions(a,u){let h;this.updatePasswordCharacterOptionsStatuses(u,!1,!1,!1,!1);for(let p=0;p<a.length;p++)h=a.charAt(p),this.updatePasswordCharacterOptionsStatuses(u,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(a,u,h,p,_){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=u)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=p)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=_))}}class Pa{constructor(a,u,h,p){this.app=a,this.heartbeatServiceProvider=u,this.appCheckServiceProvider=h,this.config=p,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Us(this),this.idTokenSubscription=new Us(this),this.beforeStateQueue=new ml(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Tn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=p.sdkClientVersion}_initializeWithPersistence(a,u){var h=this;return u&&(this._popupRedirectResolver=le(u)),this._initializationPromise=this.queue((0,m.A)(function*(){var p,_;if(!h._deleted&&(h.persistenceManager=yield vt.create(h,a),!h._deleted)){if(null!==(p=h._popupRedirectResolver)&&void 0!==p&&p._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch{}yield h.initializeCurrentUser(u),h.lastNotifiedUid=(null===(_=h.currentUser)||void 0===_?void 0:_.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var a=this;return(0,m.A)(function*(){if(a._deleted)return;const u=yield a.assertedPersistence.getCurrentUser();if(a.currentUser||u){if(a.currentUser&&u&&a.currentUser.uid===u.uid)return a._currentUser._assign(u),void(yield a.currentUser.getIdToken());yield a._updateCurrentUser(u,!0)}})()}initializeCurrentUserFromIdToken(a){var u=this;return(0,m.A)(function*(){try{const h=yield _e(u,{idToken:a}),p=yield k._fromGetAccountInfoResponse(u,h,a);yield u.directlySetCurrentUser(p)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),yield u.directlySetCurrentUser(null)}})()}initializeCurrentUser(a){var u=this;return(0,m.A)(function*(){var h;if((0,D._isFirebaseServerApp)(u.app)){const S=u.app.settings.authIdToken;return S?new Promise(L=>{setTimeout(()=>u.initializeCurrentUserFromIdToken(S).then(L,L))}):u.directlySetCurrentUser(null)}const p=yield u.assertedPersistence.getCurrentUser();let _=p,T=!1;if(a&&u.config.authDomain){yield u.getOrInitRedirectPersistenceManager();const S=null===(h=u.redirectUser)||void 0===h?void 0:h._redirectEventId,L=null==_?void 0:_._redirectEventId,ee=yield u.tryRedirectSignIn(a);(!S||S===L)&&null!=ee&&ee.user&&(_=ee.user,T=!0)}if(!_)return u.directlySetCurrentUser(null);if(!_._redirectEventId){if(T)try{yield u.beforeStateQueue.runMiddleware(_)}catch(S){_=p,u._popupRedirectResolver._overrideRedirectResult(u,()=>Promise.reject(S))}return _?u.reloadAndSetCurrentUserOrClear(_):u.directlySetCurrentUser(null)}return K(u._popupRedirectResolver,u,"argument-error"),yield u.getOrInitRedirectPersistenceManager(),u.redirectUser&&u.redirectUser._redirectEventId===_._redirectEventId?u.directlySetCurrentUser(_):u.reloadAndSetCurrentUserOrClear(_)})()}tryRedirectSignIn(a){var u=this;return(0,m.A)(function*(){let h=null;try{h=yield u._popupRedirectResolver._completeRedirectFn(u,a,!0)}catch{yield u._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(a){var u=this;return(0,m.A)(function*(){try{yield Me(a)}catch(h){if("auth/network-request-failed"!==(null==h?void 0:h.code))return u.directlySetCurrentUser(null)}return u.directlySetCurrentUser(a)})()}useDeviceLanguage(){this.languageCode=function Pr(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var a=this;return(0,m.A)(function*(){a._deleted=!0})()}updateCurrentUser(a){var u=this;return(0,m.A)(function*(){if((0,D._isFirebaseServerApp)(u.app))return Promise.reject(ut(u));const h=a?(0,I.Ku)(a):null;return h&&K(h.auth.config.apiKey===u.config.apiKey,u,"invalid-user-token"),u._updateCurrentUser(h&&h._clone(u))})()}_updateCurrentUser(a,u=!1){var h=this;return(0,m.A)(function*(){if(!h._deleted)return a&&K(h.tenantId===a.tenantId,h,"tenant-id-mismatch"),u||(yield h.beforeStateQueue.runMiddleware(a)),h.queue((0,m.A)(function*(){yield h.directlySetCurrentUser(a),h.notifyAuthListeners()}))})()}signOut(){var a=this;return(0,m.A)(function*(){return(0,D._isFirebaseServerApp)(a.app)?Promise.reject(ut(a)):(yield a.beforeStateQueue.runMiddleware(null),(a.redirectPersistenceManager||a._popupRedirectResolver)&&(yield a._setRedirectUser(null)),a._updateCurrentUser(null,!0))})()}setPersistence(a){var u=this;return(0,D._isFirebaseServerApp)(this.app)?Promise.reject(ut(this)):this.queue((0,m.A)(function*(){yield u.assertedPersistence.setPersistence(le(a))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(a){var u=this;return(0,m.A)(function*(){u._getPasswordPolicyInternal()||(yield u._updatePasswordPolicy());const h=u._getPasswordPolicyInternal();return h.schemaVersion!==u.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(u._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(a)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var a=this;return(0,m.A)(function*(){const u=yield function gl(l){return $i.apply(this,arguments)}(a),h=new Eh(u);null===a.tenantId?a._projectPasswordPolicy=h:a._tenantPasswordPolicies[a.tenantId]=h})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(a){this._errorFactory=new I.FA("auth","Firebase",a())}onAuthStateChanged(a,u,h){return this.registerStateListener(this.authStateSubscription,a,u,h)}beforeAuthStateChanged(a,u){return this.beforeStateQueue.pushCallback(a,u)}onIdTokenChanged(a,u,h){return this.registerStateListener(this.idTokenSubscription,a,u,h)}authStateReady(){return new Promise((a,u)=>{if(this.currentUser)a();else{const h=this.onAuthStateChanged(()=>{h(),a()},u)}})}revokeAccessToken(a){var u=this;return(0,m.A)(function*(){if(u.currentUser){const h=yield u.currentUser.getIdToken(),p={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:h};null!=u.tenantId&&(p.tenantId=u.tenantId),yield function Ki(l,a){return C.apply(this,arguments)}(u,p)}})()}toJSON(){var a;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(a=this._currentUser)||void 0===a?void 0:a.toJSON()}}_setRedirectUser(a,u){var h=this;return(0,m.A)(function*(){const p=yield h.getOrInitRedirectPersistenceManager(u);return null===a?p.removeCurrentUser():p.setCurrentUser(a)})()}getOrInitRedirectPersistenceManager(a){var u=this;return(0,m.A)(function*(){if(!u.redirectPersistenceManager){const h=a&&le(a)||u._popupRedirectResolver;K(h,u,"argument-error"),u.redirectPersistenceManager=yield vt.create(u,[le(h._redirectPersistence)],"redirectUser"),u.redirectUser=yield u.redirectPersistenceManager.getCurrentUser()}return u.redirectPersistenceManager})()}_redirectUserForId(a){var u=this;return(0,m.A)(function*(){var h,p;return u._isInitialized&&(yield u.queue((0,m.A)(function*(){}))),(null===(h=u._currentUser)||void 0===h?void 0:h._redirectEventId)===a?u._currentUser:(null===(p=u.redirectUser)||void 0===p?void 0:p._redirectEventId)===a?u.redirectUser:null})()}_persistUserIfCurrent(a){var u=this;return(0,m.A)(function*(){if(a===u.currentUser)return u.queue((0,m.A)(function*(){return u.directlySetCurrentUser(a)}))})()}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var a,u;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(u=null===(a=this.currentUser)||void 0===a?void 0:a.uid)&&void 0!==u?u:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,u,h,p){if(this._deleted)return()=>{};const _="function"==typeof u?u:u.next.bind(u);let T=!1;const S=this._isInitialized?Promise.resolve():this._initializationPromise;if(K(S,this,"internal-error"),S.then(()=>{T||_(this.currentUser)}),"function"==typeof u){const L=a.addObserver(u,h,p);return()=>{T=!0,L()}}{const L=a.addObserver(u);return()=>{T=!0,L()}}}directlySetCurrentUser(a){var u=this;return(0,m.A)(function*(){u.currentUser&&u.currentUser!==a&&u._currentUser._stopProactiveRefresh(),a&&u.isProactiveRefreshEnabled&&a._startProactiveRefresh(),u.currentUser=a,a?yield u.assertedPersistence.setCurrentUser(a):yield u.assertedPersistence.removeCurrentUser()})()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return K(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=pl(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var a=this;return(0,m.A)(function*(){var u;const h={"X-Client-Version":a.clientVersion};a.app.options.appId&&(h["X-Firebase-gmpid"]=a.app.options.appId);const p=yield null===(u=a.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getHeartbeatsHeader();p&&(h["X-Firebase-Client"]=p);const _=yield a._getAppCheckToken();return _&&(h["X-Firebase-AppCheck"]=_),h})()}_getAppCheckToken(){var a=this;return(0,m.A)(function*(){var u;const h=yield null===(u=a.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getToken();return null!=h&&h.error&&function ze(l,...a){St.logLevel<=me.$b.WARN&&St.warn(`Auth (${D.SDK_VERSION}): ${l}`,...a)}(`Error while retrieving App Check token: ${h.error}`),null==h?void 0:h.token})()}}function Ge(l){return(0,I.Ku)(l)}class Us{constructor(a){this.auth=a,this.observer=null,this.addObserver=(0,I.tD)(u=>this.observer=u)}get next(){return K(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let it={loadJS:()=>(0,m.A)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ci(l){return it.loadJS(l)}function yl(l){return`__${l}${Math.floor(1e6*Math.random())}`}class vl{constructor(a){this.type="recaptcha-enterprise",this.auth=Ge(a)}verify(a="verify",u=!1){var h=this;return(0,m.A)(function*(){function _(){return _=(0,m.A)(function*(S){if(!u){if(null==S.tenantId&&null!=S._agentRecaptchaConfig)return S._agentRecaptchaConfig.siteKey;if(null!=S.tenantId&&void 0!==S._tenantRecaptchaConfigs[S.tenantId])return S._tenantRecaptchaConfigs[S.tenantId].siteKey}return new Promise(function(){var L=(0,m.A)(function*(ee,se){Ze(S,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ve=>{if(void 0!==ve.recaptchaKey){const Mt=new sr(ve);return null==S.tenantId?S._agentRecaptchaConfig=Mt:S._tenantRecaptchaConfigs[S.tenantId]=Mt,ee(Mt.siteKey)}se(new Error("recaptcha Enterprise site key undefined"))}).catch(ve=>{se(ve)})});return function(ee,se){return L.apply(this,arguments)}}())}),_.apply(this,arguments)}function T(S,L,ee){const se=window.grecaptcha;$(se)?se.enterprise.ready(()=>{se.enterprise.execute(S,{action:a}).then(ve=>{L(ve)}).catch(()=>{L("NO_RECAPTCHA")})}):ee(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((S,L)=>{(function p(S){return _.apply(this,arguments)})(h.auth).then(ee=>{if(!u&&$(window.grecaptcha))T(ee,S,L);else{if(typeof window>"u")return void L(new Error("RecaptchaVerifier is only supported in browser"));let se=function Th(){return it.recaptchaEnterpriseScript}();0!==se.length&&(se+=ee),ci(se).then(()=>{T(ee,S,L)}).catch(ve=>{L(ve)})}}).catch(ee=>{L(ee)})})})()}}function El(l,a,u){return Cr.apply(this,arguments)}function Cr(){return(Cr=(0,m.A)(function*(l,a,u,h=!1){const p=new vl(l);let _;try{_=yield p.verify(u)}catch{_=yield p.verify(u,!0)}const T=Object.assign({},a);return Object.assign(T,h?{captchaResp:_}:{captchaResponse:_}),Object.assign(T,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(T,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),T})).apply(this,arguments)}function jn(l,a,u,h){return ji.apply(this,arguments)}function ji(){return ji=(0,m.A)(function*(l,a,u,h){var p;if(null!==(p=l._getRecaptchaConfig())&&void 0!==p&&p.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const _=yield El(l,a,u,"getOobCode"===u);return h(l,_)}return h(l,a).catch(function(){var _=(0,m.A)(function*(T){if("auth/missing-recaptcha-token"===T.code){console.log(`${u} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const S=yield El(l,a,u,"getOobCode"===u);return h(l,S)}return Promise.reject(T)});return function(T){return _.apply(this,arguments)}}())}),ji.apply(this,arguments)}function qs(l,a,u){const h=Ge(l);K(h._canInitEmulator,h,"emulator-config-failed"),K(/^https?:\/\//.test(a),h,"invalid-emulator-scheme");const p=!(null==u||!u.disableWarnings),_=xa(a),{host:T,port:S}=function Rh(l){const a=xa(l),u=/(\/\/)?([^?#/]+)/.exec(l.substr(a.length));if(!u)return{host:"",port:null};const h=u[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(h);if(p){const _=p[1];return{host:_,port:hi(h.substr(_.length+1))}}{const[_,T]=h.split(":");return{host:_,port:hi(T)}}}(a);h.config.emulator={url:`${_}//${T}${null===S?"":`:${S}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:T,port:S,protocol:_.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function Al(){function l(){const a=document.createElement("p"),u=a.style;a.innerText="Running in emulator mode. Do not use with production credentials.",u.position="fixed",u.width="100%",u.backgroundColor="#ffffff",u.border=".1em solid #000000",u.color="#b50000",u.bottom="0px",u.left="0px",u.margin="0px",u.zIndex="10000",u.textAlign="center",a.classList.add("firebase-emulator-warning"),document.body.appendChild(a)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}function xa(l){const a=l.indexOf(":");return a<0?"":l.substr(0,a+1)}function hi(l){if(!l)return null;const a=Number(l);return isNaN(a)?null:a}class xr{constructor(a,u){this.providerId=a,this.signInMethod=u}toJSON(){return zt("not implemented")}_getIdTokenResponse(a){return zt("not implemented")}_linkToIdToken(a,u){return zt("not implemented")}_getReauthenticationResolver(a){return zt("not implemented")}}function Da(l,a){return di.apply(this,arguments)}function di(){return(di=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:resetPassword",R(l,a))})).apply(this,arguments)}function ka(){return(ka=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:update",a)})).apply(this,arguments)}function fi(l,a){return Na.apply(this,arguments)}function Na(){return(Na=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:signUp",a)})).apply(this,arguments)}function Hn(){return(Hn=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:update",R(l,a))})).apply(this,arguments)}function wl(l,a){return pi.apply(this,arguments)}function pi(){return(pi=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithPassword",R(l,a))})).apply(this,arguments)}function Hi(l,a){return Dr.apply(this,arguments)}function Dr(){return(Dr=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:sendOobCode",R(l,a))})).apply(this,arguments)}function Dt(){return(Dt=(0,m.A)(function*(l,a){return Hi(l,a)})).apply(this,arguments)}function Pl(l,a){return kr.apply(this,arguments)}function kr(){return(kr=(0,m.A)(function*(l,a){return Hi(l,a)})).apply(this,arguments)}function Ws(l,a){return Ks.apply(this,arguments)}function Ks(){return(Ks=(0,m.A)(function*(l,a){return Hi(l,a)})).apply(this,arguments)}function zs(){return(zs=(0,m.A)(function*(l,a){return Hi(l,a)})).apply(this,arguments)}function Nr(){return(Nr=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithEmailLink",R(l,a))})).apply(this,arguments)}function Qi(){return(Qi=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithEmailLink",R(l,a))})).apply(this,arguments)}class Vr extends xr{constructor(a,u,h,p=null){super("password",h),this._email=a,this._password=u,this._tenantId=p}static _fromEmailAndPassword(a,u){return new Vr(a,u,"password")}static _fromEmailAndCode(a,u,h=null){return new Vr(a,u,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){const u="string"==typeof a?JSON.parse(a):a;if(null!=u&&u.email&&null!=u&&u.password){if("password"===u.signInMethod)return this._fromEmailAndPassword(u.email,u.password);if("emailLink"===u.signInMethod)return this._fromEmailAndCode(u.email,u.password,u.tenantId)}return null}_getIdTokenResponse(a){var u=this;return(0,m.A)(function*(){switch(u.signInMethod){case"password":return jn(a,{returnSecureToken:!0,email:u._email,password:u._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",wl);case"emailLink":return function Sl(l,a){return Nr.apply(this,arguments)}(a,{email:u._email,oobCode:u._password});default:Oe(a,"internal-error")}})()}_linkToIdToken(a,u){var h=this;return(0,m.A)(function*(){switch(h.signInMethod){case"password":return jn(a,{idToken:u,returnSecureToken:!0,email:h._email,password:h._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fi);case"emailLink":return function Oa(l,a){return Qi.apply(this,arguments)}(a,{idToken:u,email:h._email,oobCode:h._password});default:Oe(a,"internal-error")}})()}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}function mn(l,a){return Or.apply(this,arguments)}function Or(){return(Or=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithIdp",R(l,a))})).apply(this,arguments)}class kn extends xr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){const u=new kn(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(u.idToken=a.idToken),a.accessToken&&(u.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(u.nonce=a.nonce),a.pendingToken&&(u.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(u.accessToken=a.oauthToken,u.secret=a.oauthTokenSecret):Oe("argument-error"),u}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){const u="string"==typeof a?JSON.parse(a):a,{providerId:h,signInMethod:p}=u,_=(0,Kt.Tt)(u,["providerId","signInMethod"]);if(!h||!p)return null;const T=new kn(h,p);return T.idToken=_.idToken||void 0,T.accessToken=_.accessToken||void 0,T.secret=_.secret,T.nonce=_.nonce,T.pendingToken=_.pendingToken||null,T}_getIdTokenResponse(a){return mn(a,this.buildRequest())}_linkToIdToken(a,u){const h=this.buildRequest();return h.idToken=u,mn(a,h)}_getReauthenticationResolver(a){const u=this.buildRequest();return u.autoCreate=!1,mn(a,u)}buildRequest(){const a={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{const u={};this.idToken&&(u.id_token=this.idToken),this.accessToken&&(u.access_token=this.accessToken),this.secret&&(u.oauth_token_secret=this.secret),u.providerId=this.providerId,this.nonce&&!this.pendingToken&&(u.nonce=this.nonce),a.postBody=(0,I.Am)(u)}return a}}function Ji(){return(Ji=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:sendVerificationCode",R(l,a))})).apply(this,arguments)}function Gs(){return(Gs=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithPhoneNumber",R(l,a))})).apply(this,arguments)}function $s(){return($s=(0,m.A)(function*(l,a){const u=yield re(l,"POST","/v1/accounts:signInWithPhoneNumber",R(l,a));if(u.temporaryProof)throw Vt(l,"account-exists-with-different-credential",u);return u})).apply(this,arguments)}const bh={USER_NOT_FOUND:"user-not-found"};function js(){return(js=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithPhoneNumber",R(l,Object.assign(Object.assign({},a),{operation:"REAUTH"})),bh)})).apply(this,arguments)}class Nn extends xr{constructor(a){super("phone","phone"),this.params=a}static _fromVerification(a,u){return new Nn({verificationId:a,verificationCode:u})}static _fromTokenResponse(a,u){return new Nn({phoneNumber:a,temporaryProof:u})}_getIdTokenResponse(a){return function La(l,a){return Gs.apply(this,arguments)}(a,this._makeVerificationRequest())}_linkToIdToken(a,u){return function xl(l,a){return $s.apply(this,arguments)}(a,Object.assign({idToken:u},this._makeVerificationRequest()))}_getReauthenticationResolver(a){return function Yi(l,a){return js.apply(this,arguments)}(a,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:a,phoneNumber:u,verificationId:h,verificationCode:p}=this.params;return a&&u?{temporaryProof:a,phoneNumber:u}:{sessionInfo:h,code:p}}toJSON(){const a={providerId:this.providerId};return this.params.phoneNumber&&(a.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(a.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(a.verificationCode=this.params.verificationCode),this.params.verificationId&&(a.verificationId=this.params.verificationId),a}static fromJSON(a){"string"==typeof a&&(a=JSON.parse(a));const{verificationId:u,verificationCode:h,phoneNumber:p,temporaryProof:_}=a;return h||u||p||_?new Nn({verificationId:u,verificationCode:h,phoneNumber:p,temporaryProof:_}):null}}class Mr{constructor(a){var u,h,p,_,T,S;const L=(0,I.I9)((0,I.hp)(a)),ee=null!==(u=L.apiKey)&&void 0!==u?u:null,se=null!==(h=L.oobCode)&&void 0!==h?h:null,ve=function Xi(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=L.mode)&&void 0!==p?p:null);K(ee&&se&&ve,"argument-error"),this.apiKey=ee,this.operation=ve,this.code=se,this.continueUrl=null!==(_=L.continueUrl)&&void 0!==_?_:null,this.languageCode=null!==(T=L.languageCode)&&void 0!==T?T:null,this.tenantId=null!==(S=L.tenantId)&&void 0!==S?S:null}static parseLink(a){const u=function Lr(l){const a=(0,I.I9)((0,I.hp)(l)).link,u=a?(0,I.I9)((0,I.hp)(a)).deep_link_id:null,h=(0,I.I9)((0,I.hp)(l)).deep_link_id;return(h?(0,I.I9)((0,I.hp)(h)).link:null)||h||u||a||l}(a);try{return new Mr(u)}catch{return null}}}let Ma=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(u,h){return Vr._fromEmailAndPassword(u,h)}static credentialWithLink(u,h){const p=Mr.parseLink(h);return K(p,"argument-error"),Vr._fromEmailAndCode(u,p.code,p.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class Vn{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class Fr extends Vn{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class Zi extends Fr{static credentialFromJSON(a){const u="string"==typeof a?JSON.parse(a):a;return K("providerId"in u&&"signInMethod"in u,"argument-error"),kn._fromParams(u)}credential(a){return this._credential(Object.assign(Object.assign({},a),{nonce:a.rawNonce}))}_credential(a){return K(a.idToken||a.accessToken,"argument-error"),kn._fromParams(Object.assign(Object.assign({},a),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(a){return Zi.oauthCredentialFromTaggedObject(a)}static credentialFromError(a){return Zi.oauthCredentialFromTaggedObject(a.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:u,oauthAccessToken:h,oauthTokenSecret:p,pendingToken:_,nonce:T,providerId:S}=a;if(!h&&!p&&!u&&!_||!S)return null;try{return new Zi(S)._credential({idToken:u,accessToken:h,nonce:T,pendingToken:_})}catch{return null}}}let Ur=(()=>{class l extends Fr{constructor(){super("facebook.com")}static credential(u){return kn._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return l.credential(u.oauthAccessToken)}catch{return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),Qn=(()=>{class l extends Fr{constructor(){super("google.com"),this.addScope("profile")}static credential(u,h){return kn._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:u,accessToken:h})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthIdToken:h,oauthAccessToken:p}=u;if(!h&&!p)return null;try{return l.credential(h,p)}catch{return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),Hs=(()=>{class l extends Fr{constructor(){super("github.com")}static credential(u){return kn._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return l.credential(u.oauthAccessToken)}catch{return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class Br extends xr{constructor(a,u){super(a,a),this.pendingToken=u}_getIdTokenResponse(a){return mn(a,this.buildRequest())}_linkToIdToken(a,u){const h=this.buildRequest();return h.idToken=u,mn(a,h)}_getReauthenticationResolver(a){const u=this.buildRequest();return u.autoCreate=!1,mn(a,u)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(a){const u="string"==typeof a?JSON.parse(a):a,{providerId:h,signInMethod:p,pendingToken:_}=u;return h&&p&&_&&h===p?new Br(h,_):null}static _create(a,u){return new Br(a,u)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class qr extends Vn{constructor(a){K(a.startsWith("saml."),"argument-error"),super(a)}static credentialFromResult(a){return qr.samlCredentialFromTaggedObject(a)}static credentialFromError(a){return qr.samlCredentialFromTaggedObject(a.customData||{})}static credentialFromJSON(a){const u=Br.fromJSON(a);return K(u,"argument-error"),u}static samlCredentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{pendingToken:u,providerId:h}=a;if(!u||!h)return null;try{return Br._create(h,u)}catch{return null}}}let es=(()=>{class l extends Fr{constructor(){super("twitter.com")}static credential(u,h){return kn._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:u,oauthTokenSecret:h})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthAccessToken:h,oauthTokenSecret:p}=u;if(!h||!p)return null;try{return l.credential(h,p)}catch{return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function mi(l,a){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signUp",R(l,a))})).apply(this,arguments)}class on{constructor(a){this.user=a.user,this.providerId=a.providerId,this._tokenResponse=a._tokenResponse,this.operationType=a.operationType}static _fromIdTokenResponse(a,u,h,p=!1){return(0,m.A)(function*(){const _=yield k._fromIdTokenResponse(a,h,p),T=Dl(h);return new on({user:_,providerId:T,_tokenResponse:h,operationType:u})})()}static _forOperation(a,u,h){return(0,m.A)(function*(){yield a._updateTokensIfNecessary(h,!0);const p=Dl(h);return new on({user:a,providerId:p,_tokenResponse:h,operationType:u})})()}}function Dl(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function Ch(l){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,m.A)(function*(l){var a;if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const u=Ge(l);if(yield u._initializationPromise,null!==(a=u.currentUser)&&void 0!==a&&a.isAnonymous)return new on({user:u.currentUser,providerId:null,operationType:"signIn"});const h=yield mi(u,{returnSecureToken:!0}),p=yield on._fromIdTokenResponse(u,"signIn",h,!0);return yield u._updateCurrentUser(p.user),p})).apply(this,arguments)}class Js extends I.g{constructor(a,u,h,p){var _;super(u.code,u.message),this.operationType=h,this.user=p,Object.setPrototypeOf(this,Js.prototype),this.customData={appName:a.name,tenantId:null!==(_=a.tenantId)&&void 0!==_?_:void 0,_serverResponse:u.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(a,u,h,p){return new Js(a,u,h,p)}}function gi(l,a,u,h){return("reauthenticate"===a?u._getReauthenticationResolver(l):u._getIdTokenResponse(l)).catch(_=>{throw"auth/multi-factor-auth-required"===_.code?Js._fromErrorAndOperation(l,_,a,h):_})}function Jn(l){return new Set(l.map(({providerId:a})=>a).filter(a=>!!a))}function kl(l,a){return Ys.apply(this,arguments)}function Ys(){return Ys=(0,m.A)(function*(l,a){const u=(0,I.Ku)(l);yield Zs(!0,u,a);const{providerUserInfo:h}=yield function Sr(l,a){return zn.apply(this,arguments)}(u.auth,{idToken:yield u.getIdToken(),deleteProvider:[a]}),p=Jn(h||[]);return u.providerData=u.providerData.filter(_=>p.has(_.providerId)),p.has("phone")||(u.phoneNumber=null),yield u.auth._persistUserIfCurrent(u),u}),Ys.apply(this,arguments)}function Xs(l,a){return ur.apply(this,arguments)}function ur(){return(ur=(0,m.A)(function*(l,a,u=!1){const h=yield Le(l,a._linkToIdToken(l.auth,yield l.getIdToken()),u);return on._forOperation(l,"link",h)})).apply(this,arguments)}function Zs(l,a,u){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,m.A)(function*(l,a,u){yield Me(a);const p=!1===l?"provider-already-linked":"no-such-provider";K(Jn(a.providerData).has(u)===l,a.auth,p)})).apply(this,arguments)}function qa(l,a){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,m.A)(function*(l,a,u=!1){const{auth:h}=l;if((0,D._isFirebaseServerApp)(h.app))return Promise.reject(ut(h));const p="reauthenticate";try{const _=yield Le(l,gi(h,p,a,l),u);K(_.idToken,h,"internal-error");const T=$n(_.idToken);K(T,h,"internal-error");const{sub:S}=T;return K(l.uid===S,h,"user-mismatch"),on._forOperation(l,p,_)}catch(_){throw"auth/user-not-found"===(null==_?void 0:_.code)&&Oe(h,"user-mismatch"),_}})).apply(this,arguments)}function Ka(l,a){return eo.apply(this,arguments)}function eo(){return(eo=(0,m.A)(function*(l,a,u=!1){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const h="signIn",p=yield gi(l,h,a),_=yield on._fromIdTokenResponse(l,h,p);return u||(yield l._updateCurrentUser(_.user)),_})).apply(this,arguments)}function _i(l,a){return ts.apply(this,arguments)}function ts(){return(ts=(0,m.A)(function*(l,a){return Ka(Ge(l),a)})).apply(this,arguments)}function za(l,a){return to.apply(this,arguments)}function to(){return(to=(0,m.A)(function*(l,a){const u=(0,I.Ku)(l);return yield Zs(!1,u,a.providerId),Xs(u,a)})).apply(this,arguments)}function Nl(l,a){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,m.A)(function*(l,a){return qa((0,I.Ku)(l),a)})).apply(this,arguments)}function $a(){return($a=(0,m.A)(function*(l,a){return re(l,"POST","/v1/accounts:signInWithCustomToken",R(l,a))})).apply(this,arguments)}function no(l,a){return Wr.apply(this,arguments)}function Wr(){return Wr=(0,m.A)(function*(l,a){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const u=Ge(l),h=yield function xh(l,a){return $a.apply(this,arguments)}(u,{token:a,returnSecureToken:!0}),p=yield on._fromIdTokenResponse(u,"signIn",h);return yield u._updateCurrentUser(p.user),p}),Wr.apply(this,arguments)}class lr{constructor(a,u){this.factorId=a,this.uid=u.mfaEnrollmentId,this.enrollmentTime=new Date(u.enrolledAt).toUTCString(),this.displayName=u.displayName}static _fromServerResponse(a,u){return"phoneInfo"in u?ns._fromServerResponse(a,u):"totpInfo"in u?ro._fromServerResponse(a,u):Oe(a,"internal-error")}}class ns extends lr{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,u){return new ns(u)}}class ro extends lr{constructor(a){super("totp",a)}static _fromServerResponse(a,u){return new ro(u)}}function cr(l,a,u){var h;K((null===(h=u.url)||void 0===h?void 0:h.length)>0,l,"invalid-continue-uri"),K(typeof u.dynamicLinkDomain>"u"||u.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),a.continueUrl=u.url,a.dynamicLinkDomain=u.dynamicLinkDomain,a.canHandleCodeInApp=u.handleCodeInApp,u.iOS&&(K(u.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),a.iOSBundleId=u.iOS.bundleId),u.android&&(K(u.android.packageName.length>0,l,"missing-android-pkg-name"),a.androidInstallApp=u.android.installApp,a.androidMinimumVersionCode=u.android.minimumVersion,a.androidPackageName=u.android.packageName)}function Kr(l){return ja.apply(this,arguments)}function ja(){return(ja=(0,m.A)(function*(l){const a=Ge(l);a._getPasswordPolicyInternal()&&(yield a._updatePasswordPolicy())})).apply(this,arguments)}function st(l,a,u){return io.apply(this,arguments)}function io(){return(io=(0,m.A)(function*(l,a,u){const h=Ge(l),p={requestType:"PASSWORD_RESET",email:a,clientType:"CLIENT_TYPE_WEB"};u&&cr(h,p,u),yield jn(h,p,"getOobCode",Pl)})).apply(this,arguments)}function Dh(l,a,u){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,m.A)(function*(l,a,u){yield Da((0,I.Ku)(l),{oobCode:a,newPassword:u}).catch(function(){var h=(0,m.A)(function*(p){throw"auth/password-does-not-meet-requirements"===p.code&&Kr(l),p});return function(p){return h.apply(this,arguments)}}())}),Ha.apply(this,arguments)}function kh(l,a){return so.apply(this,arguments)}function so(){return so=(0,m.A)(function*(l,a){yield function Sh(l,a){return Hn.apply(this,arguments)}((0,I.Ku)(l),{oobCode:a})}),so.apply(this,arguments)}function Qa(l,a){return oo.apply(this,arguments)}function oo(){return(oo=(0,m.A)(function*(l,a){const u=(0,I.Ku)(l),h=yield Da(u,{oobCode:a}),p=h.requestType;switch(K(p,u,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":K(h.newEmail,u,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":K(h.mfaInfo,u,"internal-error");default:K(h.email,u,"internal-error")}let _=null;return h.mfaInfo&&(_=lr._fromServerResponse(Ge(u),h.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.newEmail:h.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.email:h.newEmail)||null,multiFactorInfo:_},operation:p}})).apply(this,arguments)}function ao(l,a){return uo.apply(this,arguments)}function uo(){return(uo=(0,m.A)(function*(l,a){const{data:u}=yield Qa((0,I.Ku)(l),a);return u.email})).apply(this,arguments)}function On(l,a,u){return lo.apply(this,arguments)}function lo(){return(lo=(0,m.A)(function*(l,a,u){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const h=Ge(l),T=yield jn(h,{returnSecureToken:!0,email:a,password:u,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",mi).catch(L=>{throw"auth/password-does-not-meet-requirements"===L.code&&Kr(l),L}),S=yield on._fromIdTokenResponse(h,"signIn",T);return yield h._updateCurrentUser(S.user),S})).apply(this,arguments)}function Nh(l,a,u){return(0,D._isFirebaseServerApp)(l.app)?Promise.reject(ut(l)):_i((0,I.Ku)(l),Ma.credential(a,u)).catch(function(){var h=(0,m.A)(function*(p){throw"auth/password-does-not-meet-requirements"===p.code&&Kr(l),p});return function(p){return h.apply(this,arguments)}}())}function Vl(l,a,u){return rs.apply(this,arguments)}function rs(){return(rs=(0,m.A)(function*(l,a,u){const h=Ge(l),p={requestType:"EMAIL_SIGNIN",email:a,clientType:"CLIENT_TYPE_WEB"};(function _(T,S){K(S.handleCodeInApp,h,"argument-error"),S&&cr(h,T,S)})(p,u),yield jn(h,p,"getOobCode",Ws)})).apply(this,arguments)}function is(l,a){const u=Mr.parseLink(a);return"EMAIL_SIGNIN"===(null==u?void 0:u.operation)}function Ol(l,a,u){return ss.apply(this,arguments)}function ss(){return(ss=(0,m.A)(function*(l,a,u){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const h=(0,I.Ku)(l),p=Ma.credentialWithLink(a,u||pn());return K(p._tenantId===(h.tenantId||null),h,"tenant-id-mismatch"),_i(h,p)})).apply(this,arguments)}function ho(){return(ho=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:createAuthUri",R(l,a))})).apply(this,arguments)}function fo(l,a){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,m.A)(function*(l,a){const h={identifier:a,continueUri:Gt()?pn():"http://localhost"},{signinMethods:p}=yield function co(l,a){return ho.apply(this,arguments)}((0,I.Ku)(l),h);return p||[]}),Ja.apply(this,arguments)}function Ll(l,a){return zr.apply(this,arguments)}function zr(){return zr=(0,m.A)(function*(l,a){const u=(0,I.Ku)(l),p={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};a&&cr(u.auth,p,a);const{email:_}=yield function Rl(l,a){return Dt.apply(this,arguments)}(u.auth,p);_!==l.email&&(yield l.reload())}),zr.apply(this,arguments)}function Ml(l,a,u){return po.apply(this,arguments)}function po(){return po=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l),_={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:a};u&&cr(h.auth,_,u);const{email:T}=yield function Va(l,a){return zs.apply(this,arguments)}(h.auth,_);T!==l.email&&(yield l.reload())}),po.apply(this,arguments)}function os(){return(os=(0,m.A)(function*(l,a){return x(l,"POST","/v1/accounts:update",a)})).apply(this,arguments)}function Fl(l,a){return yi.apply(this,arguments)}function yi(){return yi=(0,m.A)(function*(l,{displayName:a,photoURL:u}){if(void 0===a&&void 0===u)return;const h=(0,I.Ku)(l),_={idToken:yield h.getIdToken(),displayName:a,photoUrl:u,returnSecureToken:!0},T=yield Le(h,function Ya(l,a){return os.apply(this,arguments)}(h.auth,_));h.displayName=T.displayName||null,h.photoURL=T.photoUrl||null;const S=h.providerData.find(({providerId:L})=>"password"===L);S&&(S.displayName=h.displayName,S.photoURL=h.photoURL),yield h._updateTokensIfNecessary(T)}),yi.apply(this,arguments)}function Ul(l,a){const u=(0,I.Ku)(l);return(0,D._isFirebaseServerApp)(u.auth.app)?Promise.reject(ut(u.auth)):hr(u,a,null)}function Bl(l,a){return hr((0,I.Ku)(l),null,a)}function hr(l,a,u){return mo.apply(this,arguments)}function mo(){return mo=(0,m.A)(function*(l,a,u){const{auth:h}=l,_={idToken:yield l.getIdToken(),returnSecureToken:!0};a&&(_.email=a),u&&(_.password=u);const T=yield Le(l,function Ph(l,a){return ka.apply(this,arguments)}(h,_));yield l._updateTokensIfNecessary(T,!0)}),mo.apply(this,arguments)}class Gr{constructor(a,u,h={}){this.isNewUser=a,this.providerId=u,this.profile=h}}class Xa extends Gr{constructor(a,u,h,p){super(a,u,h),this.username=p}}class go extends Gr{constructor(a,u){super(a,"facebook.com",u)}}class an extends Xa{constructor(a,u){super(a,"github.com",u,"string"==typeof(null==u?void 0:u.login)?null==u?void 0:u.login:null)}}class Wl extends Gr{constructor(a,u){super(a,"google.com",u)}}class Kl extends Xa{constructor(a,u,h){super(a,"twitter.com",u,h)}}function Ii(l){const{user:a,_tokenResponse:u}=l;return a.isAnonymous&&!u?{providerId:null,isNewUser:!1,profile:null}:function ql(l){var a,u;if(!l)return null;const{providerId:h}=l,p=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},_=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!h&&null!=l&&l.idToken){const T=null===(u=null===(a=$n(l.idToken))||void 0===a?void 0:a.firebase)||void 0===u?void 0:u.sign_in_provider;if(T)return new Gr(_,"anonymous"!==T&&"custom"!==T?T:null)}if(!h)return null;switch(h){case"facebook.com":return new go(_,p);case"github.com":return new an(_,p);case"google.com":return new Wl(_,p);case"twitter.com":return new Kl(_,p,l.screenName||null);case"custom":case"anonymous":return new Gr(_,null);default:return new Gr(_,h,p)}}(u)}class Et{constructor(a,u,h){this.type=a,this.credential=u,this.user=h}static _fromIdtoken(a,u){return new Et("enroll",a,u)}static _fromMfaPendingCredential(a){return new Et("signin",a)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(a){var u,h;if(null!=a&&a.multiFactorSession){if(null!==(u=a.multiFactorSession)&&void 0!==u&&u.pendingCredential)return Et._fromMfaPendingCredential(a.multiFactorSession.pendingCredential);if(null!==(h=a.multiFactorSession)&&void 0!==h&&h.idToken)return Et._fromIdtoken(a.multiFactorSession.idToken)}return null}}class mt{constructor(a,u,h){this.session=a,this.hints=u,this.signInResolver=h}static _fromError(a,u){const h=Ge(a),p=u.customData._serverResponse,_=(p.mfaInfo||[]).map(S=>lr._fromServerResponse(h,S));K(p.mfaPendingCredential,h,"internal-error");const T=Et._fromMfaPendingCredential(p.mfaPendingCredential);return new mt(T,_,function(){var S=(0,m.A)(function*(L){const ee=yield L._process(h,T);delete p.mfaInfo,delete p.mfaPendingCredential;const se=Object.assign(Object.assign({},p),{idToken:ee.idToken,refreshToken:ee.refreshToken});switch(u.operationType){case"signIn":const ve=yield on._fromIdTokenResponse(h,u.operationType,se);return yield h._updateCurrentUser(ve.user),ve;case"reauthenticate":return K(u.user,h,"internal-error"),on._forOperation(u.user,u.operationType,se);default:Oe(h,"internal-error")}});return function(L){return S.apply(this,arguments)}}())}resolveSignIn(a){var u=this;return(0,m.A)(function*(){return u.signInResolver(a)})()}}function _o(l,a){var u;const h=(0,I.Ku)(l),p=a;return K(a.customData.operationType,h,"argument-error"),K(null===(u=p.customData._serverResponse)||void 0===u?void 0:u.mfaPendingCredential,h,"argument-error"),mt._fromError(h,p)}class tu{constructor(a){this.user=a,this.enrolledFactors=[],a._onReload(u=>{u.mfaInfo&&(this.enrolledFactors=u.mfaInfo.map(h=>lr._fromServerResponse(a.auth,h)))})}static _fromUser(a){return new tu(a)}getSession(){var a=this;return(0,m.A)(function*(){return Et._fromIdtoken(yield a.user.getIdToken(),a.user)})()}enroll(a,u){var h=this;return(0,m.A)(function*(){const p=a,_=yield h.getSession(),T=yield Le(h.user,p._process(h.user.auth,_,u));return yield h.user._updateTokensIfNecessary(T),h.user.reload()})()}unenroll(a){var u=this;return(0,m.A)(function*(){const h="string"==typeof a?a:a.uid,p=yield u.user.getIdToken();try{const _=yield Le(u.user,function vi(l,a){return x(l,"POST","/v2/accounts/mfaEnrollment:withdraw",R(l,a))}(u.user.auth,{idToken:p,mfaEnrollmentId:h}));u.enrolledFactors=u.enrolledFactors.filter(({uid:T})=>T!==h),yield u.user._updateTokensIfNecessary(_),yield u.user.reload()}catch(_){throw _}})()}}const nu=new WeakMap;function ru(l){const a=(0,I.Ku)(l);return nu.has(a)||nu.set(a,tu._fromUser(a)),nu.get(a)}const Io="__sak";class Hl{constructor(a,u){this.storageRetriever=a,this.type=u}_isAvailable(){try{return this.storage?(this.storage.setItem(Io,"1"),this.storage.removeItem(Io),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(a,u){return this.storage.setItem(a,JSON.stringify(u)),Promise.resolve()}_get(a){const u=this.storage.getItem(a);return Promise.resolve(u?JSON.parse(u):null)}_remove(a){return this.storage.removeItem(a),Promise.resolve()}get storage(){return this.storageRetriever()}}const Jl=(()=>{class l extends Hl{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(u,h)=>this.onStorageEvent(u,h),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Ql(){const l=(0,I.ZQ)();return jt(l)||br(l)}()&&function fl(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Ra(),this._shouldAllowMigration=!0}forAllChangedKeys(u){for(const h of Object.keys(this.listeners)){const p=this.storage.getItem(h),_=this.localCache[h];p!==_&&u(h,_,p)}}onStorageEvent(u,h=!1){if(!u.key)return void this.forAllChangedKeys((S,L,ee)=>{this.notifyListeners(S,ee)});const p=u.key;if(h?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const S=this.storage.getItem(p);if(u.newValue!==S)null!==u.newValue?this.storage.setItem(p,u.newValue):this.storage.removeItem(p);else if(this.localCache[p]===u.newValue&&!h)return}const _=()=>{const S=this.storage.getItem(p);!h&&this.localCache[p]===S||this.notifyListeners(p,S)},T=this.storage.getItem(p);!function wa(){return(0,I.lT)()&&10===document.documentMode}()||T===u.newValue||u.newValue===u.oldValue?_():setTimeout(_,10)}notifyListeners(u,h){this.localCache[u]=h;const p=this.listeners[u];if(p)for(const _ of Array.from(p))_(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((u,h,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:u,oldValue:h,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(u,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[u]||(this.listeners[u]=new Set,this.localCache[u]=this.storage.getItem(u)),this.listeners[u].add(h)}_removeListener(u,h){this.listeners[u]&&(this.listeners[u].delete(h),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(u,h){var p=()=>super._set,_=this;return(0,m.A)(function*(){yield p().call(_,u,h),_.localCache[u]=JSON.stringify(h)})()}_get(u){var h=()=>super._get,p=this;return(0,m.A)(function*(){const _=yield h().call(p,u);return p.localCache[u]=JSON.stringify(_),_})()}_remove(u){var h=()=>super._remove,p=this;return(0,m.A)(function*(){yield h().call(p,u),delete p.localCache[u]})()}}return l.type="LOCAL",l})(),Eo=(()=>{class l extends Hl{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(u,h){}_removeListener(u,h){}}return l.type="SESSION",l})();let Ei=(()=>{class l{constructor(u){this.eventTarget=u,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(u){const h=this.receivers.find(_=>_.isListeningto(u));if(h)return h;const p=new l(u);return this.receivers.push(p),p}isListeningto(u){return this.eventTarget===u}handleEvent(u){var h=this;return(0,m.A)(function*(){const p=u,{eventId:_,eventType:T,data:S}=p.data,L=h.handlersMap[T];if(null==L||!L.size)return;p.ports[0].postMessage({status:"ack",eventId:_,eventType:T});const ee=Array.from(L).map(function(){var ve=(0,m.A)(function*(Mt){return Mt(p.origin,S)});return function(Mt){return ve.apply(this,arguments)}}()),se=yield function Tt(l){return Promise.all(l.map(function(){var a=(0,m.A)(function*(u){try{return{fulfilled:!0,value:yield u}}catch(h){return{fulfilled:!1,reason:h}}});return function(u){return a.apply(this,arguments)}}()))}(ee);p.ports[0].postMessage({status:"done",eventId:_,eventType:T,response:se})})()}_subscribe(u,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[u]||(this.handlersMap[u]=new Set),this.handlersMap[u].add(h)}_unsubscribe(u,h){this.handlersMap[u]&&h&&this.handlersMap[u].delete(h),(!h||0===this.handlersMap[u].size)&&delete this.handlersMap[u],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function gn(l="",a=10){let u="";for(let h=0;h<a;h++)u+=Math.floor(10*Math.random());return l+u}class Ti{constructor(a){this.target=a,this.handlers=new Set}removeMessageHandler(a){a.messageChannel&&(a.messageChannel.port1.removeEventListener("message",a.onMessage),a.messageChannel.port1.close()),this.handlers.delete(a)}_send(a,u,h=50){var p=this;return(0,m.A)(function*(){const _=typeof MessageChannel<"u"?new MessageChannel:null;if(!_)throw new Error("connection_unavailable");let T,S;return new Promise((L,ee)=>{const se=gn("",20);_.port1.start();const ve=setTimeout(()=>{ee(new Error("unsupported_event"))},h);S={messageChannel:_,onMessage(Mt){const Yt=Mt;if(Yt.data.eventId===se)switch(Yt.data.status){case"ack":clearTimeout(ve),T=setTimeout(()=>{ee(new Error("timeout"))},3e3);break;case"done":clearTimeout(T),L(Yt.data.response);break;default:clearTimeout(ve),clearTimeout(T),ee(new Error("invalid_response"))}}},p.handlers.add(S),_.port1.addEventListener("message",S.onMessage),p.target.postMessage({eventType:a,eventId:se,data:u},[_.port2])}).finally(()=>{S&&p.removeMessageHandler(S)})})()}}function ht(){return window}function et(){return typeof ht().WorkerGlobalScope<"u"&&"function"==typeof ht().importScripts}function cs(){return(cs=(0,m.A)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const Yl="firebaseLocalStorageDb",b="firebaseLocalStorage",O="fbase_key";class tt{constructor(a){this.request=a}toPromise(){return new Promise((a,u)=>{this.request.addEventListener("success",()=>{a(this.request.result)}),this.request.addEventListener("error",()=>{u(this.request.error)})})}}function hs(l,a){return l.transaction([b],a?"readwrite":"readonly").objectStore(b)}function iu(){const l=indexedDB.open(Yl,1);return new Promise((a,u)=>{l.addEventListener("error",()=>{u(l.error)}),l.addEventListener("upgradeneeded",()=>{const h=l.result;try{h.createObjectStore(b,{keyPath:O})}catch(p){u(p)}}),l.addEventListener("success",(0,m.A)(function*(){const h=l.result;h.objectStoreNames.contains(b)?a(h):(h.close(),yield function Fh(){const l=indexedDB.deleteDatabase(Yl);return new tt(l).toPromise()}(),a(yield iu()))}))})}function Xl(l,a,u){return su.apply(this,arguments)}function su(){return(su=(0,m.A)(function*(l,a,u){const h=hs(l,!0).put({[O]:a,value:u});return new tt(h).toPromise()})).apply(this,arguments)}function To(){return(To=(0,m.A)(function*(l,a){const u=hs(l,!1).get(a),h=yield new tt(u).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function Zl(l,a){const u=hs(l,!0).delete(a);return new tt(u).toPromise()}const he=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var u=this;return(0,m.A)(function*(){return u.db||(u.db=yield iu()),u.db})()}_withRetries(u){var h=this;return(0,m.A)(function*(){let p=0;for(;;)try{const _=yield h._openDb();return yield u(_)}catch(_){if(p++>3)throw _;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var u=this;return(0,m.A)(function*(){return et()?u.initializeReceiver():u.initializeSender()})()}initializeReceiver(){var u=this;return(0,m.A)(function*(){u.receiver=Ei._getInstance(function ne(){return et()?self:null}()),u.receiver._subscribe("keyChanged",function(){var h=(0,m.A)(function*(p,_){return{keyProcessed:(yield u._poll()).includes(_.key)}});return function(p,_){return h.apply(this,arguments)}}()),u.receiver._subscribe("ping",function(){var h=(0,m.A)(function*(p,_){return["keyChanged"]});return function(p,_){return h.apply(this,arguments)}}())})()}initializeSender(){var u=this;return(0,m.A)(function*(){var h,p;if(u.activeServiceWorker=yield function Ht(){return cs.apply(this,arguments)}(),!u.activeServiceWorker)return;u.sender=new Ti(u.activeServiceWorker);const _=yield u.sender._send("ping",{},800);_&&null!==(h=_[0])&&void 0!==h&&h.fulfilled&&null!==(p=_[0])&&void 0!==p&&p.value.includes("keyChanged")&&(u.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(u){var h=this;return(0,m.A)(function*(){if(h.sender&&h.activeServiceWorker&&function Z(){var l;return(null===(l=null==navigator?void 0:navigator.serviceWorker)||void 0===l?void 0:l.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:u},h.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,m.A)(function*(){try{if(!indexedDB)return!1;const u=yield iu();return yield Xl(u,Io,"1"),yield Zl(u,Io),!0}catch{}return!1})()}_withPendingWrite(u){var h=this;return(0,m.A)(function*(){h.pendingWrites++;try{yield u()}finally{h.pendingWrites--}})()}_set(u,h){var p=this;return(0,m.A)(function*(){return p._withPendingWrite((0,m.A)(function*(){return yield p._withRetries(_=>Xl(_,u,h)),p.localCache[u]=h,p.notifyServiceWorker(u)}))})()}_get(u){var h=this;return(0,m.A)(function*(){const p=yield h._withRetries(_=>function Uh(l,a){return To.apply(this,arguments)}(_,u));return h.localCache[u]=p,p})()}_remove(u){var h=this;return(0,m.A)(function*(){return h._withPendingWrite((0,m.A)(function*(){return yield h._withRetries(p=>Zl(p,u)),delete h.localCache[u],h.notifyServiceWorker(u)}))})()}_poll(){var u=this;return(0,m.A)(function*(){const h=yield u._withRetries(T=>{const S=hs(T,!1).getAll();return new tt(S).toPromise()});if(!h)return[];if(0!==u.pendingWrites)return[];const p=[],_=new Set;if(0!==h.length)for(const{fbase_key:T,value:S}of h)_.add(T),JSON.stringify(u.localCache[T])!==JSON.stringify(S)&&(u.notifyListeners(T,S),p.push(T));for(const T of Object.keys(u.localCache))u.localCache[T]&&!_.has(T)&&(u.notifyListeners(T,null),p.push(T));return p})()}notifyListeners(u,h){this.localCache[u]=h;const p=this.listeners[u];if(p)for(const _ of Array.from(p))_(h)}startPolling(){var u=this;this.stopPolling(),this.pollTimer=setInterval((0,m.A)(function*(){return u._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(u,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[u]||(this.listeners[u]=new Set,this._get(u)),this.listeners[u].add(h)}_removeListener(u,h){this.listeners[u]&&(this.listeners[u].delete(h),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})(),Ie=1e12;class Wh{constructor(a){this.auth=a,this.counter=Ie,this._widgets=new Map}render(a,u){const h=this.counter;return this._widgets.set(h,new je(a,this.auth.name,u||{})),this.counter++,h}reset(a){var u;const h=a||Ie;null===(u=this._widgets.get(h))||void 0===u||u.delete(),this._widgets.delete(h)}getResponse(a){var u;return(null===(u=this._widgets.get(a||Ie))||void 0===u?void 0:u.getResponse())||""}execute(a){var u=this;return(0,m.A)(function*(){var h;return null===(h=u._widgets.get(a||Ie))||void 0===h||h.execute(),""})()}}class je{constructor(a,u,h){this.params=h,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof a?document.getElementById(a):a;K(p,"argument-error",{appName:u}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Q(l){const a=[],u="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<l;h++)a.push(u.charAt(Math.floor(62*Math.random())));return a.join("")}(50);const{callback:a,"expired-callback":u}=this.params;if(a)try{a(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,u)try{u()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const dr=yl("rcb"),ou=new Wn(3e4,6e4);class $r{constructor(){var a;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(a=ht().grecaptcha)||void 0===a||!a.render)}load(a,u=""){return K(function Kh(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(u),a,"argument-error"),this.shouldResolveImmediately(u)&&ct(ht().grecaptcha)?Promise.resolve(ht().grecaptcha):new Promise((h,p)=>{const _=ht().setTimeout(()=>{p(qe(a,"network-request-failed"))},ou.get());ht()[dr]=()=>{ht().clearTimeout(_),delete ht()[dr];const S=ht().grecaptcha;if(!S||!ct(S))return void p(qe(a,"internal-error"));const L=S.render;S.render=(ee,se)=>{const ve=L(ee,se);return this.counter++,ve},this.hostLanguage=u,h(S)},ci(`${function Sa(){return it.recaptchaV2Script}()}?${(0,I.Am)({onload:dr,render:"explicit",hl:u})}`).catch(()=>{clearTimeout(_),p(qe(a,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(a){var u;return!(null===(u=ht().grecaptcha)||void 0===u||!u.render)&&(a===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class jr{load(a){return(0,m.A)(function*(){return new Wh(a)})()}clearedOneInstance(){}}const tc="recaptcha",wi={theme:"light",type:"image"};class nc{constructor(a,u,h=Object.assign({},wi)){this.parameters=h,this.type=tc,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ge(a),this.isInvisible="invisible"===this.parameters.size,K(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof u?document.getElementById(u):u;K(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new jr:new $r,this.validateStartingState()}verify(){var a=this;return(0,m.A)(function*(){a.assertNotDestroyed();const u=yield a.render(),h=a.getAssertedRecaptcha();return h.getResponse(u)||new Promise(_=>{const T=S=>{S&&(a.tokenChangeListeners.delete(T),_(S))};a.tokenChangeListeners.add(T),a.isInvisible&&h.execute(u)})})()}render(){try{this.assertNotDestroyed()}catch(a){return Promise.reject(a)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(a=>{throw this.renderPromise=null,a})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(a=>{this.container.removeChild(a)})}validateStartingState(){K(!this.parameters.sitekey,this.auth,"argument-error"),K(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),K(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(a){return u=>{if(this.tokenChangeListeners.forEach(h=>h(u)),"function"==typeof a)a(u);else if("string"==typeof a){const h=ht()[a];"function"==typeof h&&h(u)}}}assertNotDestroyed(){K(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var a=this;return(0,m.A)(function*(){if(yield a.init(),!a.widgetId){let u=a.container;if(!a.isInvisible){const h=document.createElement("div");u.appendChild(h),u=h}a.widgetId=a.getAssertedRecaptcha().render(u,a.parameters)}return a.widgetId})()}init(){var a=this;return(0,m.A)(function*(){K(Gt()&&!et(),a.auth,"internal-error"),yield function rc(){let l=null;return new Promise(a=>{"complete"!==document.readyState?(l=()=>a(),window.addEventListener("load",l)):a()}).catch(a=>{throw l&&window.removeEventListener("load",l),a})}(),a.recaptcha=yield a._recaptchaLoader.load(a.auth,a.auth.languageCode||void 0);const u=yield function ae(l){return xn.apply(this,arguments)}(a.auth);K(u,a.auth,"internal-error"),a.parameters.sitekey=u})()}getAssertedRecaptcha(){return K(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class qt{constructor(a,u){this.verificationId=a,this.onConfirmation=u}confirm(a){const u=Nn._fromVerification(this.verificationId,a);return this.onConfirmation(u)}}function au(l,a,u){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,m.A)(function*(l,a,u){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const h=Ge(l),p=yield Hr(h,a,(0,I.Ku)(u));return new qt(p,_=>_i(h,_))})).apply(this,arguments)}function ic(l,a,u){return Mn.apply(this,arguments)}function Mn(){return(Mn=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l);yield Zs(!1,h,"phone");const p=yield Hr(h.auth,a,(0,I.Ku)(u));return new qt(p,_=>za(h,_))})).apply(this,arguments)}function uu(l,a,u){return P.apply(this,arguments)}function P(){return(P=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l);if((0,D._isFirebaseServerApp)(h.auth.app))return Promise.reject(ut(h.auth));const p=yield Hr(h.auth,a,(0,I.Ku)(u));return new qt(p,_=>Nl(h,_))})).apply(this,arguments)}function Hr(l,a,u){return _n.apply(this,arguments)}function _n(){return _n=(0,m.A)(function*(l,a,u){var h;const p=yield u.verify();try{let _;if(K("string"==typeof p,l,"argument-error"),K(u.type===tc,l,"argument-error"),_="string"==typeof a?{phoneNumber:a}:a,"session"in _){const T=_.session;if("phoneNumber"in _)return K("enroll"===T.type,l,"internal-error"),(yield function yo(l,a){return x(l,"POST","/v2/accounts/mfaEnrollment:start",R(l,a))}(l,{idToken:T.credential,phoneEnrollmentInfo:{phoneNumber:_.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{K("signin"===T.type,l,"internal-error");const S=(null===(h=_.multiFactorHint)||void 0===h?void 0:h.uid)||_.multiFactorUid;return K(S,l,"missing-multi-factor-info"),(yield function Ai(l,a){return x(l,"POST","/v2/accounts/mfaSignIn:start",R(l,a))}(l,{mfaPendingCredential:T.credential,mfaEnrollmentId:S,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:T}=yield function Cl(l,a){return Ji.apply(this,arguments)}(l,{phoneNumber:_.phoneNumber,recaptchaToken:p});return T}}finally{u._reset()}}),_n.apply(this,arguments)}function sc(l,a){return lu.apply(this,arguments)}function lu(){return(lu=(0,m.A)(function*(l,a){const u=(0,I.Ku)(l);if((0,D._isFirebaseServerApp)(u.auth.app))return Promise.reject(ut(u.auth));yield Xs(u,a)})).apply(this,arguments)}let fs=(()=>{class l{constructor(u){this.providerId=l.PROVIDER_ID,this.auth=Ge(u)}verifyPhoneNumber(u,h){return Hr(this.auth,u,(0,I.Ku)(h))}static credential(u,h){return Nn._fromVerification(u,h)}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{phoneNumber:h,temporaryProof:p}=u;return h&&p?Nn._fromTokenResponse(h,p):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function Qt(l,a){return a?le(a):(K(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class cu extends xr{constructor(a){super("custom","custom"),this.params=a}_getIdTokenResponse(a){return mn(a,this._buildIdpRequest())}_linkToIdToken(a,u){return mn(a,this._buildIdpRequest(u))}_getReauthenticationResolver(a){return mn(a,this._buildIdpRequest())}_buildIdpRequest(a){const u={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return a&&(u.idToken=a),u}}function Qr(l){return Ka(l.auth,new cu(l),l.bypassAuthState)}function oc(l){const{auth:a,user:u}=l;return K(u,a,"internal-error"),qa(u,new cu(l),l.bypassAuthState)}function hu(l){return du.apply(this,arguments)}function du(){return(du=(0,m.A)(function*(l){const{auth:a,user:u}=l;return K(u,a,"internal-error"),Xs(u,new cu(l),l.bypassAuthState)})).apply(this,arguments)}class ac{constructor(a,u,h,p,_=!1){this.auth=a,this.resolver=h,this.user=p,this.bypassAuthState=_,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(u)?u:[u]}execute(){var a=this;return new Promise(function(){var u=(0,m.A)(function*(h,p){a.pendingPromise={resolve:h,reject:p};try{a.eventManager=yield a.resolver._initialize(a.auth),yield a.onExecution(),a.eventManager.registerConsumer(a)}catch(_){a.reject(_)}});return function(h,p){return u.apply(this,arguments)}}())}onAuthEvent(a){var u=this;return(0,m.A)(function*(){const{urlResponse:h,sessionId:p,postBody:_,tenantId:T,error:S,type:L}=a;if(S)return void u.reject(S);const ee={auth:u.auth,requestUri:h,sessionId:p,tenantId:T||void 0,postBody:_||void 0,user:u.user,bypassAuthState:u.bypassAuthState};try{u.resolve(yield u.getIdpTask(L)(ee))}catch(se){u.reject(se)}})()}onError(a){this.reject(a)}getIdpTask(a){switch(a){case"signInViaPopup":case"signInViaRedirect":return Qr;case"linkViaPopup":case"linkViaRedirect":return hu;case"reauthViaPopup":case"reauthViaRedirect":return oc;default:Oe(this.auth,"internal-error")}}resolve(a){bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(a),this.unregisterAndCleanUp()}reject(a){bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(a),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const un=new Wn(2e3,1e4);function ps(l,a,u){return Jr.apply(this,arguments)}function Jr(){return(Jr=(0,m.A)(function*(l,a,u){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(qe(l,"operation-not-supported-in-this-environment"));const h=Ge(l);nn(l,a,Vn);const p=Qt(h,u);return new yn(h,"signInViaPopup",a,p).executeNotNull()})).apply(this,arguments)}function uc(l,a,u){return At.apply(this,arguments)}function At(){return(At=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l);if((0,D._isFirebaseServerApp)(h.auth.app))return Promise.reject(qe(h.auth,"operation-not-supported-in-this-environment"));nn(h.auth,a,Vn);const p=Qt(h.auth,u);return new yn(h.auth,"reauthViaPopup",a,p,h).executeNotNull()})).apply(this,arguments)}function zh(l,a,u){return wo.apply(this,arguments)}function wo(){return(wo=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l);nn(h.auth,a,Vn);const p=Qt(h.auth,u);return new yn(h.auth,"linkViaPopup",a,p,h).executeNotNull()})).apply(this,arguments)}let yn=(()=>{class l extends ac{constructor(u,h,p,_,T){super(u,h,_,T),this.provider=p,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var u=this;return(0,m.A)(function*(){const h=yield u.execute();return K(h,u.auth,"internal-error"),h})()}onExecution(){var u=this;return(0,m.A)(function*(){bt(1===u.filter.length,"Popup operations only handle one event");const h=gn();u.authWindow=yield u.resolver._openPopup(u.auth,u.provider,u.filter[0],h),u.authWindow.associatedEvent=h,u.resolver._originValidation(u.auth).catch(p=>{u.reject(p)}),u.resolver._isIframeWebStorageSupported(u.auth,p=>{p||u.reject(qe(u.auth,"web-storage-unsupported"))}),u.pollUserCancellation()})()}get eventId(){var u;return(null===(u=this.authWindow)||void 0===u?void 0:u.associatedEvent)||null}cancel(){this.reject(qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const u=()=>{var h,p;this.pollId=null!==(p=null===(h=this.authWindow)||void 0===h?void 0:h.window)&&void 0!==p&&p.closed?window.setTimeout(()=>{this.pollId=null,this.reject(qe(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(u,un.get())};u()}}return l.currentPopupAction=null,l})();const lc="pendingRedirect",fr=new Map;class cc extends ac{constructor(a,u,h=!1){super(a,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],u,void 0,h),this.eventId=null}execute(){var a=()=>super.execute,u=this;return(0,m.A)(function*(){let h=fr.get(u.auth._key());if(!h){try{const _=(yield function Gh(l,a){return fu.apply(this,arguments)}(u.resolver,u.auth))?yield a().call(u):null;h=()=>Promise.resolve(_)}catch(p){h=()=>Promise.reject(p)}fr.set(u.auth._key(),h)}return u.bypassAuthState||fr.set(u.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(a){var u=()=>super.onAuthEvent,h=this;return(0,m.A)(function*(){if("signInViaRedirect"===a.type)return u().call(h,a);if("unknown"!==a.type){if(a.eventId){const p=yield h.auth._redirectUserForId(a.eventId);if(p)return h.user=p,u().call(h,a);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,m.A)(function*(){})()}cleanUp(){}}function fu(){return(fu=(0,m.A)(function*(l,a){const u=fc(a),h=dc(l);if(!(yield h._isAvailable()))return!1;const p="true"===(yield h._get(u));return yield h._remove(u),p})).apply(this,arguments)}function pu(l,a){return mu.apply(this,arguments)}function mu(){return(mu=(0,m.A)(function*(l,a){return dc(l)._set(fc(a),"true")})).apply(this,arguments)}function $h(){fr.clear()}function hc(l,a){fr.set(l._key(),a)}function dc(l){return le(l._redirectPersistence)}function fc(l){return We(lc,l.config.apiKey,l.name)}function jh(l,a,u){return function Hh(l,a,u){return gu.apply(this,arguments)}(l,a,u)}function gu(){return(gu=(0,m.A)(function*(l,a,u){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const h=Ge(l);nn(l,a,Vn),yield h._initializationPromise;const p=Qt(h,u);return yield pu(p,h),p._openRedirect(h,a,"signInViaRedirect")})).apply(this,arguments)}function Qh(l,a,u){return function Jh(l,a,u){return _u.apply(this,arguments)}(l,a,u)}function _u(){return(_u=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l);if(nn(h.auth,a,Vn),(0,D._isFirebaseServerApp)(h.auth.app))return Promise.reject(ut(h.auth));yield h.auth._initializationPromise;const p=Qt(h.auth,u);yield pu(p,h.auth);const _=yield So(h);return p._openRedirect(h.auth,a,"reauthViaRedirect",_)})).apply(this,arguments)}function Yh(l,a,u){return function pc(l,a,u){return yu.apply(this,arguments)}(l,a,u)}function yu(){return(yu=(0,m.A)(function*(l,a,u){const h=(0,I.Ku)(l);nn(h.auth,a,Vn),yield h.auth._initializationPromise;const p=Qt(h.auth,u);yield Zs(!1,h,a.providerId),yield pu(p,h.auth);const _=yield So(h);return p._openRedirect(h.auth,a,"linkViaRedirect",_)})).apply(this,arguments)}function mc(l,a){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,m.A)(function*(l,a){return yield Ge(l)._initializationPromise,Po(l,a,!1)})).apply(this,arguments)}function Po(l,a){return Iu.apply(this,arguments)}function Iu(){return(Iu=(0,m.A)(function*(l,a,u=!1){if((0,D._isFirebaseServerApp)(l.app))return Promise.reject(ut(l));const h=Ge(l),p=Qt(h,a),T=yield new cc(h,p,u).execute();return T&&!u&&(delete T.user._redirectEventId,yield h._persistUserIfCurrent(T.user),yield h._setRedirectUser(null,a)),T})).apply(this,arguments)}function So(l){return dt.apply(this,arguments)}function dt(){return(dt=(0,m.A)(function*(l){const a=gn(`${l.uid}:::`);return l._redirectEventId=a,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),a})).apply(this,arguments)}class Xn{constructor(a){this.auth=a,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(a){this.consumers.add(a),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,a)&&(this.sendToConsumer(this.queuedRedirectEvent,a),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(a){this.consumers.delete(a)}onEvent(a){if(this.hasEventBeenHandled(a))return!1;let u=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(a,h)&&(u=!0,this.sendToConsumer(a,h),this.saveEventToCache(a))}),this.hasHandledPotentialRedirect||!function bo(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Fe(l);default:return!1}}(a)||(this.hasHandledPotentialRedirect=!0,u||(this.queuedRedirectEvent=a,u=!0)),u}sendToConsumer(a,u){var h;if(a.error&&!Fe(a)){const p=(null===(h=a.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";u.onError(qe(this.auth,p))}else u.onAuthEvent(a)}isEventForConsumer(a,u){const h=null===u.eventId||!!a.eventId&&a.eventId===u.eventId;return u.filter.includes(a.type)&&h}hasEventBeenHandled(a){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(vu(a))}saveEventToCache(a){this.cachedEventUids.add(vu(a)),this.lastProcessedEventTime=Date.now()}}function vu(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(a=>a).join("-")}function Fe({type:l,error:a}){return"unknown"===l&&"auth/no-auth-event"===(null==a?void 0:a.code)}function wt(l){return De.apply(this,arguments)}function De(){return(De=(0,m.A)(function*(l,a={}){return x(l,"GET","/v1/projects",a)})).apply(this,arguments)}const _c=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ri=/^https?/;function Co(){return(Co=(0,m.A)(function*(l){if(l.config.emulator)return;const{authorizedDomains:a}=yield wt(l);for(const u of a)try{if(Xh(u))return}catch{}Oe(l,"unauthorized-domain")})).apply(this,arguments)}function Xh(l){const a=pn(),{protocol:u,hostname:h}=new URL(a);if(l.startsWith("chrome-extension://")){const T=new URL(l);return""===T.hostname&&""===h?"chrome-extension:"===u&&l.replace("chrome-extension://","")===a.replace("chrome-extension://",""):"chrome-extension:"===u&&T.hostname===h}if(!Ri.test(u))return!1;if(_c.test(l))return h===l;const p=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(h)}const gt=new Wn(3e4,6e4);function yc(){const l=ht().___jsl;if(null!=l&&l.H)for(const a of Object.keys(l.H))if(l.H[a].r=l.H[a].r||[],l.H[a].L=l.H[a].L||[],l.H[a].r=[...l.H[a].L],l.CP)for(let u=0;u<l.CP.length;u++)l.CP[u]=null}let He=null;const xo=new Wn(5e3,15e3),Do="__/auth/iframe",ms="emulator/auth/iframe",Zh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function mr(l){const a=l.config;K(a.authDomain,l,"auth-domain-config-required");const u=a.emulator?ir(a,ms):`https://${l.config.authDomain}/${Do}`,h={apiKey:a.apiKey,appName:l.name,v:D.SDK_VERSION},p=pr.get(l.config.apiHost);p&&(h.eid=p);const _=l._getFrameworks();return _.length&&(h.fw=_.join(",")),`${u}?${(0,I.Am)(h).slice(1)}`}function Fn(){return Fn=(0,m.A)(function*(l){const a=yield function er(l){return He=He||function Zn(l){return new Promise((a,u)=>{var h,p,_;function T(){yc(),gapi.load("gapi.iframes",{callback:()=>{a(gapi.iframes.getContext())},ontimeout:()=>{yc(),u(qe(l,"network-request-failed"))},timeout:gt.get()})}if(null!==(p=null===(h=ht().gapi)||void 0===h?void 0:h.iframes)&&void 0!==p&&p.Iframe)a(gapi.iframes.getContext());else{if(null===(_=ht().gapi)||void 0===_||!_.load){const S=yl("iframefcb");return ht()[S]=()=>{gapi.load?T():u(qe(l,"network-request-failed"))},ci(`${function Ah(){return it.gapiScript}()}?onload=${S}`).catch(L=>u(L))}T()}}).catch(a=>{throw He=null,a})}(l),He}(l),u=ht().gapi;return K(u,l,"internal-error"),a.open({where:document.body,url:mr(l),messageHandlersFilter:u.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Zh,dontclear:!0},h=>new Promise(function(){var p=(0,m.A)(function*(_,T){yield h.restyle({setHideOnLeave:!1});const S=qe(l,"network-request-failed"),L=ht().setTimeout(()=>{T(S)},xo.get());function ee(){ht().clearTimeout(L),_(h)}h.ping(ee).then(ee,()=>{T(S)})});return function(_,T){return p.apply(this,arguments)}}()))}),Fn.apply(this,arguments)}const Un={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class No{constructor(a){this.window=a,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Eu="__/auth/handler",_s="emulator/auth/handler",vc=encodeURIComponent("fac");function Oo(l,a,u,h,p,_){return Si.apply(this,arguments)}function Si(){return(Si=(0,m.A)(function*(l,a,u,h,p,_){K(l.config.authDomain,l,"auth-domain-config-required"),K(l.config.apiKey,l,"invalid-api-key");const T={apiKey:l.config.apiKey,appName:l.name,authType:u,redirectUrl:h,v:D.SDK_VERSION,eventId:p};if(a instanceof Vn){a.setDefaultLanguage(l.languageCode),T.providerId=a.providerId||"",(0,I.Im)(a.getCustomParameters())||(T.customParameters=JSON.stringify(a.getCustomParameters()));for(const[se,ve]of Object.entries(_||{}))T[se]=ve}if(a instanceof Fr){const se=a.getScopes().filter(ve=>""!==ve);se.length>0&&(T.scopes=se.join(","))}l.tenantId&&(T.tid=l.tenantId);const S=T;for(const se of Object.keys(S))void 0===S[se]&&delete S[se];const L=yield l._getAppCheckToken(),ee=L?`#${vc}=${encodeURIComponent(L)}`:"";return`${function ys({config:l}){return l.emulator?ir(l,_s):`https://${l.authDomain}/${Eu}`}(l)}?${(0,I.Am)(S).slice(1)}${ee}`})).apply(this,arguments)}const Lo="webStorageSupport",Ec=class ed{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Eo,this._completeRedirectFn=Po,this._overrideRedirectResult=hc}_openPopup(a,u,h,p){var _=this;return(0,m.A)(function*(){var T;bt(null===(T=_.eventManagers[a._key()])||void 0===T?void 0:T.manager,"_initialize() not called before _openPopup()");const S=yield Oo(a,u,h,pn(),p);return function Vo(l,a,u,h=500,p=600){const _=Math.max((window.screen.availHeight-p)/2,0).toString(),T=Math.max((window.screen.availWidth-h)/2,0).toString();let S="";const L=Object.assign(Object.assign({},Un),{width:h.toString(),height:p.toString(),top:_,left:T}),ee=(0,I.ZQ)().toLowerCase();u&&(S=zi(ee)?"_blank":u),Ee(ee)&&(a=a||"http://localhost",L.scrollbars="yes");const se=Object.entries(L).reduce((Mt,[Yt,_r])=>`${Mt}${Yt}=${_r},`,"");if(function Aa(l=(0,I.ZQ)()){var a;return br(l)&&!(null===(a=window.navigator)||void 0===a||!a.standalone)}(ee)&&"_self"!==S)return function Yr(l,a){const u=document.createElement("a");u.href=l,u.target=a;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(h)}(a||"",S),new No(null);const ve=window.open(a||"",S,se);K(ve,l,"popup-blocked");try{ve.focus()}catch{}return new No(ve)}(a,S,gn())})()}_openRedirect(a,u,h,p){var _=this;return(0,m.A)(function*(){return yield _._originValidation(a),function M(l){ht().location.href=l}(yield Oo(a,u,h,pn(),p)),new Promise(()=>{})})()}_initialize(a){const u=a._key();if(this.eventManagers[u]){const{manager:p,promise:_}=this.eventManagers[u];return p?Promise.resolve(p):(bt(_,"If manager is not set, promise should be"),_)}const h=this.initAndGetManager(a);return this.eventManagers[u]={promise:h},h.catch(()=>{delete this.eventManagers[u]}),h}initAndGetManager(a){var u=this;return(0,m.A)(function*(){const h=yield function ko(l){return Fn.apply(this,arguments)}(a),p=new Xn(a);return h.register("authEvent",_=>(K(null==_?void 0:_.authEvent,a,"invalid-auth-event"),{status:p.onEvent(_.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),u.eventManagers[a._key()]={manager:p},u.iframes[a._key()]=h,p})()}_isIframeWebStorageSupported(a,u){this.iframes[a._key()].send(Lo,{type:Lo},p=>{var _;const T=null===(_=null==p?void 0:p[0])||void 0===_?void 0:_[Lo];void 0!==T&&u(!!T),Oe(a,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(a){const u=a._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function Jt(l){return Co.apply(this,arguments)}(a)),this.originValidationPromises[u]}get _shouldInitProactively(){return Ra()||jt()||br()}};class Tu{constructor(a){this.factorId=a}_process(a,u,h){switch(u.type){case"enroll":return this._finalizeEnroll(a,u.credential,h);case"signin":return this._finalizeSignIn(a,u.credential);default:return zt("unexpected MultiFactorSessionType")}}}class Mo extends Tu{constructor(a){super("phone"),this.credential=a}static _fromCredential(a){return new Mo(a)}_finalizeEnroll(a,u,h){return function us(l,a){return x(l,"POST","/v2/accounts/mfaEnrollment:finalize",R(l,a))}(a,{idToken:u,displayName:h,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(a,u){return function ec(l,a){return x(l,"POST","/v2/accounts/mfaSignIn:finalize",R(l,a))}(a,{mfaPendingCredential:u,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let kt=(()=>{class l{constructor(){}static assertion(u){return Mo._fromCredential(u)}}return l.FACTOR_ID="phone",l})();var Au="@firebase/auth";class nd{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){var a;return this.assertAuthConfigured(),(null===(a=this.auth.currentUser)||void 0===a?void 0:a.uid)||null}getToken(a){var u=this;return(0,m.A)(function*(){return u.assertAuthConfigured(),yield u.auth._initializationPromise,u.auth.currentUser?{accessToken:yield u.auth.currentUser.getIdToken(a)}:null})()}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;const u=this.auth.onIdTokenChanged(h=>{a((null==h?void 0:h.stsTokenManager.accessToken)||null)});this.internalListeners.set(a,u),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();const u=this.internalListeners.get(a);u&&(this.internalListeners.delete(a),u(),this.updateProactiveRefresh())}assertAuthConfigured(){K(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ci=(0,I.XA)("authIdTokenMaxAge")||300;let Fo=null;const wu=l=>function(){var a=(0,m.A)(function*(u){const h=u&&(yield u.getIdTokenResult()),p=h&&((new Date).getTime()-Date.parse(h.issuedAtTime))/1e3;if(p&&p>Ci)return;const _=null==h?void 0:h.token;Fo!==_&&(Fo=_,yield fetch(l,{method:_?"POST":"DELETE",headers:_?{Authorization:`Bearer ${_}`}:{}}))});return function(u){return a.apply(this,arguments)}}();function Ac(l=(0,D.getApp)()){const a=(0,D._getProvider)(l,"auth");if(a.isInitialized())return a.getImmediate();const u=function Bs(l,a){const u=(0,D._getProvider)(l,"auth");if(u.isInitialized()){const p=u.getImmediate(),_=u.getOptions();if((0,I.bD)(_,null!=a?a:{}))return p;Oe(p,"already-initialized")}return u.initialize({options:a})}(l,{popupRedirectResolver:Ec,persistence:[he,Jl,Eo]}),h=(0,I.XA)("authTokenSyncURL");if(h&&"boolean"==typeof isSecureContext&&isSecureContext){const _=new URL(h,location.origin);if(location.origin===_.origin){const T=wu(_.toString());(function Za(l,a,u){(0,I.Ku)(l).beforeAuthStateChanged(a,u)})(u,T,()=>T(u.currentUser)),function Vh(l,a,u,h){(0,I.Ku)(l).onIdTokenChanged(a,u,h)}(u,S=>T(S))}}const p=(0,I.Tj)("auth");return p&&qs(u,`http://${p}`),u}(function xt(l){it=l})({loadJS:l=>new Promise((a,u)=>{const h=document.createElement("script");h.setAttribute("src",l),h.onload=a,h.onerror=p=>{const _=qe("internal-error");_.customData=p,u(_)},h.type="text/javascript",h.charset="UTF-8",function Ru(){var l,a;return null!==(a=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==a?a:document}().appendChild(h)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function Te(l){(0,D._registerComponent)(new ue.uA("auth",(a,{options:u})=>{const h=a.getProvider("app").getImmediate(),p=a.getProvider("heartbeat"),_=a.getProvider("app-check-internal"),{apiKey:T,authDomain:S}=h.options;K(T&&!T.includes(":"),"invalid-api-key",{appName:h.name});const L={apiKey:T,authDomain:S,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pl(l)},ee=new Pa(h,p,_,L);return function Ca(l,a){const u=(null==a?void 0:a.persistence)||[],h=(Array.isArray(u)?u:[u]).map(le);null!=a&&a.errorMap&&l._updateErrorMap(a.errorMap),l._initializeWithPersistence(h,null==a?void 0:a.popupRedirectResolver)}(ee,u),ee},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,u,h)=>{a.getProvider("auth-internal").initialize()})),(0,D._registerComponent)(new ue.uA("auth-internal",a=>{const u=Ge(a.getProvider("auth").getImmediate());return new nd(u)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,D.registerVersion)(Au,"1.7.2",function Tc(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(l)),(0,D.registerVersion)(Au,"1.7.2","esm2017")}("Browser")},99:(ai,Ut,q)=>{q.d(Ut,{J1:()=>m.a5,eJ:()=>m.aa,r7:()=>m.ak,x9:()=>m.ab,xI:()=>m.o});var m=q(8407);q(7852),q(1076),q(8041),q(1362)},1662:(ai,Ut,q)=>{q.d(Ut,{f:()=>S0});var m=q(467),D=q(4438),I=q(9842),Kt=(q(2438),q(177)),ue=q(5407),Re=q(9253),ke=q(1413),Be=q(7673),Ke=q(1985),ge=q(8455),fn=q(6365),vn=q(8750),Wi=q(983),En=q(3794),Rr=q(941),St=q(5558),ze=q(6354),yt=q(6129);class Oe extends ke.B{constructor(e=1/0,t=1/0,r=yt.U){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:o}=this;t||(r.push(e),!i&&r.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let o=0;o<s.length&&!e.closed;o+=r?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const o=t.now();let c=0;for(let d=1;d<r.length&&r[d]<=o;d+=2)c=d;c&&r.splice(0,c+1)}}}var qe=q(7707),tn=q(9974);function nn(n,e,...t){if(!0===e)return void n();if(!1===e)return;const r=new qe.Ms({next:()=>{r.unsubscribe(),n()}});return(0,vn.Tg)(e(...t)).subscribe(r)}function bn(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=null!=n?n:1/0,function ut(n={}){const{connector:e=(()=>new ke.B),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return s=>{let o,c,d,f=0,g=!1,y=!1;const v=()=>{null==c||c.unsubscribe(),c=void 0},w=()=>{v(),o=d=void 0,g=y=!1},N=()=>{const F=o;w(),null==F||F.unsubscribe()};return(0,tn.N)((F,V)=>{f++,!y&&!g&&v();const H=d=null!=d?d:e();V.add(()=>{f--,0===f&&!y&&!g&&(c=nn(N,i))}),H.subscribe(V),!o&&f>0&&(o=new qe.Ms({next:te=>H.next(te),error:te=>{y=!0,v(),c=nn(w,t,te),H.error(te)},complete:()=>{g=!0,v(),c=nn(w,r),H.complete()}}),(0,vn.Tg)(F).subscribe(o))})(s)}}({connector:()=>new Oe(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var K=q(1594),zt=q(8071);function bt(n,e){return(0,zt.T)(e)?(0,St.n)(()=>n,e):(0,St.n)(()=>n)}var pn=q(6745),Gt=q(5964);q(7935);const Pr=new D.nKC("angularfire2.auth.use-emulator"),Wn=new D.nKC("angularfire2.auth.settings"),ir=new D.nKC("angularfire2.auth.tenant-id"),Cn=new D.nKC("angularfire2.auth.langugage-code"),ui=new D.nKC("angularfire2.auth.use-device-language"),z=new D.nKC("angularfire.auth.persistence"),R=(n,e,t,r,i,s,o,c)=>(0,Re.BM)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const d=e.runOutsideAngular(()=>n.auth());if(t&&d.useEmulator(...t),r&&(d.tenantId=r),d.languageCode=i,s&&d.useDeviceLanguage(),o)for(const[f,g]of Object.entries(o))d.settings[f]=g;return c&&d.setPersistence(c),d},[t,r,i,s,o,c]);let x=(()=>{var n;class e{constructor(r,i,s,o,c,d,f,g,y,v,w,N){(0,I.A)(this,"authState",void 0),(0,I.A)(this,"idToken",void 0),(0,I.A)(this,"user",void 0),(0,I.A)(this,"idTokenResult",void 0),(0,I.A)(this,"credential",void 0);const F=new ke.B,V=(0,Be.of)(void 0).pipe((0,Rr.Q)(c.outsideAngular),(0,St.n)(()=>o.runOutsideAngular(()=>Promise.resolve().then(q.bind(q,2438)))),(0,ze.T)(()=>(0,Re.iB)(r,o,i)),(0,ze.T)(H=>R(H,o,d,g,y,v,f,w)),bn({bufferSize:1,refCount:!1}));if((0,Kt.Vy)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Be.of)(null);else{V.pipe((0,K.$)()).subscribe();const H=V.pipe((0,St.n)(G=>G.getRedirectResult().then(fe=>fe,()=>null)),ue.U0,bn({bufferSize:1,refCount:!1})),te=V.pipe((0,St.n)(G=>new Ke.c(fe=>({unsubscribe:o.runOutsideAngular(()=>G.onAuthStateChanged(ce=>fe.next(ce),ce=>fe.error(ce),()=>fe.complete()))})))),X=V.pipe((0,St.n)(G=>new Ke.c(fe=>({unsubscribe:o.runOutsideAngular(()=>G.onIdTokenChanged(ce=>fe.next(ce),ce=>fe.error(ce),()=>fe.complete()))}))));this.authState=H.pipe(bt(te),(0,pn._)(c.outsideAngular),(0,Rr.Q)(c.insideAngular)),this.user=H.pipe(bt(X),(0,pn._)(c.outsideAngular),(0,Rr.Q)(c.insideAngular)),this.idToken=this.user.pipe((0,St.n)(G=>G?(0,ge.H)(G.getIdToken()):(0,Be.of)(null))),this.idTokenResult=this.user.pipe((0,St.n)(G=>G?(0,ge.H)(G.getIdTokenResult()):(0,Be.of)(null))),this.credential=function Tn(...n){const e=(0,En.lI)(n),t=(0,En.R0)(n,1/0),r=n;return r.length?1===r.length?(0,vn.Tg)(r[0]):(0,fn.U)(t)((0,ge.H)(r,e)):Wi.w}(H,F,this.authState.pipe((0,Gt.p)(G=>!G))).pipe((0,ze.T)(G=>null!=G&&G.user?G:null),(0,pn._)(c.outsideAngular),(0,Rr.Q)(c.insideAngular))}return(0,Re.Gt)(this,V,o,{spy:{apply:(H,te,X)=>{(H.startsWith("signIn")||H.startsWith("createUser"))&&X.then(G=>F.next(G))}}})}}return n=e,(0,I.A)(e,"\u0275fac",function(r){return new(r||n)(D.KVO(Re.rx),D.KVO(Re.uP,8),D.KVO(D.Agw),D.KVO(D.SKi),D.KVO(ue.u0),D.KVO(Pr,8),D.KVO(Wn,8),D.KVO(ir,8),D.KVO(Cn,8),D.KVO(ui,8),D.KVO(z,8),D.KVO(ue.Jv,8))}),(0,I.A)(e,"\u0275prov",D.jDH({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();var $,B=q(99),J=(q(7440),q(2214),q(7852)),pe=q(1362),de=q(8041),oe=q(1076),Vt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ct={},sr=sr||{},ae=Vt||self;function xn(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Ze(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var or="closure_uid_"+(1e9*Math.random()>>>0),Kn=0;function Sr(n,e,t){return n.call.apply(n.bind,arguments)}function zn(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function _e(n,e,t){return(_e=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Sr:zn).apply(null,arguments)}function Ne(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function be(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),c=2;c<arguments.length;c++)o[c-2]=arguments[c];return e.prototype[i].apply(r,o)}}function Qe(){this.s=this.s,this.o=this.o}Qe.prototype.s=!1,Qe.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function An(n){Object.prototype.hasOwnProperty.call(n,or)&&n[or]||(n[or]=++Kn)}(this)},Qe.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ot=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Gn(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function $n(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(xn(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Je(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Je.prototype.h=function(){this.defaultPrevented=!0};var Le=function(){if(!ae.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};ae.addEventListener("test",t,e),ae.removeEventListener("test",t,e)}catch{}return n}();function $t(n){return/^[\s\xa0]*$/.test(n)}function Dn(){var n=ae.navigator;return n&&(n=n.userAgent)?n:""}function Lt(n){return-1!=Dn().indexOf(n)}function Pe(n){return Pe[" "](n),n}Pe[" "]=function(){};var Ki,n,Ct=Lt("Opera"),It=Lt("Trident")||Lt("MSIE"),Bt=Lt("Edge"),pt=Bt||It,rn=Lt("Gecko")&&!(-1!=Dn().toLowerCase().indexOf("webkit")&&!Lt("Edge"))&&!(Lt("Trident")||Lt("MSIE"))&&!Lt("Edge"),ar=-1!=Dn().toLowerCase().indexOf("webkit")&&!Lt("Edge");function li(){var n=ae.document;return n?n.documentMode:void 0}e:{var C="",A=(n=Dn(),rn?/rv:([^\);]+)(\)|;)/.exec(n):Bt?/Edge\/([\d\.]+)/.exec(n):It?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):ar?/WebKit\/(\S+)/.exec(n):Ct?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(A&&(C=A?A[1]:""),It){var E=li();if(null!=E&&E>parseFloat(C)){Ki=String(E);break e}}Ki=C}var le=ae.document&&It&&(li()||parseInt(Ki,10))||void 0;function Ae(n,e){if(Je.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(rn){e:{try{Pe(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:xe[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Ae.$.h.call(this)}}be(Ae,Je);var xe={2:"touch",3:"pen",4:"mouse"};Ae.prototype.h=function(){Ae.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var We="closure_listenable_"+(1e6*Math.random()|0),vt=0;function sn(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++vt,this.fa=this.ia=!1}function Ee(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function jt(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function va(n){const e={};for(const t in n)e[t]=n[t];return e}const Fs="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ea(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Fs.length;s++)t=Fs[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Gi(n){this.src=n,this.g={},this.h=0}function br(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Ot(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Ee(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Ta(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Gi.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Ta(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new sn(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var Aa="closure_lm_"+(1e6*Math.random()|0),wa={};function Ra(n,e,t,r,i){if(r&&r.once)return ml(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ra(n,e[s],t,r,i);return null}return t=Us(t),n&&n[We]?n.O(e,t,Ze(r)?!!r.capture:!!r,i):fl(n,e,t,!1,r,i)}function fl(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Ze(i)?!!i.capture:!!i,c=Pa(n);if(c||(n[Aa]=c=new Gi(n)),(t=c.add(e,t,r,o,s)).proxy)return t;if(r=function pl(){const e=Eh;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Le||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(_l(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function ml(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ml(n,e[s],t,r,i);return null}return t=Us(t),n&&n[We]?n.P(e,t,Ze(r)?!!r.capture:!!r,i):fl(n,e,t,!0,r,i)}function gl(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)gl(n,e[s],t,r,i);else r=Ze(r)?!!r.capture:!!r,t=Us(t),n&&n[We]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Ta(s=n.g[e],t,r,i))&&(Ee(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Pa(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ta(e,t,r,i)),(t=-1<n?e[n]:null)&&$i(t))}function $i(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[We])br(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(_l(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Pa(e))?(br(t,n),0==t.h&&(t.src=null,e[Aa]=null)):Ee(n)}}}function _l(n){return n in wa?wa[n]:wa[n]="on"+n}function Eh(n,e){if(n.fa)n=!0;else{e=new Ae(e,this);var t=n.listener,r=n.la||n.src;n.ia&&$i(n),n=t.call(r,e)}return n}function Pa(n){return(n=n[Aa])instanceof Gi?n:null}var Ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function Us(n){return"function"==typeof n?n:(n[Ge]||(n[Ge]=function(e){return n.handleEvent(e)}),n[Ge])}function it(){Qe.call(this),this.i=new Gi(this),this.S=this,this.J=null}function xt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Je(e,n);else if(e instanceof Je)e.target=e.target||n;else{var i=e;Ea(e=new Je(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=ci(o,r,!0,e)&&i}if(i=ci(o=e.g=n,r,!0,e)&&i,i=ci(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=ci(o=e.g=t[s],r,!1,e)&&i}function ci(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var c=o.listener,d=o.la||o.src;o.ia&&br(n.i,o),i=!1!==c.call(d,r)&&i}}return i&&!r.defaultPrevented}be(it,Qe),it.prototype[We]=!0,it.prototype.removeEventListener=function(n,e,t,r){gl(this,n,e,t,r)},it.prototype.N=function(){if(it.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ee(t[r]);delete n.g[e],n.h--}}this.J=null},it.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},it.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Sa=ae.JSON.stringify;function Ah(){var n=ji;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Il=new class Th{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new wh,n=>n.reset());class wh{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function vl(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function El(n){ae.setTimeout(()=>{throw n},0)}let Cr,jn=!1,ji=new class yl{constructor(){this.h=this.g=null}add(e,t){const r=Il.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Tl=()=>{const n=ae.Promise.resolve(void 0);Cr=()=>{n.then(ba)}};var ba=()=>{for(var n;n=Ah();){try{n.h.call(n.g)}catch(t){El(t)}var e=Il;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}jn=!1};function Bs(n,e){it.call(this),this.h=n||1,this.g=e||ae,this.j=_e(this.qb,this),this.l=Date.now()}function Ca(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function qs(n,e,t){if("function"==typeof n)t&&(n=_e(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=_e(n.handleEvent,n)}return 2147483647<Number(e)?-1:ae.setTimeout(n,e||0)}function xa(n){n.g=qs(()=>{n.g=null,n.i&&(n.i=!1,xa(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}be(Bs,it),($=Bs.prototype).ga=!1,$.T=null,$.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),xt(this,"tick"),this.ga&&(Ca(this),this.start()))}},$.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},$.N=function(){Bs.$.N.call(this),Ca(this),delete this.g};class Rh extends Qe{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:xa(this)}N(){super.N(),this.g&&(ae.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function hi(n){Qe.call(this),this.h=n,this.g={}}be(hi,Qe);var Al=[];function xr(n,e,t,r){Array.isArray(t)||(t&&(Al[0]=t.toString()),t=Al);for(var i=0;i<t.length;i++){var s=Ra(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Da(n){jt(n.g,function(e,t){this.g.hasOwnProperty(t)&&$i(e)},n),n.g={}}function di(){this.g=!0}function fi(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Sh(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Sa(t)}catch{return e}}(n,t)+(r?" "+r:"")})}hi.prototype.N=function(){hi.$.N.call(this),Da(this)},hi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},di.prototype.Ea=function(){this.g=!1},di.prototype.info=function(){};var Hn={},wl=null;function pi(){return wl=wl||new it}function Hi(n){Je.call(this,Hn.Ta,n)}function Dr(n){const e=pi();xt(e,new Hi(e))}function Rl(n,e){Je.call(this,Hn.STAT_EVENT,n),this.stat=e}function Dt(n){const e=pi();xt(e,new Rl(e,n))}function Pl(n,e){Je.call(this,Hn.Ua,n),this.size=e}function kr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return ae.setTimeout(function(){n()},e)}Hn.Ta="serverreachability",be(Hi,Je),Hn.STAT_EVENT="statevent",be(Rl,Je),Hn.Ua="timingevent",be(Pl,Je);var Ws={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ks={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Va(){}function Sl(){}Va.prototype.h=null;var Vr,Nr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Oa(){Je.call(this,"d")}function Qi(){Je.call(this,"c")}function mn(){}function Or(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new hi(this),this.P=kn,this.V=new Bs(n=pt?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new bl}function bl(){this.i=null,this.g="",this.h=!1}be(Oa,Je),be(Qi,Je),be(mn,Va),mn.prototype.g=function(){return new XMLHttpRequest},mn.prototype.i=function(){return{}},Vr=new mn;var kn=45e3,Cl={},Ji={};function La(n,e,t){n.L=1,n.A=qr(Qn(e)),n.u=t,n.S=!0,Gs(n,null)}function Gs(n,e){n.G=Date.now(),Yi(n),n.B=Qn(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Xs(t.i,"t",r),n.o=0,t=n.l.J,n.h=new bl,n.g=Gr(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Rh(_e(n.Pa,n,n.g),n.O)),xr(n.U,n.g,"readystatechange",n.nb),e=n.I?va(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Dr(),function Ph(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",c=s.split("&"),d=0;d<c.length;d++){var f=c[d].split("=");if(1<f.length){var g=f[0];f=f[1];var y=g.split("_");o=2<=y.length&&"type"==y[1]?o+(g+"=")+f+"&":o+(g+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function xl(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function $s(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=bh(n,t),i==Ji){4==e&&(n.s=4,Dt(14),r=!1),fi(n.j,n.m,null,"[Incomplete Response]");break}if(i==Cl){n.s=4,Dt(15),fi(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}fi(n.j,n.m,i,null),Mr(n,i)}xl(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,Dt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),os(e),e.M=!0,Dt(11))):(fi(n.j,n.m,t,"[Invalid Chunked Response]"),Lr(n),Xi(n))}function bh(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?Ji:(t=Number(e.substring(t,r)),isNaN(t)?Cl:(r+=1)+t>e.length?Ji:(e=e.slice(r,r+t),n.o=r+t,e))}function Yi(n){n.Y=Date.now()+n.P,js(n,n.P)}function js(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=kr(_e(n.lb,n),e)}function Nn(n){n.C&&(ae.clearTimeout(n.C),n.C=null)}function Xi(n){0==n.l.H||n.J||Ul(n.l,n)}function Lr(n){Nn(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Ca(n.V),Da(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Mr(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||_i(t.i,n)))if(!n.K&&_i(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;yi(t),co(t)}Ya(t),Dt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=kr(_e(t.ib,t),6e3));if(1>=eo(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else hr(t,11)}else if((n.K||t.g==n)&&yi(t),!$t(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let f=i[e];if(t.V=f[0],f=f[1],2==t.H)if("c"==f[0]){t.K=f[1],t.pa=f[2];const g=f[3];null!=g&&(t.ra=g,t.l.info("VER="+t.ra));const y=f[4];null!=y&&(t.Ga=y,t.l.info("SVER="+t.Ga));const v=f[5];null!=v&&"number"==typeof v&&0<v&&(t.L=r=1.5*v,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const w=n.g;if(w){const N=w.g?w.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(N){var s=r.i;s.g||-1==N.indexOf("spdy")&&-1==N.indexOf("quic")&&-1==N.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ts(s,s.h),s.h=null))}if(r.F){const F=w.g?w.g.getResponseHeader("X-HTTP-Session-Id"):null;F&&(r.Da=F,$e(r.I,r.F,F))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=ql(r,r.J?r.pa:null,r.Y),o.K){za(r.i,o);var c=o,d=r.L;d&&c.setTimeout(d),c.C&&(Nn(c),Yi(c)),r.g=o}else po(r);0<t.j.length&&fo(t)}else"stop"!=f[0]&&"close"!=f[0]||hr(t,7);else 3==t.H&&("stop"==f[0]||"close"==f[0]?"stop"==f[0]?hr(t,7):ss(t):"noop"!=f[0]&&t.h&&t.h.Aa(f),t.A=0)}Dr()}catch{}}function Vn(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(xn(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Ma(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(xn(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Kp(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(xn(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}($=Or.prototype).setTimeout=function(n){this.P=n},$.nb=function(n){n=n.target;const e=this.M;e&&3==On(n)?e.l():this.Pa(n)},$.Pa=function(n){try{if(n==this.g)e:{const g=On(this.g);var e=this.g.Ia();if(this.g.da(),!(3>g)&&(3!=g||pt||this.g&&(this.h.h||this.g.ja()||lo(this.g)))){this.J||4!=g||7==e||Dr(),Nn(this);var t=this.g.da();this.ca=t;t:if(xl(this)){var r=lo(this.g);n="";var i=r.length,s=4==On(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Lr(this),Xi(this);var o="";break t}this.h.i=new ae.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function ka(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,g,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,d=this.g;if((c=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$t(c)){var f=c;break t}}f=null}if(!(t=f)){this.i=!1,this.s=3,Dt(12),Lr(this),Xi(this);break e}fi(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Mr(this,t)}this.S?($s(this,g,o),pt&&this.i&&3==g&&(xr(this.U,this.V,"tick",this.mb),this.V.start())):(fi(this.j,this.m,o,null),Mr(this,o)),4==g&&Lr(this),this.i&&!this.J&&(4==g?Ul(this.l,this):(this.i=!1,Yi(this)))}else(function Nh(n){const e={};n=(n.g&&2<=On(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if($t(n[r]))continue;var t=vl(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function zi(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,Dt(12)):(this.s=0,Dt(13)),Lr(this),Xi(this)}}}catch{}},$.mb=function(){if(this.g){var n=On(this.g),e=this.g.ja();this.o<e.length&&(Nn(this),$s(this,n,e),this.i&&4!=n&&Yi(this))}},$.cancel=function(){this.J=!0,Lr(this)},$.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function Na(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(Dr(),Dt(17)),Lr(this),this.s=2,Xi(this)):js(this,this.Y-n)};var Fr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ur(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ur){this.h=n.h,Hs(this,n.j),this.s=n.s,this.g=n.g,Qs(this,n.m),this.l=n.l;var e=n.i,t=new gi;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Br(this,t),this.o=n.o}else n&&(e=String(n).match(Fr))?(this.h=!1,Hs(this,e[1]||"",!0),this.s=es(e[2]||""),this.g=es(e[3]||"",!0),Qs(this,e[4]),this.l=es(e[5]||"",!0),Br(this,e[6]||"",!0),this.o=es(e[7]||"")):(this.h=!1,this.i=new gi(null,this.h))}function Qn(n){return new Ur(n)}function Hs(n,e,t){n.j=t?es(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Qs(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Br(n,e,t){e instanceof gi?(n.i=e,function Zs(n,e){e&&!n.j&&(Jn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(kl(this,r),Xs(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=mi(e,Ua)),n.i=new gi(e,n.h))}function $e(n,e,t){n.i.set(e,t)}function qr(n){return $e(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function es(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function mi(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Fa),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Fa(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Ur.prototype.toString=function(){var n=[],e=this.j;e&&n.push(mi(e,on,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(mi(e,on,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(mi(t,"/"==t.charAt(0)?Ch:Dl,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",mi(t,Js)),n.join("")};var on=/[#\/\?@]/g,Dl=/[#\?:]/g,Ch=/[#\?]/g,Ua=/[#\?@]/g,Js=/#/g;function gi(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Jn(n){n.g||(n.g=new Map,n.h=0,n.i&&function Zi(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function kl(n,e){Jn(n),e=ur(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Ys(n,e){return Jn(n),e=ur(n,e),n.g.has(e)}function Xs(n,e,t){kl(n,e),0<t.length&&(n.i=null,n.g.set(ur(n,e),Gn(t)),n.h+=t.length)}function ur(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}($=gi.prototype).add=function(n,e){Jn(this),this.i=null,n=ur(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},$.forEach=function(n,e){Jn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},$.ta=function(){Jn(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},$.Z=function(n){Jn(this);let e=[];if("string"==typeof n)Ys(this,n)&&(e=e.concat(this.g.get(ur(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},$.set=function(n,e){return Jn(this),this.i=null,Ys(this,n=ur(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},$.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},$.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Ba=class{constructor(n,e){this.g=n,this.map=e}};function qa(n){this.l=n||Wa,n=ae.PerformanceNavigationTiming?0<(n=ae.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(ae.g&&ae.g.Ka&&ae.g.Ka()&&ae.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Wa=10;function Ka(n){return!!n.h||!!n.g&&n.g.size>=n.j}function eo(n){return n.h?1:n.g?n.g.size:0}function _i(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function ts(n,e){n.g?n.g.add(e):n.h=e}function za(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function to(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Gn(n.i)}qa.prototype.cancel=function(){if(this.i=to(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Nl=class{stringify(n){return ae.JSON.stringify(n,void 0)}parse(n){return ae.JSON.parse(n,void 0)}};function Ga(){this.g=new Nl}function xh(n,e,t){const r=t||"";try{Vn(n,function(i,s){let o=i;Ze(i)&&(o=Sa(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function no(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Wr(n){this.l=n.ec||null,this.j=n.ob||!1}function lr(n,e){it.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=ns,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}be(Wr,Va),Wr.prototype.g=function(){return new lr(this.l,this.j)},Wr.prototype.i=function(n){return function(){return n}}({}),be(lr,it);var ns=0;function ro(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function cr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Kr(n)}function Kr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}($=lr.prototype).open=function(n,e){if(this.readyState!=ns)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Kr(this)},$.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||ae).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},$.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,cr(this)),this.readyState=ns},$.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof ae.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ro(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},$.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?cr(this):Kr(this),3==this.readyState&&ro(this)}},$.Za=function(n){this.g&&(this.response=this.responseText=n,cr(this))},$.Ya=function(n){this.g&&(this.response=n,cr(this))},$.ka=function(){this.g&&cr(this)},$.setRequestHeader=function(n,e){this.v.append(n,e)},$.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},$.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(lr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var ja=ae.JSON.parse;function st(n){it.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=io,this.L=this.M=!1}be(st,it);var io="",Dh=/^https?$/i,Ha=["POST","PUT"];function so(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Qa(n),ao(n)}function Qa(n){n.F||(n.F=!0,xt(n,"complete"),xt(n,"error"))}function oo(n){if(n.h&&typeof sr<"u"&&(!n.C[1]||4!=On(n)||2!=n.da()))if(n.v&&4==On(n))qs(n.La,0,n);else if(xt(n,"readystatechange"),4==On(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(Fr)[1]||null;!i&&ae.self&&ae.self.location&&(i=ae.self.location.protocol.slice(0,-1)),r=!Dh.test(i?i.toLowerCase():"")}t=r}if(t)xt(n,"complete"),xt(n,"success");else{n.m=6;try{var s=2<On(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Qa(n)}}finally{ao(n)}}}function ao(n,e){if(n.g){uo(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||xt(n,"ready");try{t.onreadystatechange=r}catch{}}}function uo(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(ae.clearTimeout(n.A),n.A=null)}function On(n){return n.g?n.g.readyState:0}function lo(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case io:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Vl(n){let e="";return jt(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function rs(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Vl(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):$e(n,e,t))}function is(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Ol(n){this.Ga=0,this.j=[],this.l=new di,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=is("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=is("baseRetryDelayMs",5e3,n),this.hb=is("retryDelaySeedMs",1e4,n),this.eb=is("forwardChannelMaxRetries",2,n),this.xa=is("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new qa(n&&n.concurrentRequestLimit),this.Ja=new Ga,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function ss(n){if(ho(n),3==n.H){var e=n.W++,t=Qn(n.I);if($e(t,"SID",n.K),$e(t,"RID",e),$e(t,"TYPE","terminate"),zr(n,t),(e=new Or(n,n.l,e)).L=2,e.A=qr(Qn(t)),t=!1,ae.navigator&&ae.navigator.sendBeacon)try{t=ae.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&ae.Image&&((new Image).src=e.A,t=!0),t||(e.g=Gr(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Yi(e)}mo(n)}function co(n){n.g&&(os(n),n.g.cancel(),n.g=null)}function ho(n){co(n),n.u&&(ae.clearTimeout(n.u),n.u=null),yi(n),n.i.cancel(),n.m&&("number"==typeof n.m&&ae.clearTimeout(n.m),n.m=null)}function fo(n){if(!Ka(n.i)&&!n.m){n.m=!0;var e=n.Na;Cr||Tl(),jn||(Cr(),jn=!0),ji.add(e,n),n.C=0}}function Ll(n,e){var t;t=e?e.m:n.W++;const r=Qn(n.I);$e(r,"SID",n.K),$e(r,"RID",t),$e(r,"AID",n.V),zr(n,r),n.o&&n.s&&rs(r,n.o,n.s),t=new Or(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Ml(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),ts(n.i,t),La(t,r,e)}function zr(n,e){n.na&&jt(n.na,function(t,r){$e(e,r,t)}),n.h&&Vn({},function(t,r){$e(e,r,t)})}function Ml(n,e,t){t=Math.min(n.j.length,t);var r=n.h?_e(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let c=!0;for(let d=0;d<t;d++){let f=i[d].g;const g=i[d].map;if(f-=s,0>f)s=Math.max(0,i[d].g-100),c=!1;else try{xh(g,o,"req"+f+"_")}catch{r&&r(g)}}if(c){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function po(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Cr||Tl(),jn||(Cr(),jn=!0),ji.add(e,n),n.A=0}}function Ya(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=kr(_e(n.Ma,n),Bl(n,n.A)),n.A++,0))}function os(n){null!=n.B&&(ae.clearTimeout(n.B),n.B=null)}function Fl(n){n.g=new Or(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Qn(n.wa);$e(e,"RID","rpc"),$e(e,"SID",n.K),$e(e,"AID",n.V),$e(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&$e(e,"TO",n.qa),$e(e,"TYPE","xmlhttp"),zr(n,e),n.o&&n.s&&rs(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=qr(Qn(e)),t.u=null,t.S=!0,Gs(t,n)}function yi(n){null!=n.v&&(ae.clearTimeout(n.v),n.v=null)}function Ul(n,e){var t=null;if(n.g==e){yi(n),os(n),n.g=null;var r=2}else{if(!_i(n.i,e))return;t=e.F,za(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;xt(r=pi(),new Pl(r,t)),fo(n)}else po(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function Ja(n,e){return!(eo(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=kr(_e(n.Na,n,e),Bl(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ya(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:hr(n,5);break;case 4:hr(n,10);break;case 3:hr(n,6);break;default:hr(n,2)}}function Bl(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function hr(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=_e(n.pb,n);t||(t=new Ur("//www.google.com/images/cleardot.gif"),ae.location&&"http"==ae.location.protocol||Hs(t,"https"),qr(t)),function $a(n,e){const t=new di;if(ae.Image){const r=new Image;r.onload=Ne(no,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ne(no,t,r,"TestLoadImage: error",!1,e),r.onabort=Ne(no,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ne(no,t,r,"TestLoadImage: timeout",!1,e),ae.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Dt(2);n.H=0,n.h&&n.h.za(e),mo(n),ho(n)}function mo(n){if(n.H=0,n.ma=[],n.h){const e=to(n.i);(0!=e.length||0!=n.j.length)&&($n(n.ma,e),$n(n.ma,n.j),n.i.i.length=0,Gn(n.j),n.j.length=0),n.h.ya()}}function ql(n,e,t){var r=t instanceof Ur?Qn(t):new Ur(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Qs(r,r.m);else{var i=ae.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Ur(null);r&&Hs(s,r),e&&(s.g=e),i&&Qs(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&$e(r,t,e),$e(r,"VER",n.ra),zr(n,r),r}function Gr(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new st(n.Ha&&!n.va?new Wr({ob:t}):n.va)).Oa(n.J),e}function Xa(){}function go(){if(It&&!(10<=Number(le)))throw Error("Environmental error: no available transport.")}function an(n,e){it.call(this),this.g=new Ol(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!$t(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!$t(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Ii(this)}function Wl(n){Oa.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Kl(){Qi.call(this),this.status=1}function Ii(n){this.g=n}function Ln(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function zl(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function Ce(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}($=st.prototype).Oa=function(n){this.M=n},$.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Vr.g(),this.C=function zs(n){return n.h||(n.h=n.i())}(this.u?this.u:Vr),this.g.onreadystatechange=_e(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void so(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=ae.FormData&&n instanceof ae.FormData,!(0<=Ot(Ha,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{uo(this),0<this.B&&((this.L=function kh(n){return It&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_e(this.ua,this)):this.A=qs(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){so(this,s)}},$.ua=function(){typeof sr<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xt(this,"timeout"),this.abort(8))},$.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,xt(this,"complete"),xt(this,"abort"),ao(this))},$.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ao(this,!0)),st.$.N.call(this)},$.La=function(){this.s||(this.G||this.v||this.l?oo(this):this.kb())},$.kb=function(){oo(this)},$.isActive=function(){return!!this.g},$.da=function(){try{return 2<On(this)?this.g.status:-1}catch{return-1}},$.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},$.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),ja(e)}},$.Ia=function(){return this.m},$.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},($=Ol.prototype).ra=8,$.H=1,$.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Or(this,this.l,n);let s=this.s;if(this.U&&(s?(s=va(s),Ea(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Ml(this,i,e),$e(t=Qn(this.I),"RID",n),$e(t,"CVER",22),this.F&&$e(t,"X-HTTP-Session-Id",this.F),zr(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Vl(s)))+"&"+e:this.o&&rs(t,this.o,s)),ts(this.i,i),this.bb&&$e(t,"TYPE","init"),this.P?($e(t,"$req",e),$e(t,"SID","null"),i.aa=!0,La(i,t,null)):La(i,t,e),this.H=2}}else 3==this.H&&(n?Ll(this,n):0==this.j.length||Ka(this.i)||Ll(this))},$.Ma=function(){if(this.u=null,Fl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=kr(_e(this.jb,this),n)}},$.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Dt(10),co(this),Fl(this))},$.ib=function(){null!=this.v&&(this.v=null,co(this),Ya(this),Dt(19))},$.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Dt(2)):(this.l.info("Failed to ping google.com"),Dt(1))},$.isActive=function(){return!!this.h&&this.h.isActive(this)},($=Xa.prototype).Ba=function(){},$.Aa=function(){},$.za=function(){},$.ya=function(){},$.isActive=function(){return!0},$.Va=function(){},go.prototype.g=function(n,e){return new an(n,e)},be(an,it),an.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Dt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=ql(n,null,n.Y),fo(n)},an.prototype.close=function(){ss(this.g)},an.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Sa(n),n=t);e.j.push(new Ba(e.fb++,n)),3==e.H&&fo(e)},an.prototype.N=function(){this.g.h=null,delete this.j,ss(this.g),delete this.g,an.$.N.call(this)},be(Wl,Oa),be(Kl,Qi),be(Ii,Xa),Ii.prototype.Ba=function(){xt(this.g,"a")},Ii.prototype.Aa=function(n){xt(this.g,new Wl(n))},Ii.prototype.za=function(n){xt(this.g,new Kl)},Ii.prototype.ya=function(){xt(this.g,"b")},be(Ln,function zp(){this.blockSize=-1}),Ln.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ln.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)zl(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){zl(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){zl(this,r),i=0;break}}this.h=i,this.i+=e},Ln.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Vh={};function Za(n){return-128<=n&&128>n?function Me(n,e){var t=Vh;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new Ce([0|e],0>e?-1:0)}):new Ce([0|n],0>n?-1:0)}function Yn(n){if(isNaN(n)||!isFinite(n))return as;if(0>n)return mt(Yn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Gl;return new Ce(e,0)}var Gl=4294967296,as=Za(0),$l=Za(1),Lh=Za(16777216);function Rn(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Et(n){return-1==n.h}function mt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new Ce(t,~n.h).add($l)}function _o(n,e){return n.add(mt(e))}function yo(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function us(n,e){this.g=n,this.h=e}function eu(n,e){if(Rn(e))throw Error("division by zero");if(Rn(n))return new us(as,as);if(Et(n))return e=eu(mt(n),e),new us(mt(e.g),mt(e.h));if(Et(e))return e=eu(n,mt(e)),new us(mt(e.g),e.h);if(30<n.g.length){if(Et(n)||Et(e))throw Error("slowDivide_ only works with positive integers.");for(var t=$l,r=e;0>=r.X(n);)t=jl(t),r=jl(r);var i=vi(t,1),s=vi(r,1);for(r=vi(r,2),t=vi(t,2);!Rn(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=vi(r,1),t=vi(t,1)}return e=_o(n,i.R(e)),new us(i,e)}for(i=as;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Yn(t)).R(e);Et(o)||0<o.X(n);)o=(s=Yn(t-=r)).R(e);Rn(s)&&(s=$l),i=i.add(s),n=_o(n,o)}return new us(i,n)}function jl(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new Ce(t,n.h)}function vi(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new Ce(i,n.h)}($=Ce.prototype).ea=function(){if(Et(this))return-mt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Gl+r)*e,e*=Gl}return n},$.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(Rn(this))return"0";if(Et(this))return"-"+mt(this).toString(n);for(var e=Yn(Math.pow(n,6)),t=this,r="";;){var i=eu(t,e).g,s=((0<(t=_o(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(Rn(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},$.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},$.X=function(n){return Et(n=_o(this,n))?-1:Rn(n)?0:1},$.abs=function(){return Et(this)?mt(this):this},$.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new Ce(t,-2147483648&t[t.length-1]?-1:0)},$.R=function(n){if(Rn(this)||Rn(n))return as;if(Et(this))return Et(n)?mt(this).R(mt(n)):mt(mt(this).R(n));if(Et(n))return mt(this.R(mt(n)));if(0>this.X(Lh)&&0>n.X(Lh))return Yn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),c=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=o*d,yo(t,2*r+2*i),t[2*r+2*i+1]+=s*d,yo(t,2*r+2*i+1),t[2*r+2*i+1]+=o*c,yo(t,2*r+2*i+1),t[2*r+2*i+2]+=s*c,yo(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new Ce(t,0)},$.gb=function(n){return eu(this,n).h},$.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new Ce(t,this.h&n.h)},$.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new Ce(t,this.h|n.h)},$.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new Ce(t,this.h^n.h)},go.prototype.createWebChannel=go.prototype.g,an.prototype.send=an.prototype.u,an.prototype.open=an.prototype.m,an.prototype.close=an.prototype.close,Ws.NO_ERROR=0,Ws.TIMEOUT=8,Ws.HTTP_ERROR=6,Ks.COMPLETE="complete",Sl.EventType=Nr,Nr.OPEN="a",Nr.CLOSE="b",Nr.ERROR="c",Nr.MESSAGE="d",it.prototype.listen=it.prototype.O,st.prototype.listenOnce=st.prototype.P,st.prototype.getLastError=st.prototype.Sa,st.prototype.getLastErrorCode=st.prototype.Ia,st.prototype.getStatus=st.prototype.da,st.prototype.getResponseJson=st.prototype.Wa,st.prototype.getResponseText=st.prototype.ja,st.prototype.send=st.prototype.ha,st.prototype.setWithCredentials=st.prototype.Oa,Ln.prototype.digest=Ln.prototype.l,Ln.prototype.reset=Ln.prototype.reset,Ln.prototype.update=Ln.prototype.j,Ce.prototype.add=Ce.prototype.add,Ce.prototype.multiply=Ce.prototype.R,Ce.prototype.modulo=Ce.prototype.gb,Ce.prototype.compare=Ce.prototype.X,Ce.prototype.toNumber=Ce.prototype.ea,Ce.prototype.toString=Ce.prototype.toString,Ce.prototype.getBits=Ce.prototype.D,Ce.fromNumber=Yn,Ce.fromString=function Oh(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return mt(Oh(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Yn(Math.pow(e,8)),r=as,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Yn(Math.pow(e,s)),r=r.R(s).add(Yn(o))):r=(r=r.R(t)).add(Yn(o))}return r};var tu=ct.createWebChannelTransport=function(){return new go},nu=ct.getStatEventTarget=function(){return pi()},ru=ct.ErrorCode=Ws,Io=ct.EventType=Ks,Hl=ct.Event=Hn,Ql=ct.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Mh=ct.FetchXmlHttpFactory=Wr,vo=ct.WebChannel=Sl,Gp=ct.XhrIo=st,Jl=ct.Md5=Ln,ls=ct.Integer=Ce;const Eo="@firebase/firestore";class Tt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Tt.UNAUTHENTICATED=new Tt(null),Tt.GOOGLE_CREDENTIALS=new Tt("google-credentials-uid"),Tt.FIRST_PARTY=new Tt("first-party-uid"),Tt.MOCK_USER=new Tt("mock-user");let Ei="10.11.1";const gn=new de.Vy("@firebase/firestore");function Ti(){return gn.logLevel}function M(n,...e){if(gn.logLevel<=de.$b.DEBUG){const t=e.map(cs);gn.debug(`Firestore (${Ei}): ${n}`,...t)}}function et(n,...e){if(gn.logLevel<=de.$b.ERROR){const t=e.map(cs);gn.error(`Firestore (${Ei}): ${n}`,...t)}}function Ht(n,...e){if(gn.logLevel<=de.$b.WARN){const t=e.map(cs);gn.warn(`Firestore (${Ei}): ${n}`,...t)}}function cs(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function Z(n="Unexpected state"){const e=`FIRESTORE (${Ei}) INTERNAL ASSERTION FAILED: `+n;throw et(e),new Error(e)}function ne(n,e){n||Z()}function j(n,e){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends oe.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class hs{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fh{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Tt.UNAUTHENTICATED))}shutdown(){}}class iu{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Xl{constructor(e){this.t=e,this.currentUser=Tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let o=new tt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new tt,e.enqueueRetryable(()=>s(this.currentUser))};const c=()=>{const f=o;e.enqueueRetryable((0,m.A)(function*(){yield f.promise,yield s(r.currentUser)}))},d=f=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),c()};this.t.onInit(f=>d(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?d(f):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new tt)}},0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ne("string"==typeof r.accessToken),new hs(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ne(null===e||"string"==typeof e),new Tt(e)}}class su{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Tt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Uh{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new su(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Tt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class To{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zl{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ne("string"==typeof t.token),this.R=t.token,new To(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Bh(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class qh{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Bh(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function he(n,e){return n<e?-1:n>e?1:0}function Ai(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function ec(n){return n+"\0"}class Ye{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new O(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ye.fromMillis(Date.now())}static fromDate(e){return Ye.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ye(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?he(this.nanoseconds,e.nanoseconds):he(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ie{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ie(e)}static min(){return new ie(new Ye(0,0))}static max(){return new ie(new Ye(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ds{constructor(e,t,r){void 0===t?t=0:t>e.length&&Z(),void 0===r?r=e.length-t:r>e.length-t&&Z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ds.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ds?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ie extends ds{construct(e,t,r){return new Ie(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new O(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Ie(t)}static emptyPath(){return new Ie([])}}const Wh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class je extends ds{construct(e,t,r){return new je(e,t,r)}static isValidIdentifier(e){return Wh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),je.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new je(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new O(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const c=e[i];if("\\"===c){if(i+1===e.length)throw new O(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new O(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===c?(o=!o,i++):"."!==c||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new O(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new je(t)}static emptyPath(){return new je([])}}class Q{constructor(e){this.path=e}static fromPath(e){return new Q(Ie.fromString(e))}static fromName(e){return new Q(Ie.fromString(e).popFirst(5))}static empty(){return new Q(Ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ie.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Q(new Ie(e.slice()))}}class dr{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function ou(n){return n.fields.find(e=>2===e.kind)}function $r(n){return n.fields.filter(e=>2!==e.kind)}dr.UNKNOWN_ID=-1;class jr{constructor(e,t){this.fieldPath=e,this.kind=t}}class wi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new wi(0,qt.min())}}function nc(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ie.fromTimestamp(1e9===r?new Ye(t+1,0):new Ye(t,r));return new qt(i,Q.empty(),e)}function rc(n){return new qt(n.readTime,n.key,-1)}class qt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new qt(ie.min(),Q.empty(),-1)}static max(){return new qt(ie.max(),Q.empty(),-1)}}function au(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=Q.comparator(n.documentKey,e.documentKey),0!==t?t:he(n.largestBatchId,e.largestBatchId))}const Ao="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ic{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Mn(n){return uu.apply(this,arguments)}function uu(){return uu=(0,m.A)(function*(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==Ao)throw n;M("LocalStore","Unexpectedly lost primary lease")}),uu.apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,r)=>{t(e)})}static reject(e){return new P((t,r)=>{r(e)})}static waitFor(e){return new P((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},d=>r(d))}),o=!0,s===i&&t()})}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next(i=>i?P.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new P((r,i)=>{const s=e.length,o=new Array(s);let c=0;for(let d=0;d<s;d++){const f=d;t(e[f]).next(g=>{o[f]=g,++c,c===s&&r(o)},g=>i(g))}})}static doWhile(e,t){return new P((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Hr{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new tt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new fs(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=hu(r.target.error);this.V.reject(new fs(e,i))}}static open(e,t,r,i){try{return new Hr(t,e.transaction(i,r))}catch(s){throw new fs(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(M("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new cu(t)}}class _n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===_n.S((0,oe.ZQ)())&&et("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M("SimpleDb","Removing database:",e),Qr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,oe.zW)())return!1;if(_n.C())return!0;const e=(0,oe.ZQ)(),t=_n.S(e),r=0<t&&t<10,i=sc(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){var t=this;return(0,m.A)(function*(){return t.db||(M("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new fs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const c=o.target.error;i("VersionError"===c.name?new O(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===c.name?new O(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c):new fs(e,c))},s.onupgradeneeded=o=>{M("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.O(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{M("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=r=>t.N(r)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,m.A)(function*(){const o="readonly"===t;let c=0;for(;;){++c;try{s.db=yield s.M(e);const d=Hr.open(s.db,e,o?"readonly":"readwrite",r),f=i(d).next(g=>(d.g(),g)).catch(g=>(d.abort(g),P.reject(g))).toPromise();return f.catch(()=>{}),yield d.m,f}catch(d){const f=d,g="FirebaseError"!==f.name&&c<3;if(M("SimpleDb","Transaction failed with error:",f.message,"Retrying:",g),s.close(),!g)return Promise.reject(f)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function sc(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class lu{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Qr(this.B.delete())}}class fs extends O{constructor(e,t){super(b.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Qt(n){return"IndexedDbTransactionError"===n.name}class cu{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(M("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(M("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Qr(r)}add(e){return M("SimpleDb","ADD",this.store.name,e,e),Qr(this.store.add(e))}get(e){return Qr(this.store.get(e)).next(t=>(void 0===t&&(t=null),M("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return M("SimpleDb","DELETE",this.store.name,e),Qr(this.store.delete(e))}count(){return M("SimpleDb","COUNT",this.store.name),Qr(this.store.count())}U(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new P((o,c)=>{s.onerror=d=>{c(d.target.error)},s.onsuccess=d=>{o(d.target.result)}})}{const s=this.cursor(r),o=[];return this.W(s,(c,d)=>{o.push(d)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new P((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){M("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const i=this.cursor(r);return this.W(i,(s,o,c)=>c.delete())}J(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Y(e){const t=this.cursor({});return new P((r,i)=>{t.onerror=s=>{const o=hu(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():r()}):r()}})}W(e,t){const r=[];return new P((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const c=o.target.result;if(!c)return void i();const d=new lu(c),f=t(c.primaryKey,c.value,d);if(f instanceof P){const g=f.catch(y=>(d.done(),P.reject(y)));r.push(g)}d.isDone?i():null===d.K?c.continue():c.continue(d.K)}}).next(()=>P.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Qr(n){return new P((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=hu(r.target.error);t(i)}})}let oc=!1;function hu(n){const e=_n.S((0,oe.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new O("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return oc||(oc=!0,setTimeout(()=>{throw r},0)),r}}return n}class du{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;M("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,m.A)(function*(){t.task=null;try{M("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(r){Qt(r)?M("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield Mn(r)}yield t.X(6e4)}))}}class ac{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,m.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.te(r,e))})()}te(e,t){const r=new Set;let i=t,s=!0;return P.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return M("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(c=>{i-=c,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(c=>(M("IndexBackfiller",`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=rc(s);au(o,r)>0&&(r=o)}),new qt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let un=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function ps(n){return null==n}function Jr(n){return 0===n&&1/n==-1/0}function uc(n){return"number"==typeof n&&Number.isInteger(n)&&!Jr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function At(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=wo(e)),e=zh(n.get(t),e);return wo(e)}function zh(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function wo(n){return n+"\x01\x01"}function yn(n){const e=n.length;if(ne(e>=2),2===e)return ne("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),Ie.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&Z(),n.charAt(o+1)){case"\x01":const c=n.substring(s,o);let d;0===i.length?d=c:(i+=c,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:Z()}s=o+2}return new Ie(r)}const lc=["userId","batchId"];function fr(n,e){return[n,At(e)]}function cc(n,e,t){return[n,At(e),t]}const Gh={},fu=["prefixPath","collectionGroup","readTime","documentId"],pu=["prefixPath","collectionGroup","documentId"],mu=["collectionGroup","readTime","prefixPath","documentId"],$h=["canonicalId","targetId"],hc=["targetId","path"],dc=["path","targetId"],fc=["collectionId","parent"],jh=["indexId","uid"],Hh=["uid","sequenceNumber"],gu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Qh=["indexId","uid","orderedDocumentKey"],Jh=["userId","collectionPath","documentId"],_u=["userId","collectionPath","largestBatchId"],Yh=["userId","collectionGroup","largestBatchId"],pc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],yu=[...pc,"documentOverlays"],mc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ro=mc,Po=[...Ro,"indexConfiguration","indexState","indexEntries"],Iu=Po;class So extends ic{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function dt(n,e){const t=j(n);return _n.F(t._e,e)}function gc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Xn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function vu(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Fe{constructor(e,t){this.comparator=e,this.root=t||wt.EMPTY}insert(e,t){return new Fe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wt.BLACK,null,null))}remove(e){return new Fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bo(this.root,e,this.comparator,!1)}getReverseIterator(){return new bo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bo(this.root,e,this.comparator,!0)}}class bo{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:wt.RED,this.left=null!=i?i:wt.EMPTY,this.right=null!=s?s:wt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new wt(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return wt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return wt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Z();const e=this.left.check();if(e!==this.right.check())throw Z();return e+(this.isRed()?0:1)}}wt.EMPTY=null,wt.RED=!0,wt.BLACK=!1,wt.EMPTY=new class{constructor(){this.size=0}get key(){throw Z()}get value(){throw Z()}get color(){throw Z()}get left(){throw Z()}get right(){throw Z()}copy(e,t,r,i,s){return this}insert(e,t,r){return new wt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class De{constructor(e){this.comparator=e,this.data=new Fe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _c(this.data.getIterator())}getIteratorFrom(e){return new _c(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof De)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new De(this.comparator);return t.data=e,t}}class _c{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ri(n){return n.hasNext()?n.getNext():void 0}class Jt{constructor(e){this.fields=e,e.sort(je.comparator)}static empty(){return new Jt([])}unionWith(e){let t=new De(je.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Jt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ai(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Co extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Co("Invalid base64 string: "+s):s}}(e);return new gt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new gt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return he(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}gt.EMPTY_BYTE_STRING=new gt("");const yc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zn(n){if(ne(!!n),"string"==typeof n){let e=0;const t=yc.exec(n);if(ne(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:He(n.seconds),nanos:He(n.nanos)}}function He(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function er(n){return"string"==typeof n?gt.fromBase64String(n):gt.fromUint8Array(n)}function xo(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Do(n){const e=n.mapValue.fields.__previous_value__;return xo(e)?Do(e):e}function ms(n){const e=Zn(n.mapValue.fields.__local_write_time__.timestampValue);return new Ye(e.seconds,e.nanos)}class Zh{constructor(e,t,r,i,s,o,c,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=f}}class pr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new pr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof pr&&e.projectId===this.projectId&&e.database===this.database}}const mr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ko={nullValue:"NULL_VALUE"};function Fn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xo(n)?4:Lo(n)?9007199254740991:10:Z()}function Un(n,e){if(n===e)return!0;const t=Fn(n);if(t!==Fn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ms(n).isEqual(ms(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Zn(i.timestampValue),c=Zn(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,er(n.bytesValue).isEqual(er(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return He(i.geoPointValue.latitude)===He(s.geoPointValue.latitude)&&He(i.geoPointValue.longitude)===He(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return He(i.integerValue)===He(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=He(i.doubleValue),c=He(s.doubleValue);return o===c?Jr(o)===Jr(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return Ai(n.arrayValue.values||[],e.arrayValue.values||[],Un);case 10:return function(i,s){const o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(gc(o)!==gc(c))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(void 0===c[d]||!Un(o[d],c[d])))return!1;return!0}(n,e);default:return Z()}var s}function gs(n,e){return void 0!==(n.values||[]).find(t=>Un(t,e))}function gr(n,e){if(n===e)return 0;const t=Fn(n),r=Fn(e);if(t!==r)return he(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return he(n.booleanValue,e.booleanValue);case 2:return function(s,o){const c=He(s.integerValue||s.doubleValue),d=He(o.integerValue||o.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(n,e);case 3:return Ic(n.timestampValue,e.timestampValue);case 4:return Ic(ms(n),ms(e));case 5:return he(n.stringValue,e.stringValue);case 6:return function(s,o){const c=er(s),d=er(o);return c.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const c=s.split("/"),d=o.split("/");for(let f=0;f<c.length&&f<d.length;f++){const g=he(c[f],d[f]);if(0!==g)return g}return he(c.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const c=he(He(s.latitude),He(o.latitude));return 0!==c?c:he(He(s.longitude),He(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const c=s.values||[],d=o.values||[];for(let f=0;f<c.length&&f<d.length;++f){const g=gr(c[f],d[f]);if(g)return g}return he(c.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===mr.mapValue&&o===mr.mapValue)return 0;if(s===mr.mapValue)return 1;if(o===mr.mapValue)return-1;const c=s.fields||{},d=Object.keys(c),f=o.fields||{},g=Object.keys(f);d.sort(),g.sort();for(let y=0;y<d.length&&y<g.length;++y){const v=he(d[y],g[y]);if(0!==v)return v;const w=gr(c[d[y]],f[g[y]]);if(0!==w)return w}return he(d.length,g.length)}(n.mapValue,e.mapValue);default:throw Z()}}function Ic(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return he(n,e);const t=Zn(n),r=Zn(e),i=he(t.seconds,r.seconds);return 0!==i?i:he(t.nanos,r.nanos)}function Pi(n){return No(n)}function No(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Zn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?er(n.bytesValue).toBase64():"referenceValue"in n?Q.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=No(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${No(t.fields[o])}`;return i+"}"}(n.mapValue):Z()}function Yr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Eu(n){return!!n&&"integerValue"in n}function _s(n){return!!n&&"arrayValue"in n}function vc(n){return!!n&&"nullValue"in n}function Oo(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Si(n){return!!n&&"mapValue"in n}function ys(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Xn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ys(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ys(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Lo(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function ed(n){return"nullValue"in n?ko:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Yr(pr.empty(),Q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:Z()}function Ec(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Yr(pr.empty(),Q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?mr:Z()}function Tu(n,e){const t=gr(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Mo(n,e){const t=gr(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class kt{constructor(e){this.value=e}static empty(){return new kt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Si(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ys(t)}setAll(e){let t=je.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=ys(o):i.push(c.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Si(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Un(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Si(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Xn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new kt(ys(this.value))}}function td(n){const e=[];return Xn(n.fields,(t,r)=>{const i=new je([t]);if(Si(r)){const s=td(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Jt(e)}class Ue{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new Ue(e,0,ie.min(),ie.min(),ie.min(),kt.empty(),0)}static newFoundDocument(e,t,r,i){return new Ue(e,1,t,ie.min(),r,i,0)}static newNoDocument(e,t){return new Ue(e,2,t,ie.min(),ie.min(),kt.empty(),0)}static newUnknownDocument(e,t){return new Ue(e,3,t,ie.min(),ie.min(),kt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ie.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ue&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ue(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class tr{constructor(e,t){this.position=e,this.inclusive=t}}function Is(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?Q.comparator(Q.fromName(o.referenceValue),t.key):gr(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Au(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Un(n.position[t],e.position[t]))return!1;return!0}class bi{constructor(e,t="asc"){this.field=e,this.dir=t}}function nd(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Tc{}class Te extends Tc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new h(e,t,r):"array-contains"===t?new S(e,r):"in"===t?new L(e,r):"not-in"===t?new ee(e,r):"array-contains-any"===t?new se(e,r):new Te(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new p(e,r):new _(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(gr(t,this.value)):null!==t&&Fn(this.value)===Fn(t)&&this.matchesComparison(gr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ve extends Tc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ve(e,t)}matches(e){return Ci(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ci(n){return"and"===n.op}function Fo(n){return"or"===n.op}function wu(n){return Ac(n)&&Ci(n)}function Ac(n){for(const e of n.filters)if(e instanceof Ve)return!1;return!0}function Ru(n){if(n instanceof Te)return n.field.canonicalString()+n.op.toString()+Pi(n.value);if(wu(n))return n.filters.map(e=>Ru(e)).join(",");{const e=n.filters.map(t=>Ru(t)).join(",");return`${n.op}(${e})`}}function l(n,e){return n instanceof Te?(r=n,(i=e)instanceof Te&&r.op===i.op&&r.field.isEqual(i.field)&&Un(r.value,i.value)):n instanceof Ve?function(r,i){return i instanceof Ve&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,c)=>s&&l(o,i.filters[c]),!0)}(n,e):void Z();var r,i}function a(n,e){const t=n.filters.concat(e);return Ve.create(t,n.op)}function u(n){return n instanceof Te?`${(t=n).field.canonicalString()} ${t.op} ${Pi(t.value)}`:n instanceof Ve?function(t){return t.op.toString()+" {"+t.getFilters().map(u).join(" ,")+"}"}(n):"Filter";var t}class h extends Te{constructor(e,t,r){super(e,t,r),this.key=Q.fromName(r.referenceValue)}matches(e){const t=Q.comparator(e.key,this.key);return this.matchesComparison(t)}}class p extends Te{constructor(e,t){super(e,"in",t),this.keys=T(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class _ extends Te{constructor(e,t){super(e,"not-in",t),this.keys=T(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function T(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>Q.fromName(r.referenceValue))}class S extends Te{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _s(t)&&gs(t.arrayValue,this.value)}}class L extends Te{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&gs(this.value.arrayValue,t)}}class ee extends Te{constructor(e,t){super(e,"not-in",t)}matches(e){if(gs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!gs(this.value.arrayValue,t)}}class se extends Te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_s(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>gs(this.value.arrayValue,r))}}class ve{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.ue=null}}function Mt(n,e=null,t=[],r=[],i=null,s=null,o=null){return new ve(n,e,t,r,i,s,o)}function Yt(n){const e=j(n);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ru(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),ps(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Pi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Pi(r)).join(",")),e.ue=t}return e.ue}function _r(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!nd(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!l(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Au(n.startAt,e.startAt)&&Au(n.endAt,e.endAt)}function vs(n){return Q.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function xi(n,e){return n.filters.filter(t=>t instanceof Te&&t.field.isEqual(e))}function Pu(n,e,t){let r=ko,i=!0;for(const s of xi(n,e)){let o=ko,c=!0;switch(s.op){case"<":case"<=":o=ed(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=ko}Tu({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Tu({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function Su(n,e,t){let r=mr,i=!0;for(const s of xi(n,e)){let o=mr,c=!0;switch(s.op){case">=":case">":o=Ec(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=mr}Mo({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Mo({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class Pn{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null}}function bu(n,e,t,r,i,s,o,c){return new Pn(n,e,t,r,i,s,o,c)}function Xr(n){return new Pn(n)}function Uo(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Bo(n){return null!==n.collectionGroup}function Di(n){const e=j(n);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new De(je.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(f=>{f.isInequality()&&(c=c.add(f.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new bi(s,r))}),t.has(je.keyField().canonicalString())||e.ce.push(new bi(je.keyField(),r))}return e.ce}function Nt(n){const e=j(n);return e.le||(e.le=function wc(n,e){if("F"===n.limitType)return Mt(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new bi(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new tr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new tr(n.startAt.position,n.startAt.inclusive):null;return Mt(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,Di(n))),e.le}function rd(n,e){const t=n.filters.concat([e]);return new Pn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Rc(n,e,t){return new Pn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Cu(n,e){return _r(Nt(n),Nt(e))&&n.limitType===e.limitType}function jp(n){return`${Yt(Nt(n))}|lt:${n.limitType}`}function qo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>u(i)).join(", ")}]`),ps(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Pi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Pi(i)).join(",")),`Target(${r})`}(Nt(n))}; limitType=${n.limitType})`}function xu(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Q.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Di(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,c,d){const f=Is(o,c,d);return o.inclusive?f<=0:f<0}(r.startAt,Di(r),i)||r.endAt&&!function(o,c,d){const f=Is(o,c,d);return o.inclusive?f>=0:f>0}(r.endAt,Di(r),i)));var r,i}function Hp(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Qp(n){return(e,t)=>{let r=!1;for(const i of Di(n)){const s=Uy(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function Uy(n,e,t){const r=n.field.isKeyField()?Q.comparator(e.key,t.key):function(s,o,c){const d=o.data.field(s),f=c.data.field(s);return null!==d&&null!==f?gr(d,f):Z()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Z()}}class Zr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Xn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return vu(this.inner)}size(){return this.innerSize}}const By=new Fe(Q.comparator);function In(){return By}const Jp=new Fe(Q.comparator);function Du(...n){let e=Jp;for(const t of n)e=e.insert(t.key,t);return e}function Yp(n){let e=Jp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function yr(){return ku()}function Xp(){return ku()}function ku(){return new Zr(n=>n.toString(),(n,e)=>n.isEqual(e))}const qy=new Fe(Q.comparator),Wy=new De(Q.comparator);function ye(...n){let e=Wy;for(const t of n)e=e.add(t);return e}const Ky=new De(he);function id(){return Ky}function Zp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jr(e)?"-0":e}}function em(n){return{integerValue:""+n}}function tm(n,e){return uc(e)?em(e):Zp(n,e)}class Pc{constructor(){this._=void 0}}function zy(n,e,t){return n instanceof Wo?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&xo(s)&&(s=Do(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Es?rm(n,e):n instanceof Ts?im(n,e):function(i,s){const o=nm(i,s),c=sm(o)+sm(i.Pe);return Eu(o)&&Eu(i.Pe)?em(c):Zp(i.serializer,c)}(n,e)}function Gy(n,e,t){return n instanceof Es?rm(n,e):n instanceof Ts?im(n,e):t}function nm(n,e){return n instanceof Ko?Eu(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Wo extends Pc{}class Es extends Pc{constructor(e){super(),this.elements=e}}function rm(n,e){const t=om(e);for(const r of n.elements)t.some(i=>Un(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ts extends Pc{constructor(e){super(),this.elements=e}}function im(n,e){let t=om(e);for(const r of n.elements)t=t.filter(i=>!Un(i,r));return{arrayValue:{values:t}}}class Ko extends Pc{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function sm(n){return He(n.integerValue||n.doubleValue)}function om(n){return _s(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Nu{constructor(e,t){this.field=e,this.transform=t}}class jy{constructor(e,t){this.version=e,this.transformResults=t}}class ot{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ot}static exists(e){return new ot(void 0,e)}static updateTime(e){return new ot(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Sc(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class bc{}function am(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Go(n.key,ot.none()):new zo(n.key,n.data,ot.none());{const t=n.data,r=kt.empty();let i=new De(je.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new ei(n.key,r,new Jt(i.toArray()),ot.none())}}function Hy(n,e,t){n instanceof zo?function(i,s,o){const c=i.value.clone(),d=cm(i.fieldTransforms,s,o.transformResults);c.setAll(d),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof ei?function(i,s,o){if(!Sc(i.precondition,s))return void s.convertToUnknownDocument(o.version);const c=cm(i.fieldTransforms,s,o.transformResults),d=s.data;d.setAll(lm(i)),d.setAll(c),s.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Vu(n,e,t,r){return n instanceof zo?function(s,o,c,d){if(!Sc(s.precondition,o))return c;const f=s.value.clone(),g=hm(s.fieldTransforms,d,o);return f.setAll(g),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof ei?function(s,o,c,d){if(!Sc(s.precondition,o))return c;const f=hm(s.fieldTransforms,d,o),g=o.data;return g.setAll(lm(s)),g.setAll(f),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),null===c?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(y=>y.field))}(n,e,t,r):(c=t,Sc(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c);var o,c}function Qy(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=nm(r.transform,i||null);null!=s&&(null===t&&(t=kt.empty()),t.set(r.field,s))}return t||null}function um(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Ai(r,i,(s,o)=>function $y(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Es&&i instanceof Es||r instanceof Ts&&i instanceof Ts?Ai(r.elements,i.elements,Un):r instanceof Ko&&i instanceof Ko?Un(r.Pe,i.Pe):r instanceof Wo&&i instanceof Wo);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class zo extends bc{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ei extends bc{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function lm(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function cm(n,e,t){const r=new Map;ne(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,Gy(o,c,t[i]))}return r}function hm(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,zy(s,o,e))}return r}class Go extends bc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sd extends bc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class od{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Hy(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Vu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Vu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Xp();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;const d=am(o,c);null!==d&&r.set(i.key,d),o.isValidDocument()||o.convertToNoDocument(ie.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ye())}isEqual(e){return this.batchId===e.batchId&&Ai(this.mutations,e.mutations,(t,r)=>um(t,r))&&Ai(this.baseMutations,e.baseMutations,(t,r)=>um(t,r))}}class ad{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){ne(e.mutations.length===r.length);let i=function(){return qy}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new ad(e,t,r,i)}}class ud{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Yy{constructor(e,t){this.count=e,this.unchangedNames=t}}var Rt,Se;function dm(n){switch(n){default:return Z();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function fm(n){if(void 0===n)return et("GRPC error has no .code"),b.UNKNOWN;switch(n){case Rt.OK:return b.OK;case Rt.CANCELLED:return b.CANCELLED;case Rt.UNKNOWN:return b.UNKNOWN;case Rt.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case Rt.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case Rt.INTERNAL:return b.INTERNAL;case Rt.UNAVAILABLE:return b.UNAVAILABLE;case Rt.UNAUTHENTICATED:return b.UNAUTHENTICATED;case Rt.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case Rt.NOT_FOUND:return b.NOT_FOUND;case Rt.ALREADY_EXISTS:return b.ALREADY_EXISTS;case Rt.PERMISSION_DENIED:return b.PERMISSION_DENIED;case Rt.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case Rt.ABORTED:return b.ABORTED;case Rt.OUT_OF_RANGE:return b.OUT_OF_RANGE;case Rt.UNIMPLEMENTED:return b.UNIMPLEMENTED;case Rt.DATA_LOSS:return b.DATA_LOSS;default:return Z()}}(Se=Rt||(Rt={}))[Se.OK=0]="OK",Se[Se.CANCELLED=1]="CANCELLED",Se[Se.UNKNOWN=2]="UNKNOWN",Se[Se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Se[Se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Se[Se.NOT_FOUND=5]="NOT_FOUND",Se[Se.ALREADY_EXISTS=6]="ALREADY_EXISTS",Se[Se.PERMISSION_DENIED=7]="PERMISSION_DENIED",Se[Se.UNAUTHENTICATED=16]="UNAUTHENTICATED",Se[Se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Se[Se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Se[Se.ABORTED=10]="ABORTED",Se[Se.OUT_OF_RANGE=11]="OUT_OF_RANGE",Se[Se.UNIMPLEMENTED=12]="UNIMPLEMENTED",Se[Se.INTERNAL=13]="INTERNAL",Se[Se.UNAVAILABLE=14]="UNAVAILABLE",Se[Se.DATA_LOSS=15]="DATA_LOSS";function pm(){return new TextEncoder}const Xy=new ls([4294967295,4294967295],0);function mm(n){const e=pm().encode(n),t=new Jl;return t.update(e),new Uint8Array(t.digest())}function gm(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ls([t,r],0),new ls([i,s],0)]}class ld{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ou(`Invalid padding: ${t}`);if(r<0)throw new Ou(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Ou(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Ou(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ls.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(ls.fromNumber(r)));return 1===i.compare(Xy)&&(i=new ls([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=mm(e),[r,i]=gm(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new ld(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(0===this.Ie)return;const t=mm(e),[r,i]=gm(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ou extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Lu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Mu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Lu(ie.min(),i,new Fe(he),In(),ye())}}class Mu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Mu(r,t,ye(),ye(),ye())}}class xc{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}}class _m{constructor(e,t){this.targetId=e,this.me=t}}class ym{constructor(e,t,r=gt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Im{constructor(){this.fe=0,this.ge=Em(),this.pe=gt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=ye(),t=ye(),r=ye();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Z()}}),new Mu(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=Em()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ne(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Zy{constructor(e){this.Le=e,this.Be=new Map,this.ke=In(),this.qe=vm(),this.Qe=new Fe(he)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,r=e.me.count,i=this.Je(t);if(i){const s=i.target;if(vs(s))if(0===r){const o=new Q(s.path);this.Ue(t,o,Ue.newNoDocument(o,ie.min()))}else ne(1===r);else{const o=this.Ye(t);if(o!==r){const c=this.Ze(e),d=c?this.Xe(c,e,o):1;0!==d&&(this.je(t),this.Qe=this.Qe.insert(t,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,c;try{o=er(r).toUint8Array()}catch(d){if(d instanceof Co)return Ht("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new ld(o,i,s)}catch(d){return Ht(d instanceof Ou?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return 0===c.Ie?null:c}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,o)=>{const c=this.Je(o);if(c){if(s.current&&vs(c.target)){const d=new Q(c.target.path);null!==this.ke.get(d)||this.it(o,d)||this.Ue(o,d,Ue.newNoDocument(d,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=ye();this.qe.forEach((s,o)=>{let c=!0;o.forEachWhile(d=>{const f=this.Je(d);return!f||"TargetPurposeLimboResolution"===f.purpose||(c=!1,!1)}),c&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new Lu(e,t,this.Qe,this.ke,r);return this.ke=In(),this.qe=vm(),this.Qe=new Fe(he),i}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Im,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new De(he),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||M("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Im),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vm(){return new Fe(Q.comparator)}function Em(){return new Fe(Q.comparator)}const eI={asc:"ASCENDING",desc:"DESCENDING"},tI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},nI={and:"AND",or:"OR"};class rI{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function cd(n,e){return n.useProto3Json||ps(e)?e:{value:e}}function $o(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Tm(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function iI(n,e){return $o(n,e.toTimestamp())}function _t(n){return ne(!!n),ie.fromTimestamp(function(t){const r=Zn(t);return new Ye(r.seconds,r.nanos)}(n))}function hd(n,e){return dd(n,e).canonicalString()}function dd(n,e){const t=(i=n,new Ie(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Am(n){const e=Ie.fromString(n);return ne(Nm(e)),e}function Fu(n,e){return hd(n.databaseId,e.path)}function Ir(n,e){const t=Am(e);if(t.get(1)!==n.databaseId.projectId)throw new O(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Q(Pm(t))}function wm(n,e){return hd(n.databaseId,e)}function Rm(n){const e=Am(n);return 4===e.length?Ie.emptyPath():Pm(e)}function fd(n){return new Ie(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Pm(n){return ne(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Sm(n,e,t){return{name:Fu(n,e),fields:t.value.mapValue.fields}}function bm(n,e,t){const r=Ir(n,e.name),i=_t(e.updateTime),s=e.createTime?_t(e.createTime):ie.min(),o=new kt({mapValue:{fields:e.fields}}),c=Ue.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function Uu(n,e){let t;if(e instanceof zo)t={update:Sm(n,e.key,e.value)};else if(e instanceof Go)t={delete:Fu(n,e.key)};else if(e instanceof ei)t={update:Sm(n,e.key,e.data),updateMask:dI(e.fieldMask)};else{if(!(e instanceof sd))return Z();t={verify:Fu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const c=o.transform;if(c instanceof Wo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Es)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Ts)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Ko)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw Z()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:iI(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:Z()),t;var s}function pd(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ot.updateTime(_t(s.updateTime)):void 0!==s.exists?ot.exists(s.exists):ot.none():ot.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let d=null;"setToServerValue"in c?(ne("REQUEST_TIME"===c.setToServerValue),d=new Wo):"appendMissingElements"in c?d=new Es(c.appendMissingElements.values||[]):"removeAllFromArray"in c?d=new Ts(c.removeAllFromArray.values||[]):"increment"in c?d=new Ko(o,c.increment):Z();const f=je.fromServerFormat(c.fieldPath);return new Nu(f,d)}(n,i)):[];var s;if(e.update){const i=Ir(n,e.update.name),s=new kt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Jt((e.updateMask.fieldPaths||[]).map(g=>je.fromServerFormat(g)));return new ei(i,s,o,t,r)}return new zo(i,s,t,r)}if(e.delete){const i=Ir(n,e.delete);return new Go(i,t)}if(e.verify){const i=Ir(n,e.verify);return new sd(i,t)}return Z()}function Cm(n,e){return{documents:[wm(n,e.path)]}}function md(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=wm(n,i);const s=function(f){if(0!==f.length)return km(Ve.create(f,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(f){if(0!==f.length)return f.map(g=>{return{field:ki((v=g).field),direction:lI(v.dir)};var v})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=cd(n,e.limit);return null!==c&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt={before:(f=e.startAt).inclusive,values:f.position}),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{_t:t,parent:i};var f}function xm(n){let e=Rm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){ne(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(y){const v=Dm(y);return v instanceof Ve&&wu(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(v=>{return new bi(jo((N=v).field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction));var N}));let c=null;t.limit&&(c=function(y){let v;return v="object"==typeof y?y.value:y,ps(v)?null:v}(t.limit));let d=null;var y;t.startAt&&(d=new tr((y=t.startAt).values||[],!!y.before));let f=null;return t.endAt&&(f=function(y){return new tr(y.values||[],!y.before)}(t.endAt)),bu(e,i,o,s,c,"F",d,f)}function Dm(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=jo(t.unaryFilter.field);return Te.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=jo(t.unaryFilter.field);return Te.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=jo(t.unaryFilter.field);return Te.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=jo(t.unaryFilter.field);return Te.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Z()}}(n):void 0!==n.fieldFilter?Te.create(jo((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Z()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return Ve.create(t.compositeFilter.filters.map(r=>Dm(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Z()}}(t.compositeFilter.op))}(n):Z();var t}function lI(n){return eI[n]}function cI(n){return tI[n]}function hI(n){return nI[n]}function ki(n){return{fieldPath:n.canonicalString()}}function jo(n){return je.fromServerFormat(n.fieldPath)}function km(n){return n instanceof Te?function(t){if("=="===t.op){if(Oo(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NAN"}};if(vc(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Oo(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NOT_NAN"}};if(vc(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ki(t.field),op:cI(t.op),value:t.value}}}(n):n instanceof Ve?function(t){const r=t.getFilters().map(i=>km(i));return 1===r.length?r[0]:{compositeFilter:{op:hI(t.op),filters:r}}}(n):Z()}function dI(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Nm(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class ti{constructor(e,t,r,i,s=ie.min(),o=ie.min(),c=gt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new ti(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Vm{constructor(e){this.ut=e}}function Om(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Dc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Fu(s=n.ut,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:$o(s,o.version.toTimestamp()),createTime:$o(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:As(e.version)};else{if(!e.isUnknownDocument())return Z();r.unknownDocument={path:t.path.toArray(),version:As(e.version)}}var s,o;return r}function Dc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function As(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ws(n){const e=new Ye(n.seconds,n.nanoseconds);return ie.fromTimestamp(e)}function Rs(n,e){const t=(e.baseMutations||[]).map(s=>pd(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>pd(n.ut,s)),i=Ye.fromMillis(e.localWriteTimeMs);return new od(e.batchId,i,t,r)}function Bu(n){const e=ws(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?ws(n.lastLimboFreeSnapshotVersion):ie.min();let r;return r=void 0!==n.query.documents?(ne(1===(s=n.query).documents.length),Nt(Xr(Rm(s.documents[0])))):function(s){return Nt(xm(s))}(n.query),new ti(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,gt.fromBase64String(n.resumeToken));var s}function Lm(n,e){const t=As(e.snapshotVersion),r=As(e.lastLimboFreeSnapshotVersion);let i;i=vs(e.target)?Cm(n.ut,e.target):md(n.ut,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Yt(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function gd(n){const e=xm({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Rc(e,e.limit,"L"):e}function _d(n,e){return new ud(e.largestBatchId,pd(n.ut,e.overlayMutation))}function Mm(n,e){const t=e.path.lastSegment();return[n,At(e.path.popLast()),t]}function Fm(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:As(r.readTime),documentKey:At(r.documentKey.path),largestBatchId:r.largestBatchId}}class pI{getBundleMetadata(e,t){return Um(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:ws(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Um(e).put({bundleId:(i=t).id,createTime:As(_t(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Bm(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:gd(s.bundledQuery),readTime:ws(s.readTime)};var s})}saveNamedQuery(e,t){return Bm(e).put({name:(i=t).name,readTime:As(_t(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Um(n){return dt(n,"bundles")}function Bm(n){return dt(n,"namedQueries")}class kc{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new kc(e,t.uid||"")}getOverlay(e,t){return qu(e).get(Mm(this.userId,t)).next(r=>r?_d(this.serializer,r):null)}getOverlays(e,t){const r=yr();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const c=new ud(t,o);i.push(this.lt(e,c))}),P.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(At(o.getCollectionPath())));const s=[];return i.forEach(o=>{const c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(qu(e).j("collectionPathOverlayIndex",c))}),P.waitFor(s)}getOverlaysForCollection(e,t,r){const i=yr(),s=At(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return qu(e).U("collectionPathOverlayIndex",o).next(c=>{for(const d of c){const f=_d(this.serializer,d);i.set(f.getKey(),f)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=yr();let o;const c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return qu(e).J({index:"collectionGroupOverlayIndex",range:c},(d,f,g)=>{const y=_d(this.serializer,f);s.size()<i||y.largestBatchId===o?(s.set(y.getKey(),y),o=y.largestBatchId):g.done()}).next(()=>s)}lt(e,t){return qu(e).put(function(i,s,o){const[c,d,f]=Mm(s,o.mutation.key);return{userId:s,collectionPath:d,documentId:f,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Uu(i.ut,o.mutation)}}(this.serializer,this.userId,t))}}function qu(n){return dt(n,"documentOverlays")}class Ps{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(He(e.integerValue));else if("doubleValue"in e){const r=He(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Jr(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),"string"==typeof r&&(r=Zn(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(er(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Lo(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):Z()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),Q.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function mI(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function qm(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=mI(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}Ps.St=new Ps;class gI{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Lt(e),r=qm(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Lt(e),r=qm(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class _I{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class yI{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Wu{constructor(){this.Wt=new gI,this.Gt=new _I(this.Wt),this.zt=new yI(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class Ss{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ss(this.indexId,this.documentKey,this.arrayValue,r)}}function Ni(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Wm(n.arrayValue,e.arrayValue),0!==t?t:(t=Wm(n.directionalValue,e.directionalValue),0!==t?t:Q.comparator(n.documentKey,e.documentKey)))}function Wm(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Km{constructor(e){this.Jt=new De((t,r)=>je.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(ne(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=ou(e);if(void 0!==t&&!this.tn(t))return!1;const r=$r(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const c=this.Jt.getIterator().getNext();if(!i.has(c.field.canonicalString())){const d=r[s];if(!this.nn(c,d)||!this.rn(this.Yt[o++],d))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new De(je.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new jr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new jr(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new jr(r.field,"asc"===r.dir?0:1)));return new dr(dr.UNKNOWN_ID,this.collectionId,t,wi.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function zm(n){var e,t;if(ne(n instanceof Te||n instanceof Ve),n instanceof Te){if(n instanceof L){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Te.create(n.field,"==",s)))||[];return Ve.create(i,"or")}return n}const r=n.filters.map(i=>zm(i));return Ve.create(r,n.op)}function II(n){if(0===n.getFilters().length)return[];const e=vd(zm(n));return ne(Gm(e)),yd(e)||Id(e)?[e]:e.getFilters()}function yd(n){return n instanceof Te}function Id(n){return n instanceof Ve&&wu(n)}function Gm(n){return yd(n)||Id(n)||function(t){if(t instanceof Ve&&Fo(t)){for(const r of t.getFilters())if(!yd(r)&&!Id(r))return!1;return!0}return!1}(n)}function vd(n){if(ne(n instanceof Te||n instanceof Ve),n instanceof Te)return n;if(1===n.filters.length)return vd(n.filters[0]);const e=n.filters.map(r=>vd(r));let t=Ve.create(e,n.op);return t=Nc(t),Gm(t)?t:(ne(t instanceof Ve),ne(Ci(t)),ne(t.filters.length>1),t.filters.reduce((r,i)=>Ed(r,i)))}function Ed(n,e){let t;return ne(n instanceof Te||n instanceof Ve),ne(e instanceof Te||e instanceof Ve),t=n instanceof Te?e instanceof Te?Ve.create([n,e],"and"):$m(n,e):e instanceof Te?$m(e,n):function(i,s){if(ne(i.filters.length>0&&s.filters.length>0),Ci(i)&&Ci(s))return a(i,s.getFilters());const o=Fo(i)?i:s,c=Fo(i)?s:i,d=o.filters.map(f=>Ed(f,c));return Ve.create(d,"or")}(n,e),Nc(t)}function $m(n,e){if(Ci(e))return a(e,n.getFilters());{const t=e.filters.map(r=>Ed(n,r));return Ve.create(t,"or")}}function Nc(n){if(ne(n instanceof Te||n instanceof Ve),n instanceof Te)return n;const e=n.getFilters();if(1===e.length)return Nc(e[0]);if(Ac(n))return n;const t=e.map(i=>Nc(i)),r=[];return t.forEach(i=>{i instanceof Te?r.push(i):i instanceof Ve&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:Ve.create(r,n.op)}class vI{constructor(){this.on=new Td}addToCollectionParentIndex(e,t){return this.on.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(qt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(qt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class Td{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new De(Ie.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new De(Ie.comparator)).toArray()}}const Vc=new Uint8Array(0);class EI{constructor(e,t){this.databaseId=t,this._n=new Td,this.an=new Zr(r=>Yt(r),(r,i)=>_r(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:At(i)};return jm(e).put(s)}return P.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[ec(t),""],!1,!0);return jm(e).U(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(yn(o.parent))}return r})}addFieldIndex(e,t){const r=Ku(e),i={indexId:(c=t).indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var c;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Qo(e);return s.next(c=>{o.put(Fm(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Ku(e),i=Qo(e),s=Ho(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Ku(e),r=Ho(e),i=Qo(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return P.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Km(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Ho(e);let i=!0;const s=new Map;return P.forEach(this.un(t),o=>this.cn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=ye();const c=[];return P.forEach(s,(d,f)=>{var X;M("IndexedDbIndexManager",`Using index ${X=d,`id=${X.indexId}|cg=${X.collectionGroup}|f=${X.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`} to execute ${Yt(t)}`);const g=function(X,G){const fe=ou(G);if(void 0===fe)return null;for(const ce of xi(X,fe.fieldPath))switch(ce.op){case"array-contains-any":return ce.value.arrayValue.values||[];case"array-contains":return[ce.value]}return null}(f,d),y=function(X,G){const fe=new Map;for(const ce of $r(G))for(const rt of xi(X,ce.fieldPath))switch(rt.op){case"==":case"in":fe.set(ce.fieldPath.canonicalString(),rt.value);break;case"not-in":case"!=":return fe.set(ce.fieldPath.canonicalString(),rt.value),Array.from(fe.values())}return null}(f,d),v=function(X,G){const fe=[];let ce=!0;for(const rt of $r(G)){const Pt=0===rt.kind?Pu(X,rt.fieldPath,X.startAt):Su(X,rt.fieldPath,X.startAt);fe.push(Pt.value),ce&&(ce=Pt.inclusive)}return new tr(fe,ce)}(f,d),w=function(X,G){const fe=[];let ce=!0;for(const rt of $r(G)){const Pt=0===rt.kind?Su(X,rt.fieldPath,X.endAt):Pu(X,rt.fieldPath,X.endAt);fe.push(Pt.value),ce&&(ce=Pt.inclusive)}return new tr(fe,ce)}(f,d),N=this.ln(d,f,v),F=this.ln(d,f,w),V=this.hn(d,f,y),H=this.Pn(d.indexId,g,N,v.inclusive,F,w.inclusive,V);return P.forEach(H,te=>r.G(te,t.limit).next(X=>{X.forEach(G=>{const fe=Q.fromSegments(G.documentKey);o.has(fe)||(o=o.add(fe),c.push(fe))})}))}).next(()=>c)}return P.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:II(Ve.create(e.filters,"and")).map(r=>Mt(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,c){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),f=d/(null!=t?t.length:1),g=[];for(let y=0;y<d;++y){const v=t?this.In(t[y/f]):Vc,w=this.Tn(e,v,r[y%f],i),N=this.En(e,v,s[y%f],o),F=c.map(V=>this.Tn(e,v,V,!0));g.push(...this.createRange(w,N,F))}return g}Tn(e,t,r,i){const s=new Ss(e,Q.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new Ss(e,Q.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new Km(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const c of s)r.en(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let r=2;const i=this.un(t);return P.forEach(i,s=>this.cn(e,s).next(o=>{o?0!==r&&o.fields.length<function(d){let f=new De(je.comparator),g=!1;for(const y of d.filters)for(const v of y.getFlattenedFilters())v.field.isKeyField()||("array-contains"===v.op||"array-contains-any"===v.op?g=!0:f=f.add(v.field));for(const y of d.orderBy)y.field.isKeyField()||(f=f.add(y.field));return f.size+(g?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new Wu;for(const i of $r(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.jt(i.kind);Ps.St.ht(s,o)}return r.Ut()}In(e){const t=new Wu;return Ps.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Wu;return Ps.St.ht(Yr(this.databaseId,t),r.jt(function(s){const o=$r(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new Wu);let s=0;for(const o of $r(e)){const c=r[s++];for(const d of i)if(this.Rn(t,o.fieldPath)&&_s(c))i=this.Vn(i,o,c);else{const f=d.jt(o.kind);Ps.St.ht(c,f)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const c of i){const d=new Wu;d.seed(c.Ut()),Ps.St.ht(o,d.jt(t.kind)),s.push(d)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof Te&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Ku(e),i=Qo(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{const o=[];return P.forEach(s,c=>i.get([c.indexId,this.uid]).next(d=>{o.push(function(g,y){const v=y?new wi(y.sequenceNumber,new qt(ws(y.readTime),new Q(yn(y.documentKey)),y.largestBatchId)):wi.empty(),w=g.fields.map(([N,F])=>new jr(je.fromServerFormat(N),F));return new dr(g.indexId,g.collectionGroup,w,v)}(c,d))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:he(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Ku(e),s=Qo(e);return this.fn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(c=>P.forEach(c,d=>s.put(Fm(d.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return P.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(r.set(i.collectionGroup,c),P.forEach(c,d=>this.gn(e,i,d).next(f=>{const g=this.pn(s,d);return f.isEqual(g)?P.resolve():this.yn(e,s,d,f,g)}))))})}wn(e,t,r,i){return Ho(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return Ho(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=Ho(e);let s=new De(Ni);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,c)=>{s=s.add(new Ss(r.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}pn(e,t){let r=new De(Ni);const i=this.dn(t,e);if(null==i)return r;const s=ou(t);if(null!=s){const o=e.data.field(s.fieldPath);if(_s(o))for(const c of o.arrayValue.values||[])r=r.add(new Ss(t.indexId,e.key,this.In(c),i))}else r=r.add(new Ss(t.indexId,e.key,Vc,i));return r}yn(e,t,r,i,s){M("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(d,f,g,y,v){const w=d.getIterator(),N=f.getIterator();let F=Ri(w),V=Ri(N);for(;F||V;){let H=!1,te=!1;if(F&&V){const X=g(F,V);X<0?te=!0:X>0&&(H=!0)}else null!=F?te=!0:H=!0;H?(y(V),V=Ri(N)):te?(v(F),F=Ri(w)):(F=Ri(w),V=Ri(N))}}(i,s,Ni,c=>{o.push(this.wn(e,t,r,c))},c=>{o.push(this.Sn(e,t,r,c))}),P.waitFor(o)}fn(e){let t=1;return Qo(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,c)=>Ni(o,c)).filter((o,c,d)=>!c||0!==Ni(o,d[c-1]));const i=[];i.push(e);for(const o of r){const c=Ni(o,e),d=Ni(o,t);if(0===c)i[0]=e.Ht();else if(c>0&&d<0)i.push(o),i.push(o.Ht());else if(d>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Vc,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Vc,[]]))}return s}bn(e,t){return Ni(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Hm)}getMinOffset(e,t){return P.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||Z())).next(Hm)}}function jm(n){return dt(n,"collectionParents")}function Ho(n){return dt(n,"indexEntries")}function Ku(n){return dt(n,"indexConfiguration")}function Qo(n){return dt(n,"indexState")}function Hm(n){ne(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;au(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new qt(e.readTime,e.documentKey,t)}const Qm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Xt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Xt(e,Xt.DEFAULT_COLLECTION_PERCENTILE,Xt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Jm(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let c=0;const d=r.J({range:o},(g,y,v)=>(c++,v.delete()));s.push(d.next(()=>{ne(1===c)}));const f=[];for(const g of t.mutations){const y=cc(e,g.key.path,t.batchId);s.push(i.delete(y)),f.push(g.key)}return P.waitFor(s).next(()=>f)}function Oc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Z();e=n.noDocument}return JSON.stringify(e).length}Xt.DEFAULT_COLLECTION_PERCENTILE=10,Xt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xt.DEFAULT=new Xt(41943040,Xt.DEFAULT_COLLECTION_PERCENTILE,Xt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xt.DISABLED=new Xt(-1,0,0);class Lc{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){ne(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Lc(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Vi(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Jo(e),o=Vi(e);return o.add({}).next(c=>{ne("number"==typeof c);const d=new od(c,t,r,i),f=function(w,N,F){const V=F.baseMutations.map(te=>Uu(w.ut,te)),H=F.mutations.map(te=>Uu(w.ut,te));return{userId:N,batchId:F.batchId,localWriteTimeMs:F.localWriteTime.toMillis(),baseMutations:V,mutations:H}}(this.serializer,this.userId,d),g=[];let y=new De((v,w)=>he(v.canonicalString(),w.canonicalString()));for(const v of i){const w=cc(this.userId,v.key.path,c);y=y.add(v.key.path.popLast()),g.push(o.put(f)),g.push(s.put(w,Gh))}return y.forEach(v=>{g.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Dn[c]=d.keys()}),P.waitFor(g).next(()=>d)})}lookupMutationBatch(e,t){return Vi(e).get(t).next(r=>r?(ne(r.userId===this.userId),Rs(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?P.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Vi(e).J({index:"userMutationsIndex",range:i},(o,c,d)=>{c.userId===this.userId&&(ne(c.batchId>=r),s=Rs(this.serializer,c)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Vi(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Vi(e).U("userMutationsIndex",t).next(r=>r.map(i=>Rs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=fr(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Jo(e).J({range:i},(o,c,d)=>{const[f,g,y]=o,v=yn(g);if(f===this.userId&&t.path.isEqual(v))return Vi(e).get(y).next(w=>{if(!w)throw Z();ne(w.userId===this.userId),s.push(Rs(this.serializer,w))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(he);const i=[];return t.forEach(s=>{const o=fr(this.userId,s.path),c=IDBKeyRange.lowerBound(o),d=Jo(e).J({range:c},(f,g,y)=>{const[v,w,N]=f,F=yn(w);v===this.userId&&s.path.isEqual(F)?r=r.add(N):y.done()});i.push(d)}),P.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=fr(this.userId,r),o=IDBKeyRange.lowerBound(s);let c=new De(he);return Jo(e).J({range:o},(d,f,g)=>{const[y,v,w]=d,N=yn(v);y===this.userId&&r.isPrefixOf(N)?N.length===i&&(c=c.add(w)):g.done()}).next(()=>this.vn(e,c))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Vi(e).get(s).next(o=>{if(null===o)throw Z();ne(o.userId===this.userId),r.push(Rs(this.serializer,o))}))}),P.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Jm(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),P.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Jo(e).J({range:r},(s,o,c)=>{if(s[0]===this.userId){const d=yn(s[1]);i.push(d)}else c.done()}).next(()=>{ne(0===i.length)})})}containsKey(e,t){return Ym(e,this.userId,t)}Mn(e){return Xm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ym(n,e,t){const r=fr(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Jo(n).J({range:s,H:!0},(c,d,f)=>{const[g,y,v]=c;g===e&&y===i&&(o=!0),f.done()}).next(()=>o)}function Vi(n){return dt(n,"mutations")}function Jo(n){return dt(n,"documentMutations")}function Xm(n){return dt(n,"mutationQueues")}class bs{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new bs(0)}static Nn(){return new bs(-1)}}class TI{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{const r=new bs(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>ie.fromTimestamp(new Ye(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Yo(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(ne(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Yo(e).J((o,c)=>{const d=Bu(c);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>P.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Yo(e).J((r,i)=>{const s=Bu(i);t(s)})}Ln(e){return Zm(e).get("targetGlobalKey").next(t=>(ne(null!==t),t))}Bn(e,t){return Zm(e).put("targetGlobalKey",t)}kn(e,t){return Yo(e).put(Lm(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Yt(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Yo(e).J({range:i,index:"queryTargetsIndex"},(o,c,d)=>{const f=Bu(c);_r(t,f.target)&&(s=f,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Oi(e);return t.forEach(o=>{const c=At(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))}),P.waitFor(i)}removeMatchingKeys(e,t,r){const i=Oi(e);return P.forEach(t,s=>{const o=At(s.path);return P.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Oi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Oi(e);let s=ye();return i.J({range:r,H:!0},(o,c,d)=>{const f=yn(o[1]),g=new Q(f);s=s.add(g)}).next(()=>s)}containsKey(e,t){const r=At(t.path),i=IDBKeyRange.bound([r],[ec(r)],!1,!0);let s=0;return Oi(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,c],d,f)=>{0!==o&&(s++,f.done())}).next(()=>s>0)}ot(e,t){return Yo(e).get(t).next(r=>r?Bu(r):null)}}function Yo(n){return dt(n,"targets")}function Zm(n){return dt(n,"targetGlobal")}function Oi(n){return dt(n,"targetDocuments")}function eg([n,e],[t,r]){const i=he(n,t);return 0===i?he(e,r):i}class AI{constructor(e){this.Qn=e,this.buffer=new De(eg),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();eg(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class tg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;M("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,m.A)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Qt(r)?M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Mn(r)}yield t.Gn(3e5)}))}}class wI{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return P.resolve(un.oe);const r=new AI(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Qm)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qm):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,c,d,f;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,o=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,c=Date.now(),this.removeTargets(e,r,t))).next(y=>(s=y,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(f=Date.now(),Ti()<=de.$b.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-g}ms\n\tDetermined least recently used ${i} in `+(c-o)+`ms\n\tRemoved ${s} targets in `+(d-c)+`ms\n\tRemoved ${y} documents in `+(f-d)+`ms\nTotal Duration: ${f-g}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:y})))}}class RI{constructor(e,t){this.db=e,this.garbageCollector=function ng(n,e){return new wI(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Mc(e,r)}removeReference(e,t,r){return Mc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Mc(e,t)}Xn(e,t){return function(i,s){let o=!1;return Xm(i).Y(c=>Ym(i,c,s).next(d=>(d&&(o=!0),P.resolve(!d)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(o,c)=>{if(c<=t){const d=this.Xn(e,o).next(f=>{if(!f)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ie.min()),Oi(e).delete([0,At(o.path)])))});i.push(d)}}).next(()=>P.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Mc(e,t)}Zn(e,t){const r=Oi(e);let i,s=un.oe;return r.J({index:"documentTargetsIndex"},([o,c],{path:d,sequenceNumber:f})=>{0===o?(s!==un.oe&&t(new Q(yn(i)),s),s=f,i=d):s=un.oe}).next(()=>{s!==un.oe&&t(new Q(yn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Mc(n,e){return Oi(n).put((i=n.currentSequenceNumber,{targetId:0,path:At(e.path),sequenceNumber:i}));var i}class rg{constructor(){this.changes=new Zr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ue.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class PI{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Cs(e).put(r)}removeEntry(e,t,r){return Cs(e).delete(function(s,o){const c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Dc(o),c[c.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Ue.newInvalidDocument(t);return Cs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(zu(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Ue.newInvalidDocument(t)};return Cs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(zu(t))},(i,s)=>{r={document:this.tr(t,s),size:Oc(s)}}).next(()=>r)}getEntries(e,t){let r=In();return this.rr(e,t,(i,s)=>{const o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=In(),i=new Fe(Q.comparator);return this.rr(e,t,(s,o)=>{const c=this.tr(s,o);r=r.insert(s,c),i=i.insert(s,Oc(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return P.resolve();let i=new De(ag);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(zu(i.first()),zu(i.last())),o=i.getIterator();let c=o.getNext();return Cs(e).J({index:"documentKeyIndex",range:s},(d,f,g)=>{const y=Q.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;c&&ag(c,y)<0;)r(c,null),c=o.getNext();c&&c.isEqual(y)&&(r(c,f),c=o.hasNext()?o.getNext():null),c?g.$(zu(c)):g.done()}).next(()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Dc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],d=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Cs(e).U(IDBKeyRange.bound(c,d,!0)).next(f=>{null==s||s.incrementDocumentReadCount(f.length);let g=In();for(const y of f){const v=this.tr(Q.fromSegments(y.prefixPath.concat(y.collectionGroup,y.documentId)),y);v.isFoundDocument()&&(xu(t,v)||i.has(v.key))&&(g=g.insert(v.key,v))}return g})}getAllFromCollectionGroup(e,t,r,i){let s=In();const o=og(t,r),c=og(t,qt.max());return Cs(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,c,!0)},(d,f,g)=>{const y=this.tr(Q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(y.key,y),s.size===i&&g.done()}).next(()=>s)}newChangeBuffer(e){return new SI(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return sg(e).get("remoteDocumentGlobalKey").next(t=>(ne(!!t),t))}er(e,t){return sg(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function fI(n,e){let t;if(e.document)t=bm(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Q.fromSegments(e.noDocument.path),i=ws(e.noDocument.readTime);t=Ue.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Z();{const r=Q.fromSegments(e.unknownDocument.path),i=ws(e.unknownDocument.version);t=Ue.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Ye(i[0],i[1]);return ie.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(ie.min()))return r}return Ue.newInvalidDocument(e)}}function ig(n){return new PI(n)}class SI extends rg{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new Zr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new De((s,o)=>he(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const c=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,c.readTime)),o.isValidDocument()){const d=Om(this._r.serializer,o);i=i.add(s.path.popLast());const f=Oc(d);r+=f-c.size,t.push(this._r.addEntry(e,s,d))}else if(r-=c.size,this.trackRemovals){const d=Om(this._r.serializer,o.convertToNoDocument(ie.min()));t.push(this._r.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),P.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function sg(n){return dt(n,"remoteDocumentGlobal")}function Cs(n){return dt(n,"remoteDocumentsV14")}function zu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function og(n,e){const t=e.documentKey.path.toArray();return[n,Dc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ag(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=he(t[s],r[s]),i)return i;return i=he(t.length,r.length),i||(i=he(t[t.length-2],r[r.length-2]),i||he(t[t.length-1],r[r.length-1]))}class bI{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ug{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Vu(r.mutation,i,Jt.empty(),Ye.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ye()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ye()){const i=yr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Du();return s.forEach((c,d)=>{o=o.insert(c,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=yr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ye()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=In();const o=ku(),c=ku();return t.forEach((d,f)=>{const g=r.get(f.key);i.has(f.key)&&(void 0===g||g.mutation instanceof ei)?s=s.insert(f.key,f):void 0!==g?(o.set(f.key,g.mutation.getFieldMask()),Vu(g.mutation,f,g.mutation.getFieldMask(),Ye.now())):o.set(f.key,Jt.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,g)=>o.set(f,g)),t.forEach((f,g)=>{var y;return c.set(f,new bI(g,null!==(y=o.get(f))&&void 0!==y?y:null))}),c))}recalculateAndSaveOverlays(e,t){const r=ku();let i=new Fe((o,c)=>o-c),s=ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(d=>{const f=t.get(d);if(null===f)return;let g=r.get(d)||Jt.empty();g=c.applyToLocalView(f,g),r.set(d,g);const y=(i.get(c.batchId)||ye()).add(d);i=i.insert(c.batchId,y)})}).next(()=>{const o=[],c=i.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),f=d.key,g=d.value,y=Xp();g.forEach(v=>{if(!s.has(v)){const w=am(t.get(v),r.get(v));null!==w&&y.set(v,w),s=s.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,y))}return P.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return Q.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Bo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):P.resolve(yr());let c=-1,d=s;return o.next(f=>P.forEach(f,(g,y)=>(c<y.largestBatchId&&(c=y.largestBatchId),s.get(g)?P.resolve():this.remoteDocumentCache.getEntry(e,g).next(v=>{d=d.insert(g,v)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,ye())).next(g=>({batchId:c,changes:Yp(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Q(t)).next(r=>{let i=Du();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Du();return this.indexManager.getCollectionParents(e,s).next(c=>P.forEach(c,d=>{const f=(y=t,v=d.child(s),new Pn(v,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt));var y,v;return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(g=>{g.forEach((y,v)=>{o=o.insert(y,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((d,f)=>{const g=f.getKey();null===o.get(g)&&(o=o.insert(g,Ue.newInvalidDocument(g)))});let c=Du();return o.forEach((d,f)=>{const g=s.get(d);void 0!==g&&Vu(g.mutation,f,Jt.empty(),Ye.now()),xu(t,f)&&(c=c.insert(d,f))}),c})}}class CI{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return P.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:_t(i.createTime)}),P.resolve();var i}getNamedQuery(e,t){return P.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:gd(i.bundledQuery),readTime:_t(i.readTime)}),P.resolve();var i}}class xI{constructor(){this.overlays=new Fe(Q.comparator),this.lr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=yr();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const i=yr(),s=t.length+1,o=new Q(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const d=c.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Fe((f,g)=>f-g);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let g=s.get(f.largestBatchId);null===g&&(g=yr(),s=s.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const c=yr(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,g)=>c.set(f,g)),!(c.size()>=i)););return P.resolve(c)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ud(t,r));let s=this.lr.get(t);void 0===s&&(s=ye(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class Ad{constructor(){this.hr=new De(Ft.Pr),this.Ir=new De(Ft.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new Ft(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new Ft(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new Q(new Ie([])),r=new Ft(t,e),i=new Ft(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new Q(new Ie([])),r=new Ft(t,e),i=new Ft(t,e+1);let s=ye();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Ft(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Ft{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return Q.comparator(e.key,t.key)||he(e.gr,t.gr)}static Tr(e,t){return he(e.gr,t.gr)||Q.comparator(e.key,t.key)}}class DI{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new De(Ft.Pr)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const o=new od(s,t,r,i);this.mutationQueue.push(o);for(const c of i)this.yr=this.yr.add(new Ft(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ft(t,0),i=new Ft(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const c=this.wr(o.gr);s.push(c)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(he);return t.forEach(i=>{const s=new Ft(i,0),o=new Ft(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],c=>{r=r.add(c.gr)})}),P.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Q.isDocumentKey(s)||(s=s.child(""));const o=new Ft(new Q(s),0);let c=new De(he);return this.yr.forEachWhile(d=>{const f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(c=c.add(d.gr)),!0)},o),P.resolve(this.br(c))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){ne(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return P.forEach(t.mutations,i=>{const s=new Ft(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new Ft(t,0),i=this.yr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return P.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class kI{constructor(e){this.Cr=e,this.docs=new Fe(Q.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Ue.newInvalidDocument(t))}getEntries(e,t){let r=In();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ue.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=In();const o=t.path,c=new Q(o.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:f,value:{document:g}}=d.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||au(rc(g),r)<=0||(i.has(g.key)||xu(t,g))&&(s=s.insert(g.key,g.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Z()}vr(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new NI(this)}getSize(e){return P.resolve(this.size)}}class NI extends rg{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class VI{constructor(e){this.persistence=e,this.Fr=new Zr(t=>Yt(t),_r),this.lastRemoteSnapshotVersion=ie.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Ad,this.targetCount=0,this.Nr=bs.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),P.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new bs(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.kn(t),P.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((o,c)=>{c.sequenceNumber<=t&&null===r.get(c.targetId)&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.Or.containsKey(t))}}class wd{constructor(e,t){this.Lr={},this.overlays={},this.Br=new un(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new VI(this),this.indexManager=new vI,this.remoteDocumentCache=new kI(r=>this.referenceDelegate.Qr(r)),this.serializer=new Vm(t),this.Kr=new CI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xI,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new DI(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const i=new OI(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return P.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}}class OI extends ic{constructor(e){super(),this.currentSequenceNumber=e}}class Fc{constructor(e){this.persistence=e,this.Gr=new Ad,this.zr=null}static jr(e){return new Fc(e)}get Hr(){if(this.zr)return this.zr;throw Z()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),P.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Hr,r=>{const i=Q.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,ie.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return P.or([()=>P.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class LI{constructor(e){this.serializer=e}O(e,t,r,i){const s=new Hr("createOrUpgrade",t);var d;r<1&&i>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",lc,{unique:!0}),d.createObjectStore("documentMutations"),lg(e),function(d){d.createObjectStore("remoteDocuments")}(e));let o=P.resolve();return r<3&&i>=3&&(0!==r&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),lg(e)),o=o.next(()=>function(d){const f=d.store("targetGlobal"),g={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ie.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",g)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(d,f){return f.store("mutations").U().next(g=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",lc,{unique:!0});const y=f.store("mutations"),v=g.map(w=>y.put(w));return P.waitFor(v)})}(e,s))),o=o.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(d){const f=d.createObjectStore("documentOverlays",{keyPath:Jh});f.createIndex("collectionPathOverlayIndex",_u,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",Yh,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(d){const f=d.createObjectStore("remoteDocumentsV14",{keyPath:fu});f.createIndex("documentKeyIndex",pu),f.createIndex("collectionGroupIndex",mu)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:jh}).createIndex("sequenceNumberIndex",Hh,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:gu}).createIndex("documentKeyIndex",Qh,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Oc(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>P.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(c=>P.forEach(c,d=>{ne(d.userId===s.userId);const f=Rs(this.serializer,d);return Jm(e,s.userId,f).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((o,c)=>{const d=new Ie(o),f=[0,At(d)];s.push(t.get(f).next(g=>g?P.resolve():t.put({targetId:0,path:At(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>P.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:fc});const r=t.store("collectionParents"),i=new Td,s=o=>{if(i.add(o)){const c=o.lastSegment(),d=o.popLast();return r.put({collectionId:c,parent:At(d)})}};return t.store("remoteDocuments").J({H:!0},(o,c)=>{const d=new Ie(o);return s(d.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,c,d],f)=>{const g=yn(c);return s(g.popLast())}))}ni(e){const t=e.store("targets");return t.J((r,i)=>{const s=Bu(i),o=Lm(this.serializer,s);return t.put(o)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{const c=t.store("remoteDocumentsV14"),d=(y=o,y.document?new Q(Ie.fromString(y.document.name).popFirst(5)):y.noDocument?Q.fromSegments(y.noDocument.path):y.unknownDocument?Q.fromSegments(y.unknownDocument.path):Z()).path.toArray(),f={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var y;i.push(c.put(f))}).next(()=>P.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=ig(this.serializer),s=new wd(Fc.jr,this.serializer.ut);return r.U().next(o=>{const c=new Map;return o.forEach(d=>{var f;let g=null!==(f=c.get(d.userId))&&void 0!==f?f:ye();Rs(this.serializer,d).keys().forEach(y=>g=g.add(y)),c.set(d.userId,g)}),P.forEach(c,(d,f)=>{const g=new Tt(f),y=kc.ct(this.serializer,g),v=s.getIndexManager(g),w=Lc.ct(g,this.serializer,v,s.referenceDelegate);return new ug(i,w,y,v).recalculateAndSaveOverlaysForDocumentKeys(new So(t,un.oe),d).next()})})}}function lg(n){n.createObjectStore("targetDocuments",{keyPath:hc}).createIndex("documentTargetsIndex",dc,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",$h,{unique:!0}),n.createObjectStore("targetGlobal")}const Rd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Pd{constructor(e,t,r,i,s,o,c,d,f,g,y=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=c,this.oi=f,this._i=g,this.ai=y,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=v=>Promise.resolve(),!Pd.D())throw new O(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new RI(this,i),this.Ii=t+"main",this.serializer=new Vm(d),this.Ti=new _n(this.Ii,this.ai,new LI(this.serializer)),this.qr=new TI(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ig(this.serializer),this.Kr=new pI,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===g&&et("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new O(b.FAILED_PRECONDITION,Rd);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new un(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,m.A)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,m.A)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,m.A)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Bc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(Qt(e))return M("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Gu(e).get("owner").next(t=>P.resolve(this.wi(t)))}Si(e){return Bc(e).delete(this.clientId)}bi(){var e=this;return(0,m.A)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=dt(r,"clientMetadata");return i.U().next(s=>{const o=e.Ci(s,18e5),c=s.filter(d=>-1===o.indexOf(d));return P.forEach(c,d=>i.delete(d.clientId)).next(()=>c)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?P.resolve(!0):Gu(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new O(b.FAILED_PRECONDITION,Rd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Bc(e).U().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,m.A)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new So(t,un.oe);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Bc(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Lc.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new EI(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return kc.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){M("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(d=this.ai)?Iu:15===d?Po:14===d?Ro:13===d?mc:12===d?yu:11===d?pc:void Z();var d;let o;return this.Ti.runTransaction(e,i,s,c=>(o=new So(c,this.Br?this.Br.next():un.oe),"readwrite-primary"===t?this.fi(o).next(d=>!!d||this.gi(o)).next(d=>{if(!d)throw et(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new O(b.FAILED_PRECONDITION,Ao);return r(o)}).next(d=>this.yi(o).next(()=>d)):this.Bi(o).next(()=>r(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}Bi(e){return Gu(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new O(b.FAILED_PRECONDITION,Rd)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Gu(e).put("owner",t)}static D(){return _n.D()}pi(e){const t=Gu(e);return t.get("owner").next(r=>this.wi(r)?(M("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):P.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(et(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,oe.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return M("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return et("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){et("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Gu(n){return dt(n,"owner")}function Bc(n){return dt(n,"clientMetadata")}function Sd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class bd{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=ye(),i=ye();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new bd(e,t.fromCache,r,i)}}class MI{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class cg{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=(0,oe.nr)()?8:sc((0,oe.ZQ)())>0?6:4}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new MI;return this.Hi(e,t,o).next(c=>{if(s.result=c,this.$i)return this.Ji(e,t,o,c.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(Ti()<=de.$b.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",qo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),P.resolve()):(Ti()<=de.$b.DEBUG&&M("QueryEngine","Query:",qo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(Ti()<=de.$b.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",qo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Nt(t))):P.resolve())}zi(e,t){if(Uo(t))return P.resolve(null);let r=Nt(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Rc(t,null,"F"),r=Nt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=ye(...s);return this.Gi.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(d=>{const f=this.Yi(t,c);return this.Zi(t,f,o,d.readTime)?this.zi(e,Rc(t,null,"F")):this.Xi(e,f,t,d)}))})))}ji(e,t,r,i){return Uo(t)||i.isEqual(ie.min())?P.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(t,s);return this.Zi(t,o,r,i)?P.resolve(null):(Ti()<=de.$b.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),qo(t)),this.Xi(e,o,t,nc(i,-1)).next(c=>c))})}Yi(e,t){let r=new De(Qp(e));return t.forEach((i,s)=>{xu(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return Ti()<=de.$b.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",qo(t)),this.Gi.getDocumentsMatchingQuery(e,t,qt.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class FI{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Fe(he),this.ns=new Zr(s=>Yt(s),_r),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ug(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function hg(n,e,t,r){return new FI(n,e,t,r)}function dg(n,e){return Cd.apply(this,arguments)}function Cd(){return Cd=(0,m.A)(function*(n,e){const t=j(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],c=[];let d=ye();for(const f of i){o.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}for(const f of s){c.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(r,d).next(f=>({_s:f,removedBatchIds:o,addedBatchIds:c}))})})}),Cd.apply(this,arguments)}function fg(n){const e=j(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function pg(n,e,t){let r=ye(),i=ye();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=In();return t.forEach((c,d)=>{const f=s.get(c);d.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(c)),d.isNoDocument()&&d.version.isEqual(ie.min())?(e.removeEntry(c,d.readTime),o=o.insert(c,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||0===d.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(d),o=o.insert(c,d)):M("LocalStore","Ignoring outdated watch update for ",c,". Current version:",f.version," Watch version:",d.version)}),{us:o,cs:i}})}function qI(n,e){const t=j(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Xo(n,e){const t=j(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,P.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new ti(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Zo(n,e,t){return xd.apply(this,arguments)}function xd(){return xd=(0,m.A)(function*(n,e,t){const r=j(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Qt(o))throw o;M("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),xd.apply(this,arguments)}function qc(n,e,t){const r=j(n);let i=ie.min(),s=ye();return r.persistence.runTransaction("Execute query","readwrite",o=>function(d,f,g){const y=j(d),v=y.ns.get(g);return void 0!==v?P.resolve(y.ts.get(v)):y.qr.getTargetData(f,g)}(r,o,Nt(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,c.targetId).next(d=>{s=d})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:ie.min(),t?s:ye())).next(c=>(_g(r,Hp(e),c),{documents:c,ls:s})))}function mg(n,e){const t=j(n),r=j(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function gg(n,e){const t=j(n),r=t.rs.get(e)||ie.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,nc(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(_g(t,e,i),i))}function _g(n,e,t){let r=n.rs.get(e)||ie.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Dd(){return Dd=(0,m.A)(function*(n,e,t,r){const i=j(n);let s=ye(),o=In();for(const f of t){const g=e.hs(f.metadata.name);f.document&&(s=s.add(g));const y=e.Ps(f);y.setReadTime(e.Is(f.metadata.readTime)),o=o.insert(g,y)}const c=i.ss.newChangeBuffer({trackRemovals:!0}),d=yield Xo(i,(g=r,Nt(Xr(Ie.fromString(`__bundle__/docs/${g}`)))));var g;return i.persistence.runTransaction("Apply bundle documents","readwrite",f=>pg(f,c,o).next(g=>(c.apply(f),g)).next(g=>i.qr.removeMatchingKeysForTargetId(f,d.targetId).next(()=>i.qr.addMatchingKeys(f,s,d.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(f,g.us,g.cs)).next(()=>g.us)))}),Dd.apply(this,arguments)}function KI(n,e){return kd.apply(this,arguments)}function kd(){return kd=(0,m.A)(function*(n,e,t=ye()){const r=yield Xo(n,Nt(gd(e.bundledQuery))),i=j(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=_t(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Kr.saveNamedQuery(s,e);const c=r.withResumeToken(gt.EMPTY_BYTE_STRING,o);return i.ts=i.ts.insert(c.targetId,c),i.qr.updateTargetData(s,c).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),kd.apply(this,arguments)}function yg(n,e){return`firestore_clients_${n}_${e}`}function Ig(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Nd(n,e){return`firestore_targets_${n}_${e}`}class Wc{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new O(i.error.code,i.error.message))),o?new Wc(e,t,i.state,s):(et("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class $u{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new O(r.error.code,r.error.message))),s?new $u(e,r.state,i):(et("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=id();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=uc(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Kc(e,s):(et("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Vd{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Vd(t.clientId,t.onlineState):(et("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Od{constructor(){this.activeTargetIds=id()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ld{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Fe(he),this.started=!1,this.ps=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=yg(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new Od),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,m.A)(function*(){const t=yield e.syncEngine.Li();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(yg(e.persistenceKey,i));if(s){const o=Kc.Ts(i,s);o&&(e.gs=e.gs.insert(o.clientId,o))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Nd(this.persistenceKey,e));if(r){const i=$u.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Nd(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return M("SharedClientState","READ",e,t),t}setItem(e,t){M("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){M("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(M("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void et("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,m.A)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(o){let c=un.oe;if(null!=o)try{const d=JSON.parse(o);ne("number"==typeof d),c=d}catch(d){et("SharedClientState","Failed to read sequence number from WebStorage",d)}return c}(r.newValue);i!==un.oe&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){const i=new Wc(this.currentUser,e,t,r),s=Ig(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){const t=Ig(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=Nd(this.persistenceKey,e),s=new $u(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return Kc.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return Wc.Ts(new Tt(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return $u.Ts(i,t)}Ms(e){return Vd.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,m.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);M("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],c=[];return s.forEach(d=>{i.has(d)||o.push(d)}),i.forEach(d=>{s.has(d)||c.push(d)}),this.syncEngine.Xs(o,c).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=id();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class vg{constructor(){this.eo=new Od,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Od,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class zI{ro(e){}shutdown(){}}class Eg{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let zc=null;function Md(){return null===zc?zc=268435456+Math.round(2147483648*Math.random()):zc++,"0x"+zc.toString(16)}const GI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $I{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}}const Zt="WebChannelConnection";class jI extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,o){const c=Md(),d=this.Co(t,r.toUriEncodedString());M("RestConnection",`Sending RPC '${t}' ${c}:`,d,i);const f={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(f,s,o),this.Fo(t,d,f,i).then(g=>(M("RestConnection",`Received RPC '${t}' ${c}: `,g),g),g=>{throw Ht("RestConnection",`RPC '${t}' ${c} failed with error: `,g,"url: ",d,"request:",i),g})}Mo(t,r,i,s,o,c){return this.Do(t,r,i,s,o)}vo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ei,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Co(t,r){return`${this.yo}/v1/${r}:${GI[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){const s=Md();return new Promise((o,c)=>{const d=new Gp;d.setWithCredentials(!0),d.listenOnce(Io.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ru.NO_ERROR:const g=d.getResponseJson();M(Zt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(g)),o(g);break;case ru.TIMEOUT:M(Zt,`RPC '${e}' ${s} timed out`),c(new O(b.DEADLINE_EXCEEDED,"Request time out"));break;case ru.HTTP_ERROR:const y=d.getStatus();if(M(Zt,`RPC '${e}' ${s} failed with status:`,y,"response text:",d.getResponseText()),y>0){let v=d.getResponseJson();Array.isArray(v)&&(v=v[0]);const w=null==v?void 0:v.error;if(w&&w.status&&w.message){const N=function(V){const H=V.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(H)>=0?H:b.UNKNOWN}(w.status);c(new O(N,w.message))}else c(new O(b.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new O(b.UNAVAILABLE,"Connection failed."));break;default:Z()}}finally{M(Zt,`RPC '${e}' ${s} completed.`)}});const f=JSON.stringify(i);M(Zt,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",f,r,15)})}xo(e,t,r){const i=Md(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=tu(),c=nu(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(d.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(d.xmlHttpFactory=new Mh({})),this.vo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const g=s.join("");M(Zt,`Creating RPC '${e}' stream ${i}: ${g}`,d);const y=o.createWebChannel(g,d);let v=!1,w=!1;const N=new $I({co:V=>{w?M(Zt,`Not sending because RPC '${e}' stream ${i} is closed:`,V):(v||(M(Zt,`Opening RPC '${e}' stream ${i} transport.`),y.open(),v=!0),M(Zt,`RPC '${e}' stream ${i} sending:`,V),y.send(V))},lo:()=>y.close()}),F=(V,H,te)=>{V.listen(H,X=>{try{te(X)}catch(G){setTimeout(()=>{throw G},0)}})};return F(y,vo.EventType.OPEN,()=>{w||(M(Zt,`RPC '${e}' stream ${i} transport opened.`),N.Vo())}),F(y,vo.EventType.CLOSE,()=>{w||(w=!0,M(Zt,`RPC '${e}' stream ${i} transport closed`),N.fo())}),F(y,vo.EventType.ERROR,V=>{w||(w=!0,Ht(Zt,`RPC '${e}' stream ${i} transport errored:`,V),N.fo(new O(b.UNAVAILABLE,"The operation could not be completed")))}),F(y,vo.EventType.MESSAGE,V=>{var H;if(!w){const te=V.data[0];ne(!!te);const G=te.error||(null===(H=te[0])||void 0===H?void 0:H.error);if(G){M(Zt,`RPC '${e}' stream ${i} received error:`,G);const fe=G.status;let ce=function(dl){const Fy=Rt[dl];if(void 0!==Fy)return fm(Fy)}(fe),rt=G.message;void 0===ce&&(ce=b.INTERNAL,rt="Unknown error status: "+fe+" with message "+G.message),w=!0,N.fo(new O(ce,rt)),y.close()}else M(Zt,`RPC '${e}' stream ${i} received:`,te),N.po(te)}}),F(c,Hl.STAT_EVENT,V=>{V.stat===Ql.PROXY?M(Zt,`RPC '${e}' stream ${i} detected buffering proxy`):V.stat===Ql.NOPROXY&&M(Zt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.mo()},0),N}}function Tg(){return typeof window<"u"?window:null}function Gc(){return typeof document<"u"?document:null}function ju(n){return new rI(n,!0)}class Fd{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();const t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class Ag{constructor(e,t,r,i,s,o,c,d){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Fd(e,t)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}stop(){var e=this;return(0,m.A)(function*(){e.Yo()&&(yield e.close(0))})()}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){var e=this;return(0,m.A)(function*(){if(e.Zo())return e.close(0)})()}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){var r=this;return(0,m.A)(function*(){r.i_(),r.s_(),r.Jo.cancel(),r.zo++,4!==e?r.Jo.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(et(t.toString()),et("Using maximum backoff delay to prevent overloading the backend."),r.Jo.Qo()):t&&t.code===b.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.o_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Eo(t)})()}o_(){}auth(){this.state=1;const e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{const i=new O(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){const r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){var e=this;this.state=5,this.Jo.Ko((0,m.A)(function*(){e.state=0,e.start()}))}u_(e){return M("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class HI extends Ag{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();const t=function oI(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:Z(),i=e.targetChange.targetIds||[],s=function(f,g){return f.useProto3Json?(ne(void 0===g||"string"==typeof g),gt.fromBase64String(g||"")):(ne(void 0===g||g instanceof Buffer||g instanceof Uint8Array),gt.fromUint8Array(g||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(f){const g=void 0===f.code?b.UNKNOWN:fm(f.code);return new O(g,f.message||"")}(o);t=new ym(r,i,s,c||null)}else if("documentChange"in e){const r=e.documentChange,i=Ir(n,r.document.name),s=_t(r.document.updateTime),o=r.document.createTime?_t(r.document.createTime):ie.min(),c=new kt({mapValue:{fields:r.document.fields}}),d=Ue.newFoundDocument(i,s,o,c);t=new xc(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=Ir(n,r.document),s=r.readTime?_t(r.readTime):ie.min(),o=Ue.newNoDocument(i,s);t=new xc([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Ir(n,r.document);t=new xc([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return Z();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Yy(i,s);t=new _m(r.targetId,o)}}var f;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return ie.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?ie.min():o.readTime?_t(o.readTime):ie.min()}(e);return this.listener.l_(t,r)}h_(e){const t={};t.database=fd(this.serializer),t.addTarget=function(s,o){let c;const d=o.target;if(c=vs(d)?{documents:Cm(s,d)}:{query:md(s,d)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Tm(s,o.resumeToken);const f=cd(s,o.expectedCount);null!==f&&(c.expectedCount=f)}else if(o.snapshotVersion.compareTo(ie.min())>0){c.readTime=$o(s,o.snapshotVersion.toTimestamp());const f=cd(s,o.expectedCount);null!==f&&(c.expectedCount=f)}return c}(this.serializer,e);const r=function uI(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Z()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.r_(t)}P_(e){const t={};t.database=fd(this.serializer),t.removeTarget=e,this.r_(t)}}class QI extends Ag{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(ne(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();const t=function aI(n,e){return n&&n.length>0?(ne(void 0!==e),n.map(t=>function(i,s){let o=_t(i.updateTime?i.updateTime:s);return o.isEqual(ie.min())&&(o=_t(s)),new jy(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=_t(e.commitTime);return this.listener.d_(r,t)}return ne(!e.writeResults||0===e.writeResults.length),this.I_=!0,this.listener.A_()}R_(){const e={};e.database=fd(this.serializer),this.r_(e)}E_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Uu(this.serializer,r))};this.r_(t)}}class JI extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new O(b.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,dd(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new O(b.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Mo(e,dd(t,r),i,o,c,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(b.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}}class XI{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(et(t),this.y_=!1):M("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class ZI{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(c=>{r.enqueueAndForget((0,m.A)(function*(){var d;Li(o)&&(M("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,m.A)(function*(g){const y=j(g);y.M_.add(4),yield ea(y),y.N_.set("Unknown"),y.M_.delete(4),yield Hu(y)}),function f(g){return d.apply(this,arguments)})(o))}))}),this.N_=new XI(r,i)}}function Hu(n){return Bd.apply(this,arguments)}function Bd(){return Bd=(0,m.A)(function*(n){if(Li(n))for(const e of n.x_)yield e(!0)}),Bd.apply(this,arguments)}function ea(n){return qd.apply(this,arguments)}function qd(){return qd=(0,m.A)(function*(n){for(const e of n.x_)yield e(!1)}),qd.apply(this,arguments)}function $c(n,e){const t=j(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),zd(t)?Kd(t):ra(t).Zo()&&Wd(t,e))}function ta(n,e){const t=j(n),r=ra(t);t.F_.delete(e),r.Zo()&&wg(t,e),0===t.F_.size&&(r.Zo()?r.t_():Li(t)&&t.N_.set("Unknown"))}function Wd(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ie.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ra(n).h_(e)}function wg(n,e){n.L_.xe(e),ra(n).P_(e)}function Kd(n){n.L_=new Zy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ra(n).start(),n.N_.w_()}function zd(n){return Li(n)&&!ra(n).Yo()&&n.F_.size>0}function Li(n){return 0===j(n).M_.size}function Rg(n){n.L_=void 0}function ev(n){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,m.A)(function*(n){n.N_.set("Online")}),Gd.apply(this,arguments)}function tv(n){return $d.apply(this,arguments)}function $d(){return $d=(0,m.A)(function*(n){n.F_.forEach((e,t)=>{Wd(n,e)})}),$d.apply(this,arguments)}function nv(n,e){return jd.apply(this,arguments)}function jd(){return jd=(0,m.A)(function*(n,e){Rg(n),zd(n)?(n.N_.D_(e),Kd(n)):n.N_.set("Unknown")}),jd.apply(this,arguments)}function rv(n,e,t){return Hd.apply(this,arguments)}function Hd(){return Hd=(0,m.A)(function*(n,e,t){if(n.N_.set("Online"),e instanceof ym&&2===e.state&&e.cause)try{yield(r=(0,m.A)(function*(s,o){const c=o.cause;for(const d of o.targetIds)s.F_.has(d)&&(yield s.remoteSyncer.rejectListen(d,c),s.F_.delete(d),s.L_.removeTarget(d))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){M("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield jc(n,r)}else if(e instanceof xc?n.L_.Ke(e):e instanceof _m?n.L_.He(e):n.L_.We(e),!t.isEqual(ie.min()))try{const r=yield fg(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const c=s.L_.rt(o);return c.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const g=s.F_.get(f);g&&s.F_.set(f,g.withResumeToken(d.resumeToken,o))}}),c.targetMismatches.forEach((d,f)=>{const g=s.F_.get(d);if(!g)return;s.F_.set(d,g.withResumeToken(gt.EMPTY_BYTE_STRING,g.snapshotVersion)),wg(s,d);const y=new ti(g.target,d,f,g.sequenceNumber);Wd(s,y)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){M("RemoteStore","Failed to raise snapshot:",r),yield jc(n,r)}var r}),Hd.apply(this,arguments)}function jc(n,e,t){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,m.A)(function*(n,e,t){if(!Qt(e))throw e;n.M_.add(1),yield ea(n),n.N_.set("Offline"),t||(t=()=>fg(n.localStore)),n.asyncQueue.enqueueRetryable((0,m.A)(function*(){M("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield Hu(n)}))}),Qd.apply(this,arguments)}function Pg(n,e){return e().catch(t=>jc(n,t,e))}function na(n){return Jd.apply(this,arguments)}function Jd(){return Jd=(0,m.A)(function*(n){const e=j(n),t=Mi(e);let r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;iv(e);)try{const i=yield qI(e.localStore,r);if(null===i){0===e.v_.length&&t.t_();break}r=i.batchId,sv(e,i)}catch(i){yield jc(e,i)}Sg(e)&&bg(e)}),Jd.apply(this,arguments)}function iv(n){return Li(n)&&n.v_.length<10}function sv(n,e){n.v_.push(e);const t=Mi(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function Sg(n){return Li(n)&&!Mi(n).Yo()&&n.v_.length>0}function bg(n){Mi(n).start()}function ov(n){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,m.A)(function*(n){Mi(n).R_()}),Yd.apply(this,arguments)}function av(n){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,m.A)(function*(n){const e=Mi(n);for(const t of n.v_)e.E_(t.mutations)}),Xd.apply(this,arguments)}function uv(n,e,t){return Zd.apply(this,arguments)}function Zd(){return Zd=(0,m.A)(function*(n,e,t){const r=n.v_.shift(),i=ad.from(r,e,t);yield Pg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield na(n)}),Zd.apply(this,arguments)}function lv(n,e){return ef.apply(this,arguments)}function ef(){return ef=(0,m.A)(function*(n,e){var t;e&&Mi(n).T_&&(yield(t=(0,m.A)(function*(i,s){if(dm(c=s.code)&&c!==b.ABORTED){const o=i.v_.shift();Mi(i).e_(),yield Pg(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield na(i)}var c}),function r(i,s){return t.apply(this,arguments)})(n,e)),Sg(n)&&bg(n)}),ef.apply(this,arguments)}function Cg(n,e){return tf.apply(this,arguments)}function tf(){return tf=(0,m.A)(function*(n,e){const t=j(n);t.asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials");const r=Li(t);t.M_.add(3),yield ea(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Hu(t)}),tf.apply(this,arguments)}function nf(n,e){return rf.apply(this,arguments)}function rf(){return rf=(0,m.A)(function*(n,e){const t=j(n);e?(t.M_.delete(2),yield Hu(t)):e||(t.M_.add(2),yield ea(t),t.N_.set("Unknown"))}),rf.apply(this,arguments)}function ra(n){return n.B_||(n.B_=function(t,r,i){const s=j(t);return s.m_(),new HI(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:ev.bind(null,n),Io:tv.bind(null,n),Eo:nv.bind(null,n),l_:rv.bind(null,n)}),n.x_.push(function(){var e=(0,m.A)(function*(t){t?(n.B_.e_(),zd(n)?Kd(n):n.N_.set("Unknown")):(yield n.B_.stop(),Rg(n))});return function(t){return e.apply(this,arguments)}}())),n.B_}function Mi(n){return n.k_||(n.k_=function(t,r,i){const s=j(t);return s.m_(),new QI(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:ov.bind(null,n),Eo:lv.bind(null,n),A_:av.bind(null,n),d_:uv.bind(null,n)}),n.x_.push(function(){var e=(0,m.A)(function*(t){t?(n.k_.e_(),yield na(n)):(yield n.k_.stop(),n.v_.length>0&&(M("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))});return function(t){return e.apply(this,arguments)}}())),n.k_}class sf{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new tt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,c=new sf(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new O(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ia(n,e){if(et("AsyncQueue",`${e}: ${n}`),Qt(n))return new O(b.UNAVAILABLE,`${e}: ${n}`);throw n}class sa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Q.comparator(t.key,r.key):(t,r)=>Q.comparator(t.key,r.key),this.keyedMap=Du(),this.sortedSet=new Fe(this.comparator)}static emptySet(e){return new sa(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new sa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class xg{constructor(){this.q_=new Fe(Q.comparator)}track(e){const t=e.doc.key,r=this.q_.get(t);r?0!==e.type&&3===r.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==r.type?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.q_=this.q_.remove(t):1===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):Z():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}}class oa{constructor(e,t,r,i,s,o,c,d,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new oa(e,t,sa.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class cv{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class hv{constructor(){this.queries=new Zr(e=>jp(e),Cu),this.onlineState="Unknown",this.z_=new Set}}function af(n,e){return uf.apply(this,arguments)}function uf(){return uf=(0,m.A)(function*(n,e){const t=j(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new cv,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const c=ia(o,`Initialization of query '${qo(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&hf(t)}),uf.apply(this,arguments)}function lf(n,e){return cf.apply(this,arguments)}function cf(){return cf=(0,m.A)(function*(n,e){const t=j(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}),cf.apply(this,arguments)}function dv(n,e){const t=j(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const c of o.U_)c.H_(i)&&(r=!0);o.K_=i}}r&&hf(t)}function fv(n,e,t){const r=j(n),i=r.queries.get(e);if(i)for(const s of i.U_)s.onError(t);r.queries.delete(e)}function hf(n){n.z_.forEach(e=>{e.next()})}var df,Dg;(Dg=df||(df={})).J_="default",Dg.Cache="cache";class ff{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new oa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=oa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==df.Cache}}class pv{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class kg{constructor(e){this.serializer=e}hs(e){return Ir(this.serializer,e)}Ps(e){return e.metadata.exists?bm(this.serializer,e.document,!1):Ue.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return _t(e)}}class mv{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ng(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const r=Ie.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,r=new kg(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const o of i.metadata.queries){const c=(t.get(o)||ye()).add(s);t.set(o,c)}}return t}complete(){var e=this;return(0,m.A)(function*(){const t=yield function WI(n,e,t,r){return Dd.apply(this,arguments)}(e.localStore,new kg(e.serializer),e.documents,e.oa.id),r=e.aa(e.documents);for(const i of e.queries)yield KI(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function Ng(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Vg{constructor(e){this.key=e}}class Og{constructor(e){this.key=e}}class Lg{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=ye(),this.mutatedKeys=ye(),this.Ia=Qp(e),this.Ta=new sa(this.Ia)}get Ea(){return this.la}da(e,t){const r=t?t.Aa:new xg,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,f="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,y)=>{const v=i.get(g),w=xu(this.query,y)?y:null,N=!!v&&this.mutatedKeys.has(v.key),F=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let V=!1;v&&w?v.data.isEqual(w.data)?N!==F&&(r.track({type:3,doc:w}),V=!0):this.Ra(v,w)||(r.track({type:2,doc:w}),V=!0,(d&&this.Ia(w,d)>0||f&&this.Ia(w,f)<0)&&(c=!0)):!v&&w?(r.track({type:0,doc:w}),V=!0):v&&!w&&(r.track({type:1,doc:v}),V=!0,(d||f)&&(c=!0)),V&&(w?(o=o.add(w),s=F?s.add(g):s.delete(g)):(o=o.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const g="F"===this.query.limitType?o.last():o.first();o=o.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{Ta:o,Aa:r,Zi:c,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const o=e.Aa.Q_();o.sort((g,y)=>function(w,N){const F=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Z()}};return F(w)-F(N)}(g.type,y.type)||this.Ia(g.doc,y.doc)),this.Va(r),i=null!=i&&i;const c=t&&!i?this.ma():[],d=0===this.Pa.size&&this.current&&!i?1:0,f=d!==this.ha;return this.ha=d,0!==o.length||f?{snapshot:new oa(this.query,e.Ta,s,o,e.mutatedKeys,0===d,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:c}:{fa:c}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new xg,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=ye(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});const t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new Og(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new Vg(r))}),t}pa(e){this.la=e.ls,this.Pa=ye();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return oa.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class gv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class _v{constructor(e){this.key=e,this.wa=!1}}class yv{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new Zr(c=>jp(c),Cu),this.Da=new Map,this.Ca=new Set,this.va=new Fe(Q.comparator),this.Fa=new Map,this.Ma=new Ad,this.xa={},this.Oa=new Map,this.Na=bs.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function Iv(n,e){return pf.apply(this,arguments)}function pf(){return pf=(0,m.A)(function*(n,e,t=!0){const r=Hc(n);let i;const s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Mg(r,e,t,!0),i}),pf.apply(this,arguments)}function vv(n,e){return mf.apply(this,arguments)}function mf(){return mf=(0,m.A)(function*(n,e){const t=Hc(n);yield Mg(t,e,!0,!1)}),mf.apply(this,arguments)}function Mg(n,e,t,r){return gf.apply(this,arguments)}function gf(){return gf=(0,m.A)(function*(n,e,t,r){const i=yield Xo(n.localStore,Nt(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current";let c;return r&&(c=yield _f(n,e,s,"current"===o,i.resumeToken)),n.isPrimaryClient&&t&&$c(n.remoteStore,i),c}),gf.apply(this,arguments)}function _f(n,e,t,r,i){return yf.apply(this,arguments)}function yf(){return yf=(0,m.A)(function*(n,e,t,r,i){n.Ba=(y,v,w)=>{return(N=(0,m.A)(function*(V,H,te,X){let G=H.view.da(te);G.Zi&&(G=yield qc(V.localStore,H.query,!1).then(({documents:Pt})=>H.view.da(Pt,G)));const fe=X&&X.targetChanges.get(H.targetId),ce=X&&null!=X.targetMismatches.get(H.targetId),rt=H.view.applyChanges(G,V.isPrimaryClient,fe,ce);return Cf(V,H.targetId,rt.fa),rt.snapshot}),function F(V,H,te,X){return N.apply(this,arguments)})(n,y,v,w);var N};const s=yield qc(n.localStore,e,!0),o=new Lg(e,s.ls),c=o.da(s.documents),d=Mu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),f=o.applyChanges(c,n.isPrimaryClient,d);Cf(n,t,f.fa);const g=new gv(e,t,o);return n.ba.set(e,g),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),f.snapshot}),yf.apply(this,arguments)}function Ev(n,e,t){return If.apply(this,arguments)}function If(){return If=(0,m.A)(function*(n,e,t){const r=j(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Cu(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Zo(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ta(r.remoteStore,i.targetId),aa(r,i.targetId)}).catch(Mn))):(aa(r,i.targetId),yield Zo(r.localStore,i.targetId,!0))}),If.apply(this,arguments)}function Tv(n,e){return vf.apply(this,arguments)}function vf(){return vf=(0,m.A)(function*(n,e){const t=j(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ta(t.remoteStore,r.targetId))}),vf.apply(this,arguments)}function Ef(){return Ef=(0,m.A)(function*(n,e,t){const r=Bf(n);try{const i=yield function(o,c){const d=j(o),f=Ye.now(),g=c.reduce((w,N)=>w.add(N.key),ye());let y,v;return d.persistence.runTransaction("Locally write mutations","readwrite",w=>{let N=In(),F=ye();return d.ss.getEntries(w,g).next(V=>{N=V,N.forEach((H,te)=>{te.isValidDocument()||(F=F.add(H))})}).next(()=>d.localDocuments.getOverlayedDocuments(w,N)).next(V=>{y=V;const H=[];for(const te of c){const X=Qy(te,y.get(te.key).overlayedDocument);null!=X&&H.push(new ei(te.key,X,td(X.value.mapValue),ot.exists(!0)))}return d.mutationQueue.addMutationBatch(w,f,H,c)}).next(V=>{v=V;const H=V.applyToLocalDocumentSet(y,F);return d.documentOverlayCache.saveOverlays(w,V.batchId,H)})}).then(()=>({batchId:v.batchId,changes:Yp(y)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,c,d){let f=o.xa[o.currentUser.toKey()];f||(f=new Fe(he)),f=f.insert(c,d),o.xa[o.currentUser.toKey()]=f}(r,i.batchId,t),yield ni(r,i.changes),yield na(r.remoteStore)}catch(i){const s=ia(i,"Failed to persist write");t.reject(s)}}),Ef.apply(this,arguments)}function Fg(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,m.A)(function*(n,e){const t=j(n);try{const r=yield function BI(n,e){const t=j(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const c=[];e.targetChanges.forEach((g,y)=>{const v=i.get(y);if(!v)return;c.push(t.qr.removeMatchingKeys(s,g.removedDocuments,y).next(()=>t.qr.addMatchingKeys(s,g.addedDocuments,y)));let w=v.withSequenceNumber(s.currentSequenceNumber);var F,V,H;null!==e.targetMismatches.get(y)?w=w.withResumeToken(gt.EMPTY_BYTE_STRING,ie.min()).withLastLimboFreeSnapshotVersion(ie.min()):g.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(g.resumeToken,r)),i=i.insert(y,w),V=w,H=g,(0===(F=v).resumeToken.approximateByteSize()||V.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=3e8||H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0)&&c.push(t.qr.updateTargetData(s,w))});let d=In(),f=ye();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),c.push(pg(s,o,e.documentUpdates).next(g=>{d=g.us,f=g.cs})),!r.isEqual(ie.min())){const g=t.qr.getLastRemoteSnapshotVersion(s).next(y=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(g)}return P.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,f)).next(()=>d)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Fa.get(s);o&&(ne(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?ne(o.wa):i.removedDocuments.size>0&&(ne(o.wa),o.wa=!1))}),yield ni(t,r,e)}catch(r){yield Mn(r)}}),Tf.apply(this,arguments)}function Ug(n,e,t){const r=j(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ba.forEach((s,o)=>{const c=o.view.j_(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){const d=j(o);d.onlineState=c;let f=!1;d.queries.forEach((g,y)=>{for(const v of y.U_)v.j_(c)&&(f=!0)}),f&&hf(d)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function wv(n,e,t){return Af.apply(this,arguments)}function Af(){return Af=(0,m.A)(function*(n,e,t){const r=j(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Fa.get(e),s=i&&i.key;if(s){let o=new Fe(Q.comparator);o=o.insert(s,Ue.newNoDocument(s,ie.min()));const c=ye().add(s),d=new Lu(ie.min(),new Map,new Fe(he),o,c);yield Fg(r,d),r.va=r.va.remove(s),r.Fa.delete(e),xf(r)}else yield Zo(r.localStore,e,!1).then(()=>aa(r,e,t)).catch(Mn)}),Af.apply(this,arguments)}function Rv(n,e){return wf.apply(this,arguments)}function wf(){return wf=(0,m.A)(function*(n,e){const t=j(n),r=e.batch.batchId;try{const i=yield function UI(n,e){const t=j(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(c,d,f,g){const y=f.batch,v=y.keys();let w=P.resolve();return v.forEach(N=>{w=w.next(()=>g.getEntry(d,N)).next(F=>{const V=f.docVersions.get(N);ne(null!==V),F.version.compareTo(V)<0&&(y.applyToRemoteDocument(F,f),F.isValidDocument()&&(F.setReadTime(f.commitVersion),g.addEntry(F)))})}),w.next(()=>c.mutationQueue.removeMutationBatch(d,y))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let d=ye();for(let f=0;f<c.mutationResults.length;++f)c.mutationResults[f].transformResults.length>0&&(d=d.add(c.batch.mutations[f].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);bf(t,r,null),Sf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ni(t,i)}catch(i){yield Mn(i)}}),wf.apply(this,arguments)}function Pv(n,e,t){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,m.A)(function*(n,e,t){const r=j(n);try{const i=yield function(o,c){const d=j(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return d.mutationQueue.lookupMutationBatch(f,c).next(y=>(ne(null!==y),g=y.keys(),d.mutationQueue.removeMutationBatch(f,y))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,g,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>d.localDocuments.getDocuments(f,g))})}(r.localStore,e);bf(r,e,t),Sf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ni(r,i)}catch(i){yield Mn(i)}}),Rf.apply(this,arguments)}function Pf(){return Pf=(0,m.A)(function*(n,e){const t=j(n);Li(t.remoteStore)||M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const c=j(o);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>c.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){const i=ia(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Pf.apply(this,arguments)}function Sf(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function bf(n,e,t){const r=j(n);let i=r.xa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function aa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||Bg(n,r)})}function Bg(n,e){n.Ca.delete(e.path.canonicalString());const t=n.va.get(e);null!==t&&(ta(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),xf(n))}function Cf(n,e,t){for(const r of t)r instanceof Vg?(n.Ma.addReference(r.key,e),bv(n,r)):r instanceof Og?(M("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||Bg(n,r.key)):Z()}function bv(n,e){const t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(M("SyncEngine","New document in limbo: "+t),n.Ca.add(r),xf(n))}function xf(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){const e=n.Ca.values().next().value;n.Ca.delete(e);const t=new Q(Ie.fromString(e)),r=n.Na.next();n.Fa.set(r,new _v(t)),n.va=n.va.insert(t,r),$c(n.remoteStore,new ti(Nt(Xr(t.path)),r,"TargetPurposeLimboResolution",un.oe))}}function ni(n,e,t){return Df.apply(this,arguments)}function Df(){return Df=(0,m.A)(function*(n,e,t){const r=j(n),i=[],s=[],o=[];var c;r.ba.isEmpty()||(r.ba.forEach((c,d)=>{o.push(r.Ba(d,e,t).then(f=>{if((f||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,null!=f&&f.fromCache?"not-current":"current"),f){i.push(f);const g=bd.Qi(d.targetId,f);s.push(g)}}))}),yield Promise.all(o),r.Sa.l_(i),yield(c=(0,m.A)(function*(f,g){const y=j(f);try{yield y.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>P.forEach(g,w=>P.forEach(w.ki,N=>y.persistence.referenceDelegate.addReference(v,w.targetId,N)).next(()=>P.forEach(w.qi,N=>y.persistence.referenceDelegate.removeReference(v,w.targetId,N)))))}catch(v){if(!Qt(v))throw v;M("LocalStore","Failed to update sequence numbers: "+v)}for(const v of g){const w=v.targetId;if(!v.fromCache){const N=y.ts.get(w),V=N.withLastLimboFreeSnapshotVersion(N.snapshotVersion);y.ts=y.ts.insert(w,V)}}}),function d(f,g){return c.apply(this,arguments)})(r.localStore,s))}),Df.apply(this,arguments)}function Cv(n,e){return kf.apply(this,arguments)}function kf(){return kf=(0,m.A)(function*(n,e){const t=j(n);if(!t.currentUser.isEqual(e)){M("SyncEngine","User change. New user:",e.toKey());const r=yield dg(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(c=>{c.forEach(d=>{d.reject(new O(b.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ni(t,r._s)}var s}),kf.apply(this,arguments)}function xv(n,e){const t=j(n),r=t.Fa.get(e);if(r&&r.wa)return ye().add(r.key);{let i=ye();const s=t.Da.get(e);if(!s)return i;for(const o of s){const c=t.ba.get(o);i=i.unionWith(c.view.Ea)}return i}}function Dv(n,e){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,m.A)(function*(n,e){const t=j(n),r=yield qc(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&Cf(t,e.targetId,i.fa),i}),Nf.apply(this,arguments)}function kv(n,e){return Vf.apply(this,arguments)}function Vf(){return Vf=(0,m.A)(function*(n,e){const t=j(n);return gg(t.localStore,e).then(r=>ni(t,r))}),Vf.apply(this,arguments)}function Nv(n,e,t,r){return Of.apply(this,arguments)}function Of(){return Of=(0,m.A)(function*(n,e,t,r){const i=j(n),s=yield function(c,d){const f=j(c),g=j(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",y=>g.Cn(y,d).next(v=>v?f.localDocuments.getDocuments(y,v):P.resolve(null)))}(i.localStore,e);var d;null!==s?("pending"===t?yield na(i.remoteStore):"acknowledged"===t||"rejected"===t?(bf(i,e,r||null),Sf(i,e),d=e,j(j(i.localStore).mutationQueue).Fn(d)):Z(),yield ni(i,s)):M("SyncEngine","Cannot apply mutation batch with id: "+e)}),Of.apply(this,arguments)}function Lf(){return Lf=(0,m.A)(function*(n,e){const t=j(n);if(Hc(t),Bf(t),!0===e&&!0!==t.La){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield qg(t,r.toArray());t.La=!0,yield nf(t.remoteStore,!0);for(const s of i)$c(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const r=[];let i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(aa(t,o),Zo(t.localStore,o,!0))),ta(t.remoteStore,o)}),yield i,yield qg(t,r),function(o){const c=j(o);c.Fa.forEach((d,f)=>{ta(c.remoteStore,f)}),c.Ma.Vr(),c.Fa=new Map,c.va=new Fe(Q.comparator)}(t),t.La=!1,yield nf(t.remoteStore,!1)}}),Lf.apply(this,arguments)}function qg(n,e,t){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,m.A)(function*(n,e,t){const r=j(n),i=[],s=[];for(const o of e){let c;const d=r.Da.get(o);if(d&&0!==d.length){c=yield Xo(r.localStore,Nt(d[0]));for(const f of d){const g=r.ba.get(f),y=yield Dv(r,g);y.snapshot&&s.push(y.snapshot)}}else{const f=yield mg(r.localStore,o);c=yield Xo(r.localStore,f),yield _f(r,Wg(f),o,!1,c.resumeToken)}i.push(c)}return r.Sa.l_(s),i}),Mf.apply(this,arguments)}function Wg(n){return bu(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Ov(n){return t=j(n).localStore,j(j(t).persistence).Li();var t}function Lv(n,e,t,r){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,m.A)(function*(n,e,t,r){const i=j(n);if(i.La)return void M("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield gg(i.localStore,Hp(s[0])),c=Lu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,gt.EMPTY_BYTE_STRING);yield ni(i,o,c);break}case"rejected":yield Zo(i.localStore,e,!0),aa(i,e,r);break;default:Z()}}),Ff.apply(this,arguments)}function Mv(n,e,t){return Uf.apply(this,arguments)}function Uf(){return Uf=(0,m.A)(function*(n,e,t){const r=Hc(n);if(r.La){for(const i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){M("SyncEngine","Adding an already active target "+i);continue}const s=yield mg(r.localStore,i),o=yield Xo(r.localStore,s);yield _f(r,Wg(s),o.targetId,!1,o.resumeToken),$c(r.remoteStore,o)}for(const i of t)r.Da.has(i)&&(yield Zo(r.localStore,i,!1).then(()=>{ta(r.remoteStore,i),aa(r,i)}).catch(Mn))}}),Uf.apply(this,arguments)}function Hc(n){const e=j(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Fg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=wv.bind(null,e),e.Sa.l_=dv.bind(null,e.eventManager),e.Sa.ka=fv.bind(null,e.eventManager),e}function Bf(n){const e=j(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Pv.bind(null,e),e}class ua{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,m.A)(function*(){t.serializer=ju(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return hg(this.persistence,new cg,e.initialUser,this.serializer)}createPersistence(e){return new wd(Fc.jr,this.serializer)}createSharedClientState(e){return new vg}terminate(){var e=this;return(0,m.A)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class qf extends ua{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,m.A)(function*(){yield t().call(r,e),yield r.Qa.initialize(r,e),yield Bf(r.Qa.syncEngine),yield na(r.Qa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return hg(this.persistence,new cg,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new tg(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new ac(t,this.persistence);return new du(e.asyncQueue,r)}createPersistence(e){const t=Sd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Xt.withCacheSize(this.cacheSizeBytes):Xt.DEFAULT;return new Pd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Tg(),Gc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new vg}}class Kg extends qf{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,m.A)(function*(){yield t().call(r,e);const i=r.Qa.syncEngine;r.sharedClientState instanceof Ld&&(r.sharedClientState.syncEngine={Ys:Nv.bind(null,i),Zs:Lv.bind(null,i),Xs:Mv.bind(null,i),Li:Ov.bind(null,i),Js:kv.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,m.A)(function*(o){yield function Vv(n,e){return Lf.apply(this,arguments)}(r.Qa.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Tg();if(!Ld.D(t))throw new O(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Sd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ld(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class la{initialize(e,t){var r=this;return(0,m.A)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Ug(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Cv.bind(null,r.syncEngine),yield nf(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new hv}createDatastore(e){const t=ju(e.databaseInfo.databaseId),r=new jI(e.databaseInfo);return new JI(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Ug(this.syncEngine,t,0),c=Eg.D()?new Eg:new zI,new ZI(r,i,s,o,c);var r,i,s,o,c}createSyncEngine(e,t){return function(i,s,o,c,d,f,g){const y=new yv(i,s,o,c,d,f);return g&&(y.La=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,m.A)(function*(){var t,r;yield(r=(0,m.A)(function*(s){const o=j(s);M("RemoteStore","RemoteStore shutting down."),o.M_.add(5),yield ea(o),o.O_.shutdown(),o.N_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function zg(n,e=10240){let t=0;return{read:()=>(0,m.A)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,m.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Qc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):et("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Bv{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new tt,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,m.A)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,m.A)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,m.A)(function*(){const t=yield e.za();if(null===t)return null;const r=e.Wa.decode(t),i=Number(r);isNaN(i)&&e.ja(`length string (${r}) is not valid number`);const s=yield e.Ha(i);return new pv(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>123===e)}za(){var e=this;return(0,m.A)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ha(e){var t=this;return(0,m.A)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const r=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,m.A)(function*(){const t=yield e.Ua.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class qv{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,m.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new O(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const r=yield(i=(0,m.A)(function*(o,c){const d=j(o),f={documents:c.map(w=>Fu(d.serializer,w))},g=yield d.Mo("BatchGetDocuments",d.serializer.databaseId,Ie.emptyPath(),f,c.length),y=new Map;g.forEach(w=>{const N=function sI(n,e){return"found"in e?function(r,i){ne(!!i.found);const s=Ir(r,i.found.name),o=_t(i.found.updateTime),c=i.found.createTime?_t(i.found.createTime):ie.min(),d=new kt({mapValue:{fields:i.found.fields}});return Ue.newFoundDocument(s,o,c,d)}(n,e):"missing"in e?function(r,i){ne(!!i.missing),ne(!!i.readTime);const s=Ir(r,i.missing),o=_t(i.readTime);return Ue.newNoDocument(s,o)}(n,e):Z()}(d.serializer,w);y.set(N.key.toString(),N)});const v=[];return c.forEach(w=>{const N=y.get(w.toString());ne(!!N),v.push(N)}),v}),function s(o,c){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Go(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,m.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=Q.fromPath(i);e.mutations.push(new sd(s,e.precondition(s)))}),yield(r=(0,m.A)(function*(s,o){const c=j(s),d={writes:o.map(f=>Uu(c.serializer,f))};yield c.Do("Commit",c.serializer.databaseId,Ie.emptyPath(),d)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Z();t=ie.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new O(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ie.min())?ot.exists(!1):ot.updateTime(t):ot.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ie.min()))throw new O(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ot.updateTime(t)}return ot.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Wv{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new Fd(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Jo.Ko((0,m.A)(function*(){const t=new qv(e.datastore),r=e.tu(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!ps(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!dm(t)}return!1}}class Kv{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Tt.UNAUTHENTICATED,this.clientId=qh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,m.A)(function*(c){M("FirestoreClient","Received user=",c.uid),yield s.authCredentialListener(c),s.user=c});return function(c){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(M("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new O(b.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new tt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,m.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=ia(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Jc(n,e){return Wf.apply(this,arguments)}function Wf(){return Wf=(0,m.A)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,m.A)(function*(s){r.isEqual(s)||(yield dg(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Wf.apply(this,arguments)}function Kf(n,e){return zf.apply(this,arguments)}function zf(){return zf=(0,m.A)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Gf(n);M("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Cg(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Cg(e.remoteStore,i)),n._onlineComponents=e}),zf.apply(this,arguments)}function Gg(n){return"FirebaseError"===n.name?n.code===b.FAILED_PRECONDITION||n.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Gf(n){return $f.apply(this,arguments)}function $f(){return $f=(0,m.A)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Jc(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Gg(t))throw t;Ht("Error using user provided cache. Falling back to memory cache: "+t),yield Jc(n,new ua)}}else M("FirestoreClient","Using default OfflineComponentProvider"),yield Jc(n,new ua);return n._offlineComponents}),$f.apply(this,arguments)}function Yc(n){return jf.apply(this,arguments)}function jf(){return jf=(0,m.A)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M("FirestoreClient","Using user provided OnlineComponentProvider"),yield Kf(n,n._uninitializedComponentsProvider._online)):(M("FirestoreClient","Using default OnlineComponentProvider"),yield Kf(n,new la))),n._onlineComponents}),jf.apply(this,arguments)}function $g(n){return Gf(n).then(e=>e.persistence)}function ca(n){return Gf(n).then(e=>e.localStore)}function jg(n){return Yc(n).then(e=>e.remoteStore)}function Hf(n){return Yc(n).then(e=>e.syncEngine)}function ha(n){return Qf.apply(this,arguments)}function Qf(){return Qf=(0,m.A)(function*(n){const e=yield Yc(n),t=e.eventManager;return t.onListen=Iv.bind(null,e.syncEngine),t.onUnlisten=Ev.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Tv.bind(null,e.syncEngine),t}),Qf.apply(this,arguments)}function Qg(n,e,t={}){const r=new tt;return n.asyncQueue.enqueueAndForget((0,m.A)(function*(){return function(s,o,c,d,f){const g=new Qc({next:v=>{o.enqueueAndForget(()=>lf(s,y));const w=v.docs.has(c);!w&&v.fromCache?f.reject(new O(b.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&v.fromCache&&d&&"server"===d.source?f.reject(new O(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(v)},error:v=>f.reject(v)}),y=new ff(Xr(c.path),g,{includeMetadataChanges:!0,ra:!0});return af(s,y)}(yield ha(n),n.asyncQueue,e,t,r)})),r.promise}function Jg(n,e,t={}){const r=new tt;return n.asyncQueue.enqueueAndForget((0,m.A)(function*(){return function(s,o,c,d,f){const g=new Qc({next:v=>{o.enqueueAndForget(()=>lf(s,y)),v.fromCache&&"server"===d.source?f.reject(new O(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(v)},error:v=>f.reject(v)}),y=new ff(c,g,{includeMetadataChanges:!0,ra:!0});return af(s,y)}(yield ha(n),n.asyncQueue,e,t,r)})),r.promise}function Yg(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const Xg=new Map;function Jf(n,e,t){if(!t)throw new O(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Zg(n,e,t,r){if(!0===e&&!0===r)throw new O(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function e_(n){if(!Q.isDocumentKey(n))throw new O(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function t_(n){if(Q.isDocumentKey(n))throw new O(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Xc(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":Z()}function we(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xc(n);throw new O(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function n_(n,e){if(e<=0)throw new O(b.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class r_{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new O(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new O(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Zg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Yg(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new O(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new r_({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new O(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new O(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new r_(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Fh;switch(r.type){case"firstParty":return new Uh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Xg.get(t);r&&(M("ComponentProvider","Removing Datastore"),Xg.delete(t),r.terminate())}(this),Promise.resolve()}}function i_(n,e,t,r={}){var i;const s=(n=we(n,Qu))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ht("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let c,d;if("string"==typeof r.mockUserToken)c=r.mockUserToken,d=Tt.MOCK_USER;else{c=(0,oe.Fy)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new O(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Tt(f)}n._authCredentials=new iu(new hs(c,d))}}class Wt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Wt(this.firestore,e,this._query)}}class nt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new nt(this.firestore,e,this._key)}}class vr extends Wt{constructor(e,t,r){super(e,t,Xr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new nt(this.firestore,null,new Q(e))}withConverter(e){return new vr(this.firestore,e,this._path)}}function Yf(n,e,...t){if(n=(0,oe.Ku)(n),Jf("collection","path",e),n instanceof Qu){const r=Ie.fromString(e,...t);return t_(r),new vr(n,null,r)}{if(!(n instanceof nt||n instanceof vr))throw new O(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ie.fromString(e,...t));return t_(r),new vr(n.firestore,null,r)}}function Ju(n,e,...t){if(n=(0,oe.Ku)(n),1===arguments.length&&(e=qh.newId()),Jf("doc","path",e),n instanceof Qu){const r=Ie.fromString(e,...t);return e_(r),new nt(n,null,new Q(r))}{if(!(n instanceof nt||n instanceof vr))throw new O(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ie.fromString(e,...t));return e_(r),new nt(n.firestore,n instanceof vr?n.converter:null,new Q(r))}}function s_(n,e){return n=(0,oe.Ku)(n),e=(0,oe.Ku)(e),(n instanceof nt||n instanceof vr)&&(e instanceof nt||e instanceof vr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Xf(n,e){return n=(0,oe.Ku)(n),e=(0,oe.Ku)(e),n instanceof Wt&&e instanceof Wt&&n.firestore===e.firestore&&Cu(n._query,e._query)&&n.converter===e.converter}class tE{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Fd(this,"async_queue_retry"),this.hu=()=>{const t=Gc();t&&M("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const e=Gc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Gc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new tt;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,m.A)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Jo.reset()}catch(t){if(!Qt(t))throw t;M("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Jo.Ko(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{throw this.au=r,this.uu=!1,et("INTERNAL UNHANDLED ERROR: ",function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),c}(r)),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=sf.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&Z()}verifyOperationInProgress(){}du(){var e=this;return(0,m.A)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Zf(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class nE{constructor(){this._progressObserver={},this._taskCompletionResolver=new tt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Xe extends Qu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new tE,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||o_(this),this._firestoreClient.terminate()}}function iE(n,e){const t="object"==typeof n?n:(0,J.getApp)(),r="string"==typeof n?n:e||"(default)",i=(0,J._getProvider)(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(0,oe.yU)("firestore");s&&i_(i,...s)}return i}function ft(n){return n._firestoreClient||o_(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function o_(n){var e,t,r;const i=n._freezeSettings(),s=(d=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Zh(n._databaseId,d,n._persistenceKey,(g=i).host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Yg(g.experimentalLongPollingOptions),g.useFetchStreams));var d,g;n._firestoreClient=new Kv(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function a_(n,e,t){const r=new tt;return n.asyncQueue.enqueue((0,m.A)(function*(){try{yield Jc(n,t),yield Kf(n,e),r.resolve()}catch(i){const s=i;if(!Gg(s))throw s;Ht("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function u_(n){if(n._initialized||n._terminated)throw new O(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Er{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Er(gt.fromBase64String(e))}catch(t){throw new O(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Er(gt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ri{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new O(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new je(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class xs{constructor(e){this._methodName=e}}class Zc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return he(this._lat,e._lat)||he(this._long,e._long)}}const pE=/^__.*__$/;class mE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ei(e,this.data,this.fieldMask,t,this.fieldTransforms):new zo(e,this.data,t,this.fieldTransforms)}}class l_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ei(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function c_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Z()}}class eh{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new eh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return rh(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(c_(this.fu)&&pE.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class gE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ju(e)}Fu(e,t,r,i=!1){return new eh({fu:e,methodName:t,vu:r,path:je.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ds(n){const e=n._freezeSettings(),t=ju(n._databaseId);return new gE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function th(n,e,t,r,i,s={}){const o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);op("Data must be an object, but it was:",o,r);const c=f_(r,o);let d,f;if(s.merge)d=new Jt(o.fieldMask),f=o.fieldTransforms;else if(s.mergeFields){const g=[];for(const y of s.mergeFields){const v=Zu(e,y,t);if(!o.contains(v))throw new O(b.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);m_(g,v)||g.push(v)}d=new Jt(g),f=o.fieldTransforms.filter(y=>d.covers(y.field))}else d=null,f=o.fieldTransforms;return new mE(new kt(c),d,f)}class Xu extends xs{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Xu}}function h_(n,e,t){return new eh({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ep extends xs{_toFieldTransform(e){return new Nu(e.path,new Wo)}isEqual(e){return e instanceof ep}}class tp extends xs{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=h_(this,e,!0),r=this.Mu.map(s=>ks(s,t)),i=new Es(r);return new Nu(e.path,i)}isEqual(e){return e instanceof tp&&(0,oe.bD)(this.Mu,e.Mu)}}class np extends xs{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=h_(this,e,!0),r=this.Mu.map(s=>ks(s,t)),i=new Ts(r);return new Nu(e.path,i)}isEqual(e){return e instanceof np&&(0,oe.bD)(this.Mu,e.Mu)}}class rp extends xs{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new Ko(e.serializer,tm(e.serializer,this.xu));return new Nu(e.path,t)}isEqual(e){return e instanceof rp&&this.xu===e.xu}}function ip(n,e,t,r){const i=n.Fu(1,e,t);op("Data must be an object, but it was:",i,r);const s=[],o=kt.empty();Xn(r,(d,f)=>{const g=nh(e,d,t);f=(0,oe.Ku)(f);const y=i.Su(g);if(f instanceof Xu)s.push(g);else{const v=ks(f,y);null!=v&&(s.push(g),o.set(g,v))}});const c=new Jt(s);return new l_(o,c,i.fieldTransforms)}function sp(n,e,t,r,i,s){const o=n.Fu(1,e,t),c=[Zu(e,r,t)],d=[i];if(s.length%2!=0)throw new O(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<s.length;v+=2)c.push(Zu(e,s[v])),d.push(s[v+1]);const f=[],g=kt.empty();for(let v=c.length-1;v>=0;--v)if(!m_(f,c[v])){const w=c[v];let N=d[v];N=(0,oe.Ku)(N);const F=o.Su(w);if(N instanceof Xu)f.push(w);else{const V=ks(N,F);null!=V&&(f.push(w),g.set(w,V))}}const y=new Jt(f);return new l_(g,y,o.fieldTransforms)}function d_(n,e,t,r=!1){return ks(t,n.Fu(r?4:3,e))}function ks(n,e){if(p_(n=(0,oe.Ku)(n)))return op("Unsupported field value:",e,n),f_(n,e);if(n instanceof xs)return function(r,i){if(!c_(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const c of r){let d=ks(c,i.bu(o));null==d&&(d={nullValue:"NULL_VALUE"}),s.push(d),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,oe.Ku)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return tm(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=Ye.fromDate(r);return{timestampValue:$o(i.serializer,s)}}if(r instanceof Ye){const s=new Ye(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$o(i.serializer,s)}}if(r instanceof Zc)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Er)return{bytesValue:Tm(i.serializer,r._byteString)};if(r instanceof nt){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:hd(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Xc(r)}`)}(n,e)}function f_(n,e){const t={};return vu(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Xn(n,(r,i)=>{const s=ks(i,e.pu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function p_(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Ye||n instanceof Zc||n instanceof Er||n instanceof nt||n instanceof xs)}function op(n,e,t){if(!p_(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Xc(t);throw e.Du("an object"===r?n+" a custom object":n+" "+r)}var i}function Zu(n,e,t){if((e=(0,oe.Ku)(e))instanceof ri)return e._internalPath;if("string"==typeof e)return nh(n,e);throw rh("Field path arguments must be of type string or ",n,!1,void 0,t)}const _E=new RegExp("[~\\*/\\[\\]]");function nh(n,e,t){if(e.search(_E)>=0)throw rh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ri(...e.split("."))._internalPath}catch{throw rh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function rh(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(s||o)&&(d+=" (found",s&&(d+=` in field ${r}`),o&&(d+=` in document ${i}`),d+=")"),new O(b.INVALID_ARGUMENT,c+n+d)}function m_(n,e){return n.some(t=>t.isEqual(e))}class el{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new nt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new yE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ih("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class yE extends el{data(){return super.data()}}function ih(n,e){return"string"==typeof e?nh(n,e):e instanceof ri?e._internalPath:e._delegate._internalPath}function g_(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new O(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ap{}class tl extends ap{}function Fi(n,e,...t){let r=[];e instanceof ap&&r.push(e),r=r.concat(t),function(s){const o=s.filter(d=>d instanceof da).length,c=s.filter(d=>d instanceof nl).length;if(o>1||o>0&&c>0)throw new O(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class nl extends tl{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new nl(e,t,r)}_apply(e){const t=this._parse(e);return v_(e._query,t),new Wt(e.firestore,e.converter,rd(e._query,t))}_parse(e){const t=Ds(e.firestore);return function(s,o,c,d,f,g,y){let v;if(f.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new O(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if("in"===g||"not-in"===g){I_(y,g);const w=[];for(const N of y)w.push(y_(d,s,N));v={arrayValue:{values:w}}}else v=y_(d,s,y)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||I_(y,g),v=d_(c,"where",y,"in"===g||"not-in"===g);return Te.create(f,g,v)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class da extends ap{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new da(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:Ve.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const c=s.getFlattenedFilters();for(const d of c)v_(o,d),o=rd(o,d)}(e._query,t),new Wt(e.firestore,e.converter,rd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class up extends tl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new up(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new O(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new O(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bi(s,o)}(e._query,this._field,this._direction);return new Wt(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new Pn(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class sh extends tl{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new sh(e,t,r)}_apply(e){return new Wt(e.firestore,e.converter,Rc(e._query,this._limit,this._limitType))}}class oh extends tl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new oh(e,t,r)}_apply(e){const t=__(e,this.type,this._docOrFields,this._inclusive);return new Wt(e.firestore,e.converter,(s=t,new Pn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class ah extends tl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ah(e,t,r)}_apply(e){const t=__(e,this.type,this._docOrFields,this._inclusive);return new Wt(e.firestore,e.converter,(s=t,new Pn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function __(n,e,t,r){if(t[0]=(0,oe.Ku)(t[0]),t[0]instanceof el)return function(s,o,c,d,f){if(!d)throw new O(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);const g=[];for(const y of Di(s))if(y.field.isKeyField())g.push(Yr(o,d.key));else{const v=d.data.field(y.field);if(xo(v))throw new O(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+y.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===v){const w=y.field.canonicalString();throw new O(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}g.push(v)}return new tr(g,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Ds(n.firestore);return function(o,c,d,f,g,y){const v=o.explicitOrderBy;if(g.length>v.length)throw new O(b.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const w=[];for(let N=0;N<g.length;N++){const F=g[N];if(v[N].field.isKeyField()){if("string"!=typeof F)throw new O(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof F}`);if(!Bo(o)&&-1!==F.indexOf("/"))throw new O(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${F}' contains a slash.`);const V=o.path.child(Ie.fromString(F));if(!Q.isDocumentKey(V))throw new O(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const H=new Q(V);w.push(Yr(c,H))}else{const V=d_(d,f,F);w.push(V)}}return new tr(w,y)}(n._query,n.firestore._databaseId,i,e,t,r)}}function y_(n,e,t){if("string"==typeof(t=(0,oe.Ku)(t))){if(""===t)throw new O(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bo(e)&&-1!==t.indexOf("/"))throw new O(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ie.fromString(t));if(!Q.isDocumentKey(r))throw new O(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Yr(n,new Q(r))}if(t instanceof nt)return Yr(n,t._key);throw new O(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xc(t)}.`)}function I_(n,e){if(!Array.isArray(n)||0===n.length)throw new O(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function v_(n,e){const t=function(i,s){for(const o of i)for(const c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new O(b.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class lp{convertValue(e,t="none"){switch(Fn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return He(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(er(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Xn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Zc(He(e.latitude),He(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Do(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ms(e));default:return null}}convertTimestamp(e){const t=Zn(e);return new Ye(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ie.fromString(e);ne(Nm(r));const i=new pr(r.get(1),r.get(3)),s=new Q(r.popFirst(5));return i.isEqual(t)||et(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function uh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class SE extends lp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Er(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nt(this.firestore,null,t)}}class Ns{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ii extends el{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new rl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ih("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class rl extends ii{data(e={}){return super.data(e)}}class Ui{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ns(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new rl(this._firestore,this._userDataWriter,r.key,r,new Ns(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>({type:"added",doc:new rl(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Ns(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||3!==c.type).map(c=>{const d=new rl(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Ns(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,g=-1;return 0!==c.type&&(f=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),1!==c.type&&(o=o.add(c.doc),g=o.indexOf(c.doc.key)),{type:CE(c.type),doc:d,oldIndex:f,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function CE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Z()}}function T_(n,e){return n instanceof ii&&e instanceof ii?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ui&&e instanceof Ui&&n._firestore===e._firestore&&Xf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function A_(n){n=we(n,nt);const e=we(n.firestore,Xe);return Qg(ft(e),n._key).then(t=>fp(e,n,t))}class Bi extends lp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Er(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nt(this.firestore,null,t)}}function cp(n,e,t){n=we(n,nt);const r=we(n.firestore,Xe),i=uh(n.converter,e,t);return fa(r,[th(Ds(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ot.none())])}function hp(n,e,t,...r){n=we(n,nt);const i=we(n.firestore,Xe),s=Ds(i);let o;return o="string"==typeof(e=(0,oe.Ku)(e))||e instanceof ri?sp(s,"updateDoc",n._key,e,t,r):ip(s,"updateDoc",n._key,e),fa(i,[o.toMutation(n._key,ot.exists(!0))])}function w_(n,e){const t=we(n.firestore,Xe),r=Ju(n),i=uh(n.converter,e);return fa(t,[th(Ds(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ot.exists(!1))]).then(()=>r)}function dp(n,...e){var t,r,i;n=(0,oe.Ku)(n);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Zf(e[o])||(s=e[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Zf(e[o])){const y=e[o];e[o]=null===(t=y.next)||void 0===t?void 0:t.bind(y),e[o+1]=null===(r=y.error)||void 0===r?void 0:r.bind(y),e[o+2]=null===(i=y.complete)||void 0===i?void 0:i.bind(y)}let d,f,g;if(n instanceof nt)f=we(n.firestore,Xe),g=Xr(n._key.path),d={next:y=>{e[o]&&e[o](fp(f,n,y))},error:e[o+1],complete:e[o+2]};else{const y=we(n,Wt);f=we(y.firestore,Xe),g=y._query;const v=new Bi(f);d={next:w=>{e[o]&&e[o](new Ui(f,v,y,w))},error:e[o+1],complete:e[o+2]},g_(n._query)}return function(v,w,N,F){const V=new Qc(F),H=new ff(w,V,N);return v.asyncQueue.enqueueAndForget((0,m.A)(function*(){return af(yield ha(v),H)})),()=>{V.$a(),v.asyncQueue.enqueueAndForget((0,m.A)(function*(){return lf(yield ha(v),H)}))}}(ft(f),g,c,d)}function fa(n,e){return function(r,i){const s=new tt;return r.asyncQueue.enqueueAndForget((0,m.A)(function*(){return function Av(n,e,t){return Ef.apply(this,arguments)}(yield Hf(r),i,s)})),s.promise}(ft(n),e)}function fp(n,e,t){const r=t.docs.get(e._key),i=new Bi(n);return new ii(n,i,e._key,r,new Ns(t.hasPendingWrites,t.fromCache),e.converter)}const GE={maxAttempts:5};class R_{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ds(e)}set(e,t,r){this._verifyNotCommitted();const i=qi(e,this._firestore),s=uh(i.converter,t,r),o=th(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,ot.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=qi(e,this._firestore);let o;return o="string"==typeof(t=(0,oe.Ku)(t))||t instanceof ri?sp(this._dataReader,"WriteBatch.update",s._key,t,r,i):ip(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ot.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=qi(e,this._firestore);return this._mutations=this._mutations.concat(new Go(t._key,ot.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function qi(n,e){if((n=(0,oe.Ku)(n)).firestore!==e)throw new O(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class $E extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ds(t)}get(t){const r=qi(t,this._firestore),i=new SE(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return Z();const o=s[0];if(o.isFoundDocument())return new el(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new el(this._firestore,i,r._key,null,r.converter);throw Z()})}set(t,r,i){const s=qi(t,this._firestore),o=uh(s.converter,r,i),c=th(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,c),this}update(t,r,i,...s){const o=qi(t,this._firestore);let c;return c="string"==typeof(r=(0,oe.Ku)(r))||r instanceof ri?sp(this._dataReader,"Transaction.update",o._key,r,i,s):ip(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,c),this}delete(t){const r=qi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=qi(e,this._firestore),r=new Bi(this._firestore);return super.get(e).then(i=>new ii(this._firestore,r,t._key,i._document,new Ns(!1,!1),t.converter))}}!function(e,t=!0){Ei=J.SDK_VERSION,(0,J._registerComponent)(new pe.uA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),c=new Xe(new Xl(r.getProvider("auth-internal")),new Zl(r.getProvider("app-check-internal")),function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new O(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pr(f.options.projectId,g)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),(0,J.registerVersion)(Eo,"4.6.1",e),(0,J.registerVersion)(Eo,"4.6.1","esm2017")}();var ch=function(){return ch=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},ch.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var eT={includeMetadataChanges:!1};function aT(n,e){return void 0===e&&(e={}),function oT(n){return function gp(n,e){return void 0===e&&(e=eT),new Ke.c(function(t){return{unsubscribe:dp(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)})}})}(n,{includeMetadataChanges:!0}).pipe((0,ze.T)(function(e){return e.docs}))}(n).pipe((0,ze.T)(function(t){return t.map(function(r){return function C_(n,e){var t;void 0===e&&(e={});var r=n.data(e);return n.exists()&&"object"==typeof r&&null!==r&&e.idField?ch(ch({},r),((t={})[e.idField]=n.id,t)):r}(r,e)})}))}const fT=(0,ue.S3)(aT,!0),pT=(0,ue.S3)(w_,!0),V_=(0,ue.S3)(Yf,!0),Ep=(0,ue.S3)(Ju,!0),mT=(0,ue.S3)(A_,!0),il=(0,ue.S3)(iE,!0),gT=(0,ue.S3)(cp,!0),_T=(0,ue.S3)(hp,!0);var O_=q(3236),Tp=q(9172),L_=q(4360);function Ap(){return(0,tn.N)((n,e)=>{let t,r=!1;n.subscribe((0,L_._)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var wp=q(2816),yT=q(3294),M_=q(3345);function Rp(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new O("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function F_(){if(typeof Uint8Array>"u")throw new O("unimplemented","Uint8Arrays are not available in this environment.")}function U_(){if(!function Xh(){return typeof atob<"u"}())throw new O("unimplemented","Blobs are unavailable in Firestore in this environment.")}class sl{constructor(e){this._delegate=e}static fromBase64String(e){return U_(),new sl(Er.fromBase64String(e))}static fromUint8Array(e){return F_(),new sl(Er.fromUint8Array(e))}toBase64(){return U_(),this._delegate.toBase64()}toUint8Array(){return F_(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Pp(n){return function ET(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class TT{enableIndexedDbPersistence(e,t){return function sE(n,e){u_(n=we(n,Xe));const t=ft(n);if(t._uninitializedComponentsProvider)throw new O(b.FAILED_PRECONDITION,"SDK cache is already specified.");Ht("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new la;return a_(t,i,new qf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function oE(n){u_(n=we(n,Xe));const e=ft(n);if(e._uninitializedComponentsProvider)throw new O(b.FAILED_PRECONDITION,"SDK cache is already specified.");Ht("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new la;return a_(e,r,new Kg(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function aE(n){if(n._initialized&&!n._terminated)throw new O(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new tt;return n._queue.enqueueAndForgetEvenWhileRestricted((0,m.A)(function*(){try{yield(t=(0,m.A)(function*(i){if(!_n.D())return Promise.resolve();const s=i+"main";yield _n.delete(s)}),function r(i){return t.apply(this,arguments)})(Sd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class B_{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof pr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ht("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){i_(this._delegate,e,t,r)}enableNetwork(){return function lE(n){return function zv(n){return n.asyncQueue.enqueue((0,m.A)(function*(){const e=yield $g(n),t=yield jg(n);return e.setNetworkEnabled(!0),function(i){const s=j(i);return s.M_.delete(0),Hu(s)}(t)}))}(ft(n=we(n,Xe)))}(this._delegate)}disableNetwork(){return function cE(n){return function Gv(n){return n.asyncQueue.enqueue((0,m.A)(function*(){const e=yield $g(n),t=yield jg(n);return e.setNetworkEnabled(!1),(r=(0,m.A)(function*(s){const o=j(s);o.M_.add(0),yield ea(o),o.N_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(ft(n=we(n,Xe)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Zg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function uE(n){return function(t){const r=new tt;return t.asyncQueue.enqueueAndForget((0,m.A)(function*(){return function Sv(n,e){return Pf.apply(this,arguments)}(yield Hf(t),r)})),r.promise}(ft(n=we(n,Xe)))}(this._delegate)}onSnapshotsInSync(e){return function LE(n,e){return function Hv(n,e){const t=new Qc(e);return n.asyncQueue.enqueueAndForget((0,m.A)(function*(){return i=yield ha(n),s=t,j(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),n.asyncQueue.enqueueAndForget((0,m.A)(function*(){return i=yield ha(n),s=t,void j(i).z_.delete(s);var i,s}))}}(ft(n=we(n,Xe)),Zf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new O("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new pa(this,Yf(this._delegate,e))}catch(t){throw ln(t,"collection()","Firestore.collection()")}}doc(e){try{return new Bn(this,Ju(this._delegate,e))}catch(t){throw ln(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new cn(this,function eE(n,e){if(n=we(n,Qu),Jf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new O(b.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Wt(n,null,(r=e,new Pn(Ie.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw ln(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function jE(n,e,t){n=we(n,Xe);const r=Object.assign(Object.assign({},GE),t);return function(s){if(s.maxAttempts<1)throw new O(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,c){const d=new tt;return s.asyncQueue.enqueueAndForget((0,m.A)(function*(){const f=yield function Hg(n){return Yc(n).then(e=>e.datastore)}(s);new Wv(s.asyncQueue,f,c,o,d).Xa()})),d.promise}(ft(n),i=>e(new $E(n,i)),r)}(this._delegate,t=>e(new q_(this,t)))}batch(){return ft(this._delegate),new W_(new R_(this._delegate,e=>fa(this._delegate,e)))}loadBundle(e){return function hE(n,e){const t=ft(n=we(n,Xe)),r=new nE;return function Qv(n,e,t,r){const i=function(o,c){let d;return d="string"==typeof o?pm().encode(o):o,g=function(g,y){if(g instanceof Uint8Array)return zg(g,y);if(g instanceof ArrayBuffer)return zg(new Uint8Array(g),y);if(g instanceof ReadableStream)return g.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new Bv(g,c);var g}(t,ju(e));n.asyncQueue.enqueueAndForget((0,m.A)(function*(){!function Fv(n,e,t){const r=j(n);var i;(i=(0,m.A)(function*(o,c,d){try{const f=yield c.getMetadata();if(yield function(N,F){const V=j(N),H=_t(F.createTime);return V.persistence.runTransaction("hasNewerBundle","readonly",te=>V.Kr.getBundleMetadata(te,F.id)).then(te=>!!te&&te.createTime.compareTo(H)>=0)}(o.localStore,f))return yield c.close(),d._completeWith({taskState:"Success",documentsLoaded:(N=f).totalDocuments,bytesLoaded:N.totalBytes,totalDocuments:N.totalDocuments,totalBytes:N.totalBytes}),Promise.resolve(new Set);d._updateProgress(Ng(f));const g=new mv(f,o.localStore,c.serializer);let y=yield c.qa();for(;y;){const w=yield g._a(y);w&&d._updateProgress(w),y=yield c.qa()}const v=yield g.complete();return yield ni(o,v.ca,void 0),yield function(N,F){const V=j(N);return V.persistence.runTransaction("Save bundle","readwrite",H=>V.Kr.saveBundleMetadata(H,F))}(o.localStore,f),d._completeWith(v.progress),Promise.resolve(v.ua)}catch(f){return Ht("SyncEngine",`Loading bundle failed with ${f}`),d._failWith(f),Promise.resolve(new Set)}var N}),function s(o,c,d){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Hf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function dE(n,e){return function Jv(n,e){return n.asyncQueue.enqueue((0,m.A)(function*(){return function(r,i){const s=j(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield ca(n),e)}))}(ft(n=we(n,Xe)),e).then(t=>t?new Wt(n,null,t.query):null)}(this._delegate,e).then(t=>t?new cn(this,t):null)}}class hh extends lp{constructor(e){super(),this.firestore=e}convertBytes(e){return new sl(new Er(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Bn.forKey(t,this.firestore,null)}}class q_{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new hh(e)}get(e){const t=Os(e);return this._delegate.get(t).then(r=>new ol(this._firestore,new ii(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Os(e);return r?(Rp("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Os(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Os(e);return this._delegate.delete(t),this}}class W_{constructor(e){this._delegate=e}set(e,t,r){const i=Os(e);return r?(Rp("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Os(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Os(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Vs{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new rl(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new al(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Vs.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Vs(e,new hh(e),t),i.set(t,s)),s}}Vs.INSTANCES=new WeakMap;class Bn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new hh(e)}static forPath(e,t,r){if(e.length%2!=0)throw new O("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Bn(t,new nt(t._delegate,r,new Q(e)))}static forKey(e,t,r){return new Bn(t,new nt(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new pa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new pa(this.firestore,Yf(this._delegate,e))}catch(t){throw ln(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,oe.Ku)(e))instanceof nt&&s_(this._delegate,e)}set(e,t){t=Rp("DocumentReference.set",t);try{return t?cp(this._delegate,e,t):cp(this._delegate,e)}catch(r){throw ln(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?hp(this._delegate,e):hp(this._delegate,e,t,...r)}catch(i){throw ln(i,"updateDoc()","DocumentReference.update()")}}delete(){return function OE(n){return fa(we(n.firestore,Xe),[new Go(n._key,ot.none())])}(this._delegate)}onSnapshot(...e){const t=K_(e),r=z_(e,i=>new ol(this.firestore,new ii(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return dp(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function xE(n){n=we(n,nt);const e=we(n.firestore,Xe),t=ft(e),r=new Bi(e);return function $v(n,e){const t=new tt;return n.asyncQueue.enqueueAndForget((0,m.A)(function*(){return(r=(0,m.A)(function*(s,o,c){try{const d=yield function(g,y){const v=j(g);return v.persistence.runTransaction("read document","readonly",w=>v.localDocuments.getDocument(w,y))}(s,o);d.isFoundDocument()?c.resolve(d):d.isNoDocument()?c.resolve(null):c.reject(new O(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const f=ia(d,`Failed to get document '${o} from cache`);c.reject(f)}}),function i(s,o,c){return r.apply(this,arguments)})(yield ca(n),e,t);var r})),t.promise}(t,n._key).then(i=>new ii(e,r,n._key,i,new Ns(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function DE(n){n=we(n,nt);const e=we(n.firestore,Xe);return Qg(ft(e),n._key,{source:"server"}).then(t=>fp(e,n,t))}(this._delegate):A_(this._delegate),t.then(r=>new ol(this.firestore,new ii(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Bn(this.firestore,this._delegate.withConverter(e?Vs.getInstance(this.firestore,e):null))}}function ln(n,e,t){return n.message=n.message.replace(e,t),n}function K_(n){for(const e of n)if("object"==typeof e&&!Pp(e))return e;return{}}function z_(n,e){var t,r;let i;return i=Pp(n[0])?n[0]:Pp(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ol{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Bn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return T_(this._delegate,e._delegate)}}class al extends ol{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Yl(n,e){n||Z()}(void 0!==t),t}}class cn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new hh(e)}where(e,t,r){try{return new cn(this.firestore,Fi(this._delegate,function IE(n,e,t){const r=e,i=ih("where",n);return nl._create(i,r,t)}(e,t,r)))}catch(i){throw ln(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new cn(this.firestore,Fi(this._delegate,function vE(n,e="asc"){const t=e,r=ih("orderBy",n);return up._create(r,t)}(e,t)))}catch(r){throw ln(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new cn(this.firestore,Fi(this._delegate,function EE(n){return n_("limit",n),sh._create("limit",n,"F")}(e)))}catch(t){throw ln(t,"limit()","Query.limit()")}}limitToLast(e){try{return new cn(this.firestore,Fi(this._delegate,function TE(n){return n_("limitToLast",n),sh._create("limitToLast",n,"L")}(e)))}catch(t){throw ln(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new cn(this.firestore,Fi(this._delegate,function AE(...n){return oh._create("startAt",n,!0)}(...e)))}catch(t){throw ln(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new cn(this.firestore,Fi(this._delegate,function wE(...n){return oh._create("startAfter",n,!1)}(...e)))}catch(t){throw ln(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new cn(this.firestore,Fi(this._delegate,function RE(...n){return ah._create("endBefore",n,!1)}(...e)))}catch(t){throw ln(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new cn(this.firestore,Fi(this._delegate,function PE(...n){return ah._create("endAt",n,!0)}(...e)))}catch(t){throw ln(t,"endAt()","Query.endAt()")}}isEqual(e){return Xf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function NE(n){n=we(n,Wt);const e=we(n.firestore,Xe),t=ft(e),r=new Bi(e);return function jv(n,e){const t=new tt;return n.asyncQueue.enqueueAndForget((0,m.A)(function*(){return(r=(0,m.A)(function*(s,o,c){try{const d=yield qc(s,o,!0),f=new Lg(o,d.ls),g=f.da(d.documents),y=f.applyChanges(g,!1);c.resolve(y.snapshot)}catch(d){const f=ia(d,`Failed to execute query '${o} against cache`);c.reject(f)}}),function i(s,o,c){return r.apply(this,arguments)})(yield ca(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Ui(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function VE(n){n=we(n,Wt);const e=we(n.firestore,Xe),t=ft(e),r=new Bi(e);return Jg(t,n._query,{source:"server"}).then(i=>new Ui(e,r,n,i))}(this._delegate):function kE(n){n=we(n,Wt);const e=we(n.firestore,Xe),t=ft(e),r=new Bi(e);return g_(n._query),Jg(t,n._query).then(i=>new Ui(e,r,n,i))}(this._delegate),t.then(r=>new Sp(this.firestore,new Ui(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=K_(e),r=z_(e,i=>new Sp(this.firestore,new Ui(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return dp(this._delegate,t,r)}withConverter(e){return new cn(this.firestore,this._delegate.withConverter(e?Vs.getInstance(this.firestore,e):null))}}class wT{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new al(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Sp{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new cn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new al(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new wT(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new al(this._firestore,r))})}isEqual(e){return T_(this._delegate,e._delegate)}}class pa extends cn{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Bn(this.firestore,e):null}doc(e){try{return new Bn(this.firestore,void 0===e?Ju(this._delegate):Ju(this._delegate,e))}catch(t){throw ln(t,"doc()","CollectionReference.doc()")}}add(e){return w_(this._delegate,e).then(t=>new Bn(this.firestore,t))}isEqual(e){return s_(this._delegate,e._delegate)}withConverter(e){return new pa(this.firestore,this._delegate.withConverter(e?Vs.getInstance(this.firestore,e):null))}}function Os(n){return we(n,nt)}class bp{constructor(...e){this._delegate=new ri(...e)}static documentId(){return new bp(je.keyField().canonicalString())}isEqual(e){return(e=(0,oe.Ku)(e))instanceof ri&&this._delegate._internalPath.isEqual(e._internalPath)}}class Ls{constructor(e){this._delegate=e}static serverTimestamp(){const e=function QE(){return new ep("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Ls(e)}static delete(){const e=function HE(){return new Xu("deleteField")}();return e._methodName="FieldValue.delete",new Ls(e)}static arrayUnion(...e){const t=function JE(...n){return new tp("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Ls(t)}static arrayRemove(...e){const t=function YE(...n){return new np("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Ls(t)}static increment(e){const t=function XE(n){return new rp("increment",n)}(e);return t._methodName="FieldValue.increment",new Ls(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const RT={Firestore:B_,GeoPoint:Zc,Timestamp:Ye,Blob:sl,Transaction:q_,WriteBatch:W_,DocumentReference:Bn,DocumentSnapshot:ol,Query:cn,QueryDocumentSnapshot:al,QuerySnapshot:Sp,CollectionReference:pa,FieldPath:bp,FieldValue:Ls,setLogLevel:function AT(n){!function ht(n){gn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function G_(n,e){return function bT(n,e=O_.E){return new Ke.c(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function Cp(n,e){return G_(n,e).pipe((0,ze.T)(t=>({payload:t,type:"query"})))}!function ST(n){(function PT(n,e){n.INTERNAL.registerComponent(new pe.uA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},RT)))})(n,(e,t)=>new B_(e,t,new TT)),n.registerVersion("@firebase/firestore-compat","0.3.30")}(M_.A);class $_{constructor(e,t){(0,I.A)(this,"ref",void 0),(0,I.A)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=J_(r,t);return new Q_(i,s,this.afs)}snapshotChanges(){return function CT(n,e){return G_(n,e).pipe((0,Tp.Z)(void 0),Ap(),(0,ze.T)(t=>{const[r,i]=t;return i.exists?null!=r&&r.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ue.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ze.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,ge.H)(this.ref.get(e)).pipe(ue.U0)}}function dh(n,e){return Cp(n,e).pipe((0,Tp.Z)(void 0),Ap(),(0,ze.T)(t=>{const[r,i]=t,s=i.payload.docChanges(),o=s.map(c=>({type:c.type,payload:c}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((c,d)=>{const f=s.find(y=>y.doc.ref.isEqual(c.ref)),g=null==r?void 0:r.payload.docs.find(y=>y.ref.isEqual(c.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(c.metadata)||!f&&g&&JSON.stringify(g.metadata)===JSON.stringify(c.metadata)||o.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:c}})}),o}))}function j_(n,e,t){return dh(n,t).pipe((0,wp.S)((r,i)=>function xT(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function DT(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return xp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return xp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return xp(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,yT.F)(),(0,ze.T)(r=>r.map(i=>({type:i.type,payload:i}))))}function xp(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function H_(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Q_{constructor(e,t,r){(0,I.A)(this,"ref",void 0),(0,I.A)(this,"query",void 0),(0,I.A)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=dh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ze.T)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Tp.Z)(void 0),Ap(),(0,Gt.p)(([r,i])=>i.length>0||!r),(0,ze.T)(([,r])=>r),ue.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,wp.S)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=H_(e);return j_(this.query,t,this.afs.schedulers.outsideAngular).pipe(ue.U0)}valueChanges(e={}){return Cp(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.T)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),ue.U0)}get(e){return(0,ge.H)(this.query.get(e)).pipe(ue.U0)}add(e){return this.ref.add(e)}doc(e){return new $_(this.ref.doc(e),this.afs)}}class kT{constructor(e,t){(0,I.A)(this,"query",void 0),(0,I.A)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?dh(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.T)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Gt.p)(t=>t.length>0),ue.U0):dh(this.query,this.afs.schedulers.outsideAngular).pipe(ue.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,wp.S)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=H_(e);return j_(this.query,t,this.afs.schedulers.outsideAngular).pipe(ue.U0)}valueChanges(e={}){return Cp(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.T)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),ue.U0)}get(e){return(0,ge.H)(this.query.get(e)).pipe(ue.U0)}}const NT=new D.nKC("angularfire2.enableFirestorePersistence"),VT=new D.nKC("angularfire2.firestore.persistenceSettings"),OT=new D.nKC("angularfire2.firestore.settings"),LT=new D.nKC("angularfire2.firestore.use-emulator");function J_(n,e=(t=>t)){return{query:e(n),ref:n}}let MT=(()=>{var n;class e{constructor(r,i,s,o,c,d,f,g,y,v,w,N,F,V,H,te,X){(0,I.A)(this,"schedulers",void 0),(0,I.A)(this,"firestore",void 0),(0,I.A)(this,"persistenceEnabled$",void 0),this.schedulers=f;const G=(0,Re.iB)(r,d,i),fe=y;v&&R(G,d,w,F,V,H,N,te),[this.firestore,this.persistenceEnabled$]=(0,Re.BM)(`${G.name}.firestore`,"AngularFirestore",G.name,()=>{const ce=d.runOutsideAngular(()=>G.firestore());if(o&&ce.settings(o),fe&&ce.useEmulator(...fe),s&&!(0,Kt.Vy)(c)){const rt=()=>{try{return(0,ge.H)(ce.enablePersistence(g||void 0).then(()=>!0,()=>!1))}catch(Pt){return typeof console<"u"&&console.warn(Pt),(0,Be.of)(!1)}};return[ce,d.runOutsideAngular(rt)]}return[ce,(0,Be.of)(!1)]},[o,fe,s])}collection(r,i){let s;s="string"==typeof r?this.firestore.collection(r):r;const{ref:o,query:c}=J_(s,i),d=this.schedulers.ngZone.run(()=>o);return new Q_(d,c,this)}collectionGroup(r,i){const s=i||(c=>c),o=this.firestore.collectionGroup(r);return new kT(s(o),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const s=this.schedulers.ngZone.run(()=>i);return new $_(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n=e,(0,I.A)(e,"\u0275fac",function(r){return new(r||n)(D.KVO(Re.rx),D.KVO(Re.uP,8),D.KVO(NT,8),D.KVO(OT,8),D.KVO(D.Agw),D.KVO(D.SKi),D.KVO(ue.u0),D.KVO(VT,8),D.KVO(LT,8),D.KVO(x,8),D.KVO(Pr,8),D.KVO(Wn,8),D.KVO(ir,8),D.KVO(Cn,8),D.KVO(ui,8),D.KVO(z,8),D.KVO(ue.Jv,8))}),(0,I.A)(e,"\u0275prov",D.jDH({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();var FT=q(5265);const Y_="firebasestorage.googleapis.com",X_="storageBucket";class lt extends oe.g{constructor(e,t,r=0){super(Dp(e),`Firebase Storage: ${t} (${Dp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,lt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Dp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var at=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(at||{});function Dp(n){return"storage/"+n}function kp(){return new lt(at.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Z_(){return new lt(at.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ey(){return new lt(at.CANCELED,"User canceled the upload/download.")}function ty(){return new lt(at.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function ma(n){return new lt(at.INVALID_ARGUMENT,n)}function ny(){return new lt(at.APP_DELETED,"The Firebase app was deleted.")}function ry(n){return new lt(at.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function ul(n,e){return new lt(at.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function ll(n){throw new lt(at.INTERNAL_ERROR,"Internal error: "+n)}class en{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=en.makeFromUrl(e,t)}catch{return new en(e,"")}if(""===r.path)return r;throw function QT(n){return new lt(at.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}(e)}static makeFromUrl(e,t){let r=null;const i="([A-Za-z0-9.\\-_]+)",c=new RegExp("^gs://"+i+"(/(.*))?$","i");function f(G){G.path_=decodeURIComponent(G.path)}const y=t.replace(/[.]/g,"\\."),X=[{regex:c,indices:{bucket:1,path:3},postModify:function s(G){"/"===G.path.charAt(G.path.length-1)&&(G.path_=G.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${y}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:f},{regex:new RegExp(`^https?://${t===Y_?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:f}];for(let G=0;G<X.length;G++){const fe=X[G],ce=fe.regex.exec(e);if(ce){let Pt=ce[fe.indices.path];Pt||(Pt=""),r=new en(ce[fe.indices.bucket],Pt),fe.postModify(r);break}}if(null==r)throw function HT(n){return new lt(at.INVALID_URL,"Invalid URL '"+n+"'.")}(e);return r}}class eA{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function fh(n){return"string"==typeof n||n instanceof String}function iy(n){return Np()&&n instanceof Blob}function Np(){return typeof Blob<"u"}function Vp(n,e,t,r){if(r<e)throw ma(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw ma(`Invalid value for '${n}'. Expected ${t} or less.`)}function si(n,e,t){let r=e;return null==t&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function sy(n){const e=encodeURIComponent;let t="?";for(const r in n)n.hasOwnProperty(r)&&(t=t+(e(r)+"=")+e(n[r])+"&");return t=t.slice(0,-1),t}var ga=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(ga||{});function oy(n,e){const t=n>=500&&n<600,i=-1!==[408,429].indexOf(n),s=-1!==e.indexOf(n);return t||i||s}class oA{constructor(e,t,r,i,s,o,c,d,f,g,y,v=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=d,this.timeout_=f,this.progressCallback_=g,this.connectionFactory_=y,this.retry=v,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((w,N)=>{this.resolve_=w,this.reject_=N,this.start_()})}start_(){const t=(r,i)=>{const s=this.resolve_,o=this.reject_,c=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());!function rA(n){return void 0!==n}(d)?s():s(d)}catch(d){o(d)}else if(null!==c){const d=kp();d.serverResponse=c.getErrorText(),o(this.errorCallback_?this.errorCallback_(c,d):d)}else o(i.canceled?this.appDelete_?ny():ey():Z_())};this.canceled_?t(0,new ph(!1,null,!0)):this.backoffId_=function tA(n,e,t){let r=1,i=null,s=null,o=!1,c=0;function d(){return 2===c}let f=!1;function g(...V){f||(f=!0,e.apply(null,V))}function y(V){i=setTimeout(()=>{i=null,n(w,d())},V)}function v(){s&&clearTimeout(s)}function w(V,...H){if(f)return void v();if(V)return v(),void g.call(null,V,...H);if(d()||o)return v(),void g.call(null,V,...H);let X;r<64&&(r*=2),1===c?(c=2,X=0):X=1e3*(r+Math.random()),y(X)}let N=!1;function F(V){N||(N=!0,v(),!f&&(null!==i?(V||(c=2),clearTimeout(i),y(0)):V||(c=1)))}return y(0),s=setTimeout(()=>{o=!0,F(!0)},t),F}((r,i)=>{if(i)return void r(!1,new ph(!1,null,!0));const s=this.connectionFactory_();this.pendingConnection_=s;const o=c=>{null!==this.progressCallback_&&this.progressCallback_(c.loaded,c.lengthComputable?c.total:-1)};null!==this.progressCallback_&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const c=s.getErrorCode()===ga.NO_ERROR,d=s.getStatus();if(!c||oy(d,this.additionalRetryCodes_)&&this.retry){const g=s.getErrorCode()===ga.ABORT;return void r(!1,new ph(!1,null,g))}const f=-1!==this.successCodes_.indexOf(d);r(!0,new ph(f,s))})},t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function nA(n){n(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class ph{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function fA(...n){const e=function dA(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}();if(void 0!==e){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}if(Np())return new Blob(n);throw new lt(at.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Sn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Op{constructor(e,t){this.data=e,this.contentType=t||null}}function Lp(n,e){switch(n){case Sn.RAW:return new Op(ay(e));case Sn.BASE64:case Sn.BASE64URL:return new Op(uy(n,e));case Sn.DATA_URL:return new Op(function _A(n){const e=new ly(n);return e.base64?uy(Sn.BASE64,e.rest):function gA(n){let e;try{e=decodeURIComponent(n)}catch{throw ul(Sn.DATA_URL,"Malformed data URL.")}return ay(e)}(e.rest)}(e),function yA(n){return new ly(n).contentType}(e))}throw kp()}function ay(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(r=65536|(1023&r)<<10|1023&n.charCodeAt(++t),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function uy(n,e){switch(n){case Sn.BASE64:{const i=-1!==e.indexOf("-"),s=-1!==e.indexOf("_");if(i||s)throw ul(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Sn.BASE64URL:{const i=-1!==e.indexOf("+"),s=-1!==e.indexOf("/");if(i||s)throw ul(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=function mA(n){if(typeof atob>"u")throw function ZT(n){return new lt(at.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}("base-64");return atob(n)}(e)}catch(i){throw i.message.includes("polyfill")?i:ul(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}class ly{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw ul(Sn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;null!=r&&(this.base64=function IA(n,e){return n.length>=e.length&&n.substring(n.length-e.length)===e}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}class Tr{constructor(e,t){let r=0,i="";iy(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(iy(this.data_)){const i=function pA(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}(this.data_,e,t);return null===i?null:new Tr(i)}{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Tr(r,!0)}}static getBlob(...e){if(Np()){const t=e.map(r=>r instanceof Tr?r.data_:r);return new Tr(fA.apply(null,t))}{const t=e.map(o=>fh(o)?Lp(Sn.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let s=0;return t.forEach(o=>{for(let c=0;c<o.length;c++)i[s++]=o[c]}),new Tr(i,!0)}}uploadData(){return this.data_}}function Mp(n){let e;try{e=JSON.parse(n)}catch{return null}return function sA(n){return"object"==typeof n&&!Array.isArray(n)}(e)?e:null}function cy(n){const e=n.lastIndexOf("/",n.length-2);return-1===e?n:n.slice(e+1)}function TA(n,e){return e}class hn{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||TA}}let mh=null;function cl(){if(mh)return mh;const n=[];n.push(new hn("bucket")),n.push(new hn("generation")),n.push(new hn("metageneration")),n.push(new hn("name","fullPath",!0));const t=new hn("name");t.xform=function e(s,o){return function AA(n){return!fh(n)||n.length<2?n:cy(n)}(o)},n.push(t);const i=new hn("size");return i.xform=function r(s,o){return void 0!==o?Number(o):o},n.push(i),n.push(new hn("timeCreated")),n.push(new hn("updated")),n.push(new hn("md5Hash",null,!0)),n.push(new hn("cacheControl",null,!0)),n.push(new hn("contentDisposition",null,!0)),n.push(new hn("contentEncoding",null,!0)),n.push(new hn("contentLanguage",null,!0)),n.push(new hn("contentType",null,!0)),n.push(new hn("metadata","customMetadata",!0)),mh=n,mh}function hy(n,e,t){const r=Mp(e);return null===r?null:function RA(n,e,t){const r={type:"file"},i=t.length;for(let s=0;s<i;s++){const o=t[s];r[o.local]=o.xform(r,e[o.server])}return function wA(n,e){Object.defineProperty(n,"ref",{get:function t(){const s=new en(n.bucket,n.fullPath);return e._makeStorageReference(s)}})}(r,n),r}(n,r,t)}function Fp(n,e){const t={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}const dy="prefixes",fy="items";class Ar{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function wr(n){if(!n)throw kp()}function gh(n,e){return function t(r,i){const s=hy(n,i,e);return wr(null!==s),s}}function _a(n){return function e(t,r){let i;return i=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?function $T(){return new lt(at.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}():function GT(){return new lt(at.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===t.getStatus()?function zT(n){return new lt(at.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(n.bucket):403===t.getStatus()?function jT(n){return new lt(at.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}(n.path):r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}}function hl(n){const e=_a(n);return function t(r,i){let s=e(r,i);return 404===r.getStatus()&&(s=function KT(n){return new lt(at.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}(n.path)),s.serverResponse=i.serverResponse,s}}function py(n,e,t){const i=si(e.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,c=new Ar(i,"GET",gh(n,t),o);return c.errorHandler=hl(e),c}function DA(n,e,t,r,i){const s={};s.prefix=e.isRoot?"":e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);const c=si(e.bucketOnlyServerUrl(),n.host,n._protocol),f=n.maxOperationRetryTime,g=new Ar(c,"GET",function CA(n,e){return function t(r,i){const s=function bA(n,e,t){const r=Mp(t);return null===r?null:function SA(n,e,t){const r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[dy])for(const i of t[dy]){const s=i.replace(/\/$/,""),o=n._makeStorageReference(new en(e,s));r.prefixes.push(o)}if(t[fy])for(const i of t[fy]){const s=n._makeStorageReference(new en(e,i.name));r.items.push(s)}return r}(n,e,r)}(n,e,i);return wr(null!==s),s}}(n,e.bucket),f);return g.urlParams=s,g.errorHandler=_a(e),g}function gy(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=function OA(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}function _y(n,e,t,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},d=function c(){let X="";for(let G=0;G<2;G++)X+=Math.random().toString().slice(2);return X}();o["Content-Type"]="multipart/related; boundary="+d;const f=gy(e,r,i),g=Fp(f,t),w=Tr.getBlob("--"+d+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+g+"\r\n--"+d+"\r\nContent-Type: "+f.contentType+"\r\n\r\n",r,"\r\n--"+d+"--");if(null===w)throw ty();const N={name:f.fullPath},F=si(s,n.host,n._protocol),H=n.maxUploadRetryTime,te=new Ar(F,"POST",gh(n,t),H);return te.urlParams=N,te.headers=o,te.body=w.uploadData(),te.errorHandler=_a(e),te}class _h{constructor(e,t,r,i){this.current=e,this.total=t,this.finalized=!!r,this.metadata=i||null}}function Up(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{wr(!1)}return wr(!!t&&-1!==(e||["active"]).indexOf(t)),t}const UA={STATE_CHANGED:"state_changed"},dn={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Bp(n){switch(n){case"running":case"pausing":case"canceling":return dn.RUNNING;case"paused":return dn.PAUSED;case"success":return dn.SUCCESS;case"canceled":return dn.CANCELED;default:return dn.ERROR}}class BA{constructor(e,t,r){if(function iA(n){return"function"==typeof n}(e)||null!=t||null!=r)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=r?r:void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}function ya(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}let Iy=null;class qA{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ga.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ga.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ga.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw ll("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ll("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ll("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ll("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ll("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class WA extends qA{initXhr(){this.xhr_.responseType="text"}}function nr(){return Iy?Iy():new WA}class vy{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=cl(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(at.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const s=this.isExponentialBackoffExpired();if(oy(i.status,[])){if(!s)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();i=Z_()}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(at.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{const r=function LA(n,e,t,r,i){const s=e.bucketOnlyServerUrl(),o=gy(e,r,i),c={name:o.fullPath},d=si(s,n.host,n._protocol),g={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},y=Fp(o,t),N=new Ar(d,"POST",function w(F){let V;Up(F);try{V=F.getResponseHeader("X-Goog-Upload-URL")}catch{wr(!1)}return wr(fh(V)),V},n.maxUploadRetryTime);return N.urlParams=c,N.headers=g,N.body=y,N.errorHandler=_a(e),N}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,nr,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,r)=>{const i=function MA(n,e,t,r){const d=new Ar(t,"POST",function s(f){const g=Up(f,["active","final"]);let y=null;try{y=f.getResponseHeader("X-Goog-Upload-Size-Received")}catch{wr(!1)}y||wr(!1);const v=Number(y);return wr(!isNaN(v)),new _h(v,r.size(),"final"===g)},n.maxUploadRetryTime);return d.headers={"X-Goog-Upload-Command":"query"},d.errorHandler=_a(e),d}(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,nr,t,r);this._request=s,s.getPromise().then(o=>{this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=262144*this._chunkMultiplier,t=new _h(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=function FA(n,e,t,r,i,s,o,c){const d=new _h(0,0);if(o?(d.current=o.current,d.total=o.total):(d.current=0,d.total=r.size()),r.size()!==d.total)throw function YT(){return new lt(at.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}();const f=d.total-d.current;let g=f;i>0&&(g=Math.min(g,i));const y=d.current;let w="";w=0===g?"finalize":f===g?"upload, finalize":"upload";const N={"X-Goog-Upload-Command":w,"X-Goog-Upload-Offset":`${d.current}`},F=r.slice(y,y+g);if(null===F)throw ty();const X=new Ar(t,"POST",function V(G,fe){const ce=Up(G,["active","final"]),rt=d.current+g,Pt=r.size();let dl;return dl="final"===ce?gh(e,s)(G,fe):null,new _h(rt,Pt,"final"===ce,dl)},e.maxUploadRetryTime);return X.headers=N,X.body=F.uploadData(),X.progressCallback=c||null,X.errorHandler=_a(n),X}(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(d){return this._error=d,void this._transition("error")}const c=this._ref.storage._makeRequest(o,nr,i,s,!1);this._request=c,c.getPromise().then(d=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(d.current),d.finalized?(this._metadata=d.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const r=py(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,nr,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const r=_y(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,nr,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=ey(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Bp(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,i){const s=new BA(t||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Bp(this._state)){case dn.SUCCESS:ya(this._resolve.bind(null,this.snapshot))();break;case dn.CANCELED:case dn.ERROR:ya(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Bp(this._state)){case dn.RUNNING:case dn.PAUSED:e.next&&ya(e.next.bind(e,this.snapshot))();break;case dn.SUCCESS:e.complete&&ya(e.complete.bind(e))();break;default:e.error&&ya(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Ms{constructor(e,t){this._service=e,this._location=t instanceof en?t:en.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ms(e,t)}get root(){const e=new en(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return cy(this._location.path)}get storage(){return this._service}get parent(){const e=function vA(n){if(0===n.length)return null;const e=n.lastIndexOf("/");return-1===e?"":n.slice(0,e)}(this._location.path);if(null===e)return null;const t=new en(this._location.bucket,e);return new Ms(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw ry(e)}}function Ty(n,e,t){return qp.apply(this,arguments)}function qp(){return qp=(0,m.A)(function*(n,e,t){const i=yield Ay(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),null!=i.nextPageToken&&(yield Ty(n,e,i.nextPageToken))}),qp.apply(this,arguments)}function Ay(n,e){null!=e&&"number"==typeof e.maxResults&&Vp("options.maxResults",1,1e3,e.maxResults);const t=e||{},r=DA(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,nr)}function e0(n){n._throwIfRoot("getDownloadURL");const e=function kA(n,e,t){const i=si(e.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,c=new Ar(i,"GET",function xA(n,e){return function t(r,i){const s=hy(n,i,e);return wr(null!==s),function PA(n,e,t,r){const i=Mp(e);if(null===i||!fh(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map(f=>{const y=n.fullPath;return si("/b/"+o(n.bucket)+"/o/"+o(y),t,r)+sy({alt:"media",token:f})})[0]}(s,i,n.host,n._protocol)}}(n,t),o);return c.errorHandler=hl(e),c}(n.storage,n._location,cl());return n.storage.makeRequestWithTokens(e,nr).then(t=>{if(null===t)throw function XT(){return new lt(at.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}();return t})}function wy(n,e){const t=function EA(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return 0===n.length?t:n+"/"+t}(n._location.path,e),r=new en(n._location.bucket,t);return new Ms(n.storage,r)}function Ry(n,e){if(n instanceof Wp){const t=n;if(null==t._bucket)throw function JT(){return new lt(at.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+X_+"' property when initializing the app?")}();const r=new Ms(t,t._bucket);return null!=e?Ry(r,e):r}return void 0!==e?wy(n,e):n}function s0(n,e){if(e&&function n0(n){return/^[A-Za-z]+:\/\//.test(n)}(e)){if(n instanceof Wp)return function r0(n,e){return new Ms(n,e)}(n,e);throw ma("To use ref(service, url), the first argument must be a Storage instance.")}return Ry(n,e)}function Py(n,e){const t=null==e?void 0:e[X_];return null==t?null:en.makeFromBucketSpec(t,n)}class Wp{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=Y_,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?en.makeFromBucketSpec(i,this._host):Py(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._bucket=null!=this._url?en.makeFromBucketSpec(this._url,e):Py(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Vp("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Vp("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){var e=this;return(0,m.A)(function*(){if(e._overrideAuthToken)return e._overrideAuthToken;const t=e._authProvider.getImmediate({optional:!0});if(t){const r=yield t.getToken();if(null!==r)return r.accessToken}return null})()}_getAppCheckToken(){var e=this;return(0,m.A)(function*(){const t=e._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ms(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new eA(ny());{const o=function hA(n,e,t,r,i,s,o=!0){const c=sy(n.urlParams),d=n.url+c,f=Object.assign({},n.headers);return function lA(n,e){e&&(n["X-Firebase-GMPID"]=e)}(f,e),function aA(n,e){null!==e&&e.length>0&&(n.Authorization="Firebase "+e)}(f,t),function uA(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(f,s),function cA(n,e){null!==e&&(n["X-Firebase-AppCheck"]=e)}(f,r),new oA(d,n.method,f,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){var r=this;return(0,m.A)(function*(){const[i,s]=yield Promise.all([r._getAuthToken(),r._getAppCheckToken()]);return r._makeRequest(e,t,i,s).getPromise()})()}}const Sy="@firebase/storage",Cy="storage";function a0(n,e,t,r){return function JA(n,e,t=Sn.RAW,r){n._throwIfRoot("uploadString");const i=Lp(t,e),s=Object.assign({},r);return null==s.contentType&&null!=i.contentType&&(s.contentType=i.contentType),function Ey(n,e,t){n._throwIfRoot("uploadBytes");const r=_y(n.storage,n._location,cl(),new Tr(e,!0),t);return n.storage.makeRequestWithTokens(r,nr).then(i=>({metadata:i,ref:n}))}(n,i.data,s)}(n=(0,oe.Ku)(n),e,t,r)}function xy(n){return e0(n=(0,oe.Ku)(n))}function Dy(n){return function t0(n){n._throwIfRoot("deleteObject");const e=function VA(n,e){const r=si(e.fullServerUrl(),n.host,n._protocol),c=new Ar(r,"DELETE",function o(d,f){},n.maxOperationRetryTime);return c.successCodes=[200,204],c.errorHandler=hl(e),c}(n.storage,n._location);return n.storage.makeRequestWithTokens(e,nr)}(n=(0,oe.Ku)(n))}function Ia(n,e){return s0(n=(0,oe.Ku)(n),e)}function yh(n=(0,J.getApp)(),e){n=(0,oe.Ku)(n);const r=(0,J._getProvider)(n,Cy).getImmediate({identifier:e}),i=(0,oe.yU)("storage");return i&&ky(r,...i),r}function ky(n,e,t,r={}){!function o0(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken="string"==typeof i?i:(0,oe.Fy)(i,n.app.options.projectId))}(n,e,t,r)}function p0(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Wp(t,r,i,e,J.SDK_VERSION)}!function m0(){(0,J._registerComponent)(new pe.uA(Cy,p0,"PUBLIC").setMultipleInstances(!0)),(0,J.registerVersion)(Sy,"0.12.4",""),(0,J.registerVersion)(Sy,"0.12.4","esm2017")}();class Ih{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Ny{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Ih(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new Ih(r,this,this._ref))},t)}on(e,t,r,i){let s;return t&&(s="function"==typeof t?o=>t(new Ih(o,this,this._ref)):{next:t.next?o=>t.next(new Ih(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,r||void 0,i||void 0)}}class Vy{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new oi(e,this._service))}get items(){return this._delegate.items.map(e=>new oi(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class oi{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function f0(n,e){return wy(n,e)}(this._delegate,e);return new oi(t,this.storage)}get root(){return new oi(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new oi(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Ny(function u0(n,e,t){return function QA(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new vy(n,new Tr(e),t)}(n=(0,oe.Ku)(n),e,t)}(this._delegate,e,t),this)}putString(e,t=Sn.RAW,r){this._throwIfRoot("putString");const i=Lp(t,e),s=Object.assign({},r);return null==s.contentType&&null!=i.contentType&&(s.contentType=i.contentType),new Ny(new vy(this._delegate,new Tr(i.data,!0),s),this)}listAll(){return function d0(n){return function YA(n){const e={prefixes:[],items:[]};return Ty(n,e).then(()=>e)}(n=(0,oe.Ku)(n))}(this._delegate).then(e=>new Vy(e,this.storage))}list(e){return function h0(n,e){return Ay(n=(0,oe.Ku)(n),e)}(this._delegate,e||void 0).then(t=>new Vy(t,this.storage))}getMetadata(){return function l0(n){return function XA(n){n._throwIfRoot("getMetadata");const e=py(n.storage,n._location,cl());return n.storage.makeRequestWithTokens(e,nr)}(n=(0,oe.Ku)(n))}(this._delegate)}updateMetadata(e){return function c0(n,e){return function ZA(n,e){n._throwIfRoot("updateMetadata");const t=function NA(n,e,t,r){const s=si(e.fullServerUrl(),n.host,n._protocol),c=Fp(t,r),f=n.maxOperationRetryTime,g=new Ar(s,"PATCH",gh(n,r),f);return g.headers={"Content-Type":"application/json; charset=utf-8"},g.body=c,g.errorHandler=hl(e),g}(n.storage,n._location,e,cl());return n.storage.makeRequestWithTokens(t,nr)}(n=(0,oe.Ku)(n),e)}(this._delegate,e)}getDownloadURL(){return xy(this._delegate)}delete(){return this._throwIfRoot("delete"),Dy(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw ry(e)}}class Oy{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Ly(e))throw ma("ref() expected a child path but got a URL, use refFromURL instead.");return new oi(Ia(this._delegate,e),this)}refFromURL(e){if(!Ly(e))throw ma("refFromURL() expected a full URL but got a child path, use ref() instead.");try{en.makeFromUrl(e,this._delegate.host)}catch{throw ma("refFromUrl() expected a valid full URL but got an invalid one.")}return new oi(Ia(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){ky(this._delegate,e,t,r)}}function Ly(n){return/^[A-Za-z]+:\/\//.test(n)}function I0(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new Oy(t,r)}function My(n){const e=function E0(n){return new Ke.c(e=>{const t=o=>e.next(o);t(n.snapshot);const s=n.on("state_changed",t);return n.then(o=>{t(o),e.complete()},o=>{t(n.snapshot),(o=>{e.error(o)})(o)}),function(){s()}}).pipe(function UT(n,e=O_.E){return(0,tn.N)((t,r)=>{let i=null,s=null,o=null;const c=()=>{if(i){i.unsubscribe(),i=null;const f=s;s=null,r.next(f)}};function d(){const f=o+n,g=e.now();if(g<f)return i=this.schedule(void 0,f-g),void r.add(i);c()}t.subscribe((0,L_._)(r,f=>{s=f,o=e.now(),i||(i=e.schedule(d,n),r.add(i))},()=>{c(),r.complete()},void 0,()=>{s=i=null}))})}(0))}(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>e,percentageChanges:()=>e.pipe((0,ze.T)(t=>t.bytesTransferred/t.totalBytes*100))}}function vh(n){return{getDownloadURL:()=>(0,Be.of)(void 0).pipe(ue.Oe,(0,St.n)(()=>n.getDownloadURL()),ue.U0),getMetadata:()=>(0,Be.of)(void 0).pipe(ue.Oe,(0,St.n)(()=>n.getMetadata()),ue.U0),delete:()=>(0,ge.H)(n.delete()),child:e=>vh(n.child(e)),updateMetadata:e=>(0,ge.H)(n.updateMetadata(e)),put:(e,t)=>My(n.put(e,t)),putString:(e,t,r)=>My(n.putString(e,t,r)),list:e=>(0,ge.H)(n.list(e)),listAll:()=>(0,ge.H)(n.listAll())}}!function v0(n){const e={TaskState:dn,TaskEvent:UA,StringFormat:Sn,Storage:Oy,Reference:oi};n.INTERNAL.registerComponent(new pe.uA("storage-compat",I0,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion("@firebase/storage-compat","0.3.7")}(M_.A);const T0=new D.nKC("angularfire2.storageBucket"),A0=new D.nKC("angularfire2.storage.maxUploadRetryTime"),w0=new D.nKC("angularfire2.storage.maxOperationRetryTime"),R0=new D.nKC("angularfire2.storage.use-emulator");let P0=(()=>{var n;class e{constructor(r,i,s,o,c,d,f,g,y,v){(0,I.A)(this,"storage",void 0);const w=(0,Re.iB)(r,c,i);this.storage=(0,Re.BM)(`${w.name}.storage.${s}`,"AngularFireStorage",w.name,()=>{const N=c.runOutsideAngular(()=>w.storage(s||void 0)),F=y;return F&&N.useEmulator(...F),f&&N.setMaxUploadRetryTime(f),g&&N.setMaxOperationRetryTime(g),N},[f,g])}ref(r){return vh(this.storage.ref(r))}refFromURL(r){return vh(this.storage.refFromURL(r))}upload(r,i,s){return vh(this.storage.ref(r)).put(i,s)}}return n=e,(0,I.A)(e,"\u0275fac",function(r){return new(r||n)(D.KVO(Re.rx),D.KVO(Re.uP,8),D.KVO(T0,8),D.KVO(D.Agw),D.KVO(D.SKi),D.KVO(ue.u0),D.KVO(A0,8),D.KVO(w0,8),D.KVO(R0,8),D.KVO(ue.Jv,8))}),(0,I.A)(e,"\u0275prov",D.jDH({token:n,factory:n.\u0275fac,providedIn:"any"})),e})(),S0=(()=>{var n;class e{constructor(){this.auth=(0,D.WQX)(x),this.firestore=(0,D.WQX)(MT),this.utils=(0,D.WQX)(FT.T),this.storage=(0,D.WQX)(P0)}signIn(r){return(0,B.x9)((0,B.xI)(),r.email,r.password)}signUp(r){return(0,B.eJ)((0,B.xI)(),r.email,r.password)}updateProfile(r){return(0,B.r7)((0,B.xI)().currentUser,{displayName:r})}sendRecoveryEmail(r){return(0,B.J1)((0,B.xI)(),r)}setDocument(r,i){return gT(Ep(il(),r),i)}signOut(){(0,B.xI)().signOut(),localStorage.removeItem("user"),this.utils.routerLink("/auth")}getUserInfo(r){var i=this;return(0,m.A)(function*(){return i.getDocument(`users/${r}`)})()}getCollectionData(r,i){const s=V_(il(),r);return fT(s,...i),{idField:"id"}}updateDocument(r,i){return _T(Ep(il(),r),i)}getDocument(r){return(0,m.A)(function*(){return(yield mT(Ep(il(),r))).data()})()}addDocument(r,i){return pT(V_(il(),r),i)}uploadImage(r,i){return(0,m.A)(function*(){return a0(Ia(yh(),r),i,"data_url").then(()=>xy(Ia(yh(),r)))})()}getFilePath(r){return(0,m.A)(function*(){return Ia(yh(),r).fullPath})()}deleteFile(r){return Dy(Ia(yh(),r))}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})()},5265:(ai,Ut,q)=>{q.d(Ut,{T:()=>ui});var m=q(467),D=q(4438),I=q(4964);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var Ke=function(z){return z.Unimplemented="UNIMPLEMENTED",z.Unavailable="UNAVAILABLE",z}(Ke||{});class ge extends Error{constructor(R,x,U){super(R),this.message=R,this.code=x,this.data=U}}const vn=z=>{var R,x,U,B,W;const re=z.CapacitorCustomPlatform||null,J=z.Capacitor||{},pe=J.Plugins=J.Plugins||{},de=z.CapacitorPlatforms,Vt=(null===(R=null==de?void 0:de.currentPlatform)||void 0===R?void 0:R.getPlatform)||(()=>null!==re?re.name:(z=>{var R,x;return null!=z&&z.androidBridge?"android":null!==(x=null===(R=null==z?void 0:z.webkit)||void 0===R?void 0:R.messageHandlers)&&void 0!==x&&x.bridge?"ios":"web"})(z)),$=(null===(x=null==de?void 0:de.currentPlatform)||void 0===x?void 0:x.isNativePlatform)||(()=>"web"!==Vt()),ae=(null===(U=null==de?void 0:de.currentPlatform)||void 0===U?void 0:U.isPluginAvailable)||(_e=>{const Ne=Kn.get(_e);return!!(null!=Ne&&Ne.platforms.has(Vt())||Ze(_e))}),Ze=(null===(B=null==de?void 0:de.currentPlatform)||void 0===B?void 0:B.getPluginHeader)||(_e=>{var Ne;return null===(Ne=J.PluginHeaders)||void 0===Ne?void 0:Ne.find(be=>be.name===_e)}),Kn=new Map,zn=(null===(W=null==de?void 0:de.currentPlatform)||void 0===W?void 0:W.registerPlugin)||((_e,Ne={})=>{const be=Kn.get(_e);if(be)return console.warn(`Capacitor plugin "${_e}" already registered. Cannot register plugins twice.`),be.proxy;const Qe=Vt(),wn=Ze(_e);let Ot;const Gn=function(){var Pe=(0,m.A)(function*(){return!Ot&&Qe in Ne?Ot=Ot="function"==typeof Ne[Qe]?yield Ne[Qe]():Ne[Qe]:null!==re&&!Ot&&"web"in Ne&&(Ot=Ot="function"==typeof Ne.web?yield Ne.web():Ne.web),Ot});return function(){return Pe.apply(this,arguments)}}(),Je=Pe=>{let Me;const Ct=(...It)=>{const Bt=Gn().then(pt=>{const rn=((Pe,Me)=>{var Ct,It;if(!wn){if(Pe)return null===(It=Pe[Me])||void 0===It?void 0:It.bind(Pe);throw new ge(`"${_e}" plugin is not implemented on ${Qe}`,Ke.Unimplemented)}{const Bt=null==wn?void 0:wn.methods.find(pt=>Me===pt.name);if(Bt)return"promise"===Bt.rtype?pt=>J.nativePromise(_e,Me.toString(),pt):(pt,rn)=>J.nativeCallback(_e,Me.toString(),pt,rn);if(Pe)return null===(Ct=Pe[Me])||void 0===Ct?void 0:Ct.bind(Pe)}})(pt,Pe);if(rn){const ar=rn(...It);return Me=null==ar?void 0:ar.remove,ar}throw new ge(`"${_e}.${Pe}()" is not implemented on ${Qe}`,Ke.Unimplemented)});return"addListener"===Pe&&(Bt.remove=(0,m.A)(function*(){return Me()})),Bt};return Ct.toString=()=>`${Pe.toString()}() { [capacitor code] }`,Object.defineProperty(Ct,"name",{value:Pe,writable:!1,configurable:!1}),Ct},Le=Je("addListener"),$t=Je("removeListener"),Dn=(Pe,Me)=>{const Ct=Le({eventName:Pe},Me),It=function(){var pt=(0,m.A)(function*(){const rn=yield Ct;$t({eventName:Pe,callbackId:rn},Me)});return function(){return pt.apply(this,arguments)}}(),Bt=new Promise(pt=>Ct.then(()=>pt({remove:It})));return Bt.remove=(0,m.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield It()}),Bt},Lt=new Proxy({},{get(Pe,Me){switch(Me){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return wn?Dn:Le;case"removeListener":return $t;default:return Je(Me)}}});return pe[_e]=Lt,Kn.set(_e,{name:_e,proxy:Lt,platforms:new Set([...Object.keys(Ne),...wn?[Qe]:[]])}),Lt});return J.convertFileSrc||(J.convertFileSrc=_e=>_e),J.getPlatform=Vt,J.handleError=_e=>z.console.error(_e),J.isNativePlatform=$,J.isPluginAvailable=ae,J.pluginMethodNoop=(_e,Ne,be)=>Promise.reject(`${be} does not have an implementation of "${Ne}".`),J.registerPlugin=zn,J.Exception=ge,J.DEBUG=!!J.DEBUG,J.isLoggingEnabled=!!J.isLoggingEnabled,J.platform=J.getPlatform(),J.isNative=J.isNativePlatform(),J},En=(z=>z.Capacitor=vn(z))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Tn=En.registerPlugin;class ze{constructor(R){this.listeners={},this.retainedEventArguments={},this.windowListeners={},R&&(console.warn(`Capacitor WebPlugin "${R.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=R)}addListener(R,x){var U=this;let B=!1;this.listeners[R]||(this.listeners[R]=[],B=!0),this.listeners[R].push(x);const re=this.windowListeners[R];re&&!re.registered&&this.addWindowListener(re),B&&this.sendRetainedArgumentsForEvent(R);const J=function(){var de=(0,m.A)(function*(){return U.removeListener(R,x)});return function(){return de.apply(this,arguments)}}();return Promise.resolve({remove:J})}removeAllListeners(){var R=this;return(0,m.A)(function*(){R.listeners={};for(const x in R.windowListeners)R.removeWindowListener(R.windowListeners[x]);R.windowListeners={}})()}notifyListeners(R,x,U){const B=this.listeners[R];if(B)B.forEach(W=>W(x));else if(U){let W=this.retainedEventArguments[R];W||(W=[]),W.push(x),this.retainedEventArguments[R]=W}}hasListeners(R){return!!this.listeners[R].length}registerWindowListener(R,x){this.windowListeners[x]={registered:!1,windowEventName:R,pluginEventName:x,handler:U=>{this.notifyListeners(x,U)}}}unimplemented(R="not implemented"){return new En.Exception(R,Ke.Unimplemented)}unavailable(R="not available"){return new En.Exception(R,Ke.Unavailable)}removeListener(R,x){var U=this;return(0,m.A)(function*(){const B=U.listeners[R];if(!B)return;const W=B.indexOf(x);U.listeners[R].splice(W,1),U.listeners[R].length||U.removeWindowListener(U.windowListeners[R])})()}addWindowListener(R){window.addEventListener(R.windowEventName,R.handler),R.registered=!0}removeWindowListener(R){R&&(window.removeEventListener(R.windowEventName,R.handler),R.registered=!1)}sendRetainedArgumentsForEvent(R){const x=this.retainedEventArguments[R];x&&(delete this.retainedEventArguments[R],x.forEach(U=>{this.notifyListeners(R,U)}))}}const Oe=z=>encodeURIComponent(z).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),qe=z=>z.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class tn extends ze{getCookies(){return(0,m.A)(function*(){const R=document.cookie,x={};return R.split(";").forEach(U=>{if(U.length<=0)return;let[B,W]=U.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");B=qe(B).trim(),W=qe(W).trim(),x[B]=W}),x})()}setCookie(R){return(0,m.A)(function*(){try{const x=Oe(R.key),U=Oe(R.value),B=`; expires=${(R.expires||"").replace("expires=","")}`,W=(R.path||"/").replace("path=",""),re=null!=R.url&&R.url.length>0?`domain=${R.url}`:"";document.cookie=`${x}=${U||""}${B}; path=${W}; ${re};`}catch(x){return Promise.reject(x)}})()}deleteCookie(R){return(0,m.A)(function*(){try{document.cookie=`${R.key}=; Max-Age=0`}catch(x){return Promise.reject(x)}})()}clearCookies(){return(0,m.A)(function*(){try{const R=document.cookie.split(";")||[];for(const x of R)document.cookie=x.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(R){return Promise.reject(R)}})()}clearAllCookies(){var R=this;return(0,m.A)(function*(){try{yield R.clearCookies()}catch(x){return Promise.reject(x)}})()}}Tn("CapacitorCookies",{web:()=>new tn});const nn=function(){var z=(0,m.A)(function*(R){return new Promise((x,U)=>{const B=new FileReader;B.onload=()=>{const W=B.result;x(W.indexOf(",")>=0?W.split(",")[1]:W)},B.onerror=W=>U(W),B.readAsDataURL(R)})});return function(x){return z.apply(this,arguments)}}();class bt extends ze{request(R){return(0,m.A)(function*(){const x=((z,R={})=>{const x=Object.assign({method:z.method||"GET",headers:z.headers},R),B=((z={})=>{const R=Object.keys(z);return Object.keys(z).map(B=>B.toLocaleLowerCase()).reduce((B,W,re)=>(B[W]=z[R[re]],B),{})})(z.headers)["content-type"]||"";if("string"==typeof z.data)x.body=z.data;else if(B.includes("application/x-www-form-urlencoded")){const W=new URLSearchParams;for(const[re,J]of Object.entries(z.data||{}))W.set(re,J);x.body=W.toString()}else if(B.includes("multipart/form-data")||z.data instanceof FormData){const W=new FormData;if(z.data instanceof FormData)z.data.forEach((J,pe)=>{W.append(pe,J)});else for(const J of Object.keys(z.data))W.append(J,z.data[J]);x.body=W;const re=new Headers(x.headers);re.delete("content-type"),x.headers=re}else(B.includes("application/json")||"object"==typeof z.data)&&(x.body=JSON.stringify(z.data));return x})(R,R.webFetchExtra),U=((z,R=!0)=>z?Object.entries(z).reduce((U,B)=>{const[W,re]=B;let J,pe;return Array.isArray(re)?(pe="",re.forEach(de=>{J=R?encodeURIComponent(de):de,pe+=`${W}=${J}&`}),pe.slice(0,-1)):(J=R?encodeURIComponent(re):re,pe=`${W}=${J}`),`${U}&${pe}`},"").substr(1):null)(R.params,R.shouldEncodeUrlParams),B=U?`${R.url}?${U}`:R.url,W=yield fetch(B,x),re=W.headers.get("content-type")||"";let pe,de,{responseType:J="text"}=W.ok?R:{};switch(re.includes("application/json")&&(J="json"),J){case"arraybuffer":case"blob":de=yield W.blob(),pe=yield nn(de);break;case"json":pe=yield W.json();break;default:pe=yield W.text()}const oe={};return W.headers.forEach((Vt,ct)=>{oe[ct]=Vt}),{data:pe,headers:oe,status:W.status,url:W.url}})()}get(R){var x=this;return(0,m.A)(function*(){return x.request(Object.assign(Object.assign({},R),{method:"GET"}))})()}post(R){var x=this;return(0,m.A)(function*(){return x.request(Object.assign(Object.assign({},R),{method:"POST"}))})()}put(R){var x=this;return(0,m.A)(function*(){return x.request(Object.assign(Object.assign({},R),{method:"PUT"}))})()}patch(R){var x=this;return(0,m.A)(function*(){return x.request(Object.assign(Object.assign({},R),{method:"PATCH"}))})()}delete(R){var x=this;return(0,m.A)(function*(){return x.request(Object.assign(Object.assign({},R),{method:"DELETE"}))})()}}Tn("CapacitorHttp",{web:()=>new bt});var Gt=function(z){return z.Prompt="PROMPT",z.Camera="CAMERA",z.Photos="PHOTOS",z}(Gt||{}),rr=function(z){return z.Rear="REAR",z.Front="FRONT",z}(rr||{}),qn=function(z){return z.Uri="uri",z.Base64="base64",z.DataUrl="dataUrl",z}(qn||{});class Pr extends ze{getPhoto(R){var x=this;return(0,m.A)(function*(){return new Promise(function(){var U=(0,m.A)(function*(B,W){if(R.webUseInput||R.source===Gt.Photos)x.fileInputExperience(R,B,W);else if(R.source===Gt.Prompt){let re=document.querySelector("pwa-action-sheet");re||(re=document.createElement("pwa-action-sheet"),document.body.appendChild(re)),re.header=R.promptLabelHeader||"Photo",re.cancelable=!1,re.options=[{title:R.promptLabelPhoto||"From Photos"},{title:R.promptLabelPicture||"Take Picture"}],re.addEventListener("onSelection",function(){var J=(0,m.A)(function*(pe){0===pe.detail?x.fileInputExperience(R,B,W):x.cameraExperience(R,B,W)});return function(pe){return J.apply(this,arguments)}}())}else x.cameraExperience(R,B,W)});return function(B,W){return U.apply(this,arguments)}}())})()}pickImages(R){var x=this;return(0,m.A)(function*(){return new Promise(function(){var U=(0,m.A)(function*(B,W){x.multipleFileInputExperience(B,W)});return function(B,W){return U.apply(this,arguments)}}())})()}cameraExperience(R,x,U){var B=this;return(0,m.A)(function*(){if(customElements.get("pwa-camera-modal")){const W=document.createElement("pwa-camera-modal");W.facingMode=R.direction===rr.Front?"user":"environment",document.body.appendChild(W);try{yield W.componentOnReady(),W.addEventListener("onPhoto",function(){var re=(0,m.A)(function*(J){const pe=J.detail;null===pe?U(new ge("User cancelled photos app")):pe instanceof Error?U(pe):x(yield B._getCameraPhoto(pe,R)),W.dismiss(),document.body.removeChild(W)});return function(J){return re.apply(this,arguments)}}()),W.present()}catch{B.fileInputExperience(R,x,U)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),B.fileInputExperience(R,x,U)})()}fileInputExperience(R,x,U){let B=document.querySelector("#_capacitor-camera-input");const W=()=>{var re;null===(re=B.parentNode)||void 0===re||re.removeChild(B)};B||(B=document.createElement("input"),B.id="_capacitor-camera-input",B.type="file",B.hidden=!0,document.body.appendChild(B),B.addEventListener("change",re=>{const J=B.files[0];let pe="jpeg";if("image/png"===J.type?pe="png":"image/gif"===J.type&&(pe="gif"),"dataUrl"===R.resultType||"base64"===R.resultType){const de=new FileReader;de.addEventListener("load",()=>{if("dataUrl"===R.resultType)x({dataUrl:de.result,format:pe});else if("base64"===R.resultType){const oe=de.result.split(",")[1];x({base64String:oe,format:pe})}W()}),de.readAsDataURL(J)}else x({webPath:URL.createObjectURL(J),format:pe}),W()}),B.addEventListener("cancel",re=>{U(new ge("User cancelled photos app")),W()})),B.accept="image/*",B.capture=!0,R.source===Gt.Photos||R.source===Gt.Prompt?B.removeAttribute("capture"):R.direction===rr.Front?B.capture="user":R.direction===rr.Rear&&(B.capture="environment"),B.click()}multipleFileInputExperience(R,x){let U=document.querySelector("#_capacitor-camera-input-multiple");const B=()=>{var W;null===(W=U.parentNode)||void 0===W||W.removeChild(U)};U||(U=document.createElement("input"),U.id="_capacitor-camera-input-multiple",U.type="file",U.hidden=!0,U.multiple=!0,document.body.appendChild(U),U.addEventListener("change",W=>{const re=[];for(let J=0;J<U.files.length;J++){const pe=U.files[J];let de="jpeg";"image/png"===pe.type?de="png":"image/gif"===pe.type&&(de="gif"),re.push({webPath:URL.createObjectURL(pe),format:de})}R({photos:re}),B()}),U.addEventListener("cancel",W=>{x(new ge("User cancelled photos app")),B()})),U.accept="image/*",U.click()}_getCameraPhoto(R,x){return new Promise((U,B)=>{const W=new FileReader,re=R.type.split("/")[1];"uri"===x.resultType?U({webPath:URL.createObjectURL(R),format:re,saved:!1}):(W.readAsDataURL(R),W.onloadend=()=>{const J=W.result;U("dataUrl"===x.resultType?{dataUrl:J,format:re,saved:!1}:{base64String:J.split(",")[1],format:re,saved:!1})},W.onerror=J=>{B(J)})})}checkPermissions(){var R=this;return(0,m.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw R.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw R.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var R=this;return(0,m.A)(function*(){throw R.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var R=this;return(0,m.A)(function*(){throw R.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var R=this;return(0,m.A)(function*(){throw R.unavailable("Not implemented on web.")})()}}new Pr;const ir=Tn("Camera",{web:()=>new Pr});var Cn=q(1075);let ui=(()=>{var z;class R{constructor(){this.loadingController=(0,D.WQX)(Cn.Xi),this.toastController=(0,D.WQX)(Cn.K_),this.router=(0,D.WQX)(I.Ix),this.modalController=(0,D.WQX)(Cn.W3)}loading(){return this.loadingController.create({message:"Loading..."})}showToast(U){var B=this;return(0,m.A)(function*(){(yield B.toastController.create(U)).present()})()}routerLink(U){return this.router.navigateByUrl(U)}saveInLocalStorage(U,B){return localStorage.setItem(U,JSON.stringify(B))}getFromLocalStorage(U){return JSON.parse(localStorage.getItem(U))}presentModal(U){var B=this;return(0,m.A)(function*(){yield(yield B.modalController.create(U)).present()})()}dismissModal(U){return this.modalController.dismiss(U)}takePicture(U){return(0,m.A)(function*(){return yield ir.getPhoto({quality:90,allowEditing:!0,resultType:qn.DataUrl,source:Gt.Prompt,promptLabelHeader:U,promptLabelPicture:"Toma una foto :3",promptLabelPhoto:"Selecciona una imagen :3"})})()}}return(z=R).\u0275fac=function(U){return new(U||z)},z.\u0275prov=D.jDH({token:z,factory:z.\u0275fac,providedIn:"root"}),R})()},3683:(ai,Ut,q)=>{q.d(Ut,{H:()=>ue});var m=q(4438),D=q(177),I=q(1075),me=q(4341);function Kt(Re,ke){if(1&Re){const Be=m.RV6();m.j41(0,"ion-button",4),m.bIt("click",function(){m.eBV(Be);const ge=m.XpG();return m.Njj(ge.showOrHidePassword())}),m.nrm(1,"ion-icon",5),m.k0s()}if(2&Re){const Be=m.XpG();m.R7$(),m.Y8G("name",Be.hide?"eye-outline":"eye-off-outline")}}let ue=(()=>{var Re;class ke{constructor(){this.disabled=!1,this.hide=!0}ngOnInit(){"password"===this.type&&(this.isPassword=!0)}showOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(Re=ke).\u0275fac=function(Ke){return new(Ke||Re)},Re.\u0275cmp=m.VBU({type:Re,selectors:[["app-custom-input"]],inputs:{icon:"icon",type:"type",label:"label",autocomplete:"autocomplete",control:"control",required:"required",disabled:"disabled"},decls:4,vars:7,consts:[["lines","none",1,"custom-input"],["color","primary","slot","start",3,"icon","name"],["labelPlacement","floating",3,"type","label","autocomplete","formControl"],["expand","block","fill","clear","shape","round","slot","end",3,"click",4,"ngIf"],["expand","block","fill","clear","shape","round","slot","end",3,"click"],["slot","icon-only",3,"name"]],template:function(Ke,ge){1&Ke&&(m.j41(0,"ion-item",0),m.nrm(1,"ion-icon",1)(2,"ion-input",2),m.DNE(3,Kt,2,1,"ion-button",3),m.k0s()),2&Ke&&(m.R7$(),m.Y8G("icon",ge.icon)("name",ge.icon),m.R7$(),m.Y8G("type",ge.type)("label",ge.label)("autocomplete",ge.autocomplete)("formControl",ge.control),m.R7$(),m.Y8G("ngIf",ge.isPassword))},dependencies:[D.bT,I.Jm,I.iq,I.$w,I.uz,I.Gw,me.BC,me.l_]}),ke})()},9381:(ai,Ut,q)=>{q.d(Ut,{l:()=>Re});var m=q(4438),D=q(5265),I=q(177),me=q(1075);function Kt(ke,Be){if(1&ke){const Ke=m.RV6();m.j41(0,"ion-button",6),m.bIt("click",function(){m.eBV(Ke);const fn=m.XpG();return m.Njj(fn.dismissModal())}),m.nrm(1,"ion-icon",7),m.k0s()}}function ue(ke,Be){1&ke&&m.nrm(0,"ion-menu-button",8)}let Re=(()=>{var ke;class Be{constructor(){this.utilsSrv=(0,m.WQX)(D.T)}ngOnInit(){}dismissModal(){this.utilsSrv.dismissModal()}}return(ke=Be).\u0275fac=function(ge){return new(ge||ke)},ke.\u0275cmp=m.VBU({type:ke,selectors:[["app-header"]],inputs:{title:"title",isModal:"isModal",showMenu:"showMenu"},decls:10,vars:3,consts:[[1,"ion-no-border"],["color","primary"],["slot","start"],[3,"click",4,"ngIf"],["menu","menu-content",4,"ngIf"],[1,"admin"],[3,"click"],["slot","start","name","close-circle-outline"],["menu","menu-content"]],template:function(ge,fn){1&ge&&(m.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),m.DNE(3,Kt,2,0,"ion-button",3)(4,ue,1,0,"ion-menu-button",4),m.k0s(),m.j41(5,"ion-title")(6,"strong"),m.EFF(7),m.k0s(),m.j41(8,"div",5),m.EFF(9,"A D M I N :3"),m.k0s()()()()),2&ge&&(m.R7$(3),m.Y8G("ngIf",fn.isModal),m.R7$(),m.Y8G("ngIf",fn.showMenu),m.R7$(3),m.JRh(fn.title))},dependencies:[I.bT,me.Jm,me.QW,me.eU,me.iq,me.MC,me.BC,me.ai],styles:[".admin[_ngcontent-%COMP%]{font-size:15px}"]}),Be})()},3887:(ai,Ut,q)=>{q.d(Ut,{G:()=>Kt});var m=q(177),D=q(1075),I=q(4341),me=q(4438);let Kt=(()=>{var ue;class Re{}return(ue=Re).\u0275fac=function(Be){return new(Be||ue)},ue.\u0275mod=me.$C({type:ue}),ue.\u0275inj=me.G2t({imports:[m.MD,D.bv,I.X1,I.YN,I.X1,I.YN]}),Re})()},7440:(ai,Ut,q)=>{q.d(Ut,{XU:()=>I}),q(2214),q(4438);class I{constructor(Oe){return Oe}}},2438:(ai,Ut,q)=>{q.r(Ut);var m=q(467),D=q(3345),I=q(8407),me=q(1076),Re=(q(7852),q(8041),q(1362));function ke(){return window}function ge(){return ge=(0,m.A)(function*(C,A,E){var k;const{BuildInfo:Y}=ke();(0,I.au)(A.sessionId,"AuthEvent did not contain a session ID");const le=yield function St(C){return ze.apply(this,arguments)}(A.sessionId),Ae={};return(0,I.av)()?Ae.ibi=Y.packageName:(0,I.aw)()?Ae.apn=Y.packageName:(0,I.ax)(C,"operation-not-supported-in-this-environment"),Y.displayName&&(Ae.appDisplayName=Y.displayName),Ae.sessionId=le,(0,I.ay)(C,E,A.type,void 0,null!==(k=A.eventId)&&void 0!==k?k:void 0,Ae)}),ge.apply(this,arguments)}function vn(){return(vn=(0,m.A)(function*(C){const{BuildInfo:A}=ke(),E={};(0,I.av)()?E.iosBundleId=A.packageName:(0,I.aw)()?E.androidPackageName=A.packageName:(0,I.ax)(C,"operation-not-supported-in-this-environment"),yield(0,I.az)(C,E)})).apply(this,arguments)}function Tn(){return(Tn=(0,m.A)(function*(C,A,E){const{cordova:k}=ke();let Y=()=>{};try{yield new Promise((le,Ae)=>{let xe=null;function We(){var Ee;le();const jt=null===(Ee=k.plugins.browsertab)||void 0===Ee?void 0:Ee.close;"function"==typeof jt&&jt(),"function"==typeof(null==E?void 0:E.close)&&E.close()}function vt(){xe||(xe=window.setTimeout(()=>{Ae((0,I.aB)(C,"redirect-cancelled-by-user"))},2e3))}function sn(){"visible"===(null==document?void 0:document.visibilityState)&&vt()}A.addPassiveListener(We),document.addEventListener("resume",vt,!1),(0,I.aw)()&&document.addEventListener("visibilitychange",sn,!1),Y=()=>{A.removePassiveListener(We),document.removeEventListener("resume",vt,!1),document.removeEventListener("visibilitychange",sn,!1),xe&&window.clearTimeout(xe)}})}finally{Y()}})).apply(this,arguments)}function ze(){return(ze=(0,m.A)(function*(C){const A=function yt(C){if((0,I.au)(/[0-9a-zA-Z]+/.test(C),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(C);const A=new ArrayBuffer(C.length),E=new Uint8Array(A);for(let k=0;k<C.length;k++)E[k]=C.charCodeAt(k);return E}(C),E=yield crypto.subtle.digest("SHA-256",A);return Array.from(new Uint8Array(E)).map(Y=>Y.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class qe extends I.aD{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(A=>{this.resolveInialized=A})}addPassiveListener(A){this.passiveListeners.add(A)}removePassiveListener(A){this.passiveListeners.delete(A)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(A){return this.resolveInialized(),this.passiveListeners.forEach(E=>E(A)),super.onEvent(A)}initialized(){var A=this;return(0,m.A)(function*(){yield A.initPromise})()}}function nn(C){return bn.apply(this,arguments)}function bn(){return(bn=(0,m.A)(function*(C){const A=yield bt()._get(pn(C));return A&&(yield bt()._remove(pn(C))),A})).apply(this,arguments)}function zt(){const C=[];for(let E=0;E<20;E++){const k=Math.floor(62*Math.random());C.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(k))}return C.join("")}function bt(){return(0,I.aE)(I.b)}function pn(C){return(0,I.aF)("authEvent",C.config.apiKey,C.name)}function qn(C){if(null==C||!C.includes("?"))return{};const[A,...E]=C.split("?");return(0,me.I9)(E.join("?"))}const ir=class Wn{constructor(){this._redirectPersistence=I.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=I.aG,this._overrideRedirectResult=I.aH}_initialize(A){var E=this;return(0,m.A)(function*(){const k=A._key();let Y=E.eventManagers.get(k);return Y||(Y=new qe(A),E.eventManagers.set(k,Y),E.attachCallbackListeners(A,Y)),Y})()}_openPopup(A){(0,I.ax)(A,"operation-not-supported-in-this-environment")}_openRedirect(A,E,k,Y){var le=this;return(0,m.A)(function*(){!function Rr(C){var A,E,k,Y,le,Ae,xe,We,vt,sn;const Ee=ke();(0,I.aC)("function"==typeof(null===(A=null==Ee?void 0:Ee.universalLinks)||void 0===A?void 0:A.subscribe),C,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,I.aC)(typeof(null===(E=null==Ee?void 0:Ee.BuildInfo)||void 0===E?void 0:E.packageName)<"u",C,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,I.aC)("function"==typeof(null===(le=null===(Y=null===(k=null==Ee?void 0:Ee.cordova)||void 0===k?void 0:k.plugins)||void 0===Y?void 0:Y.browsertab)||void 0===le?void 0:le.openUrl),C,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,I.aC)("function"==typeof(null===(We=null===(xe=null===(Ae=null==Ee?void 0:Ee.cordova)||void 0===Ae?void 0:Ae.plugins)||void 0===xe?void 0:xe.browsertab)||void 0===We?void 0:We.isAvailable),C,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,I.aC)("function"==typeof(null===(sn=null===(vt=null==Ee?void 0:Ee.cordova)||void 0===vt?void 0:vt.InAppBrowser)||void 0===sn?void 0:sn.open),C,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(A);const Ae=yield le._initialize(A);yield Ae.initialized(),Ae.resetRedirect(),(0,I.aI)(),yield le._originValidation(A);const xe=function tn(C,A,E=null){return{type:A,eventId:E,urlResponse:null,sessionId:zt(),postBody:null,tenantId:C.tenantId,error:(0,I.aB)(C,"no-auth-event")}}(A,k,Y);yield function ut(C,A){return bt()._set(pn(C),A)}(A,xe);const We=yield function Ke(C,A,E){return ge.apply(this,arguments)}(A,xe,E),vt=yield function Wi(C){const{cordova:A}=ke();return new Promise(E=>{A.plugins.browsertab.isAvailable(k=>{let Y=null;k?A.plugins.browsertab.openUrl(C):Y=A.InAppBrowser.open(C,(0,I.aA)()?"_blank":"_system","location=yes"),E(Y)})})}(We);return function En(C,A,E){return Tn.apply(this,arguments)}(A,Ae,vt)})()}_isIframeWebStorageSupported(A,E){throw new Error("Method not implemented.")}_originValidation(A){const E=A._key();return this.originValidationPromises[E]||(this.originValidationPromises[E]=function fn(C){return vn.apply(this,arguments)}(A)),this.originValidationPromises[E]}attachCallbackListeners(A,E){const{universalLinks:k,handleOpenURL:Y,BuildInfo:le}=ke(),Ae=setTimeout((0,m.A)(function*(){yield nn(A),E.onEvent(Cn())}),500),xe=function(){var sn=(0,m.A)(function*(Ee){clearTimeout(Ae);const jt=yield nn(A);let zi=null;jt&&null!=Ee&&Ee.url&&(zi=function K(C,A){var E,k;const Y=function rr(C){const A=qn(C),E=A.link?decodeURIComponent(A.link):void 0,k=qn(E).link,Y=A.deep_link_id?decodeURIComponent(A.deep_link_id):void 0;return qn(Y).link||Y||k||E||C}(A);if(Y.includes("/__/auth/callback")){const le=qn(Y),Ae=le.firebaseError?function Gt(C){try{return JSON.parse(C)}catch{return null}}(decodeURIComponent(le.firebaseError)):null,xe=null===(k=null===(E=null==Ae?void 0:Ae.code)||void 0===E?void 0:E.split("auth/"))||void 0===k?void 0:k[1],We=xe?(0,I.aB)(xe):null;return We?{type:C.type,eventId:C.eventId,tenantId:C.tenantId,error:We,urlResponse:null,sessionId:null,postBody:null}:{type:C.type,eventId:C.eventId,tenantId:C.tenantId,sessionId:C.sessionId,urlResponse:Y,postBody:null}}return null}(jt,Ee.url)),E.onEvent(zi||Cn())});return function(jt){return sn.apply(this,arguments)}}();typeof k<"u"&&"function"==typeof k.subscribe&&k.subscribe(null,xe);const We=Y,vt=`${le.packageName.toLowerCase()}://`;ke().handleOpenURL=function(){var sn=(0,m.A)(function*(Ee){if(Ee.toLowerCase().startsWith(vt)&&xe({url:Ee}),"function"==typeof We)try{We(Ee)}catch(jt){console.error(jt)}});return function(Ee){return sn.apply(this,arguments)}}()}};function Cn(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,I.aB)("no-auth-event")}}function U(){var C;return(null===(C=null==self?void 0:self.location)||void 0===C?void 0:C.protocol)||null}function W(C=(0,me.ZQ)()){return!("file:"!==U()&&"ionic:"!==U()&&"capacitor:"!==U()||!C.toLowerCase().match(/iphone|ipad|ipod|android/))}function oe(){try{const C=self.localStorage,A=I.aN();if(C)return C.setItem(A,"1"),C.removeItem(A),!function de(C=(0,me.ZQ)()){return function J(){return(0,me.lT)()&&11===(null==document?void 0:document.documentMode)}()||function pe(C=(0,me.ZQ)()){return/Edge\/\d+/.test(C)}(C)}()||(0,me.zW)()}catch{return Vt()&&(0,me.zW)()}return!1}function Vt(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function ct(){return(function B(){return"http:"===U()||"https:"===U()}()||(0,me.sr)()||W())&&!function re(){return(0,me.lV)()||(0,me.Ll)()}()&&oe()&&!Vt()}function $(){return W()&&typeof document<"u"}function ae(){return(ae=(0,m.A)(function*(){return!!$()&&new Promise(C=>{const A=setTimeout(()=>{C(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(A),C(!0)})})})).apply(this,arguments)}const Ze={LOCAL:"local",NONE:"none",SESSION:"session"},An=I.aC,or="persistence";function Sr(C){return zn.apply(this,arguments)}function zn(){return(zn=(0,m.A)(function*(C){yield C._initializationPromise;const A=Ne(),E=I.aF(or,C.config.apiKey,C.name);A&&A.setItem(E,C._getPersistence())})).apply(this,arguments)}function Ne(){var C;try{return(null===(C=function xn(){return typeof window<"u"?window:null}())||void 0===C?void 0:C.sessionStorage)||null}catch{return null}}const be=I.aC;class Qe{constructor(){this.browserResolver=I.aE(I.k),this.cordovaResolver=I.aE(ir),this.underlyingResolver=null,this._redirectPersistence=I.a,this._completeRedirectFn=I.aG,this._overrideRedirectResult=I.aH}_initialize(A){var E=this;return(0,m.A)(function*(){return yield E.selectUnderlyingResolver(),E.assertedUnderlyingResolver._initialize(A)})()}_openPopup(A,E,k,Y){var le=this;return(0,m.A)(function*(){return yield le.selectUnderlyingResolver(),le.assertedUnderlyingResolver._openPopup(A,E,k,Y)})()}_openRedirect(A,E,k,Y){var le=this;return(0,m.A)(function*(){return yield le.selectUnderlyingResolver(),le.assertedUnderlyingResolver._openRedirect(A,E,k,Y)})()}_isIframeWebStorageSupported(A,E){this.assertedUnderlyingResolver._isIframeWebStorageSupported(A,E)}_originValidation(A){return this.assertedUnderlyingResolver._originValidation(A)}get _shouldInitProactively(){return $()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return be(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var A=this;return(0,m.A)(function*(){if(A.underlyingResolver)return;const E=yield function sr(){return ae.apply(this,arguments)}();A.underlyingResolver=E?A.cordovaResolver:A.browserResolver})()}}function wn(C){return C.unwrap()}function Gn(C){return Je(C)}function Je(C){const{_tokenResponse:A}=C instanceof me.g?C.customData:C;if(!A)return null;if(!(C instanceof me.g)&&"temporaryProof"in A&&"phoneNumber"in A)return I.P.credentialFromResult(C);const E=A.providerId;if(!E||E===I.p.PASSWORD)return null;let k;switch(E){case I.p.GOOGLE:k=I.X;break;case I.p.FACEBOOK:k=I.W;break;case I.p.GITHUB:k=I.Y;break;case I.p.TWITTER:k=I.$;break;default:const{oauthIdToken:Y,oauthAccessToken:le,oauthTokenSecret:Ae,pendingToken:xe,nonce:We}=A;return le||Ae||Y||xe?xe?E.startsWith("saml.")?I.aQ._create(E,xe):I.N._fromParams({providerId:E,signInMethod:E,pendingToken:xe,idToken:Y,accessToken:le}):new I.Z(E).credential({idToken:Y,accessToken:le,rawNonce:We}):null}return C instanceof me.g?k.credentialFromError(C):k.credentialFromResult(C)}function Le(C,A){return A.catch(E=>{throw E instanceof me.g&&function $n(C,A){var E;const k=null===(E=A.customData)||void 0===E?void 0:E._tokenResponse;if("auth/multi-factor-auth-required"===(null==A?void 0:A.code))A.resolver=new Lt(C,I.as(C,A));else if(k){const Y=Je(A),le=A;Y&&(le.credential=Y,le.tenantId=k.tenantId||void 0,le.email=k.email||void 0,le.phoneNumber=k.phoneNumber||void 0)}}(C,E),E}).then(E=>{const Y=E.user;return{operationType:E.operationType,credential:Gn(E),additionalUserInfo:I.aq(E),user:Pe.getOrCreate(Y)}})}function $t(C,A){return Dn.apply(this,arguments)}function Dn(){return(Dn=(0,m.A)(function*(C,A){const E=yield A;return{verificationId:E.verificationId,confirm:k=>Le(C,E.confirm(k))}})).apply(this,arguments)}class Lt{constructor(A,E){this.resolver=E,this.auth=function Ot(C){return C.wrapped()}(A)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(A){return Le(wn(this.auth),this.resolver.resolveSignIn(A))}}class Pe{constructor(A){this._delegate=A,this.multiFactor=I.at(A)}static getOrCreate(A){return Pe.USER_MAP.has(A)||Pe.USER_MAP.set(A,new Pe(A)),Pe.USER_MAP.get(A)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(A){return this._delegate.getIdTokenResult(A)}getIdToken(A){return this._delegate.getIdToken(A)}linkAndRetrieveDataWithCredential(A){return this.linkWithCredential(A)}linkWithCredential(A){var E=this;return(0,m.A)(function*(){return Le(E.auth,I.a2(E._delegate,A))})()}linkWithPhoneNumber(A,E){var k=this;return(0,m.A)(function*(){return $t(k.auth,I.l(k._delegate,A,E))})()}linkWithPopup(A){var E=this;return(0,m.A)(function*(){return Le(E.auth,I.d(E._delegate,A,Qe))})()}linkWithRedirect(A){var E=this;return(0,m.A)(function*(){return yield Sr(I.aJ(E.auth)),I.g(E._delegate,A,Qe)})()}reauthenticateAndRetrieveDataWithCredential(A){return this.reauthenticateWithCredential(A)}reauthenticateWithCredential(A){var E=this;return(0,m.A)(function*(){return Le(E.auth,I.a3(E._delegate,A))})()}reauthenticateWithPhoneNumber(A,E){return $t(this.auth,I.r(this._delegate,A,E))}reauthenticateWithPopup(A){return Le(this.auth,I.e(this._delegate,A,Qe))}reauthenticateWithRedirect(A){var E=this;return(0,m.A)(function*(){return yield Sr(I.aJ(E.auth)),I.h(E._delegate,A,Qe)})()}sendEmailVerification(A){return I.ag(this._delegate,A)}unlink(A){var E=this;return(0,m.A)(function*(){return yield I.ap(E._delegate,A),E})()}updateEmail(A){return I.al(this._delegate,A)}updatePassword(A){return I.am(this._delegate,A)}updatePhoneNumber(A){return I.u(this._delegate,A)}updateProfile(A){return I.ak(this._delegate,A)}verifyBeforeUpdateEmail(A,E){return I.ah(this._delegate,A,E)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Pe.USER_MAP=new WeakMap;const Me=I.aC;let Ct=(()=>{class C{constructor(E,k){if(this.app=E,k.isInitialized())return this._delegate=k.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:Y}=E.options;Me(Y,"invalid-api-key",{appName:E.name}),Me(Y,"invalid-api-key",{appName:E.name});const le=typeof window<"u"?Qe:void 0;this._delegate=k.initialize({options:{persistence:Bt(Y,E.name),popupRedirectResolver:le}}),this._delegate._updateErrorMap(I.G),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Pe.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(E){this._delegate.languageCode=E}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(E){this._delegate.tenantId=E}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(E,k){I.K(this._delegate,E,k)}applyActionCode(E){return I.a7(this._delegate,E)}checkActionCode(E){return I.a8(this._delegate,E)}confirmPasswordReset(E,k){return I.a6(this._delegate,E,k)}createUserWithEmailAndPassword(E,k){var Y=this;return(0,m.A)(function*(){return Le(Y._delegate,I.aa(Y._delegate,E,k))})()}fetchProvidersForEmail(E){return this.fetchSignInMethodsForEmail(E)}fetchSignInMethodsForEmail(E){return I.af(this._delegate,E)}isSignInWithEmailLink(E){return I.ad(this._delegate,E)}getRedirectResult(){var E=this;return(0,m.A)(function*(){Me(ct(),E._delegate,"operation-not-supported-in-this-environment");const k=yield I.j(E._delegate,Qe);return k?Le(E._delegate,Promise.resolve(k)):{credential:null,user:null}})()}addFrameworkForLogging(E){!function ui(C,A){(0,I.aJ)(C)._logFramework(A)}(this._delegate,E)}onAuthStateChanged(E,k,Y){const{next:le,error:Ae,complete:xe}=It(E,k,Y);return this._delegate.onAuthStateChanged(le,Ae,xe)}onIdTokenChanged(E,k,Y){const{next:le,error:Ae,complete:xe}=It(E,k,Y);return this._delegate.onIdTokenChanged(le,Ae,xe)}sendSignInLinkToEmail(E,k){return I.ac(this._delegate,E,k)}sendPasswordResetEmail(E,k){return I.a5(this._delegate,E,k||void 0)}setPersistence(E){var k=this;return(0,m.A)(function*(){let Y;switch(function Kn(C,A){An(Object.values(Ze).includes(A),C,"invalid-persistence-type"),(0,me.lV)()?An(A!==Ze.SESSION,C,"unsupported-persistence-type"):(0,me.Ll)()?An(A===Ze.NONE,C,"unsupported-persistence-type"):Vt()?An(A===Ze.NONE||A===Ze.LOCAL&&(0,me.zW)(),C,"unsupported-persistence-type"):An(A===Ze.NONE||oe(),C,"unsupported-persistence-type")}(k._delegate,E),E){case Ze.SESSION:Y=I.a;break;case Ze.LOCAL:Y=(yield I.aE(I.i)._isAvailable())?I.i:I.b;break;case Ze.NONE:Y=I.U;break;default:return I.ax("argument-error",{appName:k._delegate.name})}return k._delegate.setPersistence(Y)})()}signInAndRetrieveDataWithCredential(E){return this.signInWithCredential(E)}signInAnonymously(){return Le(this._delegate,I.a0(this._delegate))}signInWithCredential(E){return Le(this._delegate,I.a1(this._delegate,E))}signInWithCustomToken(E){return Le(this._delegate,I.a4(this._delegate,E))}signInWithEmailAndPassword(E,k){return Le(this._delegate,I.ab(this._delegate,E,k))}signInWithEmailLink(E,k){return Le(this._delegate,I.ae(this._delegate,E,k))}signInWithPhoneNumber(E,k){return $t(this._delegate,I.s(this._delegate,E,k))}signInWithPopup(E){var k=this;return(0,m.A)(function*(){return Me(ct(),k._delegate,"operation-not-supported-in-this-environment"),Le(k._delegate,I.c(k._delegate,E,Qe))})()}signInWithRedirect(E){var k=this;return(0,m.A)(function*(){return Me(ct(),k._delegate,"operation-not-supported-in-this-environment"),yield Sr(k._delegate),I.f(k._delegate,E,Qe)})()}updateCurrentUser(E){return this._delegate.updateCurrentUser(E)}verifyPasswordResetCode(E){return I.a9(this._delegate,E)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return C.Persistence=Ze,C})();function It(C,A,E){let k=C;"function"!=typeof C&&({next:k,error:A,complete:E}=C);const Y=k;return{next:Ae=>Y(Ae&&Pe.getOrCreate(Ae)),error:A,complete:E}}function Bt(C,A){const E=function _e(C,A){const E=Ne();if(!E)return[];const k=I.aF(or,C,A);switch(E.getItem(k)){case Ze.NONE:return[I.U];case Ze.LOCAL:return[I.i,I.a];case Ze.SESSION:return[I.a];default:return[]}}(C,A);if(typeof self<"u"&&!E.includes(I.i)&&E.push(I.i),typeof window<"u")for(const k of[I.b,I.a])E.includes(k)||E.push(k);return E.includes(I.U)||E.push(I.U),E}class pt{constructor(){this.providerId="phone",this._delegate=new I.P(wn(D.A.auth()))}static credential(A,E){return I.P.credential(A,E)}verifyPhoneNumber(A,E){return this._delegate.verifyPhoneNumber(A,E)}unwrap(){return this._delegate}}pt.PHONE_SIGN_IN_METHOD=I.P.PHONE_SIGN_IN_METHOD,pt.PROVIDER_ID=I.P.PROVIDER_ID;const rn=I.aC;class ar{constructor(A,E,k=D.A.app()){var Y;rn(null===(Y=k.options)||void 0===Y?void 0:Y.apiKey,"invalid-api-key",{appName:k.name}),this._delegate=new I.R(k.auth(),A,E),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Ki(C){C.INTERNAL.registerComponent(new Re.uA("auth-compat",A=>{const E=A.getProvider("app-compat").getImmediate(),k=A.getProvider("auth");return new Ct(E,k)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:I.A.EMAIL_SIGNIN,PASSWORD_RESET:I.A.PASSWORD_RESET,RECOVER_EMAIL:I.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:I.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:I.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:I.A.VERIFY_EMAIL}},EmailAuthProvider:I.V,FacebookAuthProvider:I.W,GithubAuthProvider:I.Y,GoogleAuthProvider:I.X,OAuthProvider:I.Z,SAMLAuthProvider:I._,PhoneAuthProvider:pt,PhoneMultiFactorGenerator:I.m,RecaptchaVerifier:ar,TwitterAuthProvider:I.$,Auth:Ct,AuthCredential:I.L,Error:me.g}).setInstantiationMode("LAZY").setMultipleInstances(!1)),C.registerVersion("@firebase/auth-compat","0.5.7")}(D.A)}}]);